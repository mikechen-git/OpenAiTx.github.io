<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MiniExcel - mini-software/MiniExcel</title>
    <meta name="title" content="MiniExcel - mini-software/MiniExcel">
    <meta name="description" content="mini-software/MiniExcel - GitHub repository vi documentation and informationDự án này là một phần của .NET Foundation và tuân theo quy tắc ứng xử của họ. English | 简体中文 | 繁體中文 Ngôi sao Star và ủng hộ Donate của bạn sẽ giúp MiniExcel phá...">
    <meta name="keywords" content="mini-software, MiniExcel, GitHub, repository, vi documentation">
    <meta name="author" content="Open AI Tx">
    <meta name="robots" content="index, follow">
    <meta property="og:type" content="website">
    <meta property="og:url" content="https://openaitx.github.io/projects/mini-software/MiniExcel/README-vi.html">
    <meta property="og:title" content="MiniExcel - mini-software/MiniExcel">
    <meta property="og:description" content="mini-software/MiniExcel - GitHub repository vi documentation and information">
    <meta property="og:image" content="https://openaitx.github.io/logo_crop.png">
    <link rel="icon" type="image/jpeg" href="/icon.jpg">
    <link rel="apple-touch-icon" href="/icon.jpg">
    <script src="/js/marked.min.js?v=20250613"></script>
    <link rel="stylesheet" href="/css/github.min.css?v=20250613">
    <script src="/js/highlight.min.js?v=20250613"></script>
    <link rel="stylesheet" href="/view.css?v=20250613">
    <style>
        body { display: flex; flex-direction: column; min-height: 100vh; }
        .main-container { margin: 0 auto; width: 100%; max-width: 980px; padding: 0 20px; }
        @media (max-width: 768px) { .main-container { padding: 0 15px; } }
        .markdown-body img { max-width: 100%; height: auto; }
        .header { text-align: center; margin-bottom: 30px; padding: 20px; background-color: #f6f8fa; border-bottom: 1px solid #e1e4e8; position: relative; }
        .header .links { margin-top: 10px; font-size: 16px; }
        .header .links a { color: #0366d6; text-decoration: none; margin-left: 5px; }
        .header .links a:hover { text-decoration: underline; }
        .language-badges { margin-top: 15px; text-align: center; }
        .language-badges a { display: inline-block; margin: 2px; text-decoration: none; }
        .language-badges img { height: 20px; border-radius: 3px; }
        .language-badges a:hover img { opacity: 0.8; }
    </style>
</head>
<body>
    <div class="header">
        <div class="links">
            GitHub Repository: <a href="https://github.com/mini-software/MiniExcel" id="githubRepoLink" target="_blank">mini-software/MiniExcel</a>
<h1 style="display: none;">Dự án này là một phần của .NET Foundation và tuân theo quy tắc ứng xử của họ. English | 简体中文 | 繁體中文 Ngôi sao Star và ủng hộ Donate của bạn sẽ giúp MiniExcel phá...</h1>
        </div>
        <div class="language-badges" id="languageBadges">
            <!-- You can generate language badges here if needed -->
        </div>
    </div>
    <div class="main-container">
        <div class="markdown-body" id="content">
            <div style="text-align: center">
<p><a href="https://www.nuget.org/packages/MiniExcel"><img src="https://img.shields.io/nuget/v/MiniExcel.svg" alt="NuGet"></a>  <a href="https://www.nuget.org/packages/MiniExcel"><img src="https://img.shields.io/nuget/dt/MiniExcel.svg" alt=""></a>
<a href="https://ci.appveyor.com/project/mini-software/miniexcel/branch/master"><img src="https://ci.appveyor.com/api/projects/status/b2vustrwsuqx45f4/branch/master?svg=true" alt="Build status"></a>
<a href="https://gitee.com/dotnetchina/MiniExcel"><img src="https://gitee.com/dotnetchina/MiniExcel/badge/star.svg" alt="star"></a> <a href="https://github.com/mini-software/MiniExcel" rel="nofollow"><img src="https://img.shields.io/github/stars/mini-software/MiniExcel?logo=github" alt="GitHub stars"></a>
<a href="https://www.nuget.org/packages/MiniExcel"><img src="https://img.shields.io/badge/.NET-%3E%3D%204.5-red.svg" alt="version"></a>
<a href="https://deepwiki.com/mini-software/MiniExcel"><img src="https://deepwiki.com/badge.svg" alt="Ask DeepWiki"></a>
</p>
</div>
<hr />
<p><a href="https://www.dotnetfoundation.org/"><img align="right" src="https://github.com/dotnet-foundation/swag/blob/main/logo/dotnetfoundation_v4.png?raw=true" width="100" /></a></p>
<div style="text-align: center">
<p>Dự án này là một phần của <a href="https://www.dotnetfoundation.org/">.NET Foundation</a> và tuân theo <a href="https://www.dotnetfoundation.org/code-of-conduct">quy tắc ứng xử</a> của họ. </p>
</div>
<hr />
<div style="text-align: center">
<p><strong><a href="README.md">English</a> | <a href="README.zh-CN.md">简体中文</a> | <a href="README.zh-Hant.md">繁體中文</a></strong></p>
</div>
<hr />
<div style="text-align: center">
 Ngôi sao <a href="https://github.com/mini-software/MiniExcel">Star</a> và <a href="https://miniexcel.github.io">ủng hộ Donate</a> của bạn sẽ giúp MiniExcel phát triển tốt hơn
</div>
<hr />
<h3>Giới thiệu</h3>
<p>MiniExcel là công cụ xử lý Excel trên .NET đơn giản và hiệu quả giúp tránh OOM.</p>
<p>Hiện nay, hầu hết các framework phổ biến đều cần tải toàn bộ dữ liệu vào bộ nhớ để dễ thao tác, điều này dẫn đến vấn đề tiêu tốn bộ nhớ. MiniExcel cố gắng sử dụng thuật toán từ luồng (stream) để giảm mức chiếm dụng từ 1000 MB xuống chỉ còn vài MB, tránh hiện tượng OOM (hết bộ nhớ).</p>
<p><img src="https://user-images.githubusercontent.com/12729184/113086657-ab8bd000-9214-11eb-9563-c970ac1ee35e.png" alt="image" /></p>
<h3>Tính năng</h3>
<ul>
<li>Tiêu thụ bộ nhớ thấp, tránh OOM (hết bộ nhớ) và full GC</li>
<li>Hỗ trợ xử lý dữ liệu từng dòng theo thời gian thực</li>
<li>Hỗ trợ thực thi LINQ deferred, cho phép truy vấn phức tạp, phân trang nhanh với mức tiêu thụ thấp</li>
<li>Nhẹ, không cần cài đặt Microsoft Office, không COM+, DLL có kích thước nhỏ hơn 400KB</li>
<li>API dễ sử dụng để đọc/ghi/điền dữ liệu excel</li>
</ul>
<h3>Bắt đầu</h3>
<ul>
<li><p><a href="#getstart1">Nhập/Truy vấn Excel</a></p>
</li>
<li><p><a href="#getstart2">Xuất/Tạo Excel</a></p>
</li>
<li><p><a href="#getstart3">Mẫu Excel Template</a></p>
</li>
<li><p><a href="#getstart4">Tên/Cột/Chỉ số/Cột bị bỏ qua</a></p>
</li>
<li><p><a href="#getstart5">Ví dụ</a></p>
</li>
</ul>
<h3>Cài đặt</h3>
<p>Bạn có thể cài đặt package <a href="https://www.nuget.org/packages/MiniExcel">từ NuGet</a></p>
<h3>Ghi chú phát hành</h3>
<p>Vui lòng xem <a href="docs">Ghi chú phát hành</a></p>
<h3>Công việc cần làm</h3>
<p>Vui lòng xem <a href="https://github.com/mini-software/MiniExcel/projects/1?fullscreen=true">TODO</a></p>
<h3>Hiệu năng</h3>
<p>Mã nguồn cho các benchmark có thể được tìm thấy tại <a href="https://raw.githubusercontent.com/mini-software/MiniExcel/master/benchmarks/MiniExcel.Benchmarks/Program.cs">MiniExcel.Benchmarks</a>.</p>
<p>File dùng để kiểm tra hiệu năng là <a href="https://raw.githubusercontent.com/mini-software/MiniExcel/master/benchmarks/MiniExcel.Benchmarks/Test1%2C000%2C000x10.xlsx"><strong>Test1,000,000x10.xlsx</strong></a>, một tài liệu 32MB chứa 1.000.000 dòng * 10 cột, các ô đều có giá trị &quot;HelloWorld&quot;.</p>
<p>Để chạy tất cả các benchmark, sử dụng:</p>
<pre><code class="language-bash">dotnet run -project .\benchmarks\MiniExcel.Benchmarks -c Release -f net9.0 -filter * --join
</code></pre>
<p>Bạn có thể tìm kết quả benchmark cho bản phát hành mới nhất <a href="https://raw.githubusercontent.com/mini-software/MiniExcel/master/benchmarks/results">tại đây</a>.</p>
<h3>Truy vấn/Nhập Excel  <a name="getstart1"></a></h3>
<h4>1. Thực thi truy vấn và ánh xạ kết quả vào IEnumerable kiểu mạnh <a href="https://dotnetfiddle.net/w5WD1J">[Thử ngay]</a></h4>
<p>Khuyến nghị sử dụng Stream.Query để đạt hiệu quả tốt hơn.</p>
<pre><code class="language-csharp">public class UserAccount
{
    public Guid ID { get; set; }
    public string Name { get; set; }
    public DateTime BoD { get; set; }
    public int Age { get; set; }
    public bool VIP { get; set; }
    public decimal Points { get; set; }
}

var rows = MiniExcel.Query&lt;UserAccount&gt;(path);

// hoặc

using (var stream = File.OpenRead(path))
    var rows = stream.Query&lt;UserAccount&gt;();
</code></pre>
<p><img src="https://user-images.githubusercontent.com/12729184/111107423-c8c46b80-8591-11eb-982f-c97a2dafb379.png" alt="image" /></p>
<h4>2. Thực thi truy vấn và ánh xạ vào danh sách đối tượng động không cần dùng dòng đầu làm tiêu đề <a href="https://dotnetfiddle.net/w5WD1J">[Thử ngay]</a></h4>
<ul>
<li>Khóa dynamic là <code>A.B.C.D..</code></li>
</ul>
<p>| MiniExcel | 1 |
|-----------|---|
| Github    | 2 |</p>
<pre><code class="language-csharp">
var rows = MiniExcel.Query(path).ToList();

// hoặc
using (var stream = File.OpenRead(path))
{
    var rows = stream.Query().ToList();

    Assert.Equal(&quot;MiniExcel&quot;, rows[0].A);
    Assert.Equal(1, rows[0].B);
    Assert.Equal(&quot;Github&quot;, rows[1].A);
    Assert.Equal(2, rows[1].B);
}
</code></pre>
<h4>3. Thực thi truy vấn với dòng đầu tiên là tiêu đề <a href="https://dotnetfiddle.net/w5WD1J">[Thử ngay]</a></h4>
<p>Lưu ý: Nếu trùng tên cột sẽ dùng cột bên phải cuối cùng</p>
<p>Excel đầu vào:</p>
<p>| Column1   | Column2 |
|-----------|---------|
| MiniExcel | 1       |
| Github    | 2       |</p>
<pre><code class="language-csharp">
var rows = MiniExcel.Query(useHeaderRow:true).ToList();

// hoặc

using (var stream = File.OpenRead(path))
{
    var rows = stream.Query(useHeaderRow:true).ToList();

    Assert.Equal(&quot;MiniExcel&quot;, rows[0].Column1);
    Assert.Equal(1, rows[0].Column2);
    Assert.Equal(&quot;Github&quot;, rows[1].Column1);
    Assert.Equal(2, rows[1].Column2);
}
</code></pre>
<h4>4. Truy vấn hỗ trợ LINQ Extension First/Take/Skip ...v.v.</h4>
<p>Truy vấn First</p>
<pre><code class="language-csharp">var row = MiniExcel.Query(path).First();
Assert.Equal(&quot;HelloWorld&quot;, row.A);

// hoặc

using (var stream = File.OpenRead(path))
{
    var row = stream.Query().First();
    Assert.Equal(&quot;HelloWorld&quot;, row.A);
}
</code></pre>
<p>Hiệu năng giữa MiniExcel/ExcelDataReader/ClosedXML/EPPlus
<img src="https://user-images.githubusercontent.com/12729184/111072392-6037a900-8515-11eb-9693-5ce2dad1e460.gif" alt="queryfirst" /></p>
<h4>5. Truy vấn theo tên sheet</h4>
<pre><code class="language-csharp">MiniExcel.Query(path, sheetName: &quot;SheetName&quot;);
//hoặc
stream.Query(sheetName: &quot;SheetName&quot;);
</code></pre>
<h4>6. Truy vấn tất cả tên sheet và dòng dữ liệu</h4>
<pre><code class="language-csharp">var sheetNames = MiniExcel.GetSheetNames(path);
foreach (var sheetName in sheetNames)
{
    var rows = MiniExcel.Query(path, sheetName: sheetName);
}
</code></pre>
<h4>7. Lấy Các Cột</h4>
<pre><code class="language-csharp">var columns = MiniExcel.GetColumns(path); // ví dụ kết quả: [&quot;A&quot;,&quot;B&quot;...]

var cnt = columns.Count;  // lấy số lượng cột
</code></pre>
<h4>8. Dynamic Query ép kiểu dòng sang <code>IDictionary&lt;string,object&gt;</code></h4>
<pre><code class="language-csharp">foreach(IDictionary&lt;string,object&gt; row in MiniExcel.Query(path))
{
    //..
}

// hoặc
var rows = MiniExcel.Query(path).Cast&lt;IDictionary&lt;string,object&gt;&gt;();
// hoặc truy vấn phạm vi chỉ định (viết hoa)
// A2 đại diện cho dòng thứ hai của cột A, C3 đại diện cho dòng thứ ba của cột C
// Nếu bạn không muốn giới hạn dòng, chỉ cần không bao gồm số
var rows = MiniExcel.QueryRange(path, startCell: &quot;A2&quot;, endCell: &quot;C3&quot;).Cast&lt;IDictionary&lt;string, object&gt;&gt;();
</code></pre>
<h4>9. Query Excel trả về DataTable</h4>
<p>Không khuyến nghị, vì DataTable sẽ tải toàn bộ dữ liệu vào bộ nhớ và làm mất tính năng tiêu thụ bộ nhớ thấp của MiniExcel.</p>
<pre><code class="language-C#">var table = MiniExcel.QueryAsDataTable(path, useHeaderRow: true);
</code></pre>
<p><img src="https://user-images.githubusercontent.com/12729184/116673475-07917200-a9d6-11eb-947e-a6f68cce58df.png" alt="image" /></p>
<h4>10. Chỉ định ô bắt đầu đọc dữ liệu</h4>
<pre><code class="language-csharp">MiniExcel.Query(path,useHeaderRow:true,startCell:&quot;B3&quot;)
</code></pre>
<p><img src="https://user-images.githubusercontent.com/12729184/117260316-8593c400-ae81-11eb-9877-c087b7ac2b01.png" alt="image" /></p>
<h4>11. Điền các ô gộp (Merged Cells)</h4>
<p>Lưu ý: Hiệu suất sẽ chậm hơn so với <code>không sử dụng fill merge</code></p>
<p>Lý do: Chuẩn OpenXml đặt mergeCells ở cuối file, dẫn đến việc phải duyệt sheetxml hai lần</p>
<pre><code class="language-csharp">    var config = new OpenXmlConfiguration()
    {
        FillMergedCells = true
    };
    var rows = MiniExcel.Query(path, configuration: config);
</code></pre>
<p><img src="https://user-images.githubusercontent.com/12729184/117973630-3527d500-b35f-11eb-95c3-bde255f8114e.png" alt="image" /></p>
<p>hỗ trợ điền đa hàng và đa cột với chiều dài và chiều rộng biến đổi</p>
<p><img src="https://user-images.githubusercontent.com/12729184/117973820-6d2f1800-b35f-11eb-88d8-555063938108.png" alt="image" /></p>
<h4>12. Đọc file lớn bằng bộ nhớ đệm trên đĩa (Disk-Base Cache - SharedString)</h4>
<p>Nếu kích thước SharedStrings vượt quá 5 MB, MiniExcel mặc định sẽ sử dụng bộ nhớ đệm trên ổ đĩa cục bộ, ví dụ, <a href="https://github.com/MiniExcel/MiniExcel/files/8403819/NotDuplicateSharedStrings_10x100000.xlsx">10x100000.xlsx</a> (một triệu dòng dữ liệu), khi tắt cache ổ đĩa, bộ nhớ tối đa sử dụng là 195MB, nhưng bật cache ổ đĩa chỉ cần 65MB. Lưu ý, tối ưu hóa này sẽ mất một ít hiệu suất, nên trường hợp này thời gian đọc sẽ tăng từ 7.4 giây lên 27.2 giây. Nếu bạn không cần, có thể tắt cache ổ đĩa với đoạn code sau:</p>
<pre><code class="language-csharp">var config = new OpenXmlConfiguration { EnableSharedStringCache = false };
MiniExcel.Query(path,configuration: config)
</code></pre>
<p>Bạn có thể dùng <code>SharedStringCacheSize</code> để thay đổi kích thước file sharedString vượt quá ngưỡng chỉ định cho việc cache trên đĩa.</p>
<pre><code class="language-csharp">var config = new OpenXmlConfiguration { SharedStringCacheSize=500*1024*1024 };
MiniExcel.Query(path, configuration: config);
</code></pre>
<p><img src="https://user-images.githubusercontent.com/12729184/161411851-1c3f72a7-33b3-4944-84dc-ffc1d16747dd.png" alt="image" /></p>
<p><img src="https://user-images.githubusercontent.com/12729184/161411825-17f53ec7-bef4-4b16-b234-e24799ea41b0.png" alt="image" /></p>
<h3>Tạo/Xuất Excel  <a name="getstart2"></a></h3>
<ol>
<li><p>Phải là kiểu không trừu tượng với constructor không tham số công khai.</p>
</li>
<li><p>MiniExcel hỗ trợ tham số IEnumerable Deferred Execution, nếu bạn muốn sử dụng ít bộ nhớ nhất, vui lòng không gọi các phương thức như ToList</p>
</li>
</ol>
<p>ví dụ: ToList hoặc không sử dụng bộ nhớ
<img src="https://user-images.githubusercontent.com/12729184/112587389-752b0b00-8e38-11eb-8a52-cfb76c57e5eb.png" alt="image" /></p>
<h4>1. Ẩn danh hoặc kiểu mạnh <a href="https://dotnetfiddle.net/w5WD1J">[Thử ngay]</a></h4>
<pre><code class="language-csharp">var path = Path.Combine(Path.GetTempPath(), $&quot;{Guid.NewGuid()}.xlsx&quot;);
MiniExcel.SaveAs(path, new[] {
    new { Column1 = &quot;MiniExcel&quot;, Column2 = 1 },
    new { Column1 = &quot;Github&quot;, Column2 = 2}
});
</code></pre>
<h4>2. <code>IEnumerable&lt;IDictionary&lt;string, object&gt;&gt;</code></h4>
<pre><code class="language-csharp">var values = new List&lt;Dictionary&lt;string, object&gt;&gt;()
{
    new Dictionary&lt;string,object&gt;{{ &quot;Column1&quot;, &quot;MiniExcel&quot; }, { &quot;Column2&quot;, 1 } },
    new Dictionary&lt;string,object&gt;{{ &quot;Column1&quot;, &quot;Github&quot; }, { &quot;Column2&quot;, 2 } }
};
MiniExcel.SaveAs(path, values);
</code></pre>
<p>Kết quả File Tạo:</p>
<p>| Column1   | Column2 |
|-----------|---------|
| MiniExcel | 1       |
| Github    | 2       |</p>
<h4>3.  IDataReader</h4>
<ul>
<li><code>Khuyến nghị</code>, có thể tránh tải toàn bộ dữ liệu vào bộ nhớ</li>
</ul>
<pre><code class="language-csharp">MiniExcel.SaveAs(path, reader);
</code></pre>
<p><img src="https://user-images.githubusercontent.com/12729184/121275378-149a5e80-c8bc-11eb-85fe-5453552134f0.png" alt="image" /></p>
<p>DataReader xuất nhiều sheet (được khuyên dùng bởi Dapper ExecuteReader)</p>
<pre><code class="language-csharp">using (var cnn = Connection)
{
    cnn.Open();
    var sheets = new Dictionary&lt;string,object&gt;();
    sheets.Add(&quot;sheet1&quot;, cnn.ExecuteReader(&quot;select 1 id&quot;));
    sheets.Add(&quot;sheet2&quot;, cnn.ExecuteReader(&quot;select 2 id&quot;));
    MiniExcel.SaveAs(&quot;Demo.xlsx&quot;, sheets);
}
</code></pre>
<h4>4. Datatable</h4>
<ul>
<li><p><code>Không khuyến nghị</code>, sẽ tải toàn bộ dữ liệu vào bộ nhớ</p>
</li>
<li><p>DataTable sử dụng Caption cho tên cột trước, sau đó mới dùng columname</p>
</li>
</ul>
<pre><code class="language-csharp">var path = Path.Combine(Path.GetTempPath(), $&quot;{Guid.NewGuid()}.xlsx&quot;);
var table = new DataTable();
{
    table.Columns.Add(&quot;Column1&quot;, typeof(string));
    table.Columns.Add(&quot;Column2&quot;, typeof(decimal));
    table.Rows.Add(&quot;MiniExcel&quot;, 1);
    table.Rows.Add(&quot;Github&quot;, 2);
}

MiniExcel.SaveAs(path, table);
</code></pre>
<h4>5. Dapper Query</h4>
<p>Cảm ơn @shaofing #552, vui lòng sử dụng <code>CommandDefinition + CommandFlags.NoCache</code></p>
<pre><code class="language-csharp">using (var connection = GetConnection(connectionString))
{
    var rows = connection.Query(
        new CommandDefinition(
            @&quot;select 'MiniExcel' as Column1,1 as Column2 union all select 'Github',2&quot;
            , flags: CommandFlags.NoCache)
        );
    // Lưu ý: QueryAsync sẽ throw exception đóng kết nối
    MiniExcel.SaveAs(path, rows);
</code></pre>
<p>}</p>
<pre><code>
Đoạn mã dưới đây sẽ tải tất cả dữ liệu vào bộ nhớ

```csharp
using (var connection = GetConnection(connectionString))
{
    var rows = connection.Query(@&quot;select 'MiniExcel' as Column1,1 as Column2 union all select 'Github',2&quot;);
    MiniExcel.SaveAs(path, rows);
}
</code></pre>
<h4>6. Lưu với MemoryStream  <a href="https://dotnetfiddle.net/JOen0e">[Thử ngay]</a></h4>
<pre><code class="language-csharp">using (var stream = new MemoryStream()) //hỗ trợ FileStream, MemoryStream, v.v.
{
    stream.SaveAs(values);
}
</code></pre>
<p>ví dụ: API xuất excel</p>
<pre><code class="language-csharp">public IActionResult DownloadExcel()
{
    var values = new[] {
        new { Column1 = &quot;MiniExcel&quot;, Column2 = 1 },
        new { Column1 = &quot;Github&quot;, Column2 = 2}
    };

    var memoryStream = new MemoryStream();
    memoryStream.SaveAs(values);
    memoryStream.Seek(0, SeekOrigin.Begin);
    return new FileStreamResult(memoryStream, &quot;application/vnd.openxmlformats-officedocument.spreadsheetml.sheet&quot;)
    {
        FileDownloadName = &quot;demo.xlsx&quot;
    };
}
</code></pre>
<h4>7. Tạo nhiều Sheet</h4>
<pre><code class="language-csharp">// 1. Dictionary&lt;string,object&gt;
var users = new[] { new { Name = &quot;Jack&quot;, Age = 25 }, new { Name = &quot;Mike&quot;, Age = 44 } };
var department = new[] { new { ID = &quot;01&quot;, Name = &quot;HR&quot; }, new { ID = &quot;02&quot;, Name = &quot;IT&quot; } };
var sheets = new Dictionary&lt;string, object&gt;
{
    [&quot;users&quot;] = users,
    [&quot;department&quot;] = department
};
MiniExcel.SaveAs(path, sheets);

// 2. DataSet
var sheets = new DataSet();
sheets.Add(UsersDataTable);
sheets.Add(DepartmentDataTable);
//..
MiniExcel.SaveAs(path, sheets);
</code></pre>
<p><img src="https://user-images.githubusercontent.com/12729184/118130875-6e7c4580-b430-11eb-9b82-22f02716bd63.png" alt="image" /></p>
<h4>8. Tuỳ chọn TableStyles</h4>
<p>Kiểu mặc định</p>
<p><img src="https://user-images.githubusercontent.com/12729184/138234373-cfa97109-b71f-4711-b7f5-0eaaa4a0a3a6.png" alt="image" /></p>
<p>Không cấu hình kiểu dáng</p>
<pre><code class="language-csharp">var config = new OpenXmlConfiguration()
{
     TableStyles = TableStyles.None
};
MiniExcel.SaveAs(path, value,configuration:config);
</code></pre>
<p><img src="https://user-images.githubusercontent.com/12729184/118784917-f3e57700-b8c2-11eb-8718-8d955b1bc197.png" alt="image" /></p>
<h4>9. AutoFilter</h4>
<p>Từ phiên bản v0.19.0  <code>OpenXmlConfiguration.AutoFilter</code> có thể bật/tắt AutoFilter, giá trị mặc định là <code>true</code>, và thiết lập AutoFilter như sau:</p>
<pre><code class="language-csharp">MiniExcel.SaveAs(path, value, configuration: new OpenXmlConfiguration() { AutoFilter = false });
</code></pre>
<h4>10. Tạo ảnh</h4>
<pre><code class="language-csharp">var value = new[] {
    new { Name=&quot;github&quot;,Image=File.ReadAllBytes(PathHelper.GetFile(&quot;images/github_logo.png&quot;))},
    new { Name=&quot;google&quot;,Image=File.ReadAllBytes(PathHelper.GetFile(&quot;images/google_logo.png&quot;))},
    new { Name=&quot;microsoft&quot;,Image=File.ReadAllBytes(PathHelper.GetFile(&quot;images/microsoft_logo.png&quot;))},
    new { Name=&quot;reddit&quot;,Image=File.ReadAllBytes(PathHelper.GetFile(&quot;images/reddit_logo.png&quot;))},
    new { Name=&quot;statck_overflow&quot;,Image=File.ReadAllBytes(PathHelper.GetFile(&quot;images/statck_overflow_logo.png&quot;))},
};
MiniExcel.SaveAs(path, value);
</code></pre>
<p><img src="https://user-images.githubusercontent.com/12729184/150462383-ad9931b3-ed8d-4221-a1d6-66f799743433.png" alt="image" /></p>
<h4>11. Xuất file mảng Byte</h4>
<p>Từ phiên bản 1.22.0, khi kiểu dữ liệu là <code>byte[]</code> thì hệ thống sẽ lưu đường dẫn file tại ô theo mặc định, và khi import hệ thống có thể chuyển đổi về <code>byte[]</code>. Nếu bạn không muốn sử dụng tính năng này, bạn có thể thiết lập <code>OpenXmlConfiguration.EnableConvertByteArray</code> thành <code>false</code>, điều này giúp cải thiện hiệu suất hệ thống.</p>
<p><img src="https://user-images.githubusercontent.com/12729184/153702334-c3b834f4-6ae4-4ddf-bd4e-e5005d5d8c6a.png" alt="image" /></p>
<p>Từ phiên bản 1.22.0, khi kiểu dữ liệu là <code>byte[]</code> thì hệ thống sẽ lưu đường dẫn file tại ô theo mặc định, và khi import hệ thống có thể chuyển đổi về <code>byte[]</code>. Nếu bạn không muốn sử dụng tính năng này, bạn có thể thiết lập <code>OpenXmlConfiguration.EnableConvertByteArray</code> thành <code>false</code>, điều này giúp cải thiện hiệu suất hệ thống.</p>
<p><img src="https://user-images.githubusercontent.com/12729184/153702334-c3b834f4-6ae4-4ddf-bd4e-e5005d5d8c6a.png" alt="image" /></p>
<h4>12. Gộp các ô giống nhau theo chiều dọc</h4>
<p>Chức năng này chỉ hỗ trợ định dạng <code>xlsx</code> và sẽ gộp các ô theo chiều dọc giữa thẻ @merge và @endmerge.<br />
Bạn có thể sử dụng @mergelimit để giới hạn phạm vi gộp các ô theo chiều dọc.</p>
<pre><code class="language-csharp">var mergedFilePath = Path.Combine(Path.GetTempPath(), $&quot;{Guid.NewGuid().ToString()}.xlsx&quot;);

var path = @&quot;../../../../../samples/xlsx/TestMergeWithTag.xlsx&quot;;

MiniExcel.MergeSameCells(mergedFilePath, path);
</code></pre>
<pre><code class="language-csharp">var memoryStream = new MemoryStream();

var path = @&quot;../../../../../samples/xlsx/TestMergeWithTag.xlsx&quot;;

memoryStream.MergeSameCells(path);
</code></pre>
<p>Nội dung file trước và sau khi gộp:</p>
<p>Không giới hạn gộp:</p>
<img width="318" alt="Screenshot 2023-08-07 at 11 59 24" src="https://github.com/mini-software/MiniExcel/assets/38832863/49cc96b9-6c35-4bf3-8d43-a9752a15b22e">
<img width="318" alt="Screenshot 2023-08-07 at 11 59 57" src="https://github.com/mini-software/MiniExcel/assets/38832863/3fbd529b-3ae6-4bbe-b4d8-2793a5a58010">
<p>Có giới hạn gộp:</p>
<img width="346" alt="Screenshot 2023-08-08 at 18 21 00" src="https://github.com/mini-software/MiniExcel/assets/38832863/04049d28-84d5-4c2a-bcff-5847547df5e1">
<img width="346" alt="Screenshot 2023-08-08 at 18 21 40" src="https://github.com/mini-software/MiniExcel/assets/38832863/f5cf8957-b0b0-4831-b8fc-8556299235c2">
<h4>13. Bỏ qua giá trị null</h4>
<p>Tùy chọn mới để ghi các ô trống cho giá trị null:</p>
<pre><code class="language-csharp">DataTable dt = new DataTable();

/* ... */

DataRow dr = dt.NewRow();

dr[&quot;Name1&quot;] = &quot;Somebody once&quot;;
dr[&quot;Name2&quot;] = null;
dr[&quot;Name3&quot;] = &quot;told me.&quot;;

dt.Rows.Add(dr);

OpenXmlConfiguration configuration = new OpenXmlConfiguration()
{
     EnableWriteNullValueCell = true // Giá trị mặc định.
};

MiniExcel.SaveAs(@&quot;C:\temp\Book1.xlsx&quot;, dt, configuration: configuration);
</code></pre>
<p><img src="https://user-images.githubusercontent.com/31481586/241419455-3c0aec8a-4e5f-4d83-b7ec-6572124c165d.png" alt="image" /></p>
<pre><code class="language-xml">&lt;x:row r=&quot;2&quot;&gt;
    &lt;x:c r=&quot;A2&quot; t =&quot;str&quot; s=&quot;2&quot;&gt;
        &lt;x:v&gt;Somebody once&lt;/x:v&gt;
    &lt;/x:c&gt;
    &lt;x:c r=&quot;B2&quot; s=&quot;2&quot;&gt;&lt;/x:c&gt;
    &lt;x:c r=&quot;C2&quot; t =&quot;str&quot; s=&quot;2&quot;&gt;
        &lt;x:v&gt;told me.&lt;/x:v&gt;
    &lt;/x:c&gt;
&lt;/x:row&gt;
</code></pre>
<p>Hành vi trước đây:</p>
<pre><code class="language-csharp">/* ... */

OpenXmlConfiguration configuration = new OpenXmlConfiguration()
{
     EnableWriteNullValueCell = false // Giá trị mặc định là true.
};

MiniExcel.SaveAs(@&quot;C:\temp\Book1.xlsx&quot;, dt, configuration: configuration);
</code></pre>
<p><img src="https://user-images.githubusercontent.com/31481586/241419441-c4f27e8f-3f87-46db-a10f-08665864c874.png" alt="image" /></p>
<pre><code class="language-xml">&lt;x:row r=&quot;2&quot;&gt;
    &lt;x:c r=&quot;A2&quot; t =&quot;str&quot; s=&quot;2&quot;&gt;
        &lt;x:v&gt;Somebody once&lt;/x:v&gt;
    &lt;/x:c&gt;
    &lt;x:c r=&quot;B2&quot; t =&quot;str&quot; s=&quot;2&quot;&gt;
        &lt;x:v&gt;&lt;/x:v&gt;
    &lt;/x:c&gt;
    &lt;x:c r=&quot;C2&quot; t =&quot;str&quot; s=&quot;2&quot;&gt;
        &lt;x:v&gt;told me.&lt;/x:v&gt;
    &lt;/x:c&gt;
&lt;/x:row&gt;
</code></pre>
<p>Hoạt động cho giá trị null và DBNull.</p>
<h4>14. Cố định khung bảng (Freeze Panes)</h4>
<pre><code class="language-csharp">/* ... */

OpenXmlConfiguration configuration = new OpenXmlConfiguration()
{
    FreezeRowCount = 1,     // mặc định là 1
    FreezeColumnCount = 2   // mặc định là 0
};

MiniExcel.SaveAs(@&quot;C:\temp\Book1.xlsx&quot;, dt, configuration: configuration);
</code></pre>
<p><img src="https://raw.githubusercontent.com/mini-software/MiniExcel/master/docs/images/freeze-pane-1.png" alt="image" /></p>
<h3>Đổ Dữ Liệu Vào Mẫu Excel <a name="getstart3"></a></h3>
<ul>
<li>Cú pháp khai báo tương tự như template Vue <code>{{tên biến}}</code>, hoặc render tập hợp <code>{{tên tập hợp.tên trường}}</code></li>
<li>Render tập hợp hỗ trợ IEnumerable/DataTable/DapperRow</li>
</ul>
<h4>1. Đổ Dữ Liệu Cơ Bản</h4>
<p>Mẫu:
<img src="https://user-images.githubusercontent.com/12729184/114537556-ed8d2b00-9c84-11eb-8303-a69f62c41e5b.png" alt="image" /></p>
<p>Kết quả:
<img src="https://user-images.githubusercontent.com/12729184/114537490-d8180100-9c84-11eb-8c69-db58692f3a85.png" alt="image" /></p>
<p>Mã nguồn:</p>
<pre><code class="language-csharp">// 1. Bằng POCO
var value = new
{
    Name = &quot;Jack&quot;,
    CreateDate = new DateTime(2021, 01, 01),
    VIP = true,
    Points = 123
};
MiniExcel.SaveAsByTemplate(path, templatePath, value);


// 2. Bằng Dictionary
var value = new Dictionary&lt;string, object&gt;()
{
    [&quot;Name&quot;] = &quot;Jack&quot;,
    [&quot;CreateDate&quot;] = new DateTime(2021, 01, 01),
    [&quot;VIP&quot;] = true,
    [&quot;Points&quot;] = 123
};
MiniExcel.SaveAsByTemplate(path, templatePath, value);
</code></pre>
<h4>2. Đổ Dữ Liệu IEnumerable</h4>
<blockquote>
<p>Lưu ý1: Sử dụng IEnumerable đầu tiên cùng cột làm cơ sở để đổ danh sách</p>
</blockquote>
<p>Mẫu:
<img src="https://user-images.githubusercontent.com/12729184/114564652-14f2f080-9ca3-11eb-831f-09e3fedbc5fc.png" alt="image" /></p>
<p>Kết quả:
<img src="https://user-images.githubusercontent.com/12729184/114564204-b2015980-9ca2-11eb-900d-e21249f93f7c.png" alt="image" /></p>
<p>Mã nguồn:</p>
<pre><code class="language-csharp">//1. Bằng POCO
var value = new
{
    employees = new[] {
        new {name=&quot;Jack&quot;,department=&quot;HR&quot;},
        new {name=&quot;Lisa&quot;,department=&quot;HR&quot;},
        new {name=&quot;John&quot;,department=&quot;HR&quot;},
        new {name=&quot;Mike&quot;,department=&quot;IT&quot;},
        new {name=&quot;Neo&quot;,department=&quot;IT&quot;},
        new {name=&quot;Loan&quot;,department=&quot;IT&quot;}
    }
};
MiniExcel.SaveAsByTemplate(path, templatePath, value);

//2. Bằng Dictionary
var value = new Dictionary&lt;string, object&gt;()
{
    [&quot;employees&quot;] = new[] {
        new {name=&quot;Jack&quot;,department=&quot;HR&quot;},
        new {name=&quot;Lisa&quot;,department=&quot;HR&quot;},
        new {name=&quot;John&quot;,department=&quot;HR&quot;},
        new {name=&quot;Mike&quot;,department=&quot;IT&quot;},
        new {name=&quot;Neo&quot;,department=&quot;IT&quot;},
        new {name=&quot;Loan&quot;,department=&quot;IT&quot;}
    }
};
MiniExcel.SaveAsByTemplate(path, templatePath, value);
</code></pre>
<h4>3. Đổ Dữ Liệu Phức Tạp</h4>
<blockquote>
<p>Lưu ý: Hỗ trợ nhiều sheet và sử dụng cùng một biến</p>
</blockquote>
<p>Mẫu:</p>
<p><img src="https://user-images.githubusercontent.com/12729184/114565255-acf0da00-9ca3-11eb-8a7f-8131b2265ae8.png" alt="image" /></p>
<p>Kết quả:</p>
<p><img src="https://user-images.githubusercontent.com/12729184/114565329-bf6b1380-9ca3-11eb-85e3-3969e8bf6378.png" alt="image" /></p>
<pre><code class="language-csharp">// 1. Bằng POCO
var value = new
{
    title = &quot;FooCompany&quot;,
    managers = new[] {
        new {name=&quot;Jack&quot;,department=&quot;HR&quot;},
        new {name=&quot;Loan&quot;,department=&quot;IT&quot;}
    },
    employees = new[] {
        new {name=&quot;Wade&quot;,department=&quot;HR&quot;},
        new {name=&quot;Felix&quot;,department=&quot;HR&quot;},
        new {name=&quot;Eric&quot;,department=&quot;IT&quot;},
        new {name=&quot;Keaton&quot;,department=&quot;IT&quot;}
    }
};
MiniExcel.SaveAsByTemplate(path, templatePath, value);

// 2. Bằng Dictionary
var value = new Dictionary&lt;string, object&gt;()
{
    [&quot;title&quot;] = &quot;FooCompany&quot;,
    [&quot;managers&quot;] = new[] {
        new {name=&quot;Jack&quot;,department=&quot;HR&quot;},
        new {name=&quot;Loan&quot;,department=&quot;IT&quot;}
    },
    [&quot;employees&quot;] = new[] {
        new {name=&quot;Wade&quot;,department=&quot;HR&quot;},
        new {name=&quot;Felix&quot;,department=&quot;HR&quot;},
        new {name=&quot;Eric&quot;,department=&quot;IT&quot;},
        new {name=&quot;Keaton&quot;,department=&quot;IT&quot;}
    }
};
MiniExcel.SaveAsByTemplate(path, templatePath, value);
</code></pre>
<h4>4. Hiệu Năng Đổ Dữ Liệu Lớn</h4>
<blockquote>
<p>LƯU Ý: Sử dụng IEnumerable thực thi deferred thay vì ToList sẽ giúp tiết kiệm tối đa bộ nhớ khi dùng MiniExcel</p>
</blockquote>
<p><img src="https://user-images.githubusercontent.com/12729184/114577091-5046ec80-9cae-11eb-924b-087c7becf8da.png" alt="image" /></p>
<h4>5. Tự động ánh xạ kiểu dữ liệu cho giá trị ô</h4>
<p>Mẫu</p>
<p><img src="https://user-images.githubusercontent.com/12729184/114802504-64830a80-9dd0-11eb-8d56-8e8c401b3ace.png" alt="image" /></p>
<p>Kết quả</p>
<p><img src="https://user-images.githubusercontent.com/12729184/114802419-43221e80-9dd0-11eb-9ffe-a2ce34fe7076.png" alt="image" /></p>
<p>Class</p>
<pre><code class="language-csharp">public class Poco
{
    public string @string { get; set; }
    public int? @int { get; set; }
</code></pre>
<pre><code class="language-csharp">public decimal? @decimal { get; set; }
public double? @double { get; set; }
public DateTime? datetime { get; set; }
public bool? @bool { get; set; }
public Guid? Guid { get; set; }
}
</code></pre>
<p>Mã nguồn</p>
<pre><code class="language-csharp">var poco = new TestIEnumerableTypePoco { @string = &quot;string&quot;, @int = 123, @decimal = decimal.Parse(&quot;123.45&quot;), @double = (double)123.33, @datetime = new DateTime(2021, 4, 1), @bool = true, @Guid = Guid.NewGuid() };
var value = new
{
    Ts = new[] {
        poco,
        new TestIEnumerableTypePoco{},
        null,
        poco
    }
};
MiniExcel.SaveAsByTemplate(path, templatePath, value);
</code></pre>
<h4>6. Ví dụ: Liệt kê các dự án Github</h4>
<p>Mẫu</p>
<p><img src="https://user-images.githubusercontent.com/12729184/115068623-12073280-9f25-11eb-9124-f4b3efcdb2a7.png" alt="image" /></p>
<p>Kết quả</p>
<p><img src="https://user-images.githubusercontent.com/12729184/115068639-1a5f6d80-9f25-11eb-9f45-27c434d19a78.png" alt="image" /></p>
<p>Mã nguồn</p>
<pre><code class="language-csharp">var projects = new[]
{
    new {Name = &quot;MiniExcel&quot;,Link=&quot;https://github.com/mini-software/MiniExcel&quot;,Star=146, CreateTime=new DateTime(2021,03,01)},
    new {Name = &quot;HtmlTableHelper&quot;,Link=&quot;https://github.com/mini-software/HtmlTableHelper&quot;,Star=16, CreateTime=new DateTime(2020,02,01)},
    new {Name = &quot;PocoClassGenerator&quot;,Link=&quot;https://github.com/mini-software/PocoClassGenerator&quot;,Star=16, CreateTime=new DateTime(2019,03,17)}
};
var value = new
{
    User = &quot;ITWeiHan&quot;,
    Projects = projects,
    TotalStar = projects.Sum(s =&gt; s.Star)
};
MiniExcel.SaveAsByTemplate(path, templatePath, value);
</code></pre>
<h4>7. Điền dữ liệu theo nhóm</h4>
<pre><code class="language-csharp">var value = new Dictionary&lt;string, object&gt;()
{
    [&quot;employees&quot;] = new[] {
        new {name=&quot;Jack&quot;,department=&quot;HR&quot;},
        new {name=&quot;Jack&quot;,department=&quot;HR&quot;},
        new {name=&quot;John&quot;,department=&quot;HR&quot;},
        new {name=&quot;John&quot;,department=&quot;IT&quot;},
        new {name=&quot;Neo&quot;,department=&quot;IT&quot;},
        new {name=&quot;Loan&quot;,department=&quot;IT&quot;}
    }
};
await MiniExcel.SaveAsByTemplateAsync(path, templatePath, value);
</code></pre>
<h5>1. Với thẻ <code>@group</code> và thẻ <code>@header</code></h5>
<p>Trước</p>
<p><img src="https://user-images.githubusercontent.com/38832863/218646717-21b9d57a-2be2-4e9a-801b-ae212231d2b4.PNG" alt="before_with_header" /></p>
<p>Sau</p>
<p><img src="https://user-images.githubusercontent.com/38832863/218646721-58a7a340-7004-4bc2-af24-cffcb2c20737.PNG" alt="after_with_header" /></p>
<h5>2. Với thẻ @group và không có thẻ @header</h5>
<p>Trước</p>
<p><img src="https://user-images.githubusercontent.com/38832863/218646873-b12417fa-801b-4890-8e96-669ed3b43902.PNG" alt="before_without_header" /></p>
<p>Sau</p>
<p><img src="https://user-images.githubusercontent.com/38832863/218646872-622461ba-342e-49ee-834f-b91ad9c2dac3.PNG" alt="after_without_header" /></p>
<h5>3. Không có thẻ @group</h5>
<p>Trước</p>
<p><img src="https://user-images.githubusercontent.com/38832863/218646975-f52a68eb-e031-43b5-abaa-03b67c052d1a.PNG" alt="without_group" /></p>
<p>Sau</p>
<p><img src="https://user-images.githubusercontent.com/38832863/218646974-4a3c0e07-7c66-4088-ad07-b4ad3695b7e1.PNG" alt="without_group_after" /></p>
<h4>8. Câu lệnh If/ElseIf/Else trong ô</h4>
<p>Quy tắc:</p>
<ol>
<li>Hỗ trợ DateTime, Double, Int với các toán tử ==, !=, &gt;, &gt;=, &lt;, &lt;=.</li>
<li>Hỗ trợ String với các toán tử ==, !=.</li>
<li>Mỗi câu lệnh phải trên một dòng mới.</li>
<li>Thêm một khoảng trắng trước và sau toán tử.</li>
<li>Không được có dòng mới bên trong câu lệnh.</li>
<li>Ô phải có định dạng chính xác như bên dưới.</li>
</ol>
<pre><code class="language-csharp">@if(name == Jack)
{{employees.name}}
@elseif(name == Neo)
Test {{employees.name}}
@else
{{employees.department}}
@endif
</code></pre>
<p>Trước</p>
<p><img src="https://user-images.githubusercontent.com/38832863/235360606-ca654769-ff55-4f5b-98d2-d2ec0edb8173.PNG" alt="if_before" /></p>
<p>Sau</p>
<p><img src="https://user-images.githubusercontent.com/38832863/235360609-869bb960-d63d-45ae-8d64-9e8b0d0ab658.PNG" alt="if_after" /></p>
<h4>9. DataTable làm tham số</h4>
<pre><code class="language-csharp">var managers = new DataTable();
{
    managers.Columns.Add(&quot;name&quot;);
    managers.Columns.Add(&quot;department&quot;);
    managers.Rows.Add(&quot;Jack&quot;, &quot;HR&quot;);
    managers.Rows.Add(&quot;Loan&quot;, &quot;IT&quot;);
}
var value = new Dictionary&lt;string, object&gt;()
{
    [&quot;title&quot;] = &quot;FooCompany&quot;,
    [&quot;managers&quot;] = managers,
};
MiniExcel.SaveAsByTemplate(path, templatePath, value);
</code></pre>
<h4>10. Công thức</h4>
<h5>1. Ví dụ</h5>
<p>Thêm tiền tố <code>$</code> cho công thức của bạn và sử dụng <code>$enumrowstart</code> và <code>$enumrowend</code> để đánh dấu tham chiếu đến dòng bắt đầu và dòng kết thúc của tập hợp:</p>
<p><img src="docs/images/template-formulas-1.png" alt="image" /></p>
<p>Khi mẫu được render, tiền tố <code>$</code> sẽ bị loại bỏ và <code>$enumrowstart</code>, <code>$enumrowend</code> sẽ được thay thế bằng số dòng bắt đầu và kết thúc của tập hợp:</p>
<p><img src="docs/images/template-formulas-2.png" alt="image" /></p>
<h5>2. Một số công thức ví dụ khác:</h5>
<p>|              |                                                                                           |
|--------------|-------------------------------------------------------------------------------------------|
| Tổng         | <code>$=SUM(C{{$enumrowstart}}:C{{$enumrowend}})</code>                                              |
| TB thay thế  | <code>$=SUM(C{{$enumrowstart}}:C{{$enumrowend}}) / COUNT(C{{$enumrowstart}}:C{{$enumrowend}})</code> |
| Khoảng       | <code>$=MAX(C{{$enumrowstart}}:C{{$enumrowend}}) - MIN(C{{$enumrowstart}}:C{{$enumrowend}})</code>   |</p>
<h4>11. Khác</h4>
<h5>1. Kiểm tra key tham số mẫu</h5>
<p>Từ phiên bản V1.24.0, mặc định sẽ bỏ qua key tham số mẫu bị thiếu và thay bằng chuỗi rỗng, <code>IgnoreTemplateParameterMissing</code> có thể kiểm soát việc ném ngoại lệ hay không.</p>
<pre><code class="language-csharp">var config = new OpenXmlConfiguration()
{
    IgnoreTemplateParameterMissing = false,
};
MiniExcel.SaveAsByTemplate(path, templatePath, value, config)
</code></pre>
<p><img src="https://user-images.githubusercontent.com/12729184/157464332-e316f829-54aa-4c84-a5aa-9aef337b668d.png" alt="image" /></p>
<h3>Thuộc tính Tên/Chỉ số/Cột Bỏ qua của Excel <a name="getstart4"></a></h3>
<h4>1. Chỉ định tên cột, chỉ số cột, bỏ qua cột</h4>
<p>Ví dụ Excel</p>
<p><img src="https://user-images.githubusercontent.com/12729184/114230869-3e163700-99ac-11eb-9a90-2039d4b4b313.png" alt="image" /></p>
<p>Mã nguồn</p>
<pre><code class="language-csharp">public class ExcelAttributeDemo
{
    [ExcelColumnName(&quot;Column1&quot;)]
</code></pre>
<pre><code class="language-csharp">public string Test1 { get; set; }
[ExcelColumnName(&quot;Column2&quot;)]
public string Test2 { get; set; }
[ExcelIgnore]
public string Test3 { get; set; }
[ExcelColumnIndex(&quot;I&quot;)] // hệ thống sẽ chuyển &quot;I&quot; thành chỉ số 8
public string Test4 { get; set; }
public string Test5 { get; } //không có set sẽ bị bỏ qua
public string Test6 { get; private set; } //set không public sẽ bị bỏ qua
[ExcelColumnIndex(3)] // bắt đầu từ 0
public string Test7 { get; set; }
}

var rows = MiniExcel.Query&lt;ExcelAttributeDemo&gt;(path).ToList();
Assert.Equal(&quot;Column1&quot;, rows[0].Test1);
Assert.Equal(&quot;Column2&quot;, rows[0].Test2);
Assert.Null(rows[0].Test3);
Assert.Equal(&quot;Test7&quot;, rows[0].Test4);
Assert.Null(rows[0].Test5);
Assert.Null(rows[0].Test6);
Assert.Equal(&quot;Test4&quot;, rows[0].Test7);
</code></pre>
<h4>2. Định Dạng Tùy Chỉnh (ExcelFormatAttribute)</h4>
<p>Từ V0.21.0 hỗ trợ class chứa phương thức định dạng <code>ToString(string content)</code></p>
<p>Class</p>
<pre><code class="language-csharp">public class Dto
{
    public string Name { get; set; }

    [ExcelFormat(&quot;MMMM dd, yyyy&quot;)]
    public DateTime InDate { get; set; }
}
</code></pre>
<p>Code</p>
<pre><code class="language-csharp">var value = new Dto[] {
    new Issue241Dto{ Name=&quot;Jack&quot;,InDate=new DateTime(2021,01,04)},
    new Issue241Dto{ Name=&quot;Henry&quot;,InDate=new DateTime(2020,04,05)},
};
MiniExcel.SaveAs(path, value);
</code></pre>
<p>Kết quả</p>
<p><img src="https://user-images.githubusercontent.com/12729184/118910788-ab2bcd80-b957-11eb-8d42-bfce36621b1b.png" alt="image" /></p>
<p>Query hỗ trợ chuyển đổi định dạng tùy chỉnh</p>
<p><img src="https://user-images.githubusercontent.com/12729184/118911286-87b55280-b958-11eb-9a88-c8ff403d240a.png" alt="image" /></p>
<h4>3. Đặt Độ Rộng Cột (ExcelColumnWidthAttribute)</h4>
<pre><code class="language-csharp">public class Dto
{
    [ExcelColumnWidth(20)]
    public int ID { get; set; }
    [ExcelColumnWidth(15.50)]
    public string Name { get; set; }
}
</code></pre>
<h4>4. Nhiều tên cột ánh xạ vào cùng một thuộc tính.</h4>
<pre><code class="language-csharp">public class Dto
{
    [ExcelColumnName(excelColumnName:&quot;EmployeeNo&quot;,aliases:new[] { &quot;EmpNo&quot;,&quot;No&quot; })]
    public string Empno { get; set; }
    public string Name { get; set; }
}
</code></pre>
<h4>5. System.ComponentModel.DisplayNameAttribute = ExcelColumnName.excelColumnNameAttribute</h4>
<p>Từ phiên bản 1.24.0, hệ thống hỗ trợ System.ComponentModel.DisplayNameAttribute = ExcelColumnName.excelColumnNameAttribute</p>
<pre><code class="language-C#">public class TestIssueI4TXGTDto
{
    public int ID { get; set; }
    public string Name { get; set; }
    [DisplayName(&quot;Specification&quot;)]
    public string Spc { get; set; }
    [DisplayName(&quot;Unit Price&quot;)]
    public decimal Up { get; set; }
}
</code></pre>
<h4>6. ExcelColumnAttribute</h4>
<p>Từ phiên bản V1.26.0, nhiều thuộc tính có thể được đơn giản hóa như sau:</p>
<pre><code class="language-csharp">        public class TestIssueI4ZYUUDto
        {
            [ExcelColumn(Name = &quot;ID&quot;,Index =0)]
            public string MyProperty { get; set; }
            [ExcelColumn(Name = &quot;CreateDate&quot;, Index = 1,Format =&quot;yyyy-MM&quot;,Width =100)]
            public DateTime MyProperty2 { get; set; }
        }
</code></pre>
<h4>7. DynamicColumnAttribute</h4>
<p>Từ phiên bản V1.26.0, chúng ta có thể thiết lập thuộc tính của Column một cách động</p>
<pre><code class="language-csharp">            var config = new OpenXmlConfiguration
            {
                DynamicColumns = new DynamicExcelColumn[] {
                    new DynamicExcelColumn(&quot;id&quot;){Ignore=true},
                    new DynamicExcelColumn(&quot;name&quot;){Index=1,Width=10},
                    new DynamicExcelColumn(&quot;createdate&quot;){Index=0,Format=&quot;yyyy-MM-dd&quot;,Width=15},
                    new DynamicExcelColumn(&quot;point&quot;){Index=2,Name=&quot;Account Point&quot;},
                }
            };
            var path = PathHelper.GetTempPath();
            var value = new[] { new { id = 1, name = &quot;Jack&quot;, createdate = new DateTime(2022, 04, 12) ,point = 123.456} };
            MiniExcel.SaveAs(path, value, configuration: config);
</code></pre>
<p><img src="https://user-images.githubusercontent.com/12729184/164510353-5aecbc4e-c3ce-41e8-b6cf-afd55eb23b68.png" alt="image" /></p>
<h4>8. DynamicSheetAttribute</h4>
<p>Từ phiên bản V1.31.4 chúng ta có thể thiết lập thuộc tính của Sheet một cách động. Có thể đặt tên sheet và trạng thái (hiển thị/ẩn).</p>
<pre><code class="language-csharp">            var configuration = new OpenXmlConfiguration
            {
                DynamicSheets = new DynamicExcelSheet[] {
                    new DynamicExcelSheet(&quot;usersSheet&quot;) { Name = &quot;Users&quot;, State = SheetState.Visible },
                    new DynamicExcelSheet(&quot;departmentSheet&quot;) { Name = &quot;Departments&quot;, State = SheetState.Hidden }
                }
            };

            var users = new[] { new { Name = &quot;Jack&quot;, Age = 25 }, new { Name = &quot;Mike&quot;, Age = 44 } };
            var department = new[] { new { ID = &quot;01&quot;, Name = &quot;HR&quot; }, new { ID = &quot;02&quot;, Name = &quot;IT&quot; } };
            var sheets = new Dictionary&lt;string, object&gt;
            {
                [&quot;usersSheet&quot;] = users,
                [&quot;departmentSheet&quot;] = department
            };

            var path = PathHelper.GetTempPath();
            MiniExcel.SaveAs(path, sheets, configuration: configuration);
</code></pre>
<p>Chúng ta cũng có thể sử dụng thuộc tính mới ExcelSheetAttribute:</p>
<pre><code class="language-C#">   [ExcelSheet(Name = &quot;Departments&quot;, State = SheetState.Hidden)]
   private class DepartmentDto
   {
      [ExcelColumn(Name = &quot;ID&quot;,Index = 0)]
      public string ID { get; set; }
      [ExcelColumn(Name = &quot;Name&quot;,Index = 1)]
      public string Name { get; set; }
   }
</code></pre>
<h3>Thêm, Xóa, Cập Nhật</h3>
<h4>Thêm</h4>
<p>v1.28.0 hỗ trợ CSV chèn N dòng dữ liệu sau dòng cuối cùng</p>
<pre><code class="language-csharp">// Gốc
{
    var value = new[] {
          new { ID=1,Name =&quot;Jack&quot;,InDate=new DateTime(2021,01,03)},
          new { ID=2,Name =&quot;Henry&quot;,InDate=new DateTime(2020,05,03)},
    };
    MiniExcel.SaveAs(path, value);
}
// Chèn 1 dòng sau dòng cuối
{
    var value = new { ID=3,Name = &quot;Mike&quot;, InDate = new DateTime(2021, 04, 23) };
    MiniExcel.Insert(path, value);
}
// Chèn N dòng sau dòng cuối
{
    var value = new[] {
          new { ID=4,Name =&quot;Frank&quot;,InDate=new DateTime(2021,06,07)},
          new { ID=5,Name =&quot;Gloria&quot;,InDate=new DateTime(2022,05,03)},
</code></pre>
<pre><code class="language-csharp">};
MiniExcel.Insert(path, value);
}
</code></pre>
<p><img src="https://user-images.githubusercontent.com/12729184/191023733-1e2fa732-db5c-4a3a-9722-b891fe5aa069.png" alt="image" /></p>
<p>v1.37.0 hỗ trợ chèn một sheet mới vào một workbook excel đã tồn tại</p>
<pre><code class="language-csharp">// File excel gốc
{
    var value = new[] {
          new { ID=1,Name =&quot;Jack&quot;,InDate=new DateTime(2021,01,03)},
          new { ID=2,Name =&quot;Henry&quot;,InDate=new DateTime(2020,05,03)},
    };
    MiniExcel.SaveAs(path, value, sheetName: &quot;Sheet1&quot;);
}
// Chèn một sheet mới
{
    var value = new { ID=3,Name = &quot;Mike&quot;, InDate = new DateTime(2021, 04, 23) };
    MiniExcel.Insert(path, table, sheetName: &quot;Sheet2&quot;);
}
</code></pre>
<h4>Xóa (chờ cập nhật)</h4>
<h4>Cập nhật (chờ cập nhật)</h4>
<h3>Tự động kiểm tra loại Excel <a name="getstart5"></a></h3>
<ul>
<li>MiniExcel sẽ kiểm tra xem là xlsx hay csv dựa trên <code>phần mở rộng của file</code> theo mặc định, tuy nhiên có thể không chính xác, vui lòng chỉ định thủ công nếu cần.</li>
<li>Đối với Stream thì không thể biết từ loại excel nào, vui lòng chỉ định thủ công.</li>
</ul>
<pre><code class="language-csharp">stream.SaveAs(excelType:ExcelType.CSV);
//hoặc
stream.SaveAs(excelType:ExcelType.XLSX);
//hoặc
stream.Query(excelType:ExcelType.CSV);
//hoặc
stream.Query(excelType:ExcelType.XLSX);
</code></pre>
<h3>CSV</h3>
<h4>Lưu ý</h4>
<ul>
<li>Mặc định trả về kiểu <code>string</code>, và giá trị sẽ không được chuyển đổi sang số hoặc datetime, trừ khi kiểu được định nghĩa bằng generic kiểu mạnh.</li>
</ul>
<h4>Tùy chỉnh ký tự phân cách</h4>
<p>Mặc định là <code>,</code> làm ký tự phân cách, bạn có thể sửa thuộc tính <code>Seperator</code> để tùy chỉnh</p>
<pre><code class="language-csharp">var config = new MiniExcelLibs.Csv.CsvConfiguration()
{
    Seperator=';'
};
MiniExcel.SaveAs(path, values,configuration: config);
</code></pre>
<p>Từ phiên bản V1.30.1 hỗ trợ hàm tùy chỉnh ký tự phân cách (cảm ơn @hyzx86)</p>
<pre><code class="language-csharp">var config = new CsvConfiguration()
{
    SplitFn = (row) =&gt; Regex.Split(row, $&quot;[\t,](?=(?:[^\&quot;]|\&quot;[^\&quot;]*\&quot;)*$)&quot;)
        .Select(s =&gt; Regex.Replace(s.Replace(&quot;\&quot;\&quot;&quot;, &quot;\&quot;&quot;), &quot;^\&quot;|\&quot;$&quot;, &quot;&quot;)).ToArray()
};
var rows = MiniExcel.Query(path, configuration: config).ToList();
</code></pre>
<h4>Tùy chỉnh ký tự xuống dòng</h4>
<p>Mặc định là <code>\r\n</code> làm ký tự xuống dòng, bạn có thể sửa thuộc tính <code>NewLine</code> để tùy chỉnh</p>
<pre><code class="language-csharp">var config = new MiniExcelLibs.Csv.CsvConfiguration()
{
    NewLine='\n'
};
MiniExcel.SaveAs(path, values,configuration: config);
</code></pre>
<h4>Tùy chỉnh mã hóa</h4>
<ul>
<li>Mặc định mã hóa là &quot;Detect Encoding From Byte Order Marks&quot;  (detectEncodingFromByteOrderMarks: true)</li>
<li>Nếu bạn có yêu cầu mã hóa riêng, vui lòng chỉnh sửa thuộc tính StreamReaderFunc / StreamWriterFunc</li>
</ul>
<pre><code class="language-csharp">// Đọc
var config = new MiniExcelLibs.Csv.CsvConfiguration()
{
    StreamReaderFunc = (stream) =&gt; new StreamReader(stream,Encoding.GetEncoding(&quot;gb2312&quot;))
};
var rows = MiniExcel.Query(path, true,excelType:ExcelType.CSV,configuration: config);

// Ghi
var config = new MiniExcelLibs.Csv.CsvConfiguration()
{
    StreamWriterFunc = (stream) =&gt; new StreamWriter(stream, Encoding.GetEncoding(&quot;gb2312&quot;))
};
MiniExcel.SaveAs(path, value,excelType:ExcelType.CSV, configuration: config);
</code></pre>
<h4>Đọc chuỗi rỗng thành null</h4>
<p>Theo mặc định, giá trị rỗng sẽ được ánh xạ thành string.Empty. Bạn có thể thay đổi hành vi này</p>
<pre><code class="language-csharp">var config = new MiniExcelLibs.Csv.CsvConfiguration()
{
   ReadEmptyStringAsNull = true
};
</code></pre>
<h3>DataReader</h3>
<h4>1. GetReader</h4>
<p>Từ phiên bản 1.23.0, bạn có thể GetDataReader</p>
<pre><code class="language-csharp">    using (var reader = MiniExcel.GetReader(path,true))
    {
        while (reader.Read())
        {
            for (int i = 0; i &lt; reader.FieldCount; i++)
            {
                var value = reader.GetValue(i);
            }
        }
    }
</code></pre>
<h3>Async</h3>
<ul>
<li>v0.17.0 hỗ trợ Async (cảm ơn isdaniel ( SHIH,BING-SIOU)](https://github.com/isdaniel))</li>
</ul>
<pre><code class="language-csharp">public static Task SaveAsAsync(string path, object value, bool printHeader = true, string sheetName = &quot;Sheet1&quot;, ExcelType excelType = ExcelType.UNKNOWN, IConfiguration configuration = null)
public static Task SaveAsAsync(this Stream stream, object value, bool printHeader = true, string sheetName = &quot;Sheet1&quot;, ExcelType excelType = ExcelType.XLSX, IConfiguration configuration = null)
public static Task&lt;IEnumerable&lt;dynamic&gt;&gt; QueryAsync(string path, bool useHeaderRow = false, string sheetName = null, ExcelType excelType = ExcelType.UNKNOWN, string startCell = &quot;A1&quot;, IConfiguration configuration = null)
public static Task&lt;IEnumerable&lt;T&gt;&gt; QueryAsync&lt;T&gt;(this Stream stream, string sheetName = null, ExcelType excelType = ExcelType.UNKNOWN, string startCell = &quot;A1&quot;, IConfiguration configuration = null) where T : class, new()
public static Task&lt;IEnumerable&lt;T&gt;&gt; QueryAsync&lt;T&gt;(string path, string sheetName = null, ExcelType excelType = ExcelType.UNKNOWN, string startCell = &quot;A1&quot;, IConfiguration configuration = null) where T : class, new()
public static Task&lt;IEnumerable&lt;IDictionary&lt;string, object&gt;&gt;&gt; QueryAsync(this Stream stream, bool useHeaderRow = false, string sheetName = null, ExcelType excelType = ExcelType.UNKNOWN, string startCell = &quot;A1&quot;, IConfiguration configuration = null)
public static Task SaveAsByTemplateAsync(this Stream stream, string templatePath, object value)
public static Task SaveAsByTemplateAsync(this Stream stream, byte[] templateBytes, object value)
public static Task SaveAsByTemplateAsync(string path, string templatePath, object value)
public static Task SaveAsByTemplateAsync(string path, byte[] templateBytes, object value)
public static Task&lt;DataTable&gt; QueryAsDataTableAsync(string path, bool useHeaderRow = true, string sheetName = null, ExcelType excelType = ExcelType.UNKNOWN, string startCell = &quot;A1&quot;, IConfiguration configuration = null)
</code></pre>
<ul>
<li>v1.25.0 hỗ trợ <code>cancellationToken</code>.</li>
</ul>
<h3>Khác</h3>
<h4>1. Enum</h4>
<p>Hãy chắc chắn tên cột trong excel và tên thuộc tính giống nhau, hệ thống sẽ tự động ánh xạ (không phân biệt hoa thường)</p>
<p><img src="https://user-images.githubusercontent.com/12729184/116210595-9784b100-a775-11eb-936f-8e7a8b435961.png" alt="image" /></p>
<p>Từ phiên bản V0.18.0 hỗ trợ Enum Description</p>
<pre><code class="language-csharp">public class Dto
{
    public string Name { get; set; }
    public I49RYZUserType UserType { get; set; }
}

public enum Type
{
    [Description(&quot;General User&quot;)]
    V1,
    [Description(&quot;General Administrator&quot;)]
    V2,
    [Description(&quot;Super Administrator&quot;)]
    V3
}
</code></pre>
<pre><code>
![image](https://user-images.githubusercontent.com/12729184/133116630-27cc7161-099a-48b8-9784-cd1e443af3d1.png)

Từ phiên bản 1.30.0 đã hỗ trợ mô tả excel cho Enum, cảm ơn @KaneLeung

#### 2. Chuyển đổi CSV sang XLSX hoặc chuyển đổi XLSX sang CSV

```csharp
MiniExcel.ConvertXlsxToCsv(xlsxPath, csvPath);
MiniExcel.ConvertXlsxToCsv(xlsxStream, csvStream);
MiniExcel.ConvertCsvToXlsx(csvPath, xlsxPath);
MiniExcel.ConvertCsvToXlsx(csvStream, xlsxStream);
</code></pre>
<pre><code class="language-csharp">using (var excelStream = new FileStream(path: filePath, FileMode.Open, FileAccess.Read))
using (var csvStream = new MemoryStream())
{
   MiniExcel.ConvertXlsxToCsv(excelStream, csvStream);
}
</code></pre>
<h4>3. Tuỳ chỉnh CultureInfo</h4>
<p>Từ phiên bản 1.22.0, bạn có thể tuỳ chỉnh CultureInfo như bên dưới, mặc định hệ thống là <code>CultureInfo.InvariantCulture</code>.</p>
<pre><code class="language-csharp">var config = new CsvConfiguration()
{
    Culture = new CultureInfo(&quot;fr-FR&quot;),
};
MiniExcel.SaveAs(path, value, configuration: config);

// hoặc
MiniExcel.Query(path, configuration: config);
</code></pre>
<h4>4. Tuỳ chỉnh Buffer Size</h4>
<pre><code class="language-csharp">    public abstract class Configuration : IConfiguration
    {
        public int BufferSize { get; set; } = 1024 * 512;
    }
</code></pre>
<h4>5. FastMode</h4>
<p>Hệ thống sẽ không kiểm soát bộ nhớ, nhưng bạn có thể có tốc độ lưu nhanh hơn.</p>
<pre><code class="language-csharp">var config = new OpenXmlConfiguration() { FastMode = true };
MiniExcel.SaveAs(path, reader,configuration:config);
</code></pre>
<h4>6. Thêm nhiều ảnh một lúc (MiniExcel.AddPicture)</h4>
<pre><code class="language-csharp">var images = new[]
{
    new MiniExcelPicture
    {
        ImageBytes = File.ReadAllBytes(PathHelper.GetFile(&quot;images/github_logo.png&quot;)),
        SheetName = null, // mặc định null là sheet đầu tiên
        CellAddress = &quot;C3&quot;, // bắt buộc
    },
    new MiniExcelPicture
    {
        ImageBytes = File.ReadAllBytes(PathHelper.GetFile(&quot;images/google_logo.png&quot;)),
        PictureType = &quot;image/png&quot;, // mặc định PictureType = image/png
        SheetName = &quot;Demo&quot;,
        CellAddress = &quot;C9&quot;, // bắt buộc
        WidthPx = 100,
        HeightPx = 100,
    },
};
MiniExcel.AddPicture(path, images);
</code></pre>
<p><img src="https://github.com/user-attachments/assets/19c4d241-9753-4ede-96c8-f810c1a22247" alt="Image" /></p>
<h4>7. Lấy kích thước Sheet</h4>
<pre><code class="language-csharp">var dim = MiniExcel.GetSheetDimensions(path);
</code></pre>
<h3>Ví dụ:</h3>
<h4>1. SQLite &amp; Dapper <code>Large Size File</code> SQL Insert Tránh OOM</h4>
<p>lưu ý : vui lòng không gọi các phương thức ToList/ToArray sau khi Query, vì nó sẽ tải toàn bộ dữ liệu vào bộ nhớ</p>
<pre><code class="language-csharp">using (var connection = new SQLiteConnection(connectionString))
{
    connection.Open();
    using (var transaction = connection.BeginTransaction())
    using (var stream = File.OpenRead(path))
    {
       var rows = stream.Query();
       foreach (var row in rows)
             connection.Execute(&quot;insert into T (A,B) values (@A,@B)&quot;, new { row.A, row.B }, transaction: transaction);
       transaction.Commit();
    }
}
</code></pre>
<p>hiệu năng:
<img src="https://user-images.githubusercontent.com/12729184/111072579-2dda7b80-8516-11eb-9843-c01a1edc88ec.png" alt="image" /></p>
<h4>2. ASP.NET Core 3.1 hoặc MVC 5 Download/Upload Excel Xlsx API Demo <a href="tests/MiniExcel.Tests.AspNetCore">Dùng thử</a></h4>
<pre><code class="language-csharp">public class ApiController : Controller
{
    public IActionResult Index()
    {
        return new ContentResult
        {
            ContentType = &quot;text/html&quot;,
            StatusCode = (int)HttpStatusCode.OK,
            Content = @&quot;&lt;html&gt;&lt;body&gt;
&lt;a href='api/DownloadExcel'&gt;DownloadExcel&lt;/a&gt;&lt;br&gt;
&lt;a href='api/DownloadExcelFromTemplatePath'&gt;DownloadExcelFromTemplatePath&lt;/a&gt;&lt;br&gt;
&lt;a href='api/DownloadExcelFromTemplateBytes'&gt;DownloadExcelFromTemplateBytes&lt;/a&gt;&lt;br&gt;
&lt;p&gt;Upload Excel&lt;/p&gt;
&lt;form method='post' enctype='multipart/form-data' action='/api/uploadexcel'&gt;
    &lt;input type='file' name='excel'&gt; &lt;br&gt;
    &lt;input type='submit' &gt;
&lt;/form&gt;
&lt;/body&gt;&lt;/html&gt;&quot;
        };
    }

    public IActionResult DownloadExcel()
    {
        var values = new[] {
            new { Column1 = &quot;MiniExcel&quot;, Column2 = 1 },
            new { Column1 = &quot;Github&quot;, Column2 = 2}
        };
        var memoryStream = new MemoryStream();
        memoryStream.SaveAs(values);
        memoryStream.Seek(0, SeekOrigin.Begin);
        return new FileStreamResult(memoryStream, &quot;application/vnd.openxmlformats-officedocument.spreadsheetml.sheet&quot;)
        {
            FileDownloadName = &quot;demo.xlsx&quot;
        };
    }

    public IActionResult DownloadExcelFromTemplatePath()
    {
        string templatePath = &quot;TestTemplateComplex.xlsx&quot;;

        Dictionary&lt;string, object&gt; value = new Dictionary&lt;string, object&gt;()
        {
            [&quot;title&quot;] = &quot;FooCompany&quot;,
            [&quot;managers&quot;] = new[] {
                new {name=&quot;Jack&quot;,department=&quot;HR&quot;},
                new {name=&quot;Loan&quot;,department=&quot;IT&quot;}
            },
            [&quot;employees&quot;] = new[] {
                new {name=&quot;Wade&quot;,department=&quot;HR&quot;},
                new {name=&quot;Felix&quot;,department=&quot;HR&quot;},
                new {name=&quot;Eric&quot;,department=&quot;IT&quot;},
                new {name=&quot;Keaton&quot;,department=&quot;IT&quot;}
            }
        };

        MemoryStream memoryStream = new MemoryStream();
        memoryStream.SaveAsByTemplate(templatePath, value);
        memoryStream.Seek(0, SeekOrigin.Begin);
        return new FileStreamResult(memoryStream, &quot;application/vnd.openxmlformats-officedocument.spreadsheetml.sheet&quot;)
        {
            FileDownloadName = &quot;demo.xlsx&quot;
        };
    }

    private static Dictionary&lt;string, Byte[]&gt; TemplateBytesCache = new Dictionary&lt;string, byte[]&gt;();

    static ApiController()
    {
        string templatePath = &quot;TestTemplateComplex.xlsx&quot;;
        byte[] bytes = System.IO.File.ReadAllBytes(templatePath);
        TemplateBytesCache.Add(templatePath, bytes);
    }

    public IActionResult DownloadExcelFromTemplateBytes()
    {
        byte[] bytes = TemplateBytesCache[&quot;TestTemplateComplex.xlsx&quot;];

        Dictionary&lt;string, object&gt; value = new Dictionary&lt;string, object&gt;()
        {
            [&quot;title&quot;] = &quot;FooCompany&quot;,
            [&quot;managers&quot;] = new[] {
                new {name=&quot;Jack&quot;,department=&quot;HR&quot;},
                new {name=&quot;Loan&quot;,department=&quot;IT&quot;}
</code></pre>
<pre><code class="language-csharp">            },
            [&quot;employees&quot;] = new[] {
                new {name=&quot;Wade&quot;,department=&quot;HR&quot;},
                new {name=&quot;Felix&quot;,department=&quot;HR&quot;},
                new {name=&quot;Eric&quot;,department=&quot;IT&quot;},
                new {name=&quot;Keaton&quot;,department=&quot;IT&quot;}
            }
        };

        MemoryStream memoryStream = new MemoryStream();
        memoryStream.SaveAsByTemplate(bytes, value);
        memoryStream.Seek(0, SeekOrigin.Begin);
        return new FileStreamResult(memoryStream, &quot;application/vnd.openxmlformats-officedocument.spreadsheetml.sheet&quot;)
        {
            FileDownloadName = &quot;demo.xlsx&quot;
        };
    }

    public IActionResult UploadExcel(IFormFile excel)
    {
        var stream = new MemoryStream();
        excel.CopyTo(stream);

        foreach (var item in stream.Query(true))
        {
            // xử lý logic của bạn ở đây, v.v.
        }

        return Ok(&quot;Tải file lên thành công&quot;);
    }
}
</code></pre>
<h4>3. Truy vấn phân trang</h4>
<pre><code class="language-csharp">void Main()
{
    var rows = MiniExcel.Query(path);

    Console.WriteLine(&quot;==== Trang số 1 ====&quot;);
    Console.WriteLine(Page(rows,pageSize:3,page:1));
    Console.WriteLine(&quot;==== Trang số 50 ====&quot;);
    Console.WriteLine(Page(rows,pageSize:3,page:50));
    Console.WriteLine(&quot;==== Trang số 5000 ====&quot;);
    Console.WriteLine(Page(rows,pageSize:3,page:5000));
}

public static IEnumerable&lt;T&gt; Page&lt;T&gt;(IEnumerable&lt;T&gt; en, int pageSize, int page)
{
    return en.Skip(page * pageSize).Take(pageSize);
}
</code></pre>
<p><img src="https://user-images.githubusercontent.com/12729184/114679083-6ef4c400-9d3e-11eb-9f78-a86daa45fe46.gif" alt="20210419" /></p>
<h4>4. WebForm xuất Excel bằng memorystream</h4>
<pre><code class="language-csharp">var fileName = &quot;Demo.xlsx&quot;;
var sheetName = &quot;Sheet1&quot;;
HttpResponse response = HttpContext.Current.Response;
response.Clear();
response.ContentType = &quot;application/vnd.openxmlformats-officedocument.spreadsheetml.sheet&quot;;
response.AddHeader(&quot;Content-Disposition&quot;, $&quot;attachment;filename=\&quot;{fileName}\&quot;&quot;);
var values = new[] {
    new { Column1 = &quot;MiniExcel&quot;, Column2 = 1 },
    new { Column1 = &quot;Github&quot;, Column2 = 2}
};
var memoryStream = new MemoryStream();
memoryStream.SaveAs(values, sheetName: sheetName);
memoryStream.Seek(0, SeekOrigin.Begin);
memoryStream.CopyTo(Response.OutputStream);
response.End();
</code></pre>
<h4>5. Đa ngôn ngữ động (i18n) và quản lý quyền vai trò</h4>
<p>Như ví dụ, tạo một phương thức để xử lý i18n và quản lý phân quyền, và sử dụng <code>yield return</code> để trả về <code>IEnumerable&lt;Dictionary&lt;string, object&gt;&gt;</code> nhằm đạt được hiệu ứng xử lý động và tiết kiệm bộ nhớ.</p>
<pre><code class="language-csharp">void Main()
{
    var value = new Order[] {
        new Order(){OrderNo = &quot;SO01&quot;,CustomerID=&quot;C001&quot;,ProductID=&quot;P001&quot;,Qty=100,Amt=500},
        new Order(){OrderNo = &quot;SO02&quot;,CustomerID=&quot;C002&quot;,ProductID=&quot;P002&quot;,Qty=300,Amt=400},
    };

    Console.WriteLine(&quot;en-Us và vai trò Sales&quot;);
    {
        var path = Path.GetTempPath() + Guid.NewGuid() + &quot;.xlsx&quot;;
        var lang = &quot;en-US&quot;;
        var role = &quot;Sales&quot;;
        MiniExcel.SaveAs(path, GetOrders(lang, role, value));
        MiniExcel.Query(path, true).Dump();
    }

    Console.WriteLine(&quot;zh-CN và vai trò PMC&quot;);
    {
        var path = Path.GetTempPath() + Guid.NewGuid() + &quot;.xlsx&quot;;
        var lang = &quot;zh-CN&quot;;
        var role = &quot;PMC&quot;;
        MiniExcel.SaveAs(path, GetOrders(lang, role, value));
        MiniExcel.Query(path, true).Dump();
    }
}

private IEnumerable&lt;Dictionary&lt;string, object&gt;&gt; GetOrders(string lang, string role, Order[] orders)
{
    foreach (var order in orders)
    {
        var newOrder = new Dictionary&lt;string, object&gt;();

        if (lang == &quot;zh-CN&quot;)
        {
            newOrder.Add(&quot;客户编号&quot;, order.CustomerID);
            newOrder.Add(&quot;订单编号&quot;, order.OrderNo);
            newOrder.Add(&quot;产品编号&quot;, order.ProductID);
            newOrder.Add(&quot;数量&quot;, order.Qty);
            if (role == &quot;Sales&quot;)
                newOrder.Add(&quot;价格&quot;, order.Amt);
            yield return newOrder;
        }
        else if (lang == &quot;en-US&quot;)
        {
            newOrder.Add(&quot;Customer ID&quot;, order.CustomerID);
            newOrder.Add(&quot;Order No&quot;, order.OrderNo);
            newOrder.Add(&quot;Product ID&quot;, order.ProductID);
            newOrder.Add(&quot;Quantity&quot;, order.Qty);
            if (role == &quot;Sales&quot;)
                newOrder.Add(&quot;Amount&quot;, order.Amt);
            yield return newOrder;
        }
        else
        {
            throw new InvalidDataException($&quot;lang {lang} wrong&quot;);
        }
    }
}

public class Order
{
    public string OrderNo { get; set; }
    public string CustomerID { get; set; }
    public decimal Qty { get; set; }
    public string ProductID { get; set; }
    public decimal Amt { get; set; }
}
</code></pre>
<p><img src="https://user-images.githubusercontent.com/12729184/118939964-d24bc480-b982-11eb-88dd-f06655f6121a.png" alt="image" /></p>
<h3>FAQ</h3>
<h4>Q: Tiêu đề cột trong Excel không giống tên thuộc tính của class, làm sao để ánh xạ?</h4>
<p>A. Vui lòng sử dụng thuộc tính ExcelColumnName</p>
<p><img src="https://user-images.githubusercontent.com/12729184/116020475-eac50980-a678-11eb-8804-129e87200e5e.png" alt="image" /></p>
<h4>Q. Làm sao để truy vấn hoặc xuất nhiều sheet?</h4>
<p>A. Sử dụng phương thức <code>GetSheetNames</code> với tham số sheetName trong  Query .</p>
<pre><code class="language-csharp">var sheets = MiniExcel.GetSheetNames(path);
foreach (var sheet in sheets)
{
    Console.WriteLine($&quot;sheet name : {sheet} &quot;);
    var rows = MiniExcel.Query(path,useHeaderRow:true,sheetName:sheet);
    Console.WriteLine(rows);
}
</code></pre>
<p><img src="https://user-images.githubusercontent.com/12729184/116199841-2a1f5300-a76a-11eb-90a3-6710561cf6db.png" alt="image" /></p>
<h4>Q. Làm sao để truy vấn hoặc xuất thông tin về trạng thái hiển thị của sheet?</h4>
<p>A. Sử dụng phương thức <code>GetSheetInformations</code>.</p>
<pre><code class="language-csharp">var sheets = MiniExcel.GetSheetInformations(path);
foreach (var sheetInfo in sheets)
{
    Console.WriteLine($&quot;sheet index : {sheetInfo.Index} &quot;); // chỉ số sheet tiếp theo - đánh số từ 0
    Console.WriteLine($&quot;sheet name : {sheetInfo.Name} &quot;);   // tên sheet
    Console.WriteLine($&quot;sheet state : {sheetInfo.State} &quot;); // trạng thái hiển thị của sheet - visible / hidden
}
</code></pre>
<h4>Hỏi. Việc sử dụng Count có tải tất cả dữ liệu vào bộ nhớ không?</h4>
<p>Không, bài kiểm tra hình ảnh có 1 triệu dòng * 10 cột dữ liệu, mức sử dụng bộ nhớ tối đa là &lt;60MB, và mất 13,65 giây</p>
<p><img src="https://user-images.githubusercontent.com/12729184/117118518-70586000-adc3-11eb-9ce3-2ba76cf8b5e5.png" alt="image" /></p>
<h4>Hỏi. Query sử dụng chỉ số số nguyên như thế nào?</h4>
<p>Chỉ số mặc định của Query là Key dạng chuỗi: A,B,C.... Nếu bạn muốn chuyển sang chỉ số số, hãy tạo phương thức sau để chuyển đổi</p>
<pre><code class="language-csharp">void Main()
{
    var path = @&quot;D:\git\MiniExcel\samples\xlsx\TestTypeMapping.xlsx&quot;;
    var rows = MiniExcel.Query(path,true);
    foreach (var r in ConvertToIntIndexRows(rows))
    {
        Console.Write($&quot;column 0 : {r[0]} ,column 1 : {r[1]}&quot;);
        Console.WriteLine();
    }
}

private IEnumerable&lt;Dictionary&lt;int, object&gt;&gt; ConvertToIntIndexRows(IEnumerable&lt;object&gt; rows)
{
    ICollection&lt;string&gt; keys = null;
    var isFirst = true;
    foreach (IDictionary&lt;string,object&gt; r in rows)
    {
        if(isFirst)
        {
            keys = r.Keys;
            isFirst = false;
        }

        var dic = new Dictionary&lt;int, object&gt;();
        var index = 0;
        foreach (var key in keys)
            dic[index++] = r[key];
        yield return dic;
    }
}
</code></pre>
<h4>Hỏi. Khi xuất Excel, nếu giá trị rỗng thì tạo file excel không có tiêu đề</h4>
<p>Vì MiniExcel sử dụng logic tương tự JSON.NET để lấy kiểu dữ liệu từ giá trị một cách động nhằm đơn giản hóa thao tác API, nên không thể biết được kiểu dữ liệu nếu không có dữ liệu. Bạn có thể xem thêm tại <a href="https://github.com/mini-software/MiniExcel/issues/133">issue #133</a> để hiểu rõ hơn.</p>
<p><img src="https://user-images.githubusercontent.com/12729184/122639771-546c0c00-d12e-11eb-800c-498db27889ca.png" alt="image" /></p>
<blockquote>
<p>Kiểu strong type &amp; DataTable sẽ sinh tiêu đề, nhưng Dictionary vẫn tạo file Excel rỗng</p>
</blockquote>
<h4>Hỏi. Làm thế nào để dừng foreach khi gặp dòng trống?</h4>
<p>MiniExcel có thể kết hợp với <code>LINQ TakeWhile</code> để dừng vòng lặp foreach.</p>
<p><img src="https://user-images.githubusercontent.com/12729184/130209137-162621c2-f337-4479-9996-beeac65bc4d4.png" alt="Image" /></p>
<h4>Hỏi. Làm thế nào để loại bỏ các dòng trống?</h4>
<p><img src="https://user-images.githubusercontent.com/12729184/137873865-7107d8f5-eb59-42db-903a-44e80589f1b2.png" alt="image" /></p>
<p>IEnumerable :</p>
<pre><code class="language-csharp">public static IEnumerable&lt;dynamic&gt; QueryWithoutEmptyRow(Stream stream, bool useHeaderRow, string sheetName, ExcelType excelType, string startCell, IConfiguration configuration)
{
    var rows = stream.Query(useHeaderRow,sheetName,excelType,startCell,configuration);
    foreach (IDictionary&lt;string,object&gt; row in rows)
    {
        if(row.Keys.Any(key=&gt;row[key]!=null))
            yield return row;
    }
}
</code></pre>
<p>DataTable :</p>
<pre><code class="language-csharp">public static DataTable QueryAsDataTableWithoutEmptyRow(Stream stream, bool useHeaderRow, string sheetName, ExcelType excelType, string startCell, IConfiguration configuration)
{
    if (sheetName == null &amp;&amp; excelType != ExcelType.CSV) /*Issue #279*/
        sheetName = stream.GetSheetNames().First();

    var dt = new DataTable(sheetName);
    var first = true;
    var rows = stream.Query(useHeaderRow,sheetName,excelType,startCell,configuration);
    foreach (IDictionary&lt;string, object&gt; row in rows)
    {
        if (first)
        {

            foreach (var key in row.Keys)
            {
                var column = new DataColumn(key, typeof(object)) { Caption = key };
                dt.Columns.Add(column);
            }

            dt.BeginLoadData();
            first = false;
        }

        var newRow = dt.NewRow();
        var isNull=true;
        foreach (var key in row.Keys)
        {
            var _v = row[key];
            if(_v!=null)
                isNull = false;
            newRow[key] = _v;
        }

        if(!isNull)
            dt.Rows.Add(newRow);
    }

    dt.EndLoadData();
    return dt;
}
</code></pre>
<h4>Hỏi. Làm thế nào để SaveAs(path,value) ghi đè file đã tồn tại mà không báo lỗi &quot;The file ...xlsx already exists error&quot;</h4>
<p>Vui lòng sử dụng lớp Stream để tùy chỉnh logic tạo file, ví dụ:</p>
<pre><code class="language-C#">    using (var stream = File.Create(&quot;Demo.xlsx&quot;))
        MiniExcel.SaveAs(stream,value);
</code></pre>
<p>hoặc, từ phiên bản V1.25.0, SaveAs hỗ trợ tham số overwriteFile để bật/tắt ghi đè file đã tồn tại</p>
<pre><code class="language-csharp">    MiniExcel.SaveAs(path, value, overwriteFile: true);
</code></pre>
<h3>Giới hạn và lưu ý</h3>
<ul>
<li>Hiện không hỗ trợ xls và file mã hóa</li>
<li>xlsm chỉ hỗ trợ Query</li>
</ul>
<h3>Tham khảo</h3>
<p><a href="https://github.com/ExcelDataReader/ExcelDataReader">ExcelDataReader</a>  / <a href="https://github.com/ClosedXML/ClosedXML">ClosedXML</a> / <a href="https://github.com/DapperLib/Dapper">Dapper</a> / <a href="https://github.com/andersnm/ExcelNumberFormat">ExcelNumberFormat</a></p>
<h3>Cảm ơn</h3>
<h4><a href="https://www.jetbrains.com/">Jetbrains</a></h4>
<p><img src="https://user-images.githubusercontent.com/12729184/123997015-8456c180-da02-11eb-829a-aec476fe8e94.png" alt="jetbrains-variant-2" /></p>
<p>Cảm ơn đã cung cấp miễn phí All product IDE cho dự án này (<a href="https://user-images.githubusercontent.com/12729184/123988233-6ab17c00-d9fa-11eb-8739-2a08c6a4a263.png">License</a>)</p>
<h3>Chia sẻ đóng góp donate</h3>
<p>Liên kết https://github.com/orgs/mini-software/discussions/754</p>
<h3>Những người đóng góp</h3>
<p><img src="https://contrib.rocks/image?repo=mini-software/MiniExcel" alt="" /></p>
<hr />
<p>Tranlated By <a href="https://github.com/OpenAiTx/OpenAiTx">Open Ai Tx</a> | Last indexed: 2025-06-08</p>
<hr />

        </div>
    </div>
    <footer class="footer">
        Powered by <a href="https://github.com/OpenAiTx/OpenAiTx" target="_blank">Open AI Tx</a>
    </footer>
    <!-- Default Statcounter code for openaitx
https://openaitx.github.io/ -->
    <script type="text/javascript">
        var sc_project = 13142514;
        var sc_invisible = 1;
        var sc_security = "d03a31d8"; 
    </script>
    <script type="text/javascript" src="https://www.statcounter.com/counter/counter.js" async></script>
    <noscript>
        <div class="statcounter"><a title="Web Analytics" href="https://statcounter.com/" target="_blank"><img
                    class="statcounter" src="https://c.statcounter.com/13142514/0/d03a31d8/1/" alt="Web Analytics"
                    referrerPolicy="no-referrer-when-downgrade"></a></div>
    </noscript>
    <!-- End of Statcounter Code -->
</body>
</html>