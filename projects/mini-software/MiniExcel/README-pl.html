<!DOCTYPE html><html lang="en"><head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Open AI Tx - Markdown Viewer</title>

    <!-- Primary Meta Tags -->
    <meta name="title" content="Open AI Tx - Markdown Viewer">
    <meta name="description" content="GitHub style markdown viewer for Open AI Tx projects">
    <meta name="keywords" content="Open AI Tx, Markdown, GitHub Style, Documentation">
    <meta name="author" content="Open AI Tx">
    <meta name="robots" content="index, follow">

    <!-- Open Graph -->
    <meta property="og:type" content="website">
    <meta property="og:url" content="https://openaitx.github.io/view.html">
    <meta property="og:title" content="Open AI Tx - Markdown Viewer">
    <meta property="og:description" content="GitHub style markdown viewer for Open AI Tx projects">
    <meta property="og:image" content="https://openaitx.github.io/logo_crop.png">

    <!-- Favicon -->
    <link rel="icon" type="image/jpeg" href="icon.jpg">
    <link rel="apple-touch-icon" href="icon.jpg">

    <!-- Marked.js for Markdown rendering -->
    <script type="text/javascript" async="" src="https://www.statcounter.com/counter/recorder.js"></script><script src="js/marked.min.js"></script>
    <!-- Highlight.js for code syntax highlighting -->
    <link rel="stylesheet" href="css/github.min.css">
    <script src="js/highlight.min.js"></script>
    <!-- Custom CSS -->
    <link rel="stylesheet" href="view.css">
    <style>
        /* Layout */
        body {
            display: flex;
            flex-direction: column;
            min-height: 100vh;
        }

        .main-container {
            margin: 0 auto;
            width: 100%;
            max-width: 980px;
            padding: 0 20px;
        }

        @media (max-width: 768px) {
            .main-container {
                padding: 0 15px;
            }
        }

        /* Image size restrictions */
        .markdown-body img {
            max-width: 100%;
            height: auto;
        }

        /* Existing styles */
        .header {
            text-align: center;
            margin-bottom: 30px;
            padding: 20px;
            background-color: #f6f8fa;
            border-bottom: 1px solid #e1e4e8;
            position: relative;
        }

        .back-button {
            position: absolute;
            left: 20px;
            top: 50%;
            transform: translateY(-50%);
            color: #0366d6;
            text-decoration: none;
            display: flex;
            align-items: center;
            font-size: 14px;
            padding: 5px 10px;
            border: 1px solid #e1e4e8;
            border-radius: 6px;
            background-color: #fff;
        }

        .back-button:hover {
            background-color: #f6f8fa;
            border-color: #0366d6;
        }

        .back-button::before {
            content: "←";
            margin-right: 5px;
            font-size: 16px;
        }

        .header .links {
            margin-top: 10px;
            font-size: 16px;
        }

        .header .links a {
            color: #0366d6;
            text-decoration: none;
            margin-left: 5px;
        }

        .header .links a:hover {
            text-decoration: underline;
        }
        
        /* Language badges styles */
        .language-badges {
            margin-top: 15px;
            text-align: center;
        }
        .language-badges a {
            display: inline-block;
            margin: 2px;
            text-decoration: none;
        }
        .language-badges img {
            height: 20px;
            border-radius: 3px;
        }
        .language-badges a:hover img {
            opacity: 0.8;
        }
    </style>
</head>

<body>
    <div class="header">
        <a href="javascript:history.back()" class="back-button">Back</a>
        <div class="links">
            GitHub Repository: <a href="https://github.com/mini-software/MiniExcel" id="githubRepoLink" target="_blank">mini-software/MiniExcel</a>
        </div>
        <div class="language-badges" id="languageBadges"><a href="https://openaitx.github.io/view.html?user=mini-software&amp;project=MiniExcel&amp;lang=en"><img src="https://img.shields.io/badge/EN-white" alt="version"></a> <a href="https://openaitx.github.io/view.html?user=mini-software&amp;project=MiniExcel&amp;lang=zh-CN"><img src="https://img.shields.io/badge/简中-white" alt="version"></a> <a href="https://openaitx.github.io/view.html?user=mini-software&amp;project=MiniExcel&amp;lang=zh-TW"><img src="https://img.shields.io/badge/繁中-white" alt="version"></a> <a href="https://openaitx.github.io/view.html?user=mini-software&amp;project=MiniExcel&amp;lang=ja"><img src="https://img.shields.io/badge/日本語-white" alt="version"></a> <a href="https://openaitx.github.io/view.html?user=mini-software&amp;project=MiniExcel&amp;lang=ko"><img src="https://img.shields.io/badge/한국어-white" alt="version"></a> <a href="https://openaitx.github.io/view.html?user=mini-software&amp;project=MiniExcel&amp;lang=th"><img src="https://img.shields.io/badge/ไทย-white" alt="version"></a> <a href="https://openaitx.github.io/view.html?user=mini-software&amp;project=MiniExcel&amp;lang=fr"><img src="https://img.shields.io/badge/Français-white" alt="version"></a> <a href="https://openaitx.github.io/view.html?user=mini-software&amp;project=MiniExcel&amp;lang=de"><img src="https://img.shields.io/badge/Deutsch-white" alt="version"></a> <a href="https://openaitx.github.io/view.html?user=mini-software&amp;project=MiniExcel&amp;lang=es"><img src="https://img.shields.io/badge/Español-white" alt="version"></a> <a href="https://openaitx.github.io/view.html?user=mini-software&amp;project=MiniExcel&amp;lang=it"><img src="https://img.shields.io/badge/Italiano-white" alt="version"></a> <a href="https://openaitx.github.io/view.html?user=mini-software&amp;project=MiniExcel&amp;lang=ru"><img src="https://img.shields.io/badge/Русский-white" alt="version"></a> <a href="https://openaitx.github.io/view.html?user=mini-software&amp;project=MiniExcel&amp;lang=pt"><img src="https://img.shields.io/badge/Português-white" alt="version"></a> <a href="https://openaitx.github.io/view.html?user=mini-software&amp;project=MiniExcel&amp;lang=nl"><img src="https://img.shields.io/badge/Nederlands-white" alt="version"></a> <a href="https://openaitx.github.io/view.html?user=mini-software&amp;project=MiniExcel&amp;lang=pl"><img src="https://img.shields.io/badge/Polski-white" alt="version"></a> <a href="https://openaitx.github.io/view.html?user=mini-software&amp;project=MiniExcel&amp;lang=ar"><img src="https://img.shields.io/badge/العربية-white" alt="version"></a> <a href="https://openaitx.github.io/view.html?user=mini-software&amp;project=MiniExcel&amp;lang=tr"><img src="https://img.shields.io/badge/Türkçe-white" alt="version"></a> <a href="https://openaitx.github.io/view.html?user=mini-software&amp;project=MiniExcel&amp;lang=vi"><img src="https://img.shields.io/badge/Tiếng Việt-white" alt="version"></a></div>
    </div>

    <div class="main-container">
        <div class="markdown-body" id="content"><div style="text-align: center">
<p><a href="https://www.nuget.org/packages/MiniExcel"><img src="https://img.shields.io/nuget/v/MiniExcel.svg" alt="NuGet"></a>  <a href="https://www.nuget.org/packages/MiniExcel"><img src="https://img.shields.io/nuget/dt/MiniExcel.svg" alt=""></a>
<a href="https://ci.appveyor.com/project/mini-software/miniexcel/branch/master"><img src="https://ci.appveyor.com/api/projects/status/b2vustrwsuqx45f4/branch/master?svg=true" alt="Build status"></a>
<a href="https://gitee.com/dotnetchina/MiniExcel"><img src="https://gitee.com/dotnetchina/MiniExcel/badge/star.svg" alt="star"></a> <a href="https://github.com/mini-software/MiniExcel" rel="nofollow"><img src="https://img.shields.io/github/stars/mini-software/MiniExcel?logo=github" alt="GitHub stars"></a>
<a href="https://www.nuget.org/packages/MiniExcel"><img src="https://img.shields.io/badge/.NET-%3E%3D%204.5-red.svg" alt="version"></a>
<a href="https://deepwiki.com/mini-software/MiniExcel"><img src="https://deepwiki.com/badge.svg" alt="Ask DeepWiki"></a>
</p>
</div>

<hr>
<p><a href="https://www.dotnetfoundation.org/"><img align="right" src="https://github.com/dotnet-foundation/swag/blob/main/logo/dotnetfoundation_v4.png?raw=true" width="100"></a></p>
<div style="text-align: center">
<p>Ten projekt jest częścią <a href="https://www.dotnetfoundation.org/">.NET Foundation</a> i działa zgodnie z ich <a href="https://www.dotnetfoundation.org/code-of-conduct">kodeksem postępowania</a>. </p>
</div>

<hr>
<div style="text-align: center">
<p><strong><a href="README.md">English</a> | <a href="README.zh-CN.md">简体中文</a> | <a href="README.zh-Hant.md">繁體中文</a></strong></p>
</div>

<hr>
<div style="text-align: center">
 Twój <a href="https://github.com/mini-software/MiniExcel">Star</a> i <a href="https://miniexcel.github.io">Donate</a> mogą sprawić, że MiniExcel będzie jeszcze lepszy
</div>

<hr>
<h3>Wprowadzenie</h3>
<p>MiniExcel to proste i wydajne narzędzie .NET do przetwarzania plików Excel, zapobiegające OOM.</p>
<p>Obecnie większość popularnych frameworków musi załadować wszystkie dane do pamięci, aby umożliwić operacje, co powoduje problemy z zużyciem pamięci. MiniExcel stara się używać algorytmu opartego na strumieniach, by zredukować oryginalne zajęcie 1000 MB do kilku MB i uniknąć OOM (out of memory).</p>
<p><img src="https://user-images.githubusercontent.com/12729184/113086657-ab8bd000-9214-11eb-9563-c970ac1ee35e.png" alt="image"></p>
<h3>Funkcje</h3>
<ul>
<li>Niskie zużycie pamięci, zapobiega OOM (out of memory) i pełnemu GC</li>
<li>Obsługuje operacje na każdym wierszu danych w czasie rzeczywistym</li>
<li>Obsługuje odroczone wykonanie LINQ, umożliwia zapytania z niskim zużyciem pamięci, szybkie stronicowanie i inne złożone operacje</li>
<li>Lekki, nie wymaga instalacji Microsoft Office, brak COM+, rozmiar DLL mniejszy niż 400KB</li>
<li>Łatwe w użyciu API do odczytu/zapisu/wypełniania excela</li>
</ul>
<h3>Pierwsze kroki</h3>
<ul>
<li><p><a href="#getstart1">Importowanie/Zapytania Excel</a></p>
</li>
<li><p><a href="#getstart2">Eksportowanie/Tworzenie Excel</a></p>
</li>
<li><p><a href="#getstart3">Szablon Excel</a></p>
</li>
<li><p><a href="#getstart4">Nazwa kolumny/Indeks/Atrybut ignorowania w Excelu</a></p>
</li>
<li><p><a href="#getstart5">Przykłady</a></p>
</li>
</ul>
<h3>Instalacja</h3>
<p>Możesz zainstalować paczkę <a href="https://www.nuget.org/packages/MiniExcel">z NuGet</a></p>
<h3>Notatki o wydaniu</h3>
<p>Sprawdź <a href="https://raw.githubusercontent.com/mini-software/MiniExcel/master/docs">Release Notes</a></p>
<h3>TODO</h3>
<p>Sprawdź <a href="https://github.com/mini-software/MiniExcel/projects/1?fullscreen=true">TODO</a></p>
<h3>Wydajność</h3>
<p>Kod do benchmarków znajduje się w <a href="https://raw.githubusercontent.com/mini-software/MiniExcel/master/benchmarks/MiniExcel.Benchmarks/Program.cs">MiniExcel.Benchmarks</a>.</p>
<p>Plik użyty do testowania wydajności to <a href="https://raw.githubusercontent.com/mini-software/MiniExcel/master/benchmarks/MiniExcel.Benchmarks/Test1%2C000%2C000x10.xlsx"><strong>Test1,000,000x10.xlsx</strong></a>, dokument o wielkości 32MB zawierający 1 000 000 wierszy * 10 kolumn, gdzie komórki są wypełnione tekstem "HelloWorld".</p>
<p>Aby uruchomić wszystkie benchmarki, użyj:</p>
<pre><code class="language-bash hljs">dotnet run -project .\benchmarks\MiniExcel.Benchmarks -c Release -f net9.0 -filter * --<span class="hljs-built_in">join</span>
</code></pre>
<p>Wyniki benchmarków dla najnowszego wydania znajdziesz <a href="https://raw.githubusercontent.com/mini-software/MiniExcel/master/benchmarks/results">tutaj</a>.</p>
<h3>Zapytania/Import Excel  <a name="getstart1"></a></h3>
<h4>1. Wykonaj zapytanie i zmapuj wyniki do silnie typizowanego IEnumerable <a href="https://dotnetfiddle.net/w5WD1J">[Wypróbuj]</a></h4>
<p>Zaleca się użycie Stream.Query ze względu na lepszą wydajność.</p>
<pre><code class="language-csharp hljs"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title">UserAccount</span>
{
    <span class="hljs-keyword">public</span> Guid ID { <span class="hljs-keyword">get</span>; <span class="hljs-keyword">set</span>; }
    <span class="hljs-keyword">public</span> <span class="hljs-built_in">string</span> Name { <span class="hljs-keyword">get</span>; <span class="hljs-keyword">set</span>; }
    <span class="hljs-keyword">public</span> DateTime BoD { <span class="hljs-keyword">get</span>; <span class="hljs-keyword">set</span>; }
    <span class="hljs-keyword">public</span> <span class="hljs-built_in">int</span> Age { <span class="hljs-keyword">get</span>; <span class="hljs-keyword">set</span>; }
    <span class="hljs-keyword">public</span> <span class="hljs-built_in">bool</span> VIP { <span class="hljs-keyword">get</span>; <span class="hljs-keyword">set</span>; }
    <span class="hljs-keyword">public</span> <span class="hljs-built_in">decimal</span> Points { <span class="hljs-keyword">get</span>; <span class="hljs-keyword">set</span>; }
}

<span class="hljs-keyword">var</span> rows = MiniExcel.Query&lt;UserAccount&gt;(path);

<span class="hljs-comment">// lub</span>

<span class="hljs-keyword">using</span> (<span class="hljs-keyword">var</span> stream = File.OpenRead(path))
    <span class="hljs-keyword">var</span> rows = stream.Query&lt;UserAccount&gt;();
</code></pre>
<p><img src="https://user-images.githubusercontent.com/12729184/111107423-c8c46b80-8591-11eb-982f-c97a2dafb379.png" alt="image"></p>
<h4>2. Wykonaj zapytanie i zmapuj do listy dynamicznych obiektów bez używania nagłówka <a href="https://dotnetfiddle.net/w5WD1J">[Wypróbuj]</a></h4>
<ul>
<li>dynamic key to <code>A.B.C.D..</code></li>
</ul>
<table>
<thead>
<tr>
<th>MiniExcel</th>
<th>1</th>
</tr>
</thead>
<tbody><tr>
<td>Github</td>
<td>2</td>
</tr>
</tbody></table>
<pre><code class="language-csharp hljs">
<span class="hljs-keyword">var</span> rows = MiniExcel.Query(path).ToList();

<span class="hljs-comment">// lub</span>
<span class="hljs-keyword">using</span> (<span class="hljs-keyword">var</span> stream = File.OpenRead(path))
{
    <span class="hljs-keyword">var</span> rows = stream.Query().ToList();

    Assert.Equal(<span class="hljs-string">"MiniExcel"</span>, rows[<span class="hljs-number">0</span>].A);
    Assert.Equal(<span class="hljs-number">1</span>, rows[<span class="hljs-number">0</span>].B);
    Assert.Equal(<span class="hljs-string">"Github"</span>, rows[<span class="hljs-number">1</span>].A);
    Assert.Equal(<span class="hljs-number">2</span>, rows[<span class="hljs-number">1</span>].B);
}
</code></pre>
<h4>3. Wykonaj zapytanie z pierwszym wierszem jako nagłówkiem <a href="https://dotnetfiddle.net/w5WD1J">[Wypróbuj]</a></h4>
<p>uwaga: w przypadku powtarzających się nazw kolumn używana jest ostatnia z prawej strony</p>
<p>Input Excel :</p>
<table>
<thead>
<tr>
<th>Column1</th>
<th>Column2</th>
</tr>
</thead>
<tbody><tr>
<td>MiniExcel</td>
<td>1</td>
</tr>
<tr>
<td>Github</td>
<td>2</td>
</tr>
</tbody></table>
<pre><code class="language-csharp hljs">
<span class="hljs-keyword">var</span> rows = MiniExcel.Query(useHeaderRow:<span class="hljs-literal">true</span>).ToList();

<span class="hljs-comment">// lub</span>

<span class="hljs-keyword">using</span> (<span class="hljs-keyword">var</span> stream = File.OpenRead(path))
{
    <span class="hljs-keyword">var</span> rows = stream.Query(useHeaderRow:<span class="hljs-literal">true</span>).ToList();

    Assert.Equal(<span class="hljs-string">"MiniExcel"</span>, rows[<span class="hljs-number">0</span>].Column1);
    Assert.Equal(<span class="hljs-number">1</span>, rows[<span class="hljs-number">0</span>].Column2);
    Assert.Equal(<span class="hljs-string">"Github"</span>, rows[<span class="hljs-number">1</span>].Column1);
    Assert.Equal(<span class="hljs-number">2</span>, rows[<span class="hljs-number">1</span>].Column2);
}
</code></pre>
<h4>4. Zapytania z wykorzystaniem rozszerzeń LINQ First/Take/Skip itd.</h4>
<p>Query First</p>
<pre><code class="language-csharp hljs"><span class="hljs-keyword">var</span> row = MiniExcel.Query(path).First();
Assert.Equal(<span class="hljs-string">"HelloWorld"</span>, row.A);

<span class="hljs-comment">// lub</span>

<span class="hljs-keyword">using</span> (<span class="hljs-keyword">var</span> stream = File.OpenRead(path))
{
    <span class="hljs-keyword">var</span> row = stream.Query().First();
    Assert.Equal(<span class="hljs-string">"HelloWorld"</span>, row.A);
}
</code></pre>
<p>Wydajność MiniExcel/ExcelDataReader/ClosedXML/EPPlus<br><img src="https://user-images.githubusercontent.com/12729184/111072392-6037a900-8515-11eb-9693-5ce2dad1e460.gif" alt="queryfirst"></p>
<h4>5. Zapytanie po nazwie arkusza</h4>
<pre><code class="language-csharp hljs">MiniExcel.Query(path, sheetName: <span class="hljs-string">"SheetName"</span>);
<span class="hljs-comment">//lub</span>
stream.Query(sheetName: <span class="hljs-string">"SheetName"</span>);
</code></pre>
<h4>6. Zapytanie o wszystkie nazwy arkuszy i wiersze</h4>
<pre><code class="language-csharp hljs"><span class="hljs-keyword">var</span> sheetNames = MiniExcel.GetSheetNames(path);
<span class="hljs-keyword">foreach</span> (<span class="hljs-keyword">var</span> sheetName <span class="hljs-keyword">in</span> sheetNames)
{
    <span class="hljs-keyword">var</span> rows = MiniExcel.Query(path, sheetName: sheetName);
}
</code></pre>
<h4>7. Pobierz kolumny</h4>
<pre><code class="language-csharp hljs"><span class="hljs-keyword">var</span> columns = MiniExcel.GetColumns(path); <span class="hljs-comment">// np. wynik : ["A","B"...]</span>

<span class="hljs-keyword">var</span> cnt = columns.Count;  <span class="hljs-comment">// liczba kolumn</span>
</code></pre>
<h4>8. Dynamiczne zapytanie rzutujące wiersz na <code>IDictionary&lt;string,object&gt;</code></h4>
<pre><code class="language-csharp hljs"><span class="hljs-keyword">foreach</span>(IDictionary&lt;<span class="hljs-built_in">string</span>,<span class="hljs-built_in">object</span>&gt; row <span class="hljs-keyword">in</span> MiniExcel.Query(path))
{
    <span class="hljs-comment">//..</span>
}

<span class="hljs-comment">// lub</span>
<span class="hljs-keyword">var</span> rows = MiniExcel.Query(path).Cast&lt;IDictionary&lt;<span class="hljs-built_in">string</span>,<span class="hljs-built_in">object</span>&gt;&gt;();
<span class="hljs-comment">// lub zapytanie o określone zakresy (z wielkiej litery)</span>
<span class="hljs-comment">// A2 oznacza drugi wiersz kolumny A, C3 oznacza trzeci wiersz kolumny C</span>
<span class="hljs-comment">// Jeśli nie chcesz ograniczać wierszy, po prostu nie podawaj liczb</span>
<span class="hljs-keyword">var</span> rows = MiniExcel.QueryRange(path, startCell: <span class="hljs-string">"A2"</span>, endCell: <span class="hljs-string">"C3"</span>).Cast&lt;IDictionary&lt;<span class="hljs-built_in">string</span>, <span class="hljs-built_in">object</span>&gt;&gt;();
</code></pre>
<h4>9. Zapytanie do Excela zwraca DataTable</h4>
<p>Nie zalecane, ponieważ DataTable wczytuje wszystkie dane do pamięci i traci zaletę niskiego zużycia pamięci przez MiniExcel.</p>
<pre><code class="language-C# hljs language-C">var table = MiniExcel.QueryAsDataTable(path, useHeaderRow: <span class="hljs-literal">true</span>);
</code></pre>
<p><img src="https://user-images.githubusercontent.com/12729184/116673475-07917200-a9d6-11eb-947e-a6f68cce58df.png" alt="image"></p>
<h4>10. Określ komórkę, od której zaczyna się czytanie danych</h4>
<pre><code class="language-csharp hljs">MiniExcel.Query(path,useHeaderRow:<span class="hljs-literal">true</span>,startCell:<span class="hljs-string">"B3"</span>)
</code></pre>
<p><img src="https://user-images.githubusercontent.com/12729184/117260316-8593c400-ae81-11eb-9877-c087b7ac2b01.png" alt="image"></p>
<h4>11. Wypełnianie scalonych komórek</h4>
<p>Uwaga: Wydajność jest niższa w porównaniu do <code>nie używania wypełniania scalonych komórek</code></p>
<p>Powód: Standard OpenXml umieszcza mergeCells na dole pliku, co powoduje konieczność dwukrotnego przechodzenia przez sheetxml</p>
<pre><code class="language-csharp hljs">    <span class="hljs-keyword">var</span> config = <span class="hljs-keyword">new</span> OpenXmlConfiguration()
    {
        FillMergedCells = <span class="hljs-literal">true</span>
    };
    <span class="hljs-keyword">var</span> rows = MiniExcel.Query(path, configuration: config);
</code></pre>
<p><img src="https://user-images.githubusercontent.com/12729184/117973630-3527d500-b35f-11eb-95c3-bde255f8114e.png" alt="image"></p>
<p>obsługa zmiennej długości i szerokości wielorzędowego i wielokolumnowego wypełniania</p>
<p><img src="https://user-images.githubusercontent.com/12729184/117973820-6d2f1800-b35f-11eb-88d8-555063938108.png" alt="image"></p>
<h4>12. Odczyt dużych plików przez pamięć podręczną na dysku (Disk-Base Cache - SharedString)</h4>
<p>Jeśli rozmiar SharedStrings przekracza 5 MB, MiniExcel domyślnie użyje lokalnej pamięci podręcznej na dysku, np. <a href="https://github.com/MiniExcel/MiniExcel/files/8403819/NotDuplicateSharedStrings_10x100000.xlsx">10x100000.xlsx</a> (milion wierszy danych), po wyłączeniu pamięci podręcznej na dysku maksymalne zużycie pamięci to 195MB, ale przy włączonej pamięci podręcznej wystarczy tylko 65MB. Uwaga, ta optymalizacja wymaga pewnych kosztów wydajności, więc w tym przypadku czas odczytu wzrasta z 7,4 sekundy do 27,2 sekundy. Jeśli tego nie potrzebujesz, możesz wyłączyć pamięć podręczną na dysku poniższym kodem:</p>
<pre><code class="language-csharp hljs"><span class="hljs-keyword">var</span> config = <span class="hljs-keyword">new</span> OpenXmlConfiguration { EnableSharedStringCache = <span class="hljs-literal">false</span> };
MiniExcel.Query(path,configuration: config)
</code></pre>
<p>Możesz użyć <code>SharedStringCacheSize</code>, aby zmienić rozmiar pliku sharedString, po przekroczeniu którego używana będzie pamięć podręczna na dysku</p>
<pre><code class="language-csharp hljs"><span class="hljs-keyword">var</span> config = <span class="hljs-keyword">new</span> OpenXmlConfiguration { SharedStringCacheSize=<span class="hljs-number">500</span>*<span class="hljs-number">1024</span>*<span class="hljs-number">1024</span> };
MiniExcel.Query(path, configuration: config);
</code></pre>
<p><img src="https://user-images.githubusercontent.com/12729184/161411851-1c3f72a7-33b3-4944-84dc-ffc1d16747dd.png" alt="image"></p>
<p><img src="https://user-images.githubusercontent.com/12729184/161411825-17f53ec7-bef4-4b16-b234-e24799ea41b0.png" alt="image"></p>
<h3>Tworzenie/Eksportowanie Excela  <a name="getstart2"></a></h3>
<ol>
<li><p>Typ musi być nieabstrakcyjny i posiadać publiczny konstruktor bezparametrowy.</p>
</li>
<li><p>MiniExcel obsługuje przekazywanie IEnumerable z odroczonym wykonaniem. Jeśli chcesz używać minimalnej ilości pamięci, nie wywołuj metod takich jak ToList</p>
</li>
</ol>
<p>np.: ToList lub nie - zużycie pamięci<br><img src="https://user-images.githubusercontent.com/12729184/112587389-752b0b00-8e38-11eb-8a52-cfb76c57e5eb.png" alt="image"></p>
<h4>1. Typ anonimowy lub silnie typowany <a href="https://dotnetfiddle.net/w5WD1J">[Wypróbuj]</a></h4>
<pre><code class="language-csharp hljs"><span class="hljs-keyword">var</span> path = Path.Combine(Path.GetTempPath(), <span class="hljs-string">$"<span class="hljs-subst">{Guid.NewGuid()}</span>.xlsx"</span>);
MiniExcel.SaveAs(path, <span class="hljs-keyword">new</span>[] {
    <span class="hljs-keyword">new</span> { Column1 = <span class="hljs-string">"MiniExcel"</span>, Column2 = <span class="hljs-number">1</span> },
    <span class="hljs-keyword">new</span> { Column1 = <span class="hljs-string">"Github"</span>, Column2 = <span class="hljs-number">2</span>}
});
</code></pre>
<h4>2. <code>IEnumerable&lt;IDictionary&lt;string, object&gt;&gt;</code></h4>
<pre><code class="language-csharp hljs"><span class="hljs-keyword">var</span> values = <span class="hljs-keyword">new</span> List&lt;Dictionary&lt;<span class="hljs-built_in">string</span>, <span class="hljs-built_in">object</span>&gt;&gt;()
{
    <span class="hljs-keyword">new</span> Dictionary&lt;<span class="hljs-built_in">string</span>,<span class="hljs-built_in">object</span>&gt;{{ <span class="hljs-string">"Column1"</span>, <span class="hljs-string">"MiniExcel"</span> }, { <span class="hljs-string">"Column2"</span>, <span class="hljs-number">1</span> } },
    <span class="hljs-keyword">new</span> Dictionary&lt;<span class="hljs-built_in">string</span>,<span class="hljs-built_in">object</span>&gt;{{ <span class="hljs-string">"Column1"</span>, <span class="hljs-string">"Github"</span> }, { <span class="hljs-string">"Column2"</span>, <span class="hljs-number">2</span> } }
};
MiniExcel.SaveAs(path, values);
</code></pre>
<p>Wynikowy plik:</p>
<table>
<thead>
<tr>
<th>Column1</th>
<th>Column2</th>
</tr>
</thead>
<tbody><tr>
<td>MiniExcel</td>
<td>1</td>
</tr>
<tr>
<td>Github</td>
<td>2</td>
</tr>
</tbody></table>
<h4>3.  IDataReader</h4>
<ul>
<li><code>Zalecane</code>, pozwala uniknąć ładowania wszystkich danych do pamięci</li>
</ul>
<pre><code class="language-csharp hljs">MiniExcel.SaveAs(path, reader);
</code></pre>
<p><img src="https://user-images.githubusercontent.com/12729184/121275378-149a5e80-c8bc-11eb-85fe-5453552134f0.png" alt="image"></p>
<p>Eksport DataReader do wielu arkuszy (zalecane przez Dapper ExecuteReader)</p>
<pre><code class="language-csharp hljs"><span class="hljs-keyword">using</span> (<span class="hljs-keyword">var</span> cnn = Connection)
{
    cnn.Open();
    <span class="hljs-keyword">var</span> sheets = <span class="hljs-keyword">new</span> Dictionary&lt;<span class="hljs-built_in">string</span>,<span class="hljs-built_in">object</span>&gt;();
    sheets.Add(<span class="hljs-string">"sheet1"</span>, cnn.ExecuteReader(<span class="hljs-string">"select 1 id"</span>));
    sheets.Add(<span class="hljs-string">"sheet2"</span>, cnn.ExecuteReader(<span class="hljs-string">"select 2 id"</span>));
    MiniExcel.SaveAs(<span class="hljs-string">"Demo.xlsx"</span>, sheets);
}
</code></pre>
<h4>4. Datatable</h4>
<ul>
<li><p><code>Nie zalecane</code>, ładuje wszystkie dane do pamięci</p>
</li>
<li><p>DataTable używa Caption jako nazwy kolumny w pierwszej kolejności, potem columname</p>
</li>
</ul>
<pre><code class="language-csharp hljs"><span class="hljs-keyword">var</span> path = Path.Combine(Path.GetTempPath(), <span class="hljs-string">$"<span class="hljs-subst">{Guid.NewGuid()}</span>.xlsx"</span>);
<span class="hljs-keyword">var</span> table = <span class="hljs-keyword">new</span> DataTable();
{
    table.Columns.Add(<span class="hljs-string">"Column1"</span>, <span class="hljs-keyword">typeof</span>(<span class="hljs-built_in">string</span>));
    table.Columns.Add(<span class="hljs-string">"Column2"</span>, <span class="hljs-keyword">typeof</span>(<span class="hljs-built_in">decimal</span>));
    table.Rows.Add(<span class="hljs-string">"MiniExcel"</span>, <span class="hljs-number">1</span>);
    table.Rows.Add(<span class="hljs-string">"Github"</span>, <span class="hljs-number">2</span>);
}

MiniExcel.SaveAs(path, table);
</code></pre>
<h4>5. Dapper Query</h4>
<p>Dzięki @shaofing #552 , proszę używać <code>CommandDefinition + CommandFlags.NoCache</code></p>
<pre><code class="language-csharp hljs"><span class="hljs-keyword">using</span> (<span class="hljs-keyword">var</span> connection = GetConnection(connectionString))
{
    <span class="hljs-keyword">var</span> rows = connection.Query(
        <span class="hljs-keyword">new</span> CommandDefinition(
            <span class="hljs-string">@"select 'MiniExcel' as Column1,1 as Column2 union all select 'Github',2"</span>
            , flags: CommandFlags.NoCache)
        );
    <span class="hljs-comment">// Uwaga: QueryAsync rzuci wyjątek zamkniętego połączenia</span>
    MiniExcel.SaveAs(path, rows);
</code></pre>
<p>}</p>
<pre><code class="hljs language-csharp">
Poniższy kod załaduje wszystkie dane <span class="hljs-keyword">do</span> pamięci

```<span class="hljs-function">csharp
<span class="hljs-title">using</span> (<span class="hljs-params"><span class="hljs-keyword">var</span> connection = GetConnection(connectionString</span>))</span>
{
    <span class="hljs-keyword">var</span> rows = connection.Query(<span class="hljs-string">@"select 'MiniExcel' as Column1,1 as Column2 union all select 'Github',2"</span>);
    MiniExcel.SaveAs(path, rows);
}
</code></pre>
<h4>6. Zapisz jako do MemoryStream  <a href="https://dotnetfiddle.net/JOen0e">[Wypróbuj]</a></h4>
<pre><code class="language-csharp hljs"><span class="hljs-keyword">using</span> (<span class="hljs-keyword">var</span> stream = <span class="hljs-keyword">new</span> MemoryStream()) <span class="hljs-comment">//obsługa FileStream, MemoryStream itp.</span>
{
    stream.SaveAs(values);
}
</code></pre>
<p>np.: api eksportu excela</p>
<pre><code class="language-csharp hljs"><span class="hljs-function"><span class="hljs-keyword">public</span> IActionResult <span class="hljs-title">DownloadExcel</span>()</span>
{
    <span class="hljs-keyword">var</span> values = <span class="hljs-keyword">new</span>[] {
        <span class="hljs-keyword">new</span> { Column1 = <span class="hljs-string">"MiniExcel"</span>, Column2 = <span class="hljs-number">1</span> },
        <span class="hljs-keyword">new</span> { Column1 = <span class="hljs-string">"Github"</span>, Column2 = <span class="hljs-number">2</span>}
    };

    <span class="hljs-keyword">var</span> memoryStream = <span class="hljs-keyword">new</span> MemoryStream();
    memoryStream.SaveAs(values);
    memoryStream.Seek(<span class="hljs-number">0</span>, SeekOrigin.Begin);
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> FileStreamResult(memoryStream, <span class="hljs-string">"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"</span>)
    {
        FileDownloadName = <span class="hljs-string">"demo.xlsx"</span>
    };
}
</code></pre>
<h4>7. Tworzenie wielu arkuszy</h4>
<pre><code class="language-csharp hljs"><span class="hljs-comment">// 1. Dictionary&lt;string,object&gt;</span>
<span class="hljs-keyword">var</span> users = <span class="hljs-keyword">new</span>[] { <span class="hljs-keyword">new</span> { Name = <span class="hljs-string">"Jack"</span>, Age = <span class="hljs-number">25</span> }, <span class="hljs-keyword">new</span> { Name = <span class="hljs-string">"Mike"</span>, Age = <span class="hljs-number">44</span> } };
<span class="hljs-keyword">var</span> department = <span class="hljs-keyword">new</span>[] { <span class="hljs-keyword">new</span> { ID = <span class="hljs-string">"01"</span>, Name = <span class="hljs-string">"HR"</span> }, <span class="hljs-keyword">new</span> { ID = <span class="hljs-string">"02"</span>, Name = <span class="hljs-string">"IT"</span> } };
<span class="hljs-keyword">var</span> sheets = <span class="hljs-keyword">new</span> Dictionary&lt;<span class="hljs-built_in">string</span>, <span class="hljs-built_in">object</span>&gt;
{
    [<span class="hljs-string">"users"</span>] = users,
    [<span class="hljs-string">"department"</span>] = department
};
MiniExcel.SaveAs(path, sheets);

<span class="hljs-comment">// 2. DataSet</span>
<span class="hljs-keyword">var</span> sheets = <span class="hljs-keyword">new</span> DataSet();
sheets.Add(UsersDataTable);
sheets.Add(DepartmentDataTable);
<span class="hljs-comment">//..</span>
MiniExcel.SaveAs(path, sheets);
</code></pre>
<p><img src="https://user-images.githubusercontent.com/12729184/118130875-6e7c4580-b430-11eb-9b82-22f02716bd63.png" alt="image"></p>
<h4>8. Opcje TableStyles</h4>
<p>Domyślny styl</p>
<p><img src="https://user-images.githubusercontent.com/12729184/138234373-cfa97109-b71f-4711-b7f5-0eaaa4a0a3a6.png" alt="image"></p>
<p>Bez konfiguracji stylu</p>
<pre><code class="language-csharp hljs"><span class="hljs-keyword">var</span> config = <span class="hljs-keyword">new</span> OpenXmlConfiguration()
{
     TableStyles = TableStyles.None
};
MiniExcel.SaveAs(path, <span class="hljs-keyword">value</span>,configuration:config);
</code></pre>
<p><img src="https://user-images.githubusercontent.com/12729184/118784917-f3e57700-b8c2-11eb-8718-8d955b1bc197.png" alt="image"></p>
<h4>9. AutoFilter</h4>
<p>Od wersji v0.19.0 <code>OpenXmlConfiguration.AutoFilter</code> pozwala włączyć/wyłączyć AutoFilter, domyślna wartość to <code>true</code>, a sposób ustawienia AutoFilter:</p>
<pre><code class="language-csharp hljs">MiniExcel.SaveAs(path, <span class="hljs-keyword">value</span>, configuration: <span class="hljs-keyword">new</span> OpenXmlConfiguration() { AutoFilter = <span class="hljs-literal">false</span> });
</code></pre>
<h4>10. Tworzenie obrazu</h4>
<pre><code class="language-csharp hljs"><span class="hljs-keyword">var</span> <span class="hljs-keyword">value</span> = <span class="hljs-keyword">new</span>[] {
    <span class="hljs-keyword">new</span> { Name=<span class="hljs-string">"github"</span>,Image=File.ReadAllBytes(PathHelper.GetFile(<span class="hljs-string">"images/github_logo.png"</span>))},
    <span class="hljs-keyword">new</span> { Name=<span class="hljs-string">"google"</span>,Image=File.ReadAllBytes(PathHelper.GetFile(<span class="hljs-string">"images/google_logo.png"</span>))},
    <span class="hljs-keyword">new</span> { Name=<span class="hljs-string">"microsoft"</span>,Image=File.ReadAllBytes(PathHelper.GetFile(<span class="hljs-string">"images/microsoft_logo.png"</span>))},
    <span class="hljs-keyword">new</span> { Name=<span class="hljs-string">"reddit"</span>,Image=File.ReadAllBytes(PathHelper.GetFile(<span class="hljs-string">"images/reddit_logo.png"</span>))},
    <span class="hljs-keyword">new</span> { Name=<span class="hljs-string">"statck_overflow"</span>,Image=File.ReadAllBytes(PathHelper.GetFile(<span class="hljs-string">"images/statck_overflow_logo.png"</span>))},
};
MiniExcel.SaveAs(path, <span class="hljs-keyword">value</span>);
</code></pre>
<p><img src="https://user-images.githubusercontent.com/12729184/150462383-ad9931b3-ed8d-4221-a1d6-66f799743433.png" alt="image"></p>
<h4>11. Eksport pliku jako tablica bajtów</h4>
<p>Od wersji 1.22.0, gdy typ wartości to <code>byte[]</code>, system zapisze domyślnie ścieżkę pliku w komórce, a podczas importu system może przekształcić to na <code>byte[]</code>. Jeśli nie chcesz korzystać z tej funkcjonalności, możesz ustawić <code>OpenXmlConfiguration.EnableConvertByteArray</code> na <code>false</code>, co może poprawić wydajność systemu.</p>
<p><img src="https://user-images.githubusercontent.com/12729184/153702334-c3b834f4-6ae4-4ddf-bd4e-e5005d5d8c6a.png" alt="image"></p>
<p>Od wersji 1.22.0, gdy typ wartości to <code>byte[]</code>, system zapisze domyślnie ścieżkę pliku w komórce, a podczas importu system może przekształcić to na <code>byte[]</code>. Jeśli nie chcesz korzystać z tej funkcjonalności, możesz ustawić <code>OpenXmlConfiguration.EnableConvertByteArray</code> na <code>false</code>, co może poprawić wydajność systemu.</p>
<p><img src="https://user-images.githubusercontent.com/12729184/153702334-c3b834f4-6ae4-4ddf-bd4e-e5005d5d8c6a.png" alt="image"></p>
<h4>12. Scalanie tych samych komórek w pionie</h4>
<p>Ta funkcjonalność jest obsługiwana tylko w formacie <code>xlsx</code> i scala komórki pionowo pomiędzy tagami @merge i @endmerge.<br>Można użyć @mergelimit, aby ograniczyć zakres scalania komórek w pionie.</p>
<pre><code class="language-csharp hljs"><span class="hljs-keyword">var</span> mergedFilePath = Path.Combine(Path.GetTempPath(), <span class="hljs-string">$"<span class="hljs-subst">{Guid.NewGuid().ToString()}</span>.xlsx"</span>);

<span class="hljs-keyword">var</span> path = <span class="hljs-string">@"../../../../../samples/xlsx/TestMergeWithTag.xlsx"</span>;

MiniExcel.MergeSameCells(mergedFilePath, path);
</code></pre>
<pre><code class="language-csharp hljs"><span class="hljs-keyword">var</span> memoryStream = <span class="hljs-keyword">new</span> MemoryStream();

<span class="hljs-keyword">var</span> path = <span class="hljs-string">@"../../../../../samples/xlsx/TestMergeWithTag.xlsx"</span>;

memoryStream.MergeSameCells(path);
</code></pre>
<p>Zawartość pliku przed i po scaleniu:</p>
<p>Bez ograniczenia scalania:</p>
<img width="318" alt="Screenshot 2023-08-07 at 11 59 24" src="https://github.com/mini-software/MiniExcel/assets/38832863/49cc96b9-6c35-4bf3-8d43-a9752a15b22e">

<img width="318" alt="Screenshot 2023-08-07 at 11 59 57" src="https://github.com/mini-software/MiniExcel/assets/38832863/3fbd529b-3ae6-4bbe-b4d8-2793a5a58010">

<p>Z ograniczeniem scalania:</p>
<img width="346" alt="Screenshot 2023-08-08 at 18 21 00" src="https://github.com/mini-software/MiniExcel/assets/38832863/04049d28-84d5-4c2a-bcff-5847547df5e1">

<img width="346" alt="Screenshot 2023-08-08 at 18 21 40" src="https://github.com/mini-software/MiniExcel/assets/38832863/f5cf8957-b0b0-4831-b8fc-8556299235c2">

<h4>13. Pomijanie wartości null</h4>
<p>Nowa jawna opcja pozwalająca zapisywać puste komórki dla wartości null:</p>
<pre><code class="language-csharp hljs">DataTable dt = <span class="hljs-keyword">new</span> DataTable();

<span class="hljs-comment">/* ... */</span>

DataRow dr = dt.NewRow();

dr[<span class="hljs-string">"Name1"</span>] = <span class="hljs-string">"Somebody once"</span>;
dr[<span class="hljs-string">"Name2"</span>] = <span class="hljs-literal">null</span>;
dr[<span class="hljs-string">"Name3"</span>] = <span class="hljs-string">"told me."</span>;

dt.Rows.Add(dr);

OpenXmlConfiguration configuration = <span class="hljs-keyword">new</span> OpenXmlConfiguration()
{
     EnableWriteNullValueCell = <span class="hljs-literal">true</span> <span class="hljs-comment">// Wartość domyślna.</span>
};

MiniExcel.SaveAs(<span class="hljs-string">@"C:\temp\Book1.xlsx"</span>, dt, configuration: configuration);
</code></pre>
<p><img src="https://user-images.githubusercontent.com/31481586/241419455-3c0aec8a-4e5f-4d83-b7ec-6572124c165d.png" alt="image"></p>
<pre><code class="language-xml hljs"><span class="hljs-tag">&lt;<span class="hljs-name">x:row</span> <span class="hljs-attr">r</span>=<span class="hljs-string">"2"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">x:c</span> <span class="hljs-attr">r</span>=<span class="hljs-string">"A2"</span> <span class="hljs-attr">t</span> =<span class="hljs-string">"str"</span> <span class="hljs-attr">s</span>=<span class="hljs-string">"2"</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">x:v</span>&gt;</span>Somebody once<span class="hljs-tag">&lt;/<span class="hljs-name">x:v</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">x:c</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">x:c</span> <span class="hljs-attr">r</span>=<span class="hljs-string">"B2"</span> <span class="hljs-attr">s</span>=<span class="hljs-string">"2"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">x:c</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">x:c</span> <span class="hljs-attr">r</span>=<span class="hljs-string">"C2"</span> <span class="hljs-attr">t</span> =<span class="hljs-string">"str"</span> <span class="hljs-attr">s</span>=<span class="hljs-string">"2"</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">x:v</span>&gt;</span>told me.<span class="hljs-tag">&lt;/<span class="hljs-name">x:v</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">x:c</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">x:row</span>&gt;</span>
</code></pre>
<p>Poprzednie zachowanie:</p>
<pre><code class="language-csharp hljs"><span class="hljs-comment">/* ... */</span>

OpenXmlConfiguration configuration = <span class="hljs-keyword">new</span> OpenXmlConfiguration()
{
     EnableWriteNullValueCell = <span class="hljs-literal">false</span> <span class="hljs-comment">// Domyślna wartość to true.</span>
};

MiniExcel.SaveAs(<span class="hljs-string">@"C:\temp\Book1.xlsx"</span>, dt, configuration: configuration);
</code></pre>
<p><img src="https://user-images.githubusercontent.com/31481586/241419441-c4f27e8f-3f87-46db-a10f-08665864c874.png" alt="image"></p>
<pre><code class="language-xml hljs"><span class="hljs-tag">&lt;<span class="hljs-name">x:row</span> <span class="hljs-attr">r</span>=<span class="hljs-string">"2"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">x:c</span> <span class="hljs-attr">r</span>=<span class="hljs-string">"A2"</span> <span class="hljs-attr">t</span> =<span class="hljs-string">"str"</span> <span class="hljs-attr">s</span>=<span class="hljs-string">"2"</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">x:v</span>&gt;</span>Somebody once<span class="hljs-tag">&lt;/<span class="hljs-name">x:v</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">x:c</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">x:c</span> <span class="hljs-attr">r</span>=<span class="hljs-string">"B2"</span> <span class="hljs-attr">t</span> =<span class="hljs-string">"str"</span> <span class="hljs-attr">s</span>=<span class="hljs-string">"2"</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">x:v</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">x:v</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">x:c</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">x:c</span> <span class="hljs-attr">r</span>=<span class="hljs-string">"C2"</span> <span class="hljs-attr">t</span> =<span class="hljs-string">"str"</span> <span class="hljs-attr">s</span>=<span class="hljs-string">"2"</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">x:v</span>&gt;</span>told me.<span class="hljs-tag">&lt;/<span class="hljs-name">x:v</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">x:c</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">x:row</span>&gt;</span>
</code></pre>
<p>Działa dla wartości null i DBNull.</p>
<h4>14. Zamrożenie okienek</h4>
<pre><code class="language-csharp hljs"><span class="hljs-comment">/* ... */</span>

OpenXmlConfiguration configuration = <span class="hljs-keyword">new</span> OpenXmlConfiguration()
{
    FreezeRowCount = <span class="hljs-number">1</span>,     <span class="hljs-comment">// domyślnie 1</span>
    FreezeColumnCount = <span class="hljs-number">2</span>   <span class="hljs-comment">// domyślnie 0</span>
};

MiniExcel.SaveAs(<span class="hljs-string">@"C:\temp\Book1.xlsx"</span>, dt, configuration: configuration);
</code></pre>
<p><img src="https://raw.githubusercontent.com/mini-software/MiniExcel/master/docs/images/freeze-pane-1.png" alt="image"></p>
<h3>Wypełnianie danych do szablonu Excela <a name="getstart3"></a></h3>
<ul>
<li>Deklaracja jest podobna do szablonu Vue <code>{{nazwa zmiennej}}</code> lub renderowania kolekcji <code>{{nazwa kolekcji.nazwa pola}}</code></li>
<li>Renderowanie kolekcji obsługuje IEnumerable/DataTable/DapperRow</li>
</ul>
<h4>1. Podstawowe wypełnianie</h4>
<p>Szablon:<br><img src="https://user-images.githubusercontent.com/12729184/114537556-ed8d2b00-9c84-11eb-8303-a69f62c41e5b.png" alt="image"></p>
<p>Wynik:<br><img src="https://user-images.githubusercontent.com/12729184/114537490-d8180100-9c84-11eb-8c69-db58692f3a85.png" alt="image"></p>
<p>Kod:</p>
<pre><code class="language-csharp hljs"><span class="hljs-comment">// 1. Przez POCO</span>
<span class="hljs-keyword">var</span> <span class="hljs-keyword">value</span> = <span class="hljs-keyword">new</span>
{
    Name = <span class="hljs-string">"Jack"</span>,
    CreateDate = <span class="hljs-keyword">new</span> DateTime(<span class="hljs-number">2021</span>, <span class="hljs-number">01</span>, <span class="hljs-number">01</span>),
    VIP = <span class="hljs-literal">true</span>,
    Points = <span class="hljs-number">123</span>
};
MiniExcel.SaveAsByTemplate(path, templatePath, <span class="hljs-keyword">value</span>);


<span class="hljs-comment">// 2. Przez Dictionary</span>
<span class="hljs-keyword">var</span> <span class="hljs-keyword">value</span> = <span class="hljs-keyword">new</span> Dictionary&lt;<span class="hljs-built_in">string</span>, <span class="hljs-built_in">object</span>&gt;()
{
    [<span class="hljs-string">"Name"</span>] = <span class="hljs-string">"Jack"</span>,
    [<span class="hljs-string">"CreateDate"</span>] = <span class="hljs-keyword">new</span> DateTime(<span class="hljs-number">2021</span>, <span class="hljs-number">01</span>, <span class="hljs-number">01</span>),
    [<span class="hljs-string">"VIP"</span>] = <span class="hljs-literal">true</span>,
    [<span class="hljs-string">"Points"</span>] = <span class="hljs-number">123</span>
};
MiniExcel.SaveAsByTemplate(path, templatePath, <span class="hljs-keyword">value</span>);
</code></pre>
<h4>2. Wypełnianie danymi IEnumerable</h4>
<blockquote>
<p>Uwaga1: Jako podstawę do wypełnienia listy użyj pierwszego IEnumerable o tych samych kolumnach</p>
</blockquote>
<p>Szablon:<br><img src="https://user-images.githubusercontent.com/12729184/114564652-14f2f080-9ca3-11eb-831f-09e3fedbc5fc.png" alt="image"></p>
<p>Wynik:<br><img src="https://user-images.githubusercontent.com/12729184/114564204-b2015980-9ca2-11eb-900d-e21249f93f7c.png" alt="image"></p>
<p>Kod:</p>
<pre><code class="language-csharp hljs"><span class="hljs-comment">//1. Przez POCO</span>
<span class="hljs-keyword">var</span> <span class="hljs-keyword">value</span> = <span class="hljs-keyword">new</span>
{
    employees = <span class="hljs-keyword">new</span>[] {
        <span class="hljs-keyword">new</span> {name=<span class="hljs-string">"Jack"</span>,department=<span class="hljs-string">"HR"</span>},
        <span class="hljs-keyword">new</span> {name=<span class="hljs-string">"Lisa"</span>,department=<span class="hljs-string">"HR"</span>},
        <span class="hljs-keyword">new</span> {name=<span class="hljs-string">"John"</span>,department=<span class="hljs-string">"HR"</span>},
        <span class="hljs-keyword">new</span> {name=<span class="hljs-string">"Mike"</span>,department=<span class="hljs-string">"IT"</span>},
        <span class="hljs-keyword">new</span> {name=<span class="hljs-string">"Neo"</span>,department=<span class="hljs-string">"IT"</span>},
        <span class="hljs-keyword">new</span> {name=<span class="hljs-string">"Loan"</span>,department=<span class="hljs-string">"IT"</span>}
    }
};
MiniExcel.SaveAsByTemplate(path, templatePath, <span class="hljs-keyword">value</span>);

<span class="hljs-comment">//2. Przez Dictionary</span>
<span class="hljs-keyword">var</span> <span class="hljs-keyword">value</span> = <span class="hljs-keyword">new</span> Dictionary&lt;<span class="hljs-built_in">string</span>, <span class="hljs-built_in">object</span>&gt;()
{
    [<span class="hljs-string">"employees"</span>] = <span class="hljs-keyword">new</span>[] {
        <span class="hljs-keyword">new</span> {name=<span class="hljs-string">"Jack"</span>,department=<span class="hljs-string">"HR"</span>},
        <span class="hljs-keyword">new</span> {name=<span class="hljs-string">"Lisa"</span>,department=<span class="hljs-string">"HR"</span>},
        <span class="hljs-keyword">new</span> {name=<span class="hljs-string">"John"</span>,department=<span class="hljs-string">"HR"</span>},
        <span class="hljs-keyword">new</span> {name=<span class="hljs-string">"Mike"</span>,department=<span class="hljs-string">"IT"</span>},
        <span class="hljs-keyword">new</span> {name=<span class="hljs-string">"Neo"</span>,department=<span class="hljs-string">"IT"</span>},
        <span class="hljs-keyword">new</span> {name=<span class="hljs-string">"Loan"</span>,department=<span class="hljs-string">"IT"</span>}
    }
};
MiniExcel.SaveAsByTemplate(path, templatePath, <span class="hljs-keyword">value</span>);
</code></pre>
<h4>3. Zaawansowane wypełnianie danych</h4>
<blockquote>
<p>Uwaga: Obsługa wielu arkuszy i używania tej samej zmiennej</p>
</blockquote>
<p>Szablon:</p>
<p><img src="https://user-images.githubusercontent.com/12729184/114565255-acf0da00-9ca3-11eb-8a7f-8131b2265ae8.png" alt="image"></p>
<p>Wynik:</p>
<p><img src="https://user-images.githubusercontent.com/12729184/114565329-bf6b1380-9ca3-11eb-85e3-3969e8bf6378.png" alt="image"></p>
<pre><code class="language-csharp hljs"><span class="hljs-comment">// 1. Przez POCO</span>
<span class="hljs-keyword">var</span> <span class="hljs-keyword">value</span> = <span class="hljs-keyword">new</span>
{
    title = <span class="hljs-string">"FooCompany"</span>,
    managers = <span class="hljs-keyword">new</span>[] {
        <span class="hljs-keyword">new</span> {name=<span class="hljs-string">"Jack"</span>,department=<span class="hljs-string">"HR"</span>},
        <span class="hljs-keyword">new</span> {name=<span class="hljs-string">"Loan"</span>,department=<span class="hljs-string">"IT"</span>}
    },
    employees = <span class="hljs-keyword">new</span>[] {
        <span class="hljs-keyword">new</span> {name=<span class="hljs-string">"Wade"</span>,department=<span class="hljs-string">"HR"</span>},
        <span class="hljs-keyword">new</span> {name=<span class="hljs-string">"Felix"</span>,department=<span class="hljs-string">"HR"</span>},
        <span class="hljs-keyword">new</span> {name=<span class="hljs-string">"Eric"</span>,department=<span class="hljs-string">"IT"</span>},
        <span class="hljs-keyword">new</span> {name=<span class="hljs-string">"Keaton"</span>,department=<span class="hljs-string">"IT"</span>}
    }
};
MiniExcel.SaveAsByTemplate(path, templatePath, <span class="hljs-keyword">value</span>);

<span class="hljs-comment">// 2. Przez Dictionary</span>
<span class="hljs-keyword">var</span> <span class="hljs-keyword">value</span> = <span class="hljs-keyword">new</span> Dictionary&lt;<span class="hljs-built_in">string</span>, <span class="hljs-built_in">object</span>&gt;()
{
    [<span class="hljs-string">"title"</span>] = <span class="hljs-string">"FooCompany"</span>,
    [<span class="hljs-string">"managers"</span>] = <span class="hljs-keyword">new</span>[] {
        <span class="hljs-keyword">new</span> {name=<span class="hljs-string">"Jack"</span>,department=<span class="hljs-string">"HR"</span>},
        <span class="hljs-keyword">new</span> {name=<span class="hljs-string">"Loan"</span>,department=<span class="hljs-string">"IT"</span>}
    },
    [<span class="hljs-string">"employees"</span>] = <span class="hljs-keyword">new</span>[] {
        <span class="hljs-keyword">new</span> {name=<span class="hljs-string">"Wade"</span>,department=<span class="hljs-string">"HR"</span>},
        <span class="hljs-keyword">new</span> {name=<span class="hljs-string">"Felix"</span>,department=<span class="hljs-string">"HR"</span>},
        <span class="hljs-keyword">new</span> {name=<span class="hljs-string">"Eric"</span>,department=<span class="hljs-string">"IT"</span>},
        <span class="hljs-keyword">new</span> {name=<span class="hljs-string">"Keaton"</span>,department=<span class="hljs-string">"IT"</span>}
    }
};
MiniExcel.SaveAsByTemplate(path, templatePath, <span class="hljs-keyword">value</span>);
</code></pre>
<h4>4. Wydajność wypełniania dużych danych</h4>
<blockquote>
<p>UWAGA: Użycie IEnumerable z odroczonym wykonaniem zamiast ToList pozwala maksymalnie oszczędzać pamięć w MiniExcel</p>
</blockquote>
<p><img src="https://user-images.githubusercontent.com/12729184/114577091-5046ec80-9cae-11eb-924b-087c7becf8da.png" alt="image"></p>
<h4>5. Automatyczne mapowanie typu wartości komórki</h4>
<p>Szablon</p>
<p><img src="https://user-images.githubusercontent.com/12729184/114802504-64830a80-9dd0-11eb-8d56-8e8c401b3ace.png" alt="image"></p>
<p>Wynik</p>
<p><img src="https://user-images.githubusercontent.com/12729184/114802419-43221e80-9dd0-11eb-9ffe-a2ce34fe7076.png" alt="image"></p>
<p>Klasa</p>
<pre><code class="language-csharp hljs"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title">Poco</span>
{
    <span class="hljs-keyword">public</span> <span class="hljs-built_in">string</span> @string { <span class="hljs-keyword">get</span>; <span class="hljs-keyword">set</span>; }
    <span class="hljs-keyword">public</span> <span class="hljs-built_in">int</span>? @int { <span class="hljs-keyword">get</span>; <span class="hljs-keyword">set</span>; }
</code></pre>
<pre><code class="language-csharp hljs"><span class="hljs-keyword">public</span> <span class="hljs-built_in">decimal</span>? @decimal { <span class="hljs-keyword">get</span>; <span class="hljs-keyword">set</span>; }
<span class="hljs-keyword">public</span> <span class="hljs-built_in">double</span>? @double { <span class="hljs-keyword">get</span>; <span class="hljs-keyword">set</span>; }
<span class="hljs-keyword">public</span> DateTime? datetime { <span class="hljs-keyword">get</span>; <span class="hljs-keyword">set</span>; }
<span class="hljs-keyword">public</span> <span class="hljs-built_in">bool</span>? @bool { <span class="hljs-keyword">get</span>; <span class="hljs-keyword">set</span>; }
<span class="hljs-keyword">public</span> Guid? Guid { <span class="hljs-keyword">get</span>; <span class="hljs-keyword">set</span>; }
}
</code></pre>
<p>Kod</p>
<pre><code class="language-csharp hljs"><span class="hljs-keyword">var</span> poco = <span class="hljs-keyword">new</span> TestIEnumerableTypePoco { @string = <span class="hljs-string">"string"</span>, @int = <span class="hljs-number">123</span>, @decimal = <span class="hljs-built_in">decimal</span>.Parse(<span class="hljs-string">"123.45"</span>), @double = (<span class="hljs-built_in">double</span>)<span class="hljs-number">123.33</span>, @datetime = <span class="hljs-keyword">new</span> DateTime(<span class="hljs-number">2021</span>, <span class="hljs-number">4</span>, <span class="hljs-number">1</span>), @bool = <span class="hljs-literal">true</span>, @Guid = Guid.NewGuid() };
<span class="hljs-keyword">var</span> <span class="hljs-keyword">value</span> = <span class="hljs-keyword">new</span>
{
    Ts = <span class="hljs-keyword">new</span>[] {
        poco,
        <span class="hljs-keyword">new</span> TestIEnumerableTypePoco{},
        <span class="hljs-literal">null</span>,
        poco
    }
};
MiniExcel.SaveAsByTemplate(path, templatePath, <span class="hljs-keyword">value</span>);
</code></pre>
<h4>6. Przykład: Lista projektów Github</h4>
<p>Szablon</p>
<p><img src="https://user-images.githubusercontent.com/12729184/115068623-12073280-9f25-11eb-9124-f4b3efcdb2a7.png" alt="image"></p>
<p>Wynik</p>
<p><img src="https://user-images.githubusercontent.com/12729184/115068639-1a5f6d80-9f25-11eb-9f45-27c434d19a78.png" alt="image"></p>
<p>Kod</p>
<pre><code class="language-csharp hljs"><span class="hljs-keyword">var</span> projects = <span class="hljs-keyword">new</span>[]
{
    <span class="hljs-keyword">new</span> {Name = <span class="hljs-string">"MiniExcel"</span>,Link=<span class="hljs-string">"https://github.com/mini-software/MiniExcel"</span>,Star=<span class="hljs-number">146</span>, CreateTime=<span class="hljs-keyword">new</span> DateTime(<span class="hljs-number">2021</span>,<span class="hljs-number">03</span>,<span class="hljs-number">01</span>)},
    <span class="hljs-keyword">new</span> {Name = <span class="hljs-string">"HtmlTableHelper"</span>,Link=<span class="hljs-string">"https://github.com/mini-software/HtmlTableHelper"</span>,Star=<span class="hljs-number">16</span>, CreateTime=<span class="hljs-keyword">new</span> DateTime(<span class="hljs-number">2020</span>,<span class="hljs-number">02</span>,<span class="hljs-number">01</span>)},
    <span class="hljs-keyword">new</span> {Name = <span class="hljs-string">"PocoClassGenerator"</span>,Link=<span class="hljs-string">"https://github.com/mini-software/PocoClassGenerator"</span>,Star=<span class="hljs-number">16</span>, CreateTime=<span class="hljs-keyword">new</span> DateTime(<span class="hljs-number">2019</span>,<span class="hljs-number">03</span>,<span class="hljs-number">17</span>)}
};
<span class="hljs-keyword">var</span> <span class="hljs-keyword">value</span> = <span class="hljs-keyword">new</span>
{
    User = <span class="hljs-string">"ITWeiHan"</span>,
    Projects = projects,
    TotalStar = projects.Sum(s =&gt; s.Star)
};
MiniExcel.SaveAsByTemplate(path, templatePath, <span class="hljs-keyword">value</span>);
</code></pre>
<h4>7. Grupowe wypełnianie danych</h4>
<pre><code class="language-csharp hljs"><span class="hljs-keyword">var</span> <span class="hljs-keyword">value</span> = <span class="hljs-keyword">new</span> Dictionary&lt;<span class="hljs-built_in">string</span>, <span class="hljs-built_in">object</span>&gt;()
{
    [<span class="hljs-string">"employees"</span>] = <span class="hljs-keyword">new</span>[] {
        <span class="hljs-keyword">new</span> {name=<span class="hljs-string">"Jack"</span>,department=<span class="hljs-string">"HR"</span>},
        <span class="hljs-keyword">new</span> {name=<span class="hljs-string">"Jack"</span>,department=<span class="hljs-string">"HR"</span>},
        <span class="hljs-keyword">new</span> {name=<span class="hljs-string">"John"</span>,department=<span class="hljs-string">"HR"</span>},
        <span class="hljs-keyword">new</span> {name=<span class="hljs-string">"John"</span>,department=<span class="hljs-string">"IT"</span>},
        <span class="hljs-keyword">new</span> {name=<span class="hljs-string">"Neo"</span>,department=<span class="hljs-string">"IT"</span>},
        <span class="hljs-keyword">new</span> {name=<span class="hljs-string">"Loan"</span>,department=<span class="hljs-string">"IT"</span>}
    }
};
<span class="hljs-keyword">await</span> MiniExcel.SaveAsByTemplateAsync(path, templatePath, <span class="hljs-keyword">value</span>);
</code></pre>
<h5>1. Z tagiem <code>@group</code> i z tagiem <code>@header</code></h5>
<p>Przed</p>
<p><img src="https://user-images.githubusercontent.com/38832863/218646717-21b9d57a-2be2-4e9a-801b-ae212231d2b4.PNG" alt="before_with_header"></p>
<p>Po</p>
<p><img src="https://user-images.githubusercontent.com/38832863/218646721-58a7a340-7004-4bc2-af24-cffcb2c20737.PNG" alt="after_with_header"></p>
<h5>2. Z tagiem @group i bez tagu @header</h5>
<p>Przed</p>
<p><img src="https://user-images.githubusercontent.com/38832863/218646873-b12417fa-801b-4890-8e96-669ed3b43902.PNG" alt="before_without_header"></p>
<p>Po</p>
<p><img src="https://user-images.githubusercontent.com/38832863/218646872-622461ba-342e-49ee-834f-b91ad9c2dac3.PNG" alt="after_without_header"></p>
<h5>3. Bez tagu @group</h5>
<p>Przed</p>
<p><img src="https://user-images.githubusercontent.com/38832863/218646975-f52a68eb-e031-43b5-abaa-03b67c052d1a.PNG" alt="without_group"></p>
<p>Po</p>
<p><img src="https://user-images.githubusercontent.com/38832863/218646974-4a3c0e07-7c66-4088-ad07-b4ad3695b7e1.PNG" alt="without_group_after"></p>
<h4>8. Instrukcje If/ElseIf/Else wewnątrz komórki</h4>
<p>Zasady:</p>
<ol>
<li>Obsługuje DateTime, Double, Int z operatorami ==, !=, &gt;, &gt;=, &lt;, &lt;=.</li>
<li>Obsługuje String z operatorami ==, !=.</li>
<li>Każda instrukcja powinna być w nowej linii.</li>
<li>Należy dodać pojedynczą spację przed i po operatorach.</li>
<li>Nie powinno być nowej linii wewnątrz instrukcji.</li>
<li>Komórka powinna być dokładnie w poniższym formacie.</li>
</ol>
<pre><code class="language-csharp hljs">@if(name == Jack)
{{employees.name}}
@elseif(name == Neo)
Test {{employees.name}}
@else
{{employees.department}}
@endif
</code></pre>
<p>Przed</p>
<p><img src="https://user-images.githubusercontent.com/38832863/235360606-ca654769-ff55-4f5b-98d2-d2ec0edb8173.PNG" alt="if_before"></p>
<p>Po</p>
<p><img src="https://user-images.githubusercontent.com/38832863/235360609-869bb960-d63d-45ae-8d64-9e8b0d0ab658.PNG" alt="if_after"></p>
<h4>9. DataTable jako parametr</h4>
<pre><code class="language-csharp hljs"><span class="hljs-keyword">var</span> managers = <span class="hljs-keyword">new</span> DataTable();
{
    managers.Columns.Add(<span class="hljs-string">"name"</span>);
    managers.Columns.Add(<span class="hljs-string">"department"</span>);
    managers.Rows.Add(<span class="hljs-string">"Jack"</span>, <span class="hljs-string">"HR"</span>);
    managers.Rows.Add(<span class="hljs-string">"Loan"</span>, <span class="hljs-string">"IT"</span>);
}
<span class="hljs-keyword">var</span> <span class="hljs-keyword">value</span> = <span class="hljs-keyword">new</span> Dictionary&lt;<span class="hljs-built_in">string</span>, <span class="hljs-built_in">object</span>&gt;()
{
    [<span class="hljs-string">"title"</span>] = <span class="hljs-string">"FooCompany"</span>,
    [<span class="hljs-string">"managers"</span>] = managers,
};
MiniExcel.SaveAsByTemplate(path, templatePath, <span class="hljs-keyword">value</span>);
</code></pre>
<h4>10. Formuły</h4>
<h5>1. Przykład</h5>
<p>Poprzedź swoją formułę znakiem <code>$</code> i użyj <code>$enumrowstart</code> oraz <code>$enumrowend</code>, aby oznaczyć odwołania do początku i końca wierszy wyliczanych:</p>
<p><img src="docs/images/template-formulas-1.png" alt="image"></p>
<p>Po wygenerowaniu szablonu, prefiks <code>$</code> zostanie usunięty, a <code>$enumrowstart</code> i <code>$enumrowend</code> zostaną zastąpione numerami pierwszego i ostatniego wiersza zakresu:</p>
<p><img src="docs/images/template-formulas-2.png" alt="image"></p>
<h5>2. Inne przykłady formuł:</h5>
<table>
<thead>
<tr>
<th></th>
<th></th>
</tr>
</thead>
<tbody><tr>
<td>Suma</td>
<td><code>$=SUM(C{{$enumrowstart}}:C{{$enumrowend}})</code></td>
</tr>
<tr>
<td>Średnia alt.</td>
<td><code>$=SUM(C{{$enumrowstart}}:C{{$enumrowend}}) / COUNT(C{{$enumrowstart}}:C{{$enumrowend}})</code></td>
</tr>
<tr>
<td>Zakres</td>
<td><code>$=MAX(C{{$enumrowstart}}:C{{$enumrowend}}) - MIN(C{{$enumrowstart}}:C{{$enumrowend}})</code></td>
</tr>
</tbody></table>
<h4>11. Inne</h4>
<h5>1. Sprawdzanie klucza parametru szablonu</h5>
<p>Od wersji V1.24.0 domyślnie pomijane są brakujące klucze parametrów szablonu i zastępowane pustym ciągiem. Opcja <code>IgnoreTemplateParameterMissing</code> pozwala kontrolować, czy wyjątek ma być rzucany.</p>
<pre><code class="language-csharp hljs"><span class="hljs-keyword">var</span> config = <span class="hljs-keyword">new</span> OpenXmlConfiguration()
{
    IgnoreTemplateParameterMissing = <span class="hljs-literal">false</span>,
};
MiniExcel.SaveAsByTemplate(path, templatePath, <span class="hljs-keyword">value</span>, config)
</code></pre>
<p><img src="https://user-images.githubusercontent.com/12729184/157464332-e316f829-54aa-4c84-a5aa-9aef337b668d.png" alt="image"></p>
<h3>Nazwa kolumny/indeks/pomijanie w atrybucie Excela <a name="getstart4"></a></h3>
<h4>1. Wskazanie nazwy kolumny, indeksu kolumny, pomijania kolumny</h4>
<p>Przykład Excela</p>
<p><img src="https://user-images.githubusercontent.com/12729184/114230869-3e163700-99ac-11eb-9a90-2039d4b4b313.png" alt="image"></p>
<p>Kod</p>
<pre><code class="language-csharp hljs"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title">ExcelAttributeDemo</span>
{
    [<span class="hljs-meta">ExcelColumnName(<span class="hljs-string">"Column1"</span>)</span>]
</code></pre>
<pre><code class="language-csharp hljs"><span class="hljs-keyword">public</span> <span class="hljs-built_in">string</span> Test1 { <span class="hljs-keyword">get</span>; <span class="hljs-keyword">set</span>; }
[<span class="hljs-meta">ExcelColumnName(<span class="hljs-string">"Column2"</span>)</span>]
<span class="hljs-keyword">public</span> <span class="hljs-built_in">string</span> Test2 { <span class="hljs-keyword">get</span>; <span class="hljs-keyword">set</span>; }
[<span class="hljs-meta">ExcelIgnore</span>]
<span class="hljs-keyword">public</span> <span class="hljs-built_in">string</span> Test3 { <span class="hljs-keyword">get</span>; <span class="hljs-keyword">set</span>; }
[<span class="hljs-meta">ExcelColumnIndex(<span class="hljs-string">"I"</span>)</span>] <span class="hljs-comment">// system zamieni "I" na indeks 8</span>
<span class="hljs-keyword">public</span> <span class="hljs-built_in">string</span> Test4 { <span class="hljs-keyword">get</span>; <span class="hljs-keyword">set</span>; }
<span class="hljs-keyword">public</span> <span class="hljs-built_in">string</span> Test5 { <span class="hljs-keyword">get</span>; } <span class="hljs-comment">//brak set zostanie zignorowane</span>
<span class="hljs-keyword">public</span> <span class="hljs-built_in">string</span> Test6 { <span class="hljs-keyword">get</span>; <span class="hljs-keyword">private</span> <span class="hljs-keyword">set</span>; } <span class="hljs-comment">//niepubliczny set zostanie zignorowany</span>
[<span class="hljs-meta">ExcelColumnIndex(3)</span>] <span class="hljs-comment">// indeksowanie od 0</span>
<span class="hljs-keyword">public</span> <span class="hljs-built_in">string</span> Test7 { <span class="hljs-keyword">get</span>; <span class="hljs-keyword">set</span>; }
}

<span class="hljs-keyword">var</span> rows = MiniExcel.Query&lt;ExcelAttributeDemo&gt;(path).ToList();
Assert.Equal(<span class="hljs-string">"Column1"</span>, rows[<span class="hljs-number">0</span>].Test1);
Assert.Equal(<span class="hljs-string">"Column2"</span>, rows[<span class="hljs-number">0</span>].Test2);
Assert.Null(rows[<span class="hljs-number">0</span>].Test3);
Assert.Equal(<span class="hljs-string">"Test7"</span>, rows[<span class="hljs-number">0</span>].Test4);
Assert.Null(rows[<span class="hljs-number">0</span>].Test5);
Assert.Null(rows[<span class="hljs-number">0</span>].Test6);
Assert.Equal(<span class="hljs-string">"Test4"</span>, rows[<span class="hljs-number">0</span>].Test7);
</code></pre>
<h4>2. Niestandardowy format (ExcelFormatAttribute)</h4>
<p>Od wersji V0.21.0 obsługa klasy, która zawiera metodę <code>ToString(string content)</code> do formatowania</p>
<p>Klasa</p>
<pre><code class="language-csharp hljs"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title">Dto</span>
{
    <span class="hljs-keyword">public</span> <span class="hljs-built_in">string</span> Name { <span class="hljs-keyword">get</span>; <span class="hljs-keyword">set</span>; }

    [<span class="hljs-meta">ExcelFormat(<span class="hljs-string">"MMMM dd, yyyy"</span>)</span>]
    <span class="hljs-keyword">public</span> DateTime InDate { <span class="hljs-keyword">get</span>; <span class="hljs-keyword">set</span>; }
}
</code></pre>
<p>Kod</p>
<pre><code class="language-csharp hljs"><span class="hljs-keyword">var</span> <span class="hljs-keyword">value</span> = <span class="hljs-keyword">new</span> Dto[] {
    <span class="hljs-keyword">new</span> Issue241Dto{ Name=<span class="hljs-string">"Jack"</span>,InDate=<span class="hljs-keyword">new</span> DateTime(<span class="hljs-number">2021</span>,<span class="hljs-number">01</span>,<span class="hljs-number">04</span>)},
    <span class="hljs-keyword">new</span> Issue241Dto{ Name=<span class="hljs-string">"Henry"</span>,InDate=<span class="hljs-keyword">new</span> DateTime(<span class="hljs-number">2020</span>,<span class="hljs-number">04</span>,<span class="hljs-number">05</span>)},
};
MiniExcel.SaveAs(path, <span class="hljs-keyword">value</span>);
</code></pre>
<p>Wynik</p>
<p><img src="https://user-images.githubusercontent.com/12729184/118910788-ab2bcd80-b957-11eb-8d42-bfce36621b1b.png" alt="image"></p>
<p>Zapytania obsługują konwersję niestandardowego formatu</p>
<p><img src="https://user-images.githubusercontent.com/12729184/118911286-87b55280-b958-11eb-9a88-c8ff403d240a.png" alt="image"></p>
<h4>3. Ustawianie szerokości kolumny (ExcelColumnWidthAttribute)</h4>
<pre><code class="language-csharp hljs"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title">Dto</span>
{
    [<span class="hljs-meta">ExcelColumnWidth(20)</span>]
    <span class="hljs-keyword">public</span> <span class="hljs-built_in">int</span> ID { <span class="hljs-keyword">get</span>; <span class="hljs-keyword">set</span>; }
    [<span class="hljs-meta">ExcelColumnWidth(15.50)</span>]
    <span class="hljs-keyword">public</span> <span class="hljs-built_in">string</span> Name { <span class="hljs-keyword">get</span>; <span class="hljs-keyword">set</span>; }
}
</code></pre>
<h4>4. Mapowanie wielu nazw kolumn na tę samą właściwość.</h4>
<pre><code class="language-csharp hljs"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title">Dto</span>
{
    [<span class="hljs-meta">ExcelColumnName(excelColumnName:<span class="hljs-string">"EmployeeNo"</span>,aliases:new[</span>] { <span class="hljs-string">"EmpNo"</span>,<span class="hljs-string">"No"</span> })]
    <span class="hljs-keyword">public</span> <span class="hljs-built_in">string</span> Empno { <span class="hljs-keyword">get</span>; <span class="hljs-keyword">set</span>; }
    <span class="hljs-keyword">public</span> <span class="hljs-built_in">string</span> Name { <span class="hljs-keyword">get</span>; <span class="hljs-keyword">set</span>; }
}
</code></pre>
<h4>5. System.ComponentModel.DisplayNameAttribute = ExcelColumnName.excelColumnNameAttribute</h4>
<p>Od wersji 1.24.0 system obsługuje System.ComponentModel.DisplayNameAttribute = ExcelColumnName.excelColumnNameAttribute</p>
<pre><code class="language-C# hljs language-C">public <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">TestIssueI4TXGTDto</span>
{</span>
    public <span class="hljs-type">int</span> ID { get; <span class="hljs-built_in">set</span>; }
    public <span class="hljs-built_in">string</span> Name { get; <span class="hljs-built_in">set</span>; }
    [DisplayName(<span class="hljs-string">"Specification"</span>)]
    public <span class="hljs-built_in">string</span> Spc { get; <span class="hljs-built_in">set</span>; }
    [DisplayName(<span class="hljs-string">"Unit Price"</span>)]
    public decimal Up { get; <span class="hljs-built_in">set</span>; }
}
</code></pre>
<h4>6. ExcelColumnAttribute</h4>
<p>Od wersji V1.26.0, wiele atrybutów można uprościć w ten sposób:</p>
<pre><code class="language-csharp hljs">        <span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title">TestIssueI4ZYUUDto</span>
        {
            [<span class="hljs-meta">ExcelColumn(Name = <span class="hljs-string">"ID"</span>,Index =0)</span>]
            <span class="hljs-keyword">public</span> <span class="hljs-built_in">string</span> MyProperty { <span class="hljs-keyword">get</span>; <span class="hljs-keyword">set</span>; }
            [<span class="hljs-meta">ExcelColumn(Name = <span class="hljs-string">"CreateDate"</span>, Index = 1,Format =<span class="hljs-string">"yyyy-MM"</span>,Width =100)</span>]
            <span class="hljs-keyword">public</span> DateTime MyProperty2 { <span class="hljs-keyword">get</span>; <span class="hljs-keyword">set</span>; }
        }
</code></pre>
<h4>7. DynamicColumnAttribute</h4>
<p>Od wersji V1.26.0 możemy dynamicznie ustawiać atrybuty kolumny</p>
<pre><code class="language-csharp hljs">            <span class="hljs-keyword">var</span> config = <span class="hljs-keyword">new</span> OpenXmlConfiguration
            {
                DynamicColumns = <span class="hljs-keyword">new</span> DynamicExcelColumn[] {
                    <span class="hljs-keyword">new</span> DynamicExcelColumn(<span class="hljs-string">"id"</span>){Ignore=<span class="hljs-literal">true</span>},
                    <span class="hljs-keyword">new</span> DynamicExcelColumn(<span class="hljs-string">"name"</span>){Index=<span class="hljs-number">1</span>,Width=<span class="hljs-number">10</span>},
                    <span class="hljs-keyword">new</span> DynamicExcelColumn(<span class="hljs-string">"createdate"</span>){Index=<span class="hljs-number">0</span>,Format=<span class="hljs-string">"yyyy-MM-dd"</span>,Width=<span class="hljs-number">15</span>},
                    <span class="hljs-keyword">new</span> DynamicExcelColumn(<span class="hljs-string">"point"</span>){Index=<span class="hljs-number">2</span>,Name=<span class="hljs-string">"Account Point"</span>},
                }
            };
            <span class="hljs-keyword">var</span> path = PathHelper.GetTempPath();
            <span class="hljs-keyword">var</span> <span class="hljs-keyword">value</span> = <span class="hljs-keyword">new</span>[] { <span class="hljs-keyword">new</span> { id = <span class="hljs-number">1</span>, name = <span class="hljs-string">"Jack"</span>, createdate = <span class="hljs-keyword">new</span> DateTime(<span class="hljs-number">2022</span>, <span class="hljs-number">04</span>, <span class="hljs-number">12</span>) ,point = <span class="hljs-number">123.456</span>} };
            MiniExcel.SaveAs(path, <span class="hljs-keyword">value</span>, configuration: config);
</code></pre>
<p><img src="https://user-images.githubusercontent.com/12729184/164510353-5aecbc4e-c3ce-41e8-b6cf-afd55eb23b68.png" alt="image"></p>
<h4>8. DynamicSheetAttribute</h4>
<p>Od wersji V1.31.4 możemy dynamicznie ustawiać atrybuty arkusza. Możemy ustawić nazwę arkusza oraz stan (widoczność).</p>
<pre><code class="language-csharp hljs">            <span class="hljs-keyword">var</span> configuration = <span class="hljs-keyword">new</span> OpenXmlConfiguration
            {
                DynamicSheets = <span class="hljs-keyword">new</span> DynamicExcelSheet[] {
                    <span class="hljs-keyword">new</span> DynamicExcelSheet(<span class="hljs-string">"usersSheet"</span>) { Name = <span class="hljs-string">"Users"</span>, State = SheetState.Visible },
                    <span class="hljs-keyword">new</span> DynamicExcelSheet(<span class="hljs-string">"departmentSheet"</span>) { Name = <span class="hljs-string">"Departments"</span>, State = SheetState.Hidden }
                }
            };

            <span class="hljs-keyword">var</span> users = <span class="hljs-keyword">new</span>[] { <span class="hljs-keyword">new</span> { Name = <span class="hljs-string">"Jack"</span>, Age = <span class="hljs-number">25</span> }, <span class="hljs-keyword">new</span> { Name = <span class="hljs-string">"Mike"</span>, Age = <span class="hljs-number">44</span> } };
            <span class="hljs-keyword">var</span> department = <span class="hljs-keyword">new</span>[] { <span class="hljs-keyword">new</span> { ID = <span class="hljs-string">"01"</span>, Name = <span class="hljs-string">"HR"</span> }, <span class="hljs-keyword">new</span> { ID = <span class="hljs-string">"02"</span>, Name = <span class="hljs-string">"IT"</span> } };
            <span class="hljs-keyword">var</span> sheets = <span class="hljs-keyword">new</span> Dictionary&lt;<span class="hljs-built_in">string</span>, <span class="hljs-built_in">object</span>&gt;
            {
                [<span class="hljs-string">"usersSheet"</span>] = users,
                [<span class="hljs-string">"departmentSheet"</span>] = department
            };

            <span class="hljs-keyword">var</span> path = PathHelper.GetTempPath();
            MiniExcel.SaveAs(path, sheets, configuration: configuration);
</code></pre>
<p>Możemy także użyć nowego atrybutu ExcelSheetAttribute:</p>
<pre><code class="language-C# hljs language-C">   [ExcelSheet(Name = <span class="hljs-string">"Departments"</span>, State = SheetState.Hidden)]
   private <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">DepartmentDto</span>
   {</span>
      [ExcelColumn(Name = <span class="hljs-string">"ID"</span>,Index = <span class="hljs-number">0</span>)]
      public <span class="hljs-built_in">string</span> ID { get; <span class="hljs-built_in">set</span>; }
      [ExcelColumn(Name = <span class="hljs-string">"Name"</span>,Index = <span class="hljs-number">1</span>)]
      public <span class="hljs-built_in">string</span> Name { get; <span class="hljs-built_in">set</span>; }
   }
</code></pre>
<h3>Dodawanie, Usuwanie, Aktualizowanie</h3>
<h4>Dodawanie</h4>
<p>Od wersji v1.28.0 obsługa wstawiania N wierszy do pliku CSV po ostatnim wierszu</p>
<pre><code class="language-csharp hljs"><span class="hljs-comment">// Oryginał</span>
{
    <span class="hljs-keyword">var</span> <span class="hljs-keyword">value</span> = <span class="hljs-keyword">new</span>[] {
          <span class="hljs-keyword">new</span> { ID=<span class="hljs-number">1</span>,Name =<span class="hljs-string">"Jack"</span>,InDate=<span class="hljs-keyword">new</span> DateTime(<span class="hljs-number">2021</span>,<span class="hljs-number">01</span>,<span class="hljs-number">03</span>)},
          <span class="hljs-keyword">new</span> { ID=<span class="hljs-number">2</span>,Name =<span class="hljs-string">"Henry"</span>,InDate=<span class="hljs-keyword">new</span> DateTime(<span class="hljs-number">2020</span>,<span class="hljs-number">05</span>,<span class="hljs-number">03</span>)},
    };
    MiniExcel.SaveAs(path, <span class="hljs-keyword">value</span>);
}
<span class="hljs-comment">// Wstaw 1 wiersz po ostatnim</span>
{
    <span class="hljs-keyword">var</span> <span class="hljs-keyword">value</span> = <span class="hljs-keyword">new</span> { ID=<span class="hljs-number">3</span>,Name = <span class="hljs-string">"Mike"</span>, InDate = <span class="hljs-keyword">new</span> DateTime(<span class="hljs-number">2021</span>, <span class="hljs-number">04</span>, <span class="hljs-number">23</span>) };
    MiniExcel.Insert(path, <span class="hljs-keyword">value</span>);
}
<span class="hljs-comment">// Wstaw N wierszy po ostatnim</span>
{
    <span class="hljs-keyword">var</span> <span class="hljs-keyword">value</span> = <span class="hljs-keyword">new</span>[] {
          <span class="hljs-keyword">new</span> { ID=<span class="hljs-number">4</span>,Name =<span class="hljs-string">"Frank"</span>,InDate=<span class="hljs-keyword">new</span> DateTime(<span class="hljs-number">2021</span>,<span class="hljs-number">06</span>,<span class="hljs-number">07</span>)},
          <span class="hljs-keyword">new</span> { ID=<span class="hljs-number">5</span>,Name =<span class="hljs-string">"Gloria"</span>,InDate=<span class="hljs-keyword">new</span> DateTime(<span class="hljs-number">2022</span>,<span class="hljs-number">05</span>,<span class="hljs-number">03</span>)},
</code></pre>
<pre><code class="language-csharp hljs">};
MiniExcel.Insert(path, <span class="hljs-keyword">value</span>);
}
</code></pre>
<p><img src="https://user-images.githubusercontent.com/12729184/191023733-1e2fa732-db5c-4a3a-9722-b891fe5aa069.png" alt="image"></p>
<p>v1.37.0 obsługuje wstawianie nowego arkusza do istniejącego skoroszytu excel</p>
<pre><code class="language-csharp hljs"><span class="hljs-comment">// Oryginalny plik excel</span>
{
    <span class="hljs-keyword">var</span> <span class="hljs-keyword">value</span> = <span class="hljs-keyword">new</span>[] {
          <span class="hljs-keyword">new</span> { ID=<span class="hljs-number">1</span>,Name =<span class="hljs-string">"Jack"</span>,InDate=<span class="hljs-keyword">new</span> DateTime(<span class="hljs-number">2021</span>,<span class="hljs-number">01</span>,<span class="hljs-number">03</span>)},
          <span class="hljs-keyword">new</span> { ID=<span class="hljs-number">2</span>,Name =<span class="hljs-string">"Henry"</span>,InDate=<span class="hljs-keyword">new</span> DateTime(<span class="hljs-number">2020</span>,<span class="hljs-number">05</span>,<span class="hljs-number">03</span>)},
    };
    MiniExcel.SaveAs(path, <span class="hljs-keyword">value</span>, sheetName: <span class="hljs-string">"Sheet1"</span>);
}
<span class="hljs-comment">// Wstaw nowy arkusz</span>
{
    <span class="hljs-keyword">var</span> <span class="hljs-keyword">value</span> = <span class="hljs-keyword">new</span> { ID=<span class="hljs-number">3</span>,Name = <span class="hljs-string">"Mike"</span>, InDate = <span class="hljs-keyword">new</span> DateTime(<span class="hljs-number">2021</span>, <span class="hljs-number">04</span>, <span class="hljs-number">23</span>) };
    MiniExcel.Insert(path, table, sheetName: <span class="hljs-string">"Sheet2"</span>);
}
</code></pre>
<h4>Usuń (oczekuje)</h4>
<h4>Aktualizuj (oczekuje)</h4>
<h3>Automatyczne sprawdzanie typu Excela <a name="getstart5"></a></h3>
<ul>
<li>MiniExcel domyślnie sprawdza, czy jest to xlsx czy csv na podstawie <code>rozszerzenia pliku</code>, ale mogą wystąpić nieścisłości, proszę określić to ręcznie.</li>
<li>Strumień nie może określić typu excela, proszę określić go ręcznie.</li>
</ul>
<pre><code class="language-csharp hljs">stream.SaveAs(excelType:ExcelType.CSV);
<span class="hljs-comment">//lub</span>
stream.SaveAs(excelType:ExcelType.XLSX);
<span class="hljs-comment">//lub</span>
stream.Query(excelType:ExcelType.CSV);
<span class="hljs-comment">//lub</span>
stream.Query(excelType:ExcelType.XLSX);
</code></pre>
<h3>CSV</h3>
<h4>Uwaga</h4>
<ul>
<li>Domyślnie zwracany jest typ <code>string</code>, a wartość nie będzie konwertowana na liczby ani daty/godziny, chyba że typ jest zdefiniowany przez silnie typowany generyk.</li>
</ul>
<h4>Własny separator</h4>
<p>Domyślnie separatorem jest <code>,</code>, możesz go zmienić ustawiając właściwość <code>Seperator</code></p>
<pre><code class="language-csharp hljs"><span class="hljs-keyword">var</span> config = <span class="hljs-keyword">new</span> MiniExcelLibs.Csv.CsvConfiguration()
{
    Seperator=<span class="hljs-string">';'</span>
};
MiniExcel.SaveAs(path, values,configuration: config);
</code></pre>
<p>Od wersji V1.30.1 obsługa funkcji własnego separatora (dzięki @hyzx86)</p>
<pre><code class="language-csharp hljs"><span class="hljs-keyword">var</span> config = <span class="hljs-keyword">new</span> CsvConfiguration()
{
    SplitFn = (row) =&gt; Regex.Split(row, <span class="hljs-string">$"[\t,](?=(?:[^\"]|\"[^\"]*\")*$)"</span>)
        .Select(s =&gt; Regex.Replace(s.Replace(<span class="hljs-string">"\"\""</span>, <span class="hljs-string">"\""</span>), <span class="hljs-string">"^\"|\"$"</span>, <span class="hljs-string">""</span>)).ToArray()
};
<span class="hljs-keyword">var</span> rows = MiniExcel.Query(path, configuration: config).ToList();
</code></pre>
<h4>Własny znak nowej linii</h4>
<p>Domyślnie znakiem nowej linii jest <code>\r\n</code>, możesz go zmienić ustawiając właściwość <code>NewLine</code></p>
<pre><code class="language-csharp hljs"><span class="hljs-keyword">var</span> config = <span class="hljs-keyword">new</span> MiniExcelLibs.Csv.CsvConfiguration()
{
    NewLine=<span class="hljs-string">'\n'</span>
};
MiniExcel.SaveAs(path, values,configuration: config);
</code></pre>
<h4>Własne kodowanie</h4>
<ul>
<li>Domyślne kodowanie to "Detect Encoding From Byte Order Marks"  (detectEncodingFromByteOrderMarks: true)</li>
<li>Jeśli masz własne wymagania dotyczące kodowania, zmodyfikuj właściwość StreamReaderFunc / StreamWriterFunc</li>
</ul>
<pre><code class="language-csharp hljs"><span class="hljs-comment">// Odczyt</span>
<span class="hljs-keyword">var</span> config = <span class="hljs-keyword">new</span> MiniExcelLibs.Csv.CsvConfiguration()
{
    StreamReaderFunc = (stream) =&gt; <span class="hljs-keyword">new</span> StreamReader(stream,Encoding.GetEncoding(<span class="hljs-string">"gb2312"</span>))
};
<span class="hljs-keyword">var</span> rows = MiniExcel.Query(path, <span class="hljs-literal">true</span>,excelType:ExcelType.CSV,configuration: config);

<span class="hljs-comment">// Zapis</span>
<span class="hljs-keyword">var</span> config = <span class="hljs-keyword">new</span> MiniExcelLibs.Csv.CsvConfiguration()
{
    StreamWriterFunc = (stream) =&gt; <span class="hljs-keyword">new</span> StreamWriter(stream, Encoding.GetEncoding(<span class="hljs-string">"gb2312"</span>))
};
MiniExcel.SaveAs(path, <span class="hljs-keyword">value</span>,excelType:ExcelType.CSV, configuration: config);
</code></pre>
<h4>Odczyt pustego ciągu jako null</h4>
<p>Domyślnie puste wartości są mapowane na string.Empty. Możesz zmienić to zachowanie</p>
<pre><code class="language-csharp hljs"><span class="hljs-keyword">var</span> config = <span class="hljs-keyword">new</span> MiniExcelLibs.Csv.CsvConfiguration()
{
   ReadEmptyStringAsNull = <span class="hljs-literal">true</span>
};
</code></pre>
<h3>DataReader</h3>
<h4>1. GetReader</h4>
<p>Od wersji 1.23.0 możesz użyć GetDataReader</p>
<pre><code class="language-csharp hljs">    <span class="hljs-keyword">using</span> (<span class="hljs-keyword">var</span> reader = MiniExcel.GetReader(path,<span class="hljs-literal">true</span>))
    {
        <span class="hljs-keyword">while</span> (reader.Read())
        {
            <span class="hljs-keyword">for</span> (<span class="hljs-built_in">int</span> i = <span class="hljs-number">0</span>; i &lt; reader.FieldCount; i++)
            {
                <span class="hljs-keyword">var</span> <span class="hljs-keyword">value</span> = reader.GetValue(i);
            }
        }
    }
</code></pre>
<h3>Async</h3>
<ul>
<li>Od wersji v0.17.0 obsługa Async (dzięki isdaniel ( SHIH,BING-SIOU)](<a href="https://github.com/isdaniel">https://github.com/isdaniel</a>))</li>
</ul>
<pre><code class="language-csharp hljs"><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> Task <span class="hljs-title">SaveAsAsync</span>(<span class="hljs-params"><span class="hljs-built_in">string</span> path, <span class="hljs-built_in">object</span> <span class="hljs-keyword">value</span>, <span class="hljs-built_in">bool</span> printHeader = <span class="hljs-literal">true</span>, <span class="hljs-built_in">string</span> sheetName = <span class="hljs-string">"Sheet1"</span>, ExcelType excelType = ExcelType.UNKNOWN, IConfiguration configuration = <span class="hljs-literal">null</span></span>)
<span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> Task <span class="hljs-title">SaveAsAsync</span>(<span class="hljs-params"><span class="hljs-keyword">this</span> Stream stream, <span class="hljs-built_in">object</span> <span class="hljs-keyword">value</span>, <span class="hljs-built_in">bool</span> printHeader = <span class="hljs-literal">true</span>, <span class="hljs-built_in">string</span> sheetName = <span class="hljs-string">"Sheet1"</span>, ExcelType excelType = ExcelType.XLSX, IConfiguration configuration = <span class="hljs-literal">null</span></span>)
<span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> Task&lt;IEnumerable&lt;<span class="hljs-built_in">dynamic</span>&gt;&gt; <span class="hljs-title">QueryAsync</span>(<span class="hljs-params"><span class="hljs-built_in">string</span> path, <span class="hljs-built_in">bool</span> useHeaderRow = <span class="hljs-literal">false</span>, <span class="hljs-built_in">string</span> sheetName = <span class="hljs-literal">null</span>, ExcelType excelType = ExcelType.UNKNOWN, <span class="hljs-built_in">string</span> startCell = <span class="hljs-string">"A1"</span>, IConfiguration configuration = <span class="hljs-literal">null</span></span>)
<span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-title">Task</span>&lt;<span class="hljs-title">IEnumerable</span>&lt;<span class="hljs-title">T</span>&gt;&gt; <span class="hljs-title">QueryAsync</span>&lt;<span class="hljs-title">T</span>&gt;(<span class="hljs-params"><span class="hljs-keyword">this</span> Stream stream, <span class="hljs-built_in">string</span> sheetName = <span class="hljs-literal">null</span>, ExcelType excelType = ExcelType.UNKNOWN, <span class="hljs-built_in">string</span> startCell = <span class="hljs-string">"A1"</span>, IConfiguration configuration = <span class="hljs-literal">null</span></span>) <span class="hljs-keyword">where</span> T : <span class="hljs-keyword">class</span>, <span class="hljs-keyword">new</span>()
<span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-title">Task</span>&lt;<span class="hljs-title">IEnumerable</span>&lt;<span class="hljs-title">T</span>&gt;&gt; <span class="hljs-title">QueryAsync</span>&lt;<span class="hljs-title">T</span>&gt;(<span class="hljs-params"><span class="hljs-built_in">string</span> path, <span class="hljs-built_in">string</span> sheetName = <span class="hljs-literal">null</span>, ExcelType excelType = ExcelType.UNKNOWN, <span class="hljs-built_in">string</span> startCell = <span class="hljs-string">"A1"</span>, IConfiguration configuration = <span class="hljs-literal">null</span></span>) <span class="hljs-keyword">where</span> T : <span class="hljs-keyword">class</span>, <span class="hljs-keyword">new</span>()
<span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> Task&lt;IEnumerable&lt;IDictionary&lt;<span class="hljs-built_in">string</span>, <span class="hljs-built_in">object</span>&gt;&gt;&gt; <span class="hljs-title">QueryAsync</span>(<span class="hljs-params"><span class="hljs-keyword">this</span> Stream stream, <span class="hljs-built_in">bool</span> useHeaderRow = <span class="hljs-literal">false</span>, <span class="hljs-built_in">string</span> sheetName = <span class="hljs-literal">null</span>, ExcelType excelType = ExcelType.UNKNOWN, <span class="hljs-built_in">string</span> startCell = <span class="hljs-string">"A1"</span>, IConfiguration configuration = <span class="hljs-literal">null</span></span>)
<span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> Task <span class="hljs-title">SaveAsByTemplateAsync</span>(<span class="hljs-params"><span class="hljs-keyword">this</span> Stream stream, <span class="hljs-built_in">string</span> templatePath, <span class="hljs-built_in">object</span> <span class="hljs-keyword">value</span></span>)
<span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> Task <span class="hljs-title">SaveAsByTemplateAsync</span>(<span class="hljs-params"><span class="hljs-keyword">this</span> Stream stream, <span class="hljs-built_in">byte</span>[] templateBytes, <span class="hljs-built_in">object</span> <span class="hljs-keyword">value</span></span>)
<span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> Task <span class="hljs-title">SaveAsByTemplateAsync</span>(<span class="hljs-params"><span class="hljs-built_in">string</span> path, <span class="hljs-built_in">string</span> templatePath, <span class="hljs-built_in">object</span> <span class="hljs-keyword">value</span></span>)
<span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> Task <span class="hljs-title">SaveAsByTemplateAsync</span>(<span class="hljs-params"><span class="hljs-built_in">string</span> path, <span class="hljs-built_in">byte</span>[] templateBytes, <span class="hljs-built_in">object</span> <span class="hljs-keyword">value</span></span>)
<span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> Task&lt;DataTable&gt; <span class="hljs-title">QueryAsDataTableAsync</span>(<span class="hljs-params"><span class="hljs-built_in">string</span> path, <span class="hljs-built_in">bool</span> useHeaderRow = <span class="hljs-literal">true</span>, <span class="hljs-built_in">string</span> sheetName = <span class="hljs-literal">null</span>, ExcelType excelType = ExcelType.UNKNOWN, <span class="hljs-built_in">string</span> startCell = <span class="hljs-string">"A1"</span>, IConfiguration configuration = <span class="hljs-literal">null</span></span>)
</span></code></pre>
<ul>
<li>Od wersji v1.25.0 obsługa <code>cancellationToken</code>。</li>
</ul>
<h3>Inne</h3>
<h4>1. Enum</h4>
<p>Upewnij się, że nazwy w excelu i nazwie właściwości są takie same, system automatycznie zmapuje (wielkość liter nie ma znaczenia)</p>
<p><img src="https://user-images.githubusercontent.com/12729184/116210595-9784b100-a775-11eb-936f-8e7a8b435961.png" alt="image"></p>
<p>Od wersji V0.18.0 obsługa Enum Description</p>
<pre><code class="language-csharp hljs"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title">Dto</span>
{
    <span class="hljs-keyword">public</span> <span class="hljs-built_in">string</span> Name { <span class="hljs-keyword">get</span>; <span class="hljs-keyword">set</span>; }
    <span class="hljs-keyword">public</span> I49RYZUserType UserType { <span class="hljs-keyword">get</span>; <span class="hljs-keyword">set</span>; }
}

<span class="hljs-keyword">public</span> <span class="hljs-built_in">enum</span> Type
{
    [<span class="hljs-meta">Description(<span class="hljs-string">"Użytkownik ogólny"</span>)</span>]
    V1,
    [<span class="hljs-meta">Description(<span class="hljs-string">"Administrator ogólny"</span>)</span>]
    V2,
    [<span class="hljs-meta">Description(<span class="hljs-string">"Administrator główny"</span>)</span>]
    V3
}
</code></pre>
<pre><code class="hljs language-less">
!<span class="hljs-selector-attr">[image]</span>(<span class="hljs-attribute">https</span>:<span class="hljs-comment">//user-images.githubusercontent.com/12729184/133116630-27cc7161-099a-48b8-9784-cd1e443af3d1.png)</span>

Od wersji <span class="hljs-number">1.30</span>.<span class="hljs-number">0</span> dostępna jest obsługa konwersji opisu z Excela na Enum, podziękowania dla <span class="hljs-variable">@KaneLeung</span>

#### <span class="hljs-number">2</span>. Konwersja CSV do XLSX lub konwersja XLSX do CSV

<span class="hljs-built_in">``</span>`csharp
MiniExcel.<span class="hljs-built_in">ConvertXlsxToCsv</span>(xlsxPath, csvPath);
MiniExcel.<span class="hljs-built_in">ConvertXlsxToCsv</span>(xlsxStream, csvStream);
MiniExcel.<span class="hljs-built_in">ConvertCsvToXlsx</span>(csvPath, xlsxPath);
MiniExcel.<span class="hljs-built_in">ConvertCsvToXlsx</span>(csvStream, xlsxStream);
</code></pre>
<pre><code class="language-csharp hljs"><span class="hljs-keyword">using</span> (<span class="hljs-keyword">var</span> excelStream = <span class="hljs-keyword">new</span> FileStream(path: filePath, FileMode.Open, FileAccess.Read))
<span class="hljs-keyword">using</span> (<span class="hljs-keyword">var</span> csvStream = <span class="hljs-keyword">new</span> MemoryStream())
{
   MiniExcel.ConvertXlsxToCsv(excelStream, csvStream);
}
</code></pre>
<h4>3. Niestandardowa CultureInfo</h4>
<p>Od wersji 1.22.0 możesz zdefiniować własną CultureInfo jak poniżej, domyślnie system używa <code>CultureInfo.InvariantCulture</code>.</p>
<pre><code class="language-csharp hljs"><span class="hljs-keyword">var</span> config = <span class="hljs-keyword">new</span> CsvConfiguration()
{
    Culture = <span class="hljs-keyword">new</span> CultureInfo(<span class="hljs-string">"fr-FR"</span>),
};
MiniExcel.SaveAs(path, <span class="hljs-keyword">value</span>, configuration: config);

<span class="hljs-comment">// lub</span>
MiniExcel.Query(path, configuration: config);
</code></pre>
<h4>4. Niestandardowy rozmiar bufora</h4>
<pre><code class="language-csharp hljs">    <span class="hljs-keyword">public</span> <span class="hljs-keyword">abstract</span> <span class="hljs-keyword">class</span> <span class="hljs-title">Configuration</span> : <span class="hljs-title">IConfiguration</span>
    {
        <span class="hljs-keyword">public</span> <span class="hljs-built_in">int</span> BufferSize { <span class="hljs-keyword">get</span>; <span class="hljs-keyword">set</span>; } = <span class="hljs-number">1024</span> * <span class="hljs-number">512</span>;
    }
</code></pre>
<h4>5. Tryb FastMode</h4>
<p>System nie kontroluje pamięci, ale można uzyskać szybsze zapisywanie.</p>
<pre><code class="language-csharp hljs"><span class="hljs-keyword">var</span> config = <span class="hljs-keyword">new</span> OpenXmlConfiguration() { FastMode = <span class="hljs-literal">true</span> };
MiniExcel.SaveAs(path, reader,configuration:config);
</code></pre>
<h4>6. Seryjne dodawanie obrazów (MiniExcel.AddPicture)</h4>
<pre><code class="language-csharp hljs"><span class="hljs-keyword">var</span> images = <span class="hljs-keyword">new</span>[]
{
    <span class="hljs-keyword">new</span> MiniExcelPicture
    {
        ImageBytes = File.ReadAllBytes(PathHelper.GetFile(<span class="hljs-string">"images/github_logo.png"</span>)),
        SheetName = <span class="hljs-literal">null</span>, <span class="hljs-comment">// domyślnie null to pierwszy arkusz</span>
        CellAddress = <span class="hljs-string">"C3"</span>, <span class="hljs-comment">// wymagane</span>
    },
    <span class="hljs-keyword">new</span> MiniExcelPicture
    {
        ImageBytes = File.ReadAllBytes(PathHelper.GetFile(<span class="hljs-string">"images/google_logo.png"</span>)),
        PictureType = <span class="hljs-string">"image/png"</span>, <span class="hljs-comment">// domyślnie PictureType = image/png</span>
        SheetName = <span class="hljs-string">"Demo"</span>,
        CellAddress = <span class="hljs-string">"C9"</span>, <span class="hljs-comment">// wymagane</span>
        WidthPx = <span class="hljs-number">100</span>,
        HeightPx = <span class="hljs-number">100</span>,
    },
};
MiniExcel.AddPicture(path, images);
</code></pre>
<p><img src="https://github.com/user-attachments/assets/19c4d241-9753-4ede-96c8-f810c1a22247" alt="Image"></p>
<h4>7. Pobieranie wymiarów arkusza</h4>
<pre><code class="language-csharp hljs"><span class="hljs-keyword">var</span> dim = MiniExcel.GetSheetDimensions(path);
</code></pre>
<h3>Przykłady:</h3>
<h4>1. SQLite &amp; Dapper <code>Duży plik</code> Wstawianie SQL bez OOM</h4>
<p>uwaga: proszę nie wywoływać metod ToList/ToArray po Query, spowoduje to załadowanie wszystkich danych do pamięci</p>
<pre><code class="language-csharp hljs"><span class="hljs-keyword">using</span> (<span class="hljs-keyword">var</span> connection = <span class="hljs-keyword">new</span> SQLiteConnection(connectionString))
{
    connection.Open();
    <span class="hljs-keyword">using</span> (<span class="hljs-keyword">var</span> transaction = connection.BeginTransaction())
    <span class="hljs-keyword">using</span> (<span class="hljs-keyword">var</span> stream = File.OpenRead(path))
    {
       <span class="hljs-keyword">var</span> rows = stream.Query();
       <span class="hljs-keyword">foreach</span> (<span class="hljs-keyword">var</span> row <span class="hljs-keyword">in</span> rows)
             connection.Execute(<span class="hljs-string">"insert into T (A,B) values (@A,@B)"</span>, <span class="hljs-keyword">new</span> { row.A, row.B }, transaction: transaction);
       transaction.Commit();
    }
}
</code></pre>
<p>wydajność:<br><img src="https://user-images.githubusercontent.com/12729184/111072579-2dda7b80-8516-11eb-9843-c01a1edc88ec.png" alt="image"></p>
<h4>2. ASP.NET Core 3.1 lub MVC 5 Download/Upload Excel Xlsx API Demo <a href="tests/MiniExcel.Tests.AspNetCore">Wypróbuj</a></h4>
<pre><code class="language-csharp hljs"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title">ApiController</span> : <span class="hljs-title">Controller</span>
{
    <span class="hljs-function"><span class="hljs-keyword">public</span> IActionResult <span class="hljs-title">Index</span>()</span>
    {
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> ContentResult
        {
            ContentType = <span class="hljs-string">"text/html"</span>,
            StatusCode = (<span class="hljs-built_in">int</span>)HttpStatusCode.OK,
            Content = <span class="hljs-string">@"&lt;html&gt;&lt;body&gt;
&lt;a href='api/DownloadExcel'&gt;DownloadExcel&lt;/a&gt;&lt;br&gt;
&lt;a href='api/DownloadExcelFromTemplatePath'&gt;DownloadExcelFromTemplatePath&lt;/a&gt;&lt;br&gt;
&lt;a href='api/DownloadExcelFromTemplateBytes'&gt;DownloadExcelFromTemplateBytes&lt;/a&gt;&lt;br&gt;
&lt;p&gt;Upload Excel&lt;/p&gt;
&lt;form method='post' enctype='multipart/form-data' action='/api/uploadexcel'&gt;
    &lt;input type='file' name='excel'&gt; &lt;br&gt;
    &lt;input type='submit' &gt;
&lt;/form&gt;
&lt;/body&gt;&lt;/html&gt;"</span>
        };
    }

    <span class="hljs-function"><span class="hljs-keyword">public</span> IActionResult <span class="hljs-title">DownloadExcel</span>()</span>
    {
        <span class="hljs-keyword">var</span> values = <span class="hljs-keyword">new</span>[] {
            <span class="hljs-keyword">new</span> { Column1 = <span class="hljs-string">"MiniExcel"</span>, Column2 = <span class="hljs-number">1</span> },
            <span class="hljs-keyword">new</span> { Column1 = <span class="hljs-string">"Github"</span>, Column2 = <span class="hljs-number">2</span>}
        };
        <span class="hljs-keyword">var</span> memoryStream = <span class="hljs-keyword">new</span> MemoryStream();
        memoryStream.SaveAs(values);
        memoryStream.Seek(<span class="hljs-number">0</span>, SeekOrigin.Begin);
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> FileStreamResult(memoryStream, <span class="hljs-string">"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"</span>)
        {
            FileDownloadName = <span class="hljs-string">"demo.xlsx"</span>
        };
    }

    <span class="hljs-function"><span class="hljs-keyword">public</span> IActionResult <span class="hljs-title">DownloadExcelFromTemplatePath</span>()</span>
    {
        <span class="hljs-built_in">string</span> templatePath = <span class="hljs-string">"TestTemplateComplex.xlsx"</span>;

        Dictionary&lt;<span class="hljs-built_in">string</span>, <span class="hljs-built_in">object</span>&gt; <span class="hljs-keyword">value</span> = <span class="hljs-keyword">new</span> Dictionary&lt;<span class="hljs-built_in">string</span>, <span class="hljs-built_in">object</span>&gt;()
        {
            [<span class="hljs-string">"title"</span>] = <span class="hljs-string">"FooCompany"</span>,
            [<span class="hljs-string">"managers"</span>] = <span class="hljs-keyword">new</span>[] {
                <span class="hljs-keyword">new</span> {name=<span class="hljs-string">"Jack"</span>,department=<span class="hljs-string">"HR"</span>},
                <span class="hljs-keyword">new</span> {name=<span class="hljs-string">"Loan"</span>,department=<span class="hljs-string">"IT"</span>}
            },
            [<span class="hljs-string">"employees"</span>] = <span class="hljs-keyword">new</span>[] {
                <span class="hljs-keyword">new</span> {name=<span class="hljs-string">"Wade"</span>,department=<span class="hljs-string">"HR"</span>},
                <span class="hljs-keyword">new</span> {name=<span class="hljs-string">"Felix"</span>,department=<span class="hljs-string">"HR"</span>},
                <span class="hljs-keyword">new</span> {name=<span class="hljs-string">"Eric"</span>,department=<span class="hljs-string">"IT"</span>},
                <span class="hljs-keyword">new</span> {name=<span class="hljs-string">"Keaton"</span>,department=<span class="hljs-string">"IT"</span>}
            }
        };

        MemoryStream memoryStream = <span class="hljs-keyword">new</span> MemoryStream();
        memoryStream.SaveAsByTemplate(templatePath, <span class="hljs-keyword">value</span>);
        memoryStream.Seek(<span class="hljs-number">0</span>, SeekOrigin.Begin);
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> FileStreamResult(memoryStream, <span class="hljs-string">"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"</span>)
        {
            FileDownloadName = <span class="hljs-string">"demo.xlsx"</span>
        };
    }

    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> Dictionary&lt;<span class="hljs-built_in">string</span>, Byte[]&gt; TemplateBytesCache = <span class="hljs-keyword">new</span> Dictionary&lt;<span class="hljs-built_in">string</span>, <span class="hljs-built_in">byte</span>[]&gt;();

    <span class="hljs-function"><span class="hljs-keyword">static</span> <span class="hljs-title">ApiController</span>()</span>
    {
        <span class="hljs-built_in">string</span> templatePath = <span class="hljs-string">"TestTemplateComplex.xlsx"</span>;
        <span class="hljs-built_in">byte</span>[] bytes = System.IO.File.ReadAllBytes(templatePath);
        TemplateBytesCache.Add(templatePath, bytes);
    }

    <span class="hljs-function"><span class="hljs-keyword">public</span> IActionResult <span class="hljs-title">DownloadExcelFromTemplateBytes</span>()</span>
    {
        <span class="hljs-built_in">byte</span>[] bytes = TemplateBytesCache[<span class="hljs-string">"TestTemplateComplex.xlsx"</span>];

        Dictionary&lt;<span class="hljs-built_in">string</span>, <span class="hljs-built_in">object</span>&gt; <span class="hljs-keyword">value</span> = <span class="hljs-keyword">new</span> Dictionary&lt;<span class="hljs-built_in">string</span>, <span class="hljs-built_in">object</span>&gt;()
        {
            [<span class="hljs-string">"title"</span>] = <span class="hljs-string">"FooCompany"</span>,
            [<span class="hljs-string">"managers"</span>] = <span class="hljs-keyword">new</span>[] {
                <span class="hljs-keyword">new</span> {name=<span class="hljs-string">"Jack"</span>,department=<span class="hljs-string">"HR"</span>},
                <span class="hljs-keyword">new</span> {name=<span class="hljs-string">"Loan"</span>,department=<span class="hljs-string">"IT"</span>}
</code></pre>
<pre><code class="language-csharp hljs">            },
            [<span class="hljs-string">"employees"</span>] = <span class="hljs-keyword">new</span>[] {
                <span class="hljs-keyword">new</span> {name=<span class="hljs-string">"Wade"</span>,department=<span class="hljs-string">"HR"</span>},
                <span class="hljs-keyword">new</span> {name=<span class="hljs-string">"Felix"</span>,department=<span class="hljs-string">"HR"</span>},
                <span class="hljs-keyword">new</span> {name=<span class="hljs-string">"Eric"</span>,department=<span class="hljs-string">"IT"</span>},
                <span class="hljs-keyword">new</span> {name=<span class="hljs-string">"Keaton"</span>,department=<span class="hljs-string">"IT"</span>}
            }
        };

        MemoryStream memoryStream = <span class="hljs-keyword">new</span> MemoryStream();
        memoryStream.SaveAsByTemplate(bytes, <span class="hljs-keyword">value</span>);
        memoryStream.Seek(<span class="hljs-number">0</span>, SeekOrigin.Begin);
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> FileStreamResult(memoryStream, <span class="hljs-string">"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"</span>)
        {
            FileDownloadName = <span class="hljs-string">"demo.xlsx"</span>
        };
    }

    <span class="hljs-function"><span class="hljs-keyword">public</span> IActionResult <span class="hljs-title">UploadExcel</span>(<span class="hljs-params">IFormFile excel</span>)</span>
    {
        <span class="hljs-keyword">var</span> stream = <span class="hljs-keyword">new</span> MemoryStream();
        excel.CopyTo(stream);

        <span class="hljs-keyword">foreach</span> (<span class="hljs-keyword">var</span> item <span class="hljs-keyword">in</span> stream.Query(<span class="hljs-literal">true</span>))
        {
            <span class="hljs-comment">// tutaj implementuj swoją logikę itd.</span>
        }

        <span class="hljs-keyword">return</span> Ok(<span class="hljs-string">"Plik został przesłany pomyślnie"</span>);
    }
}
</code></pre>
<h4>3. Zapytanie stronicowane (Paging Query)</h4>
<pre><code class="language-csharp hljs"><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">Main</span>()</span>
{
    <span class="hljs-keyword">var</span> rows = MiniExcel.Query(path);

    Console.WriteLine(<span class="hljs-string">"==== Strona nr 1 ===="</span>);
    Console.WriteLine(Page(rows,pageSize:<span class="hljs-number">3</span>,page:<span class="hljs-number">1</span>));
    Console.WriteLine(<span class="hljs-string">"==== Strona nr 50 ===="</span>);
    Console.WriteLine(Page(rows,pageSize:<span class="hljs-number">3</span>,page:<span class="hljs-number">50</span>));
    Console.WriteLine(<span class="hljs-string">"==== Strona nr 5000 ===="</span>);
    Console.WriteLine(Page(rows,pageSize:<span class="hljs-number">3</span>,page:<span class="hljs-number">5000</span>));
}

<span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-title">IEnumerable</span>&lt;<span class="hljs-title">T</span>&gt; <span class="hljs-title">Page</span>&lt;<span class="hljs-title">T</span>&gt;(<span class="hljs-params">IEnumerable&lt;T&gt; en, <span class="hljs-built_in">int</span> pageSize, <span class="hljs-built_in">int</span> page</span>)</span>
{
    <span class="hljs-keyword">return</span> en.Skip(page * pageSize).Take(pageSize);
}
</code></pre>
<p><img src="https://user-images.githubusercontent.com/12729184/114679083-6ef4c400-9d3e-11eb-9f78-a86daa45fe46.gif" alt="20210419"></p>
<h4>4. Eksport Excela w WebForm przez MemoryStream</h4>
<pre><code class="language-csharp hljs"><span class="hljs-keyword">var</span> fileName = <span class="hljs-string">"Demo.xlsx"</span>;
<span class="hljs-keyword">var</span> sheetName = <span class="hljs-string">"Sheet1"</span>;
HttpResponse response = HttpContext.Current.Response;
response.Clear();
response.ContentType = <span class="hljs-string">"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"</span>;
response.AddHeader(<span class="hljs-string">"Content-Disposition"</span>, <span class="hljs-string">$"attachment;filename=\"<span class="hljs-subst">{fileName}</span>\""</span>);
<span class="hljs-keyword">var</span> values = <span class="hljs-keyword">new</span>[] {
    <span class="hljs-keyword">new</span> { Column1 = <span class="hljs-string">"MiniExcel"</span>, Column2 = <span class="hljs-number">1</span> },
    <span class="hljs-keyword">new</span> { Column1 = <span class="hljs-string">"Github"</span>, Column2 = <span class="hljs-number">2</span>}
};
<span class="hljs-keyword">var</span> memoryStream = <span class="hljs-keyword">new</span> MemoryStream();
memoryStream.SaveAs(values, sheetName: sheetName);
memoryStream.Seek(<span class="hljs-number">0</span>, SeekOrigin.Begin);
memoryStream.CopyTo(Response.OutputStream);
response.End();
</code></pre>
<h4>5. Dynamiczne i18n, wielojęzyczność i zarządzanie uprawnieniami ról</h4>
<p>Jak w przykładzie, utwórz metodę obsługującą i18n oraz zarządzanie uprawnieniami i użyj <code>yield return</code> do zwracania IEnumerable&lt;Dictionary&lt;string, object&gt;&gt; dla osiągnięcia dynamicznego i niskopamięciowego przetwarzania</p>
<pre><code class="language-csharp hljs"><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">Main</span>()</span>
{
    <span class="hljs-keyword">var</span> <span class="hljs-keyword">value</span> = <span class="hljs-keyword">new</span> Order[] {
        <span class="hljs-keyword">new</span> Order(){OrderNo = <span class="hljs-string">"SO01"</span>,CustomerID=<span class="hljs-string">"C001"</span>,ProductID=<span class="hljs-string">"P001"</span>,Qty=<span class="hljs-number">100</span>,Amt=<span class="hljs-number">500</span>},
        <span class="hljs-keyword">new</span> Order(){OrderNo = <span class="hljs-string">"SO02"</span>,CustomerID=<span class="hljs-string">"C002"</span>,ProductID=<span class="hljs-string">"P002"</span>,Qty=<span class="hljs-number">300</span>,Amt=<span class="hljs-number">400</span>},
    };

    Console.WriteLine(<span class="hljs-string">"en-Us i rola Sales"</span>);
    {
        <span class="hljs-keyword">var</span> path = Path.GetTempPath() + Guid.NewGuid() + <span class="hljs-string">".xlsx"</span>;
        <span class="hljs-keyword">var</span> lang = <span class="hljs-string">"en-US"</span>;
        <span class="hljs-keyword">var</span> role = <span class="hljs-string">"Sales"</span>;
        MiniExcel.SaveAs(path, GetOrders(lang, role, <span class="hljs-keyword">value</span>));
        MiniExcel.Query(path, <span class="hljs-literal">true</span>).Dump();
    }

    Console.WriteLine(<span class="hljs-string">"zh-CN i rola PMC"</span>);
    {
        <span class="hljs-keyword">var</span> path = Path.GetTempPath() + Guid.NewGuid() + <span class="hljs-string">".xlsx"</span>;
        <span class="hljs-keyword">var</span> lang = <span class="hljs-string">"zh-CN"</span>;
        <span class="hljs-keyword">var</span> role = <span class="hljs-string">"PMC"</span>;
        MiniExcel.SaveAs(path, GetOrders(lang, role, <span class="hljs-keyword">value</span>));
        MiniExcel.Query(path, <span class="hljs-literal">true</span>).Dump();
    }
}

<span class="hljs-keyword">private</span> IEnumerable&lt;Dictionary&lt;<span class="hljs-built_in">string</span>, <span class="hljs-built_in">object</span>&gt;&gt; GetOrders(<span class="hljs-built_in">string</span> lang, <span class="hljs-built_in">string</span> role, Order[] orders)
{
    <span class="hljs-keyword">foreach</span> (<span class="hljs-keyword">var</span> order <span class="hljs-keyword">in</span> orders)
    {
        <span class="hljs-keyword">var</span> newOrder = <span class="hljs-keyword">new</span> Dictionary&lt;<span class="hljs-built_in">string</span>, <span class="hljs-built_in">object</span>&gt;();

        <span class="hljs-keyword">if</span> (lang == <span class="hljs-string">"zh-CN"</span>)
        {
            newOrder.Add(<span class="hljs-string">"客户编号"</span>, order.CustomerID);
            newOrder.Add(<span class="hljs-string">"订单编号"</span>, order.OrderNo);
            newOrder.Add(<span class="hljs-string">"产品编号"</span>, order.ProductID);
            newOrder.Add(<span class="hljs-string">"数量"</span>, order.Qty);
            <span class="hljs-keyword">if</span> (role == <span class="hljs-string">"Sales"</span>)
                newOrder.Add(<span class="hljs-string">"价格"</span>, order.Amt);
            <span class="hljs-keyword">yield</span> <span class="hljs-keyword">return</span> newOrder;
        }
        <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (lang == <span class="hljs-string">"en-US"</span>)
        {
            newOrder.Add(<span class="hljs-string">"Customer ID"</span>, order.CustomerID);
            newOrder.Add(<span class="hljs-string">"Order No"</span>, order.OrderNo);
            newOrder.Add(<span class="hljs-string">"Product ID"</span>, order.ProductID);
            newOrder.Add(<span class="hljs-string">"Quantity"</span>, order.Qty);
            <span class="hljs-keyword">if</span> (role == <span class="hljs-string">"Sales"</span>)
                newOrder.Add(<span class="hljs-string">"Amount"</span>, order.Amt);
            <span class="hljs-keyword">yield</span> <span class="hljs-keyword">return</span> newOrder;
        }
        <span class="hljs-keyword">else</span>
        {
            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> InvalidDataException(<span class="hljs-string">$"lang <span class="hljs-subst">{lang}</span> wrong"</span>);
        }
    }
}

<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title">Order</span>
{
    <span class="hljs-keyword">public</span> <span class="hljs-built_in">string</span> OrderNo { <span class="hljs-keyword">get</span>; <span class="hljs-keyword">set</span>; }
    <span class="hljs-keyword">public</span> <span class="hljs-built_in">string</span> CustomerID { <span class="hljs-keyword">get</span>; <span class="hljs-keyword">set</span>; }
    <span class="hljs-keyword">public</span> <span class="hljs-built_in">decimal</span> Qty { <span class="hljs-keyword">get</span>; <span class="hljs-keyword">set</span>; }
    <span class="hljs-keyword">public</span> <span class="hljs-built_in">string</span> ProductID { <span class="hljs-keyword">get</span>; <span class="hljs-keyword">set</span>; }
    <span class="hljs-keyword">public</span> <span class="hljs-built_in">decimal</span> Amt { <span class="hljs-keyword">get</span>; <span class="hljs-keyword">set</span>; }
}
</code></pre>
<p><img src="https://user-images.githubusercontent.com/12729184/118939964-d24bc480-b982-11eb-88dd-f06655f6121a.png" alt="image"></p>
<h3>FAQ</h3>
<h4>Q: Nagłówek Excela nie jest równy nazwie właściwości klasy, jak mapować?</h4>
<p>O. Proszę użyć atrybutu ExcelColumnName</p>
<p><img src="https://user-images.githubusercontent.com/12729184/116020475-eac50980-a678-11eb-8804-129e87200e5e.png" alt="image"></p>
<h4>Q. Jak zapytać lub eksportować wiele arkuszy?</h4>
<p>O. Metoda <code>GetSheetNames</code> z parametrem  Query  sheetName.</p>
<pre><code class="language-csharp hljs"><span class="hljs-keyword">var</span> sheets = MiniExcel.GetSheetNames(path);
<span class="hljs-keyword">foreach</span> (<span class="hljs-keyword">var</span> sheet <span class="hljs-keyword">in</span> sheets)
{
    Console.WriteLine(<span class="hljs-string">$"nazwa arkusza : <span class="hljs-subst">{sheet}</span> "</span>);
    <span class="hljs-keyword">var</span> rows = MiniExcel.Query(path,useHeaderRow:<span class="hljs-literal">true</span>,sheetName:sheet);
    Console.WriteLine(rows);
}
</code></pre>
<p><img src="https://user-images.githubusercontent.com/12729184/116199841-2a1f5300-a76a-11eb-90a3-6710561cf6db.png" alt="image"></p>
<h4>Q. Jak zapytać lub eksportować informacje o widoczności arkusza?</h4>
<p>O. Metoda <code>GetSheetInformations</code>.</p>
<pre><code class="language-csharp hljs"><span class="hljs-keyword">var</span> sheets = MiniExcel.GetSheetInformations(path);
<span class="hljs-keyword">foreach</span> (<span class="hljs-keyword">var</span> sheetInfo <span class="hljs-keyword">in</span> sheets)
{
    Console.WriteLine(<span class="hljs-string">$"indeks arkusza : <span class="hljs-subst">{sheetInfo.Index}</span> "</span>); <span class="hljs-comment">// kolejny indeks arkusza - numerowany od 0</span>
    Console.WriteLine(<span class="hljs-string">$"nazwa arkusza : <span class="hljs-subst">{sheetInfo.Name}</span> "</span>);   <span class="hljs-comment">// nazwa arkusza</span>
    Console.WriteLine(<span class="hljs-string">$"stan arkusza : <span class="hljs-subst">{sheetInfo.State}</span> "</span>); <span class="hljs-comment">// stan widoczności arkusza - widoczny / ukryty</span>
}
</code></pre>
<pre><code class="hljs language-csharp"><span class="hljs-meta">#### P. Czy użycie Count załaduje wszystkie dane do pamięci?</span>

Nie, test na obrazie zawiera <span class="hljs-number">1</span> milion wierszy * <span class="hljs-number">10</span> kolumn danych, maksymalne użycie pamięci to &lt;<span class="hljs-number">60</span>MB, a czas trwania to <span class="hljs-number">13</span>,<span class="hljs-number">65</span> sekundy

![image](https:<span class="hljs-comment">//user-images.githubusercontent.com/12729184/117118518-70586000-adc3-11eb-9ce3-2ba76cf8b5e5.png)</span>

<span class="hljs-meta">#### P. Jak Query używa indeksów liczbowych?</span>

Domyślny indeks Query to klucz znakowy: A,B,C.... Jeśli chcesz zmienić na indeksy liczbowe, utwórz poniższą metodę <span class="hljs-keyword">do</span> konwersji

```<span class="hljs-function">csharp
<span class="hljs-keyword">void</span> <span class="hljs-title">Main</span>()</span>
{
    <span class="hljs-keyword">var</span> path = <span class="hljs-string">@"D:\git\MiniExcel\samples\xlsx\TestTypeMapping.xlsx"</span>;
    <span class="hljs-keyword">var</span> rows = MiniExcel.Query(path,<span class="hljs-literal">true</span>);
    <span class="hljs-keyword">foreach</span> (<span class="hljs-function"><span class="hljs-keyword">var</span> r <span class="hljs-keyword">in</span> <span class="hljs-title">ConvertToIntIndexRows</span>(<span class="hljs-params">rows</span>))</span>
    {
        Console.Write(<span class="hljs-string">$"column 0 : <span class="hljs-subst">{r[<span class="hljs-number">0</span>]}</span> ,column 1 : <span class="hljs-subst">{r[<span class="hljs-number">1</span>]}</span>"</span>);
        Console.WriteLine();
    }
}

<span class="hljs-keyword">private</span> IEnumerable&lt;Dictionary&lt;<span class="hljs-built_in">int</span>, <span class="hljs-built_in">object</span>&gt;&gt; ConvertToIntIndexRows(IEnumerable&lt;<span class="hljs-built_in">object</span>&gt; rows)
{
    ICollection&lt;<span class="hljs-built_in">string</span>&gt; keys = <span class="hljs-literal">null</span>;
    <span class="hljs-keyword">var</span> isFirst = <span class="hljs-literal">true</span>;
    <span class="hljs-keyword">foreach</span> (IDictionary&lt;<span class="hljs-built_in">string</span>,<span class="hljs-built_in">object</span>&gt; r <span class="hljs-keyword">in</span> rows)
    {
        <span class="hljs-keyword">if</span>(isFirst)
        {
            keys = r.Keys;
            isFirst = <span class="hljs-literal">false</span>;
        }

        <span class="hljs-keyword">var</span> dic = <span class="hljs-keyword">new</span> Dictionary&lt;<span class="hljs-built_in">int</span>, <span class="hljs-built_in">object</span>&gt;();
        <span class="hljs-keyword">var</span> index = <span class="hljs-number">0</span>;
        <span class="hljs-keyword">foreach</span> (<span class="hljs-keyword">var</span> key <span class="hljs-keyword">in</span> keys)
            dic[index++] = r[key];
        <span class="hljs-keyword">yield</span> <span class="hljs-keyword">return</span> dic;
    }
}
</code></pre>
<h4>P. Excel bez tytułu jest pusty, gdy eksportowana wartość jest pusta</h4>
<p>Ponieważ MiniExcel używa logiki podobnej do JSON.NET do dynamicznego pobierania typu z wartości w celu uproszczenia operacji API, typ nie może być znany bez danych. Możesz sprawdzić <a href="https://github.com/mini-software/MiniExcel/issues/133">issue #133</a> dla wyjaśnienia.</p>
<p><img src="https://user-images.githubusercontent.com/12729184/122639771-546c0c00-d12e-11eb-800c-498db27889ca.png" alt="image"></p>
<blockquote>
<p>Typ silny &amp; DataTable wygenerują nagłówki, ale Dictionary nadal będą tworzyć pusty plik Excel</p>
</blockquote>
<h4>P. Jak zatrzymać foreach przy pustym wierszu?</h4>
<p>MiniExcel można użyć z <code>LINQ TakeWhile</code>, aby zatrzymać iterator foreach.</p>
<p><img src="https://user-images.githubusercontent.com/12729184/130209137-162621c2-f337-4479-9996-beeac65bc4d4.png" alt="Image"></p>
<h4>P. Jak usunąć puste wiersze?</h4>
<p><img src="https://user-images.githubusercontent.com/12729184/137873865-7107d8f5-eb59-42db-903a-44e80589f1b2.png" alt="image"></p>
<p>IEnumerable :</p>
<pre><code class="language-csharp hljs"><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> IEnumerable&lt;<span class="hljs-built_in">dynamic</span>&gt; <span class="hljs-title">QueryWithoutEmptyRow</span>(<span class="hljs-params">Stream stream, <span class="hljs-built_in">bool</span> useHeaderRow, <span class="hljs-built_in">string</span> sheetName, ExcelType excelType, <span class="hljs-built_in">string</span> startCell, IConfiguration configuration</span>)</span>
{
    <span class="hljs-keyword">var</span> rows = stream.Query(useHeaderRow,sheetName,excelType,startCell,configuration);
    <span class="hljs-keyword">foreach</span> (IDictionary&lt;<span class="hljs-built_in">string</span>,<span class="hljs-built_in">object</span>&gt; row <span class="hljs-keyword">in</span> rows)
    {
        <span class="hljs-keyword">if</span>(row.Keys.Any(key=&gt;row[key]!=<span class="hljs-literal">null</span>))
            <span class="hljs-keyword">yield</span> <span class="hljs-keyword">return</span> row;
    }
}
</code></pre>
<p>DataTable :</p>
<pre><code class="language-csharp hljs"><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> DataTable <span class="hljs-title">QueryAsDataTableWithoutEmptyRow</span>(<span class="hljs-params">Stream stream, <span class="hljs-built_in">bool</span> useHeaderRow, <span class="hljs-built_in">string</span> sheetName, ExcelType excelType, <span class="hljs-built_in">string</span> startCell, IConfiguration configuration</span>)</span>
{
    <span class="hljs-keyword">if</span> (sheetName == <span class="hljs-literal">null</span> &amp;&amp; excelType != ExcelType.CSV) <span class="hljs-comment">/*Issue #279*/</span>
        sheetName = stream.GetSheetNames().First();

    <span class="hljs-keyword">var</span> dt = <span class="hljs-keyword">new</span> DataTable(sheetName);
    <span class="hljs-keyword">var</span> first = <span class="hljs-literal">true</span>;
    <span class="hljs-keyword">var</span> rows = stream.Query(useHeaderRow,sheetName,excelType,startCell,configuration);
    <span class="hljs-keyword">foreach</span> (IDictionary&lt;<span class="hljs-built_in">string</span>, <span class="hljs-built_in">object</span>&gt; row <span class="hljs-keyword">in</span> rows)
    {
        <span class="hljs-keyword">if</span> (first)
        {

            <span class="hljs-keyword">foreach</span> (<span class="hljs-keyword">var</span> key <span class="hljs-keyword">in</span> row.Keys)
            {
                <span class="hljs-keyword">var</span> column = <span class="hljs-keyword">new</span> DataColumn(key, <span class="hljs-keyword">typeof</span>(<span class="hljs-built_in">object</span>)) { Caption = key };
                dt.Columns.Add(column);
            }

            dt.BeginLoadData();
            first = <span class="hljs-literal">false</span>;
        }

        <span class="hljs-keyword">var</span> newRow = dt.NewRow();
        <span class="hljs-keyword">var</span> isNull=<span class="hljs-literal">true</span>;
        <span class="hljs-keyword">foreach</span> (<span class="hljs-keyword">var</span> key <span class="hljs-keyword">in</span> row.Keys)
        {
            <span class="hljs-keyword">var</span> _v = row[key];
            <span class="hljs-keyword">if</span>(_v!=<span class="hljs-literal">null</span>)
                isNull = <span class="hljs-literal">false</span>;
            newRow[key] = _v;
        }

        <span class="hljs-keyword">if</span>(!isNull)
            dt.Rows.Add(newRow);
    }

    dt.EndLoadData();
    <span class="hljs-keyword">return</span> dt;
}
</code></pre>
<h4>P. Jak SaveAs(path,value) zastąpić istniejący plik i nie wywołać błędu "The file ...xlsx already exists error"</h4>
<p>Proszę użyć klasy Stream, aby dostosować logikę tworzenia pliku, np:</p>
<pre><code class="language-C# hljs language-C">    using (var stream = File.Create(<span class="hljs-string">"Demo.xlsx"</span>))
        MiniExcel.SaveAs(stream,value);
</code></pre>
<p>lub, od wersji V1.25.0, SaveAs obsługuje parametr overwriteFile, aby włączyć/wyłączyć nadpisywanie istniejącego pliku</p>
<pre><code class="language-csharp hljs">    MiniExcel.SaveAs(path, <span class="hljs-keyword">value</span>, overwriteFile: <span class="hljs-literal">true</span>);
</code></pre>
<h3>Ograniczenia i uwagi</h3>
<ul>
<li>Brak wsparcia dla xls i plików zaszyfrowanych</li>
<li>xlsm obsługuje tylko Query</li>
</ul>
<h3>Referencje</h3>
<p><a href="https://github.com/ExcelDataReader/ExcelDataReader">ExcelDataReader</a>  / <a href="https://github.com/ClosedXML/ClosedXML">ClosedXML</a> / <a href="https://github.com/DapperLib/Dapper">Dapper</a> / <a href="https://github.com/andersnm/ExcelNumberFormat">ExcelNumberFormat</a></p>
<h3>Podziękowania</h3>
<h4><a href="https://www.jetbrains.com/">Jetbrains</a></h4>
<p><img src="https://user-images.githubusercontent.com/12729184/123997015-8456c180-da02-11eb-829a-aec476fe8e94.png" alt="jetbrains-variant-2"></p>
<p>Dziękujemy za udostępnienie darmowej licencji All product IDE dla tego projektu (<a href="https://user-images.githubusercontent.com/12729184/123988233-6ab17c00-d9fa-11eb-8739-2a08c6a4a263.png">License</a>)</p>
<h3>Wsparcie i darowizny</h3>
<p>Link <a href="https://github.com/orgs/mini-software/discussions/754">https://github.com/orgs/mini-software/discussions/754</a></p>
<h3>Współtwórcy</h3>
<p><img src="https://contrib.rocks/image?repo=mini-software/MiniExcel" alt=""></p>
<hr>
<p>Tranlated By <a href="https://github.com/OpenAiTx/OpenAiTx">Open Ai Tx</a> | Last indexed: 2025-06-08</p>
<hr>
</div>
    </div>

    <footer class="footer">
        Powered by <a href="https://github.com/OpenAiTx/OpenAiTx" target="_blank">Open AI Tx</a>
    </footer>
    <!-- Default Statcounter code for openaitx
https://openaitx.github.io/ -->
    <script type="text/javascript">
        var sc_project = 13142514;
        var sc_invisible = 1;
        var sc_security = "d03a31d8"; 
    </script>
    <script type="text/javascript" src="https://www.statcounter.com/counter/counter.js" async=""></script>
    <noscript>
        <div class="statcounter"><a title="Web Analytics" href="https://statcounter.com/" target="_blank"><img
                    class="statcounter" src="https://c.statcounter.com/13142514/0/d03a31d8/1/" alt="Web Analytics"
                    referrerPolicy="no-referrer-when-downgrade"></a></div>
    </noscript>
    <!-- End of Statcounter Code -->
    <script src="view.js"></script>


</body></html>