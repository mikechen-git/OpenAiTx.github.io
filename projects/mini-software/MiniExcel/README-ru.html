<!DOCTYPE html><html lang="en"><head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Open AI Tx - Markdown Viewer</title>

    <!-- Primary Meta Tags -->
    <meta name="title" content="Open AI Tx - Markdown Viewer">
    <meta name="description" content="GitHub style markdown viewer for Open AI Tx projects">
    <meta name="keywords" content="Open AI Tx, Markdown, GitHub Style, Documentation">
    <meta name="author" content="Open AI Tx">
    <meta name="robots" content="index, follow">

    <!-- Open Graph -->
    <meta property="og:type" content="website">
    <meta property="og:url" content="https://openaitx.github.io/view.html">
    <meta property="og:title" content="Open AI Tx - Markdown Viewer">
    <meta property="og:description" content="GitHub style markdown viewer for Open AI Tx projects">
    <meta property="og:image" content="https://openaitx.github.io/logo_crop.png">

    <!-- Favicon -->
    <link rel="icon" type="image/jpeg" href="icon.jpg">
    <link rel="apple-touch-icon" href="icon.jpg">

    <!-- Marked.js for Markdown rendering -->
    <script type="text/javascript" async="" src="https://www.statcounter.com/counter/recorder.js"></script><script src="js/marked.min.js"></script>
    <!-- Highlight.js for code syntax highlighting -->
    <link rel="stylesheet" href="css/github.min.css">
    <script src="js/highlight.min.js"></script>
    <!-- Custom CSS -->
    <link rel="stylesheet" href="view.css">
    <style>
        /* Layout */
        body {
            display: flex;
            flex-direction: column;
            min-height: 100vh;
        }

        .main-container {
            margin: 0 auto;
            width: 100%;
            max-width: 980px;
            padding: 0 20px;
        }

        @media (max-width: 768px) {
            .main-container {
                padding: 0 15px;
            }
        }

        /* Image size restrictions */
        .markdown-body img {
            max-width: 100%;
            height: auto;
        }

        /* Existing styles */
        .header {
            text-align: center;
            margin-bottom: 30px;
            padding: 20px;
            background-color: #f6f8fa;
            border-bottom: 1px solid #e1e4e8;
            position: relative;
        }

        .back-button {
            position: absolute;
            left: 20px;
            top: 50%;
            transform: translateY(-50%);
            color: #0366d6;
            text-decoration: none;
            display: flex;
            align-items: center;
            font-size: 14px;
            padding: 5px 10px;
            border: 1px solid #e1e4e8;
            border-radius: 6px;
            background-color: #fff;
        }

        .back-button:hover {
            background-color: #f6f8fa;
            border-color: #0366d6;
        }

        .back-button::before {
            content: "←";
            margin-right: 5px;
            font-size: 16px;
        }

        .header .links {
            margin-top: 10px;
            font-size: 16px;
        }

        .header .links a {
            color: #0366d6;
            text-decoration: none;
            margin-left: 5px;
        }

        .header .links a:hover {
            text-decoration: underline;
        }
        
        /* Language badges styles */
        .language-badges {
            margin-top: 15px;
            text-align: center;
        }
        .language-badges a {
            display: inline-block;
            margin: 2px;
            text-decoration: none;
        }
        .language-badges img {
            height: 20px;
            border-radius: 3px;
        }
        .language-badges a:hover img {
            opacity: 0.8;
        }
    </style>
</head>

<body>
    <div class="header">
        <a href="javascript:history.back()" class="back-button">Back</a>
        <div class="links">
            GitHub Repository: <a href="https://github.com/mini-software/MiniExcel" id="githubRepoLink" target="_blank">mini-software/MiniExcel</a>
        </div>
        <div class="language-badges" id="languageBadges"><a href="https://openaitx.github.io/view.html?user=mini-software&amp;project=MiniExcel&amp;lang=en"><img src="https://img.shields.io/badge/EN-white" alt="version"></a> <a href="https://openaitx.github.io/view.html?user=mini-software&amp;project=MiniExcel&amp;lang=zh-CN"><img src="https://img.shields.io/badge/简中-white" alt="version"></a> <a href="https://openaitx.github.io/view.html?user=mini-software&amp;project=MiniExcel&amp;lang=zh-TW"><img src="https://img.shields.io/badge/繁中-white" alt="version"></a> <a href="https://openaitx.github.io/view.html?user=mini-software&amp;project=MiniExcel&amp;lang=ja"><img src="https://img.shields.io/badge/日本語-white" alt="version"></a> <a href="https://openaitx.github.io/view.html?user=mini-software&amp;project=MiniExcel&amp;lang=ko"><img src="https://img.shields.io/badge/한국어-white" alt="version"></a> <a href="https://openaitx.github.io/view.html?user=mini-software&amp;project=MiniExcel&amp;lang=th"><img src="https://img.shields.io/badge/ไทย-white" alt="version"></a> <a href="https://openaitx.github.io/view.html?user=mini-software&amp;project=MiniExcel&amp;lang=fr"><img src="https://img.shields.io/badge/Français-white" alt="version"></a> <a href="https://openaitx.github.io/view.html?user=mini-software&amp;project=MiniExcel&amp;lang=de"><img src="https://img.shields.io/badge/Deutsch-white" alt="version"></a> <a href="https://openaitx.github.io/view.html?user=mini-software&amp;project=MiniExcel&amp;lang=es"><img src="https://img.shields.io/badge/Español-white" alt="version"></a> <a href="https://openaitx.github.io/view.html?user=mini-software&amp;project=MiniExcel&amp;lang=it"><img src="https://img.shields.io/badge/Italiano-white" alt="version"></a> <a href="https://openaitx.github.io/view.html?user=mini-software&amp;project=MiniExcel&amp;lang=ru"><img src="https://img.shields.io/badge/Русский-white" alt="version"></a> <a href="https://openaitx.github.io/view.html?user=mini-software&amp;project=MiniExcel&amp;lang=pt"><img src="https://img.shields.io/badge/Português-white" alt="version"></a> <a href="https://openaitx.github.io/view.html?user=mini-software&amp;project=MiniExcel&amp;lang=nl"><img src="https://img.shields.io/badge/Nederlands-white" alt="version"></a> <a href="https://openaitx.github.io/view.html?user=mini-software&amp;project=MiniExcel&amp;lang=pl"><img src="https://img.shields.io/badge/Polski-white" alt="version"></a> <a href="https://openaitx.github.io/view.html?user=mini-software&amp;project=MiniExcel&amp;lang=ar"><img src="https://img.shields.io/badge/العربية-white" alt="version"></a> <a href="https://openaitx.github.io/view.html?user=mini-software&amp;project=MiniExcel&amp;lang=tr"><img src="https://img.shields.io/badge/Türkçe-white" alt="version"></a> <a href="https://openaitx.github.io/view.html?user=mini-software&amp;project=MiniExcel&amp;lang=vi"><img src="https://img.shields.io/badge/Tiếng Việt-white" alt="version"></a></div>
    </div>

    <div class="main-container">
        <div class="markdown-body" id="content"><div style="text-align: center">
<p><a href="https://www.nuget.org/packages/MiniExcel"><img src="https://img.shields.io/nuget/v/MiniExcel.svg" alt="NuGet"></a>  <a href="https://www.nuget.org/packages/MiniExcel"><img src="https://img.shields.io/nuget/dt/MiniExcel.svg" alt=""></a>
<a href="https://ci.appveyor.com/project/mini-software/miniexcel/branch/master"><img src="https://ci.appveyor.com/api/projects/status/b2vustrwsuqx45f4/branch/master?svg=true" alt="Build status"></a>
<a href="https://gitee.com/dotnetchina/MiniExcel"><img src="https://gitee.com/dotnetchina/MiniExcel/badge/star.svg" alt="star"></a> <a href="https://github.com/mini-software/MiniExcel" rel="nofollow"><img src="https://img.shields.io/github/stars/mini-software/MiniExcel?logo=github" alt="GitHub stars"></a>
<a href="https://www.nuget.org/packages/MiniExcel"><img src="https://img.shields.io/badge/.NET-%3E%3D%204.5-red.svg" alt="version"></a>
<a href="https://deepwiki.com/mini-software/MiniExcel"><img src="https://deepwiki.com/badge.svg" alt="Ask DeepWiki"></a>
</p>
</div>

<hr>
<p><a href="https://www.dotnetfoundation.org/"><img align="right" src="https://github.com/dotnet-foundation/swag/blob/main/logo/dotnetfoundation_v4.png?raw=true" width="100"></a></p>
<div style="text-align: center">
<p>Этот проект является частью <a href="https://www.dotnetfoundation.org/">.NET Foundation</a> и работает в соответствии с их <a href="https://www.dotnetfoundation.org/code-of-conduct">кодексом поведения</a>. </p>
</div>

<hr>
<div style="text-align: center">
<p><strong><a href="README.md">English</a> | <a href="README.zh-CN.md">简体中文</a> | <a href="README.zh-Hant.md">繁體中文</a></strong></p>
</div>

<hr>
<div style="text-align: center">
 Ваша <a href="https://github.com/mini-software/MiniExcel">звезда</a> и <a href="https://miniexcel.github.io">пожертвование</a> помогут сделать MiniExcel лучше
</div>

<hr>
<h3>Введение</h3>
<p>MiniExcel — это простой и эффективный .NET-инструмент для обработки Excel, предотвращающий OOM.</p>
<p>В настоящее время большинство популярных фреймворков требуют загрузки всех данных в память для удобства работы, но это приводит к проблемам с потреблением памяти. MiniExcel пытается использовать алгоритм на основе потоковой обработки, чтобы сократить исходное потребление памяти с 1000 МБ до нескольких МБ и избежать OOM (out of memory).</p>
<p><img src="https://user-images.githubusercontent.com/12729184/113086657-ab8bd000-9214-11eb-9563-c970ac1ee35e.png" alt="image"></p>
<h3>Особенности</h3>
<ul>
<li>Низкое потребление памяти, предотвращает OOM (out of memory) и полный GC</li>
<li>Поддержка построчной обработки данных в реальном времени</li>
<li>Поддержка отложенного выполнения LINQ, что позволяет выполнять ресурсоэффективную, быструю постраничную и другие сложные выборки</li>
<li>Легковесность, не требует установленного Microsoft Office, без COM+, размер DLL менее 400KB</li>
<li>Простой API для чтения/записи/заполнения excel</li>
</ul>
<h3>Быстрый старт</h3>
<ul>
<li><p><a href="#getstart1">Импорт/Запрос Excel</a></p>
</li>
<li><p><a href="#getstart2">Экспорт/Создание Excel</a></p>
</li>
<li><p><a href="#getstart3">Шаблон Excel</a></p>
</li>
<li><p><a href="#getstart4">Имя столбца Excel/Индекс/Атрибут Ignore</a></p>
</li>
<li><p><a href="#getstart5">Примеры</a></p>
</li>
</ul>
<h3>Установка</h3>
<p>Вы можете установить пакет <a href="https://www.nuget.org/packages/MiniExcel">из NuGet</a></p>
<h3>История изменений</h3>
<p>Пожалуйста, смотрите <a href="docs">Release Notes</a></p>
<h3>TODO</h3>
<p>Пожалуйста, смотрите <a href="https://github.com/mini-software/MiniExcel/projects/1?fullscreen=true">TODO</a></p>
<h3>Производительность</h3>
<p>Код для тестирования производительности находится в <a href="benchmarks/MiniExcel.Benchmarks/Program.cs">MiniExcel.Benchmarks</a>.</p>
<p>Файл, используемый для тестирования производительности — <a href="benchmarks/MiniExcel.Benchmarks/Test1%2C000%2C000x10.xlsx"><strong>Test1,000,000x10.xlsx</strong></a>, 32МБ-документ, содержащий 1 000 000 строк × 10 столбцов, в каждой ячейке которого строка "HelloWorld".</p>
<p>Для запуска всех тестов производительности используйте:</p>
<pre><code class="language-bash hljs">dotnet run -project .\benchmarks\MiniExcel.Benchmarks -c Release -f net9.0 -filter * --<span class="hljs-built_in">join</span>
</code></pre>
<p>Результаты тестов производительности для последнего релиза вы можете найти <a href="benchmarks/results">здесь</a>.</p>
<h3>Запрос/Импорт Excel  <a name="getstart1"></a></h3>
<h4>1. Выполнение запроса и отображение результатов на строго типизированный IEnumerable <a href="https://dotnetfiddle.net/w5WD1J">[Попробовать]</a></h4>
<p>Рекомендуется использовать Stream.Query для лучшей производительности.</p>
<pre><code class="language-csharp hljs"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title">UserAccount</span>
{
    <span class="hljs-keyword">public</span> Guid ID { <span class="hljs-keyword">get</span>; <span class="hljs-keyword">set</span>; }
    <span class="hljs-keyword">public</span> <span class="hljs-built_in">string</span> Name { <span class="hljs-keyword">get</span>; <span class="hljs-keyword">set</span>; }
    <span class="hljs-keyword">public</span> DateTime BoD { <span class="hljs-keyword">get</span>; <span class="hljs-keyword">set</span>; }
    <span class="hljs-keyword">public</span> <span class="hljs-built_in">int</span> Age { <span class="hljs-keyword">get</span>; <span class="hljs-keyword">set</span>; }
    <span class="hljs-keyword">public</span> <span class="hljs-built_in">bool</span> VIP { <span class="hljs-keyword">get</span>; <span class="hljs-keyword">set</span>; }
    <span class="hljs-keyword">public</span> <span class="hljs-built_in">decimal</span> Points { <span class="hljs-keyword">get</span>; <span class="hljs-keyword">set</span>; }
}

<span class="hljs-keyword">var</span> rows = MiniExcel.Query&lt;UserAccount&gt;(path);

<span class="hljs-comment">// или</span>

<span class="hljs-keyword">using</span> (<span class="hljs-keyword">var</span> stream = File.OpenRead(path))
    <span class="hljs-keyword">var</span> rows = stream.Query&lt;UserAccount&gt;();
</code></pre>
<p><img src="https://user-images.githubusercontent.com/12729184/111107423-c8c46b80-8591-11eb-982f-c97a2dafb379.png" alt="image"></p>
<h4>2. Выполнение запроса и отображение результатов в список динамических объектов без использования заголовка <a href="https://dotnetfiddle.net/w5WD1J">[Попробовать]</a></h4>
<ul>
<li>динамический ключ — <code>A.B.C.D..</code></li>
</ul>
<table>
<thead>
<tr>
<th>MiniExcel</th>
<th>1</th>
</tr>
</thead>
<tbody><tr>
<td>Github</td>
<td>2</td>
</tr>
</tbody></table>
<pre><code class="language-csharp hljs">
<span class="hljs-keyword">var</span> rows = MiniExcel.Query(path).ToList();

<span class="hljs-comment">// или</span>
<span class="hljs-keyword">using</span> (<span class="hljs-keyword">var</span> stream = File.OpenRead(path))
{
    <span class="hljs-keyword">var</span> rows = stream.Query().ToList();

    Assert.Equal(<span class="hljs-string">"MiniExcel"</span>, rows[<span class="hljs-number">0</span>].A);
    Assert.Equal(<span class="hljs-number">1</span>, rows[<span class="hljs-number">0</span>].B);
    Assert.Equal(<span class="hljs-string">"Github"</span>, rows[<span class="hljs-number">1</span>].A);
    Assert.Equal(<span class="hljs-number">2</span>, rows[<span class="hljs-number">1</span>].B);
}
</code></pre>
<h4>3. Выполнение запроса с первой строкой в качестве заголовка <a href="https://dotnetfiddle.net/w5WD1J">[Попробовать]</a></h4>
<p>замечание: при одинаковых именах столбцов используется последний справа</p>
<p>Входной Excel:</p>
<table>
<thead>
<tr>
<th>Column1</th>
<th>Column2</th>
</tr>
</thead>
<tbody><tr>
<td>MiniExcel</td>
<td>1</td>
</tr>
<tr>
<td>Github</td>
<td>2</td>
</tr>
</tbody></table>
<pre><code class="language-csharp hljs">
<span class="hljs-keyword">var</span> rows = MiniExcel.Query(useHeaderRow:<span class="hljs-literal">true</span>).ToList();

<span class="hljs-comment">// или</span>

<span class="hljs-keyword">using</span> (<span class="hljs-keyword">var</span> stream = File.OpenRead(path))
{
    <span class="hljs-keyword">var</span> rows = stream.Query(useHeaderRow:<span class="hljs-literal">true</span>).ToList();

    Assert.Equal(<span class="hljs-string">"MiniExcel"</span>, rows[<span class="hljs-number">0</span>].Column1);
    Assert.Equal(<span class="hljs-number">1</span>, rows[<span class="hljs-number">0</span>].Column2);
    Assert.Equal(<span class="hljs-string">"Github"</span>, rows[<span class="hljs-number">1</span>].Column1);
    Assert.Equal(<span class="hljs-number">2</span>, rows[<span class="hljs-number">1</span>].Column2);
}
</code></pre>
<h4>4. Запрос с поддержкой LINQ-расширений First/Take/Skip и др.</h4>
<p>Запрос First</p>
<pre><code class="language-csharp hljs"><span class="hljs-keyword">var</span> row = MiniExcel.Query(path).First();
Assert.Equal(<span class="hljs-string">"HelloWorld"</span>, row.A);

<span class="hljs-comment">// или</span>

<span class="hljs-keyword">using</span> (<span class="hljs-keyword">var</span> stream = File.OpenRead(path))
{
    <span class="hljs-keyword">var</span> row = stream.Query().First();
    Assert.Equal(<span class="hljs-string">"HelloWorld"</span>, row.A);
}
</code></pre>
<p>Сравнение производительности MiniExcel/ExcelDataReader/ClosedXML/EPPlus<br><img src="https://user-images.githubusercontent.com/12729184/111072392-6037a900-8515-11eb-9693-5ce2dad1e460.gif" alt="queryfirst"></p>
<h4>5. Запрос по имени листа</h4>
<pre><code class="language-csharp hljs">MiniExcel.Query(path, sheetName: <span class="hljs-string">"SheetName"</span>);
<span class="hljs-comment">//или</span>
stream.Query(sheetName: <span class="hljs-string">"SheetName"</span>);
</code></pre>
<h4>6. Запрос всех имен листов и строк</h4>
<pre><code class="language-csharp hljs"><span class="hljs-keyword">var</span> sheetNames = MiniExcel.GetSheetNames(path);
<span class="hljs-keyword">foreach</span> (<span class="hljs-keyword">var</span> sheetName <span class="hljs-keyword">in</span> sheetNames)
{
    <span class="hljs-keyword">var</span> rows = MiniExcel.Query(path, sheetName: sheetName);
}
</code></pre>
<h4>7. Получение столбцов</h4>
<pre><code class="language-csharp hljs"><span class="hljs-keyword">var</span> columns = MiniExcel.GetColumns(path); <span class="hljs-comment">// например, результат : ["A","B"...]</span>

<span class="hljs-keyword">var</span> cnt = columns.Count;  <span class="hljs-comment">// получить количество столбцов</span>
</code></pre>
<h4>8. Динамический запрос: приведение строки к <code>IDictionary&lt;string,object&gt;</code></h4>
<pre><code class="language-csharp hljs"><span class="hljs-keyword">foreach</span>(IDictionary&lt;<span class="hljs-built_in">string</span>,<span class="hljs-built_in">object</span>&gt; row <span class="hljs-keyword">in</span> MiniExcel.Query(path))
{
    <span class="hljs-comment">//..</span>
}

<span class="hljs-comment">// или</span>
<span class="hljs-keyword">var</span> rows = MiniExcel.Query(path).Cast&lt;IDictionary&lt;<span class="hljs-built_in">string</span>,<span class="hljs-built_in">object</span>&gt;&gt;();
<span class="hljs-comment">// или запросить определённые диапазоны (с заглавными буквами)</span>
<span class="hljs-comment">// A2 обозначает вторую строку столбца A, C3 — третью строку столбца C</span>
<span class="hljs-comment">// Если вы не хотите ограничивать строки, просто не указывайте числа</span>
<span class="hljs-keyword">var</span> rows = MiniExcel.QueryRange(path, startCell: <span class="hljs-string">"A2"</span>, endCell: <span class="hljs-string">"C3"</span>).Cast&lt;IDictionary&lt;<span class="hljs-built_in">string</span>, <span class="hljs-built_in">object</span>&gt;&gt;();
</code></pre>
<h4>9. Запрос Excel с возвратом DataTable</h4>
<p>Не рекомендуется, так как DataTable загружает все данные в память и теряется преимущество MiniExcel по низкому потреблению памяти.</p>
<pre><code class="language-C# hljs language-C">var table = MiniExcel.QueryAsDataTable(path, useHeaderRow: <span class="hljs-literal">true</span>);
</code></pre>
<p><img src="https://user-images.githubusercontent.com/12729184/116673475-07917200-a9d6-11eb-947e-a6f68cce58df.png" alt="image"></p>
<h4>10. Указать ячейку, с которой начать чтение данных</h4>
<pre><code class="language-csharp hljs">MiniExcel.Query(path,useHeaderRow:<span class="hljs-literal">true</span>,startCell:<span class="hljs-string">"B3"</span>)
</code></pre>
<p><img src="https://user-images.githubusercontent.com/12729184/117260316-8593c400-ae81-11eb-9877-c087b7ac2b01.png" alt="image"></p>
<h4>11. Заполнение объединённых ячеек</h4>
<p>Примечание: Эффективность ниже по сравнению с <code>без использования объединённого заполнения</code></p>
<p>Причина: По стандарту OpenXml mergeCells располагаются в конце файла, что приводит к необходимости проходить sheetxml дважды</p>
<pre><code class="language-csharp hljs">    <span class="hljs-keyword">var</span> config = <span class="hljs-keyword">new</span> OpenXmlConfiguration()
    {
        FillMergedCells = <span class="hljs-literal">true</span>
    };
    <span class="hljs-keyword">var</span> rows = MiniExcel.Query(path, configuration: config);
</code></pre>
<p><img src="https://user-images.githubusercontent.com/12729184/117973630-3527d500-b35f-11eb-95c3-bde255f8114e.png" alt="image"></p>
<p>поддерживает переменную длину и ширину многострочного и многоколонного заполнения</p>
<p><img src="https://user-images.githubusercontent.com/12729184/117973820-6d2f1800-b35f-11eb-88d8-555063938108.png" alt="image"></p>
<h4>12. Чтение больших файлов с использованием дискового кэша (Disk-Base Cache - SharedString)</h4>
<p>Если размер SharedStrings превышает 5 МБ, MiniExcel по умолчанию будет использовать локальный дисковый кэш, например, <a href="https://github.com/MiniExcel/MiniExcel/files/8403819/NotDuplicateSharedStrings_10x100000.xlsx">10x100000.xlsx</a> (один миллион строк данных). При отключённом дисковом кэше максимальное использование памяти — 195 МБ, а при включённом — только 65 МБ. Обратите внимание: эта оптимизация требует некоторого снижения производительности, поэтому время чтения увеличится с 7,4 секунд до 27,2 секунд. Если вам это не нужно, вы можете отключить дисковый кэш следующим образом:</p>
<pre><code class="language-csharp hljs"><span class="hljs-keyword">var</span> config = <span class="hljs-keyword">new</span> OpenXmlConfiguration { EnableSharedStringCache = <span class="hljs-literal">false</span> };
MiniExcel.Query(path,configuration: config)
</code></pre>
<p>Вы можете использовать <code>SharedStringCacheSize</code>, чтобы изменить размер sharedString файла, превышающий который будет использоваться дисковый кэш</p>
<pre><code class="language-csharp hljs"><span class="hljs-keyword">var</span> config = <span class="hljs-keyword">new</span> OpenXmlConfiguration { SharedStringCacheSize=<span class="hljs-number">500</span>*<span class="hljs-number">1024</span>*<span class="hljs-number">1024</span> };
MiniExcel.Query(path, configuration: config);
</code></pre>
<p><img src="https://user-images.githubusercontent.com/12729184/161411851-1c3f72a7-33b3-4944-84dc-ffc1d16747dd.png" alt="image"></p>
<p><img src="https://user-images.githubusercontent.com/12729184/161411825-17f53ec7-bef4-4b16-b234-e24799ea41b0.png" alt="image"></p>
<h3>Создание/Экспорт Excel  <a name="getstart2"></a></h3>
<ol>
<li><p>Тип должен быть не абстрактным и иметь публичный конструктор без параметров.</p>
</li>
<li><p>MiniExcel поддерживает параметр IEnumerable с отложенным выполнением. Если вы хотите использовать минимум памяти, пожалуйста, не вызывайте методы типа ToList</p>
</li>
</ol>
<p>например: ToList или нет — использование памяти<br><img src="https://user-images.githubusercontent.com/12729184/112587389-752b0b00-8e38-11eb-8a52-cfb76c57e5eb.png" alt="image"></p>
<h4>1. Анонимный или строготипизированный тип <a href="https://dotnetfiddle.net/w5WD1J">[Попробовать]</a></h4>
<pre><code class="language-csharp hljs"><span class="hljs-keyword">var</span> path = Path.Combine(Path.GetTempPath(), <span class="hljs-string">$"<span class="hljs-subst">{Guid.NewGuid()}</span>.xlsx"</span>);
MiniExcel.SaveAs(path, <span class="hljs-keyword">new</span>[] {
    <span class="hljs-keyword">new</span> { Column1 = <span class="hljs-string">"MiniExcel"</span>, Column2 = <span class="hljs-number">1</span> },
    <span class="hljs-keyword">new</span> { Column1 = <span class="hljs-string">"Github"</span>, Column2 = <span class="hljs-number">2</span>}
});
</code></pre>
<h4>2. <code>IEnumerable&lt;IDictionary&lt;string, object&gt;&gt;</code></h4>
<pre><code class="language-csharp hljs"><span class="hljs-keyword">var</span> values = <span class="hljs-keyword">new</span> List&lt;Dictionary&lt;<span class="hljs-built_in">string</span>, <span class="hljs-built_in">object</span>&gt;&gt;()
{
    <span class="hljs-keyword">new</span> Dictionary&lt;<span class="hljs-built_in">string</span>,<span class="hljs-built_in">object</span>&gt;{{ <span class="hljs-string">"Column1"</span>, <span class="hljs-string">"MiniExcel"</span> }, { <span class="hljs-string">"Column2"</span>, <span class="hljs-number">1</span> } },
    <span class="hljs-keyword">new</span> Dictionary&lt;<span class="hljs-built_in">string</span>,<span class="hljs-built_in">object</span>&gt;{{ <span class="hljs-string">"Column1"</span>, <span class="hljs-string">"Github"</span> }, { <span class="hljs-string">"Column2"</span>, <span class="hljs-number">2</span> } }
};
MiniExcel.SaveAs(path, values);
</code></pre>
<p>Результат создания файла:</p>
<table>
<thead>
<tr>
<th>Column1</th>
<th>Column2</th>
</tr>
</thead>
<tbody><tr>
<td>MiniExcel</td>
<td>1</td>
</tr>
<tr>
<td>Github</td>
<td>2</td>
</tr>
</tbody></table>
<h4>3.  IDataReader</h4>
<ul>
<li><code>Рекомендуется</code>, позволяет избежать загрузки всех данных в память</li>
</ul>
<pre><code class="language-csharp hljs">MiniExcel.SaveAs(path, reader);
</code></pre>
<p><img src="https://user-images.githubusercontent.com/12729184/121275378-149a5e80-c8bc-11eb-85fe-5453552134f0.png" alt="image"></p>
<p>Экспорт DataReader в несколько листов (рекомендуется через Dapper ExecuteReader)</p>
<pre><code class="language-csharp hljs"><span class="hljs-keyword">using</span> (<span class="hljs-keyword">var</span> cnn = Connection)
{
    cnn.Open();
    <span class="hljs-keyword">var</span> sheets = <span class="hljs-keyword">new</span> Dictionary&lt;<span class="hljs-built_in">string</span>,<span class="hljs-built_in">object</span>&gt;();
    sheets.Add(<span class="hljs-string">"sheet1"</span>, cnn.ExecuteReader(<span class="hljs-string">"select 1 id"</span>));
    sheets.Add(<span class="hljs-string">"sheet2"</span>, cnn.ExecuteReader(<span class="hljs-string">"select 2 id"</span>));
    MiniExcel.SaveAs(<span class="hljs-string">"Demo.xlsx"</span>, sheets);
}
</code></pre>
<h4>4. Datatable</h4>
<ul>
<li><p><code>Не рекомендуется</code>, так как все данные будут загружены в память</p>
</li>
<li><p>DataTable сначала использует Caption для имени столбца, затем ColumnName</p>
</li>
</ul>
<pre><code class="language-csharp hljs"><span class="hljs-keyword">var</span> path = Path.Combine(Path.GetTempPath(), <span class="hljs-string">$"<span class="hljs-subst">{Guid.NewGuid()}</span>.xlsx"</span>);
<span class="hljs-keyword">var</span> table = <span class="hljs-keyword">new</span> DataTable();
{
    table.Columns.Add(<span class="hljs-string">"Column1"</span>, <span class="hljs-keyword">typeof</span>(<span class="hljs-built_in">string</span>));
    table.Columns.Add(<span class="hljs-string">"Column2"</span>, <span class="hljs-keyword">typeof</span>(<span class="hljs-built_in">decimal</span>));
    table.Rows.Add(<span class="hljs-string">"MiniExcel"</span>, <span class="hljs-number">1</span>);
    table.Rows.Add(<span class="hljs-string">"Github"</span>, <span class="hljs-number">2</span>);
}

MiniExcel.SaveAs(path, table);
</code></pre>
<h4>5. Dapper Query</h4>
<p>Спасибо @shaofing #552 , пожалуйста, используйте <code>CommandDefinition + CommandFlags.NoCache</code></p>
<pre><code class="language-csharp hljs"><span class="hljs-keyword">using</span> (<span class="hljs-keyword">var</span> connection = GetConnection(connectionString))
{
    <span class="hljs-keyword">var</span> rows = connection.Query(
        <span class="hljs-keyword">new</span> CommandDefinition(
            <span class="hljs-string">@"select 'MiniExcel' as Column1,1 as Column2 union all select 'Github',2"</span>
            , flags: CommandFlags.NoCache)
        );
    <span class="hljs-comment">// Примечание: QueryAsync вызовет исключение закрытия соединения</span>
    MiniExcel.SaveAs(path, rows);
</code></pre>
<p>}</p>
<pre><code class="hljs language-csharp">
Следующий код загрузит все данные в память

```<span class="hljs-function">csharp
<span class="hljs-title">using</span> (<span class="hljs-params"><span class="hljs-keyword">var</span> connection = GetConnection(connectionString</span>))</span>
{
    <span class="hljs-keyword">var</span> rows = connection.Query(<span class="hljs-string">@"select 'MiniExcel' as Column1,1 as Column2 union all select 'Github',2"</span>);
    MiniExcel.SaveAs(path, rows);
}
</code></pre>
<h4>6. Сохранение в MemoryStream  <a href="https://dotnetfiddle.net/JOen0e">[Попробовать]</a></h4>
<pre><code class="language-csharp hljs"><span class="hljs-keyword">using</span> (<span class="hljs-keyword">var</span> stream = <span class="hljs-keyword">new</span> MemoryStream()) <span class="hljs-comment">// поддержка FileStream, MemoryStream и т.д.</span>
{
    stream.SaveAs(values);
}
</code></pre>
<p>например: api для экспорта excel</p>
<pre><code class="language-csharp hljs"><span class="hljs-function"><span class="hljs-keyword">public</span> IActionResult <span class="hljs-title">DownloadExcel</span>()</span>
{
    <span class="hljs-keyword">var</span> values = <span class="hljs-keyword">new</span>[] {
        <span class="hljs-keyword">new</span> { Column1 = <span class="hljs-string">"MiniExcel"</span>, Column2 = <span class="hljs-number">1</span> },
        <span class="hljs-keyword">new</span> { Column1 = <span class="hljs-string">"Github"</span>, Column2 = <span class="hljs-number">2</span>}
    };

    <span class="hljs-keyword">var</span> memoryStream = <span class="hljs-keyword">new</span> MemoryStream();
    memoryStream.SaveAs(values);
    memoryStream.Seek(<span class="hljs-number">0</span>, SeekOrigin.Begin);
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> FileStreamResult(memoryStream, <span class="hljs-string">"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"</span>)
    {
        FileDownloadName = <span class="hljs-string">"demo.xlsx"</span>
    };
}
</code></pre>
<h4>7. Создание нескольких листов</h4>
<pre><code class="language-csharp hljs"><span class="hljs-comment">// 1. Dictionary&lt;string,object&gt;</span>
<span class="hljs-keyword">var</span> users = <span class="hljs-keyword">new</span>[] { <span class="hljs-keyword">new</span> { Name = <span class="hljs-string">"Jack"</span>, Age = <span class="hljs-number">25</span> }, <span class="hljs-keyword">new</span> { Name = <span class="hljs-string">"Mike"</span>, Age = <span class="hljs-number">44</span> } };
<span class="hljs-keyword">var</span> department = <span class="hljs-keyword">new</span>[] { <span class="hljs-keyword">new</span> { ID = <span class="hljs-string">"01"</span>, Name = <span class="hljs-string">"HR"</span> }, <span class="hljs-keyword">new</span> { ID = <span class="hljs-string">"02"</span>, Name = <span class="hljs-string">"IT"</span> } };
<span class="hljs-keyword">var</span> sheets = <span class="hljs-keyword">new</span> Dictionary&lt;<span class="hljs-built_in">string</span>, <span class="hljs-built_in">object</span>&gt;
{
    [<span class="hljs-string">"users"</span>] = users,
    [<span class="hljs-string">"department"</span>] = department
};
MiniExcel.SaveAs(path, sheets);

<span class="hljs-comment">// 2. DataSet</span>
<span class="hljs-keyword">var</span> sheets = <span class="hljs-keyword">new</span> DataSet();
sheets.Add(UsersDataTable);
sheets.Add(DepartmentDataTable);
<span class="hljs-comment">//..</span>
MiniExcel.SaveAs(path, sheets);
</code></pre>
<p><img src="https://user-images.githubusercontent.com/12729184/118130875-6e7c4580-b430-11eb-9b82-22f02716bd63.png" alt="image"></p>
<h4>8. Опции TableStyles</h4>
<p>Стиль по умолчанию</p>
<p><img src="https://user-images.githubusercontent.com/12729184/138234373-cfa97109-b71f-4711-b7f5-0eaaa4a0a3a6.png" alt="image"></p>
<p>Без настройки стиля</p>
<pre><code class="language-csharp hljs"><span class="hljs-keyword">var</span> config = <span class="hljs-keyword">new</span> OpenXmlConfiguration()
{
     TableStyles = TableStyles.None
};
MiniExcel.SaveAs(path, <span class="hljs-keyword">value</span>, configuration:config);
</code></pre>
<p><img src="https://user-images.githubusercontent.com/12729184/118784917-f3e57700-b8c2-11eb-8718-8d955b1bc197.png" alt="image"></p>
<h4>9. Автофильтр</h4>
<p>Начиная с v0.19.0 <code>OpenXmlConfiguration.AutoFilter</code> может включать/отключать автофильтр, значение по умолчанию — <code>true</code>. Настройка автофильтра:</p>
<pre><code class="language-csharp hljs">MiniExcel.SaveAs(path, <span class="hljs-keyword">value</span>, configuration: <span class="hljs-keyword">new</span> OpenXmlConfiguration() { AutoFilter = <span class="hljs-literal">false</span> });
</code></pre>
<h4>10. Добавление изображения</h4>
<pre><code class="language-csharp hljs"><span class="hljs-keyword">var</span> <span class="hljs-keyword">value</span> = <span class="hljs-keyword">new</span>[] {
    <span class="hljs-keyword">new</span> { Name=<span class="hljs-string">"github"</span>,Image=File.ReadAllBytes(PathHelper.GetFile(<span class="hljs-string">"images/github_logo.png"</span>))},
    <span class="hljs-keyword">new</span> { Name=<span class="hljs-string">"google"</span>,Image=File.ReadAllBytes(PathHelper.GetFile(<span class="hljs-string">"images/google_logo.png"</span>))},
    <span class="hljs-keyword">new</span> { Name=<span class="hljs-string">"microsoft"</span>,Image=File.ReadAllBytes(PathHelper.GetFile(<span class="hljs-string">"images/microsoft_logo.png"</span>))},
    <span class="hljs-keyword">new</span> { Name=<span class="hljs-string">"reddit"</span>,Image=File.ReadAllBytes(PathHelper.GetFile(<span class="hljs-string">"images/reddit_logo.png"</span>))},
    <span class="hljs-keyword">new</span> { Name=<span class="hljs-string">"statck_overflow"</span>,Image=File.ReadAllBytes(PathHelper.GetFile(<span class="hljs-string">"images/statck_overflow_logo.png"</span>))},
};
MiniExcel.SaveAs(path, <span class="hljs-keyword">value</span>);
</code></pre>
<p><img src="https://user-images.githubusercontent.com/12729184/150462383-ad9931b3-ed8d-4221-a1d6-66f799743433.png" alt="image"></p>
<h4>11. Экспорт файла в виде массива байт</h4>
<p>Начиная с версии 1.22.0, если тип значения — <code>byte[]</code>, система по умолчанию сохраняет путь к файлу в ячейке, а при импорте система может преобразовать это в <code>byte[]</code>. Если вы не хотите использовать это поведение, установите <code>OpenXmlConfiguration.EnableConvertByteArray</code> в <code>false</code>, это повысит эффективность системы.</p>
<p><img src="https://user-images.githubusercontent.com/12729184/153702334-c3b834f4-6ae4-4ddf-bd4e-e5005d5d8c6a.png" alt="image"></p>
<p>Начиная с версии 1.22.0, если тип значения — <code>byte[]</code>, система по умолчанию сохраняет путь к файлу в ячейке, а при импорте система может преобразовать это в <code>byte[]</code>. Если вы не хотите использовать это поведение, установите <code>OpenXmlConfiguration.EnableConvertByteArray</code> в <code>false</code>, это повысит эффективность системы.</p>
<p><img src="https://user-images.githubusercontent.com/12729184/153702334-c3b834f4-6ae4-4ddf-bd4e-e5005d5d8c6a.png" alt="image"></p>
<h4>12. Вертикальное объединение одинаковых ячеек</h4>
<p>Эта функция поддерживается только в формате <code>xlsx</code> и объединяет ячейки по вертикали между тегами @merge и @endmerge.<br>Вы можете использовать @mergelimit для ограничения границ вертикального объединения ячеек.</p>
<pre><code class="language-csharp hljs"><span class="hljs-keyword">var</span> mergedFilePath = Path.Combine(Path.GetTempPath(), <span class="hljs-string">$"<span class="hljs-subst">{Guid.NewGuid().ToString()}</span>.xlsx"</span>);

<span class="hljs-keyword">var</span> path = <span class="hljs-string">@"../../../../../samples/xlsx/TestMergeWithTag.xlsx"</span>;

MiniExcel.MergeSameCells(mergedFilePath, path);
</code></pre>
<pre><code class="language-csharp hljs"><span class="hljs-keyword">var</span> memoryStream = <span class="hljs-keyword">new</span> MemoryStream();

<span class="hljs-keyword">var</span> path = <span class="hljs-string">@"../../../../../samples/xlsx/TestMergeWithTag.xlsx"</span>;

memoryStream.MergeSameCells(path);
</code></pre>
<p>Содержимое файла до и после объединения:</p>
<p>Без ограничения объединения:</p>
<img width="318" alt="Screenshot 2023-08-07 at 11 59 24" src="https://github.com/mini-software/MiniExcel/assets/38832863/49cc96b9-6c35-4bf3-8d43-a9752a15b22e">

<img width="318" alt="Screenshot 2023-08-07 at 11 59 57" src="https://github.com/mini-software/MiniExcel/assets/38832863/3fbd529b-3ae6-4bbe-b4d8-2793a5a58010">

<p>С ограничением объединения:</p>
<img width="346" alt="Screenshot 2023-08-08 at 18 21 00" src="https://github.com/mini-software/MiniExcel/assets/38832863/04049d28-84d5-4c2a-bcff-5847547df5e1">

<img width="346" alt="Screenshot 2023-08-08 at 18 21 40" src="https://github.com/mini-software/MiniExcel/assets/38832863/f5cf8957-b0b0-4831-b8fc-8556299235c2">

<h4>13. Пропуск значений null</h4>
<p>Новая явная опция для записи пустых ячеек для значений null:</p>
<pre><code class="language-csharp hljs">DataTable dt = <span class="hljs-keyword">new</span> DataTable();

<span class="hljs-comment">/* ... */</span>

DataRow dr = dt.NewRow();

dr[<span class="hljs-string">"Name1"</span>] = <span class="hljs-string">"Somebody once"</span>;
dr[<span class="hljs-string">"Name2"</span>] = <span class="hljs-literal">null</span>;
dr[<span class="hljs-string">"Name3"</span>] = <span class="hljs-string">"told me."</span>;

dt.Rows.Add(dr);

OpenXmlConfiguration configuration = <span class="hljs-keyword">new</span> OpenXmlConfiguration()
{
     EnableWriteNullValueCell = <span class="hljs-literal">true</span> <span class="hljs-comment">// Значение по умолчанию.</span>
};

MiniExcel.SaveAs(<span class="hljs-string">@"C:\temp\Book1.xlsx"</span>, dt, configuration: configuration);
</code></pre>
<p><img src="https://user-images.githubusercontent.com/31481586/241419455-3c0aec8a-4e5f-4d83-b7ec-6572124c165d.png" alt="image"></p>
<pre><code class="language-xml hljs"><span class="hljs-tag">&lt;<span class="hljs-name">x:row</span> <span class="hljs-attr">r</span>=<span class="hljs-string">"2"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">x:c</span> <span class="hljs-attr">r</span>=<span class="hljs-string">"A2"</span> <span class="hljs-attr">t</span> =<span class="hljs-string">"str"</span> <span class="hljs-attr">s</span>=<span class="hljs-string">"2"</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">x:v</span>&gt;</span>Somebody once<span class="hljs-tag">&lt;/<span class="hljs-name">x:v</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">x:c</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">x:c</span> <span class="hljs-attr">r</span>=<span class="hljs-string">"B2"</span> <span class="hljs-attr">s</span>=<span class="hljs-string">"2"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">x:c</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">x:c</span> <span class="hljs-attr">r</span>=<span class="hljs-string">"C2"</span> <span class="hljs-attr">t</span> =<span class="hljs-string">"str"</span> <span class="hljs-attr">s</span>=<span class="hljs-string">"2"</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">x:v</span>&gt;</span>told me.<span class="hljs-tag">&lt;/<span class="hljs-name">x:v</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">x:c</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">x:row</span>&gt;</span>
</code></pre>
<p>Предыдущее поведение:</p>
<pre><code class="language-csharp hljs"><span class="hljs-comment">/* ... */</span>

OpenXmlConfiguration configuration = <span class="hljs-keyword">new</span> OpenXmlConfiguration()
{
     EnableWriteNullValueCell = <span class="hljs-literal">false</span> <span class="hljs-comment">// Значение по умолчанию — true.</span>
};

MiniExcel.SaveAs(<span class="hljs-string">@"C:\temp\Book1.xlsx"</span>, dt, configuration: configuration);
</code></pre>
<p><img src="https://user-images.githubusercontent.com/31481586/241419441-c4f27e8f-3f87-46db-a10f-08665864c874.png" alt="image"></p>
<pre><code class="language-xml hljs"><span class="hljs-tag">&lt;<span class="hljs-name">x:row</span> <span class="hljs-attr">r</span>=<span class="hljs-string">"2"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">x:c</span> <span class="hljs-attr">r</span>=<span class="hljs-string">"A2"</span> <span class="hljs-attr">t</span> =<span class="hljs-string">"str"</span> <span class="hljs-attr">s</span>=<span class="hljs-string">"2"</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">x:v</span>&gt;</span>Somebody once<span class="hljs-tag">&lt;/<span class="hljs-name">x:v</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">x:c</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">x:c</span> <span class="hljs-attr">r</span>=<span class="hljs-string">"B2"</span> <span class="hljs-attr">t</span> =<span class="hljs-string">"str"</span> <span class="hljs-attr">s</span>=<span class="hljs-string">"2"</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">x:v</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">x:v</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">x:c</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">x:c</span> <span class="hljs-attr">r</span>=<span class="hljs-string">"C2"</span> <span class="hljs-attr">t</span> =<span class="hljs-string">"str"</span> <span class="hljs-attr">s</span>=<span class="hljs-string">"2"</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">x:v</span>&gt;</span>told me.<span class="hljs-tag">&lt;/<span class="hljs-name">x:v</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">x:c</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">x:row</span>&gt;</span>
</code></pre>
<p>Работает для значений null и DBNull.</p>
<h4>14. Заморозка областей (Freeze Panes)</h4>
<pre><code class="language-csharp hljs"><span class="hljs-comment">/* ... */</span>

OpenXmlConfiguration configuration = <span class="hljs-keyword">new</span> OpenXmlConfiguration()
{
    FreezeRowCount = <span class="hljs-number">1</span>,     <span class="hljs-comment">// по умолчанию 1</span>
    FreezeColumnCount = <span class="hljs-number">2</span>   <span class="hljs-comment">// по умолчанию 0</span>
};

MiniExcel.SaveAs(<span class="hljs-string">@"C:\temp\Book1.xlsx"</span>, dt, configuration: configuration);
</code></pre>
<p><img src="https://raw.githubusercontent.com/mini-software/MiniExcel/master/docs/images/freeze-pane-1.png" alt="image"></p>
<h3>Заполнение данных в шаблон Excel <a name="getstart3"></a></h3>
<ul>
<li>Объявление похоже на шаблон Vue <code>{{имя переменной}}</code> или отображение коллекции <code>{{имя_коллекции.имя_поля}}</code></li>
<li>Отображение коллекций поддерживает IEnumerable/DataTable/DapperRow</li>
</ul>
<h4>1. Базовое заполнение</h4>
<p>Шаблон:<br><img src="https://user-images.githubusercontent.com/12729184/114537556-ed8d2b00-9c84-11eb-8303-a69f62c41e5b.png" alt="image"></p>
<p>Результат:<br><img src="https://user-images.githubusercontent.com/12729184/114537490-d8180100-9c84-11eb-8c69-db58692f3a85.png" alt="image"></p>
<p>Код:</p>
<pre><code class="language-csharp hljs"><span class="hljs-comment">// 1. Через POCO</span>
<span class="hljs-keyword">var</span> <span class="hljs-keyword">value</span> = <span class="hljs-keyword">new</span>
{
    Name = <span class="hljs-string">"Jack"</span>,
    CreateDate = <span class="hljs-keyword">new</span> DateTime(<span class="hljs-number">2021</span>, <span class="hljs-number">01</span>, <span class="hljs-number">01</span>),
    VIP = <span class="hljs-literal">true</span>,
    Points = <span class="hljs-number">123</span>
};
MiniExcel.SaveAsByTemplate(path, templatePath, <span class="hljs-keyword">value</span>);


<span class="hljs-comment">// 2. Через Dictionary</span>
<span class="hljs-keyword">var</span> <span class="hljs-keyword">value</span> = <span class="hljs-keyword">new</span> Dictionary&lt;<span class="hljs-built_in">string</span>, <span class="hljs-built_in">object</span>&gt;()
{
    [<span class="hljs-string">"Name"</span>] = <span class="hljs-string">"Jack"</span>,
    [<span class="hljs-string">"CreateDate"</span>] = <span class="hljs-keyword">new</span> DateTime(<span class="hljs-number">2021</span>, <span class="hljs-number">01</span>, <span class="hljs-number">01</span>),
    [<span class="hljs-string">"VIP"</span>] = <span class="hljs-literal">true</span>,
    [<span class="hljs-string">"Points"</span>] = <span class="hljs-number">123</span>
};
MiniExcel.SaveAsByTemplate(path, templatePath, <span class="hljs-keyword">value</span>);
</code></pre>
<h4>2. Заполнение IEnumerable</h4>
<blockquote>
<p>Примечание 1: Используется первая IEnumerable с одинаковыми колонками как основа для заполнения списка</p>
</blockquote>
<p>Шаблон:<br><img src="https://user-images.githubusercontent.com/12729184/114564652-14f2f080-9ca3-11eb-831f-09e3fedbc5fc.png" alt="image"></p>
<p>Результат:<br><img src="https://user-images.githubusercontent.com/12729184/114564204-b2015980-9ca2-11eb-900d-e21249f93f7c.png" alt="image"></p>
<p>Код:</p>
<pre><code class="language-csharp hljs"><span class="hljs-comment">//1. Через POCO</span>
<span class="hljs-keyword">var</span> <span class="hljs-keyword">value</span> = <span class="hljs-keyword">new</span>
{
    employees = <span class="hljs-keyword">new</span>[] {
        <span class="hljs-keyword">new</span> {name=<span class="hljs-string">"Jack"</span>,department=<span class="hljs-string">"HR"</span>},
        <span class="hljs-keyword">new</span> {name=<span class="hljs-string">"Lisa"</span>,department=<span class="hljs-string">"HR"</span>},
        <span class="hljs-keyword">new</span> {name=<span class="hljs-string">"John"</span>,department=<span class="hljs-string">"HR"</span>},
        <span class="hljs-keyword">new</span> {name=<span class="hljs-string">"Mike"</span>,department=<span class="hljs-string">"IT"</span>},
        <span class="hljs-keyword">new</span> {name=<span class="hljs-string">"Neo"</span>,department=<span class="hljs-string">"IT"</span>},
        <span class="hljs-keyword">new</span> {name=<span class="hljs-string">"Loan"</span>,department=<span class="hljs-string">"IT"</span>}
    }
};
MiniExcel.SaveAsByTemplate(path, templatePath, <span class="hljs-keyword">value</span>);

<span class="hljs-comment">//2. Через Dictionary</span>
<span class="hljs-keyword">var</span> <span class="hljs-keyword">value</span> = <span class="hljs-keyword">new</span> Dictionary&lt;<span class="hljs-built_in">string</span>, <span class="hljs-built_in">object</span>&gt;()
{
    [<span class="hljs-string">"employees"</span>] = <span class="hljs-keyword">new</span>[] {
        <span class="hljs-keyword">new</span> {name=<span class="hljs-string">"Jack"</span>,department=<span class="hljs-string">"HR"</span>},
        <span class="hljs-keyword">new</span> {name=<span class="hljs-string">"Lisa"</span>,department=<span class="hljs-string">"HR"</span>},
        <span class="hljs-keyword">new</span> {name=<span class="hljs-string">"John"</span>,department=<span class="hljs-string">"HR"</span>},
        <span class="hljs-keyword">new</span> {name=<span class="hljs-string">"Mike"</span>,department=<span class="hljs-string">"IT"</span>},
        <span class="hljs-keyword">new</span> {name=<span class="hljs-string">"Neo"</span>,department=<span class="hljs-string">"IT"</span>},
        <span class="hljs-keyword">new</span> {name=<span class="hljs-string">"Loan"</span>,department=<span class="hljs-string">"IT"</span>}
    }
};
MiniExcel.SaveAsByTemplate(path, templatePath, <span class="hljs-keyword">value</span>);
</code></pre>
<h4>3. Сложное заполнение данных</h4>
<blockquote>
<p>Примечание: Поддерживается многолистовое заполнение и использование одной переменной</p>
</blockquote>
<p>Шаблон:</p>
<p><img src="https://user-images.githubusercontent.com/12729184/114565255-acf0da00-9ca3-11eb-8a7f-8131b2265ae8.png" alt="image"></p>
<p>Результат:</p>
<p><img src="https://user-images.githubusercontent.com/12729184/114565329-bf6b1380-9ca3-11eb-85e3-3969e8bf6378.png" alt="image"></p>
<pre><code class="language-csharp hljs"><span class="hljs-comment">// 1. Через POCO</span>
<span class="hljs-keyword">var</span> <span class="hljs-keyword">value</span> = <span class="hljs-keyword">new</span>
{
    title = <span class="hljs-string">"FooCompany"</span>,
    managers = <span class="hljs-keyword">new</span>[] {
        <span class="hljs-keyword">new</span> {name=<span class="hljs-string">"Jack"</span>,department=<span class="hljs-string">"HR"</span>},
        <span class="hljs-keyword">new</span> {name=<span class="hljs-string">"Loan"</span>,department=<span class="hljs-string">"IT"</span>}
    },
    employees = <span class="hljs-keyword">new</span>[] {
        <span class="hljs-keyword">new</span> {name=<span class="hljs-string">"Wade"</span>,department=<span class="hljs-string">"HR"</span>},
        <span class="hljs-keyword">new</span> {name=<span class="hljs-string">"Felix"</span>,department=<span class="hljs-string">"HR"</span>},
        <span class="hljs-keyword">new</span> {name=<span class="hljs-string">"Eric"</span>,department=<span class="hljs-string">"IT"</span>},
        <span class="hljs-keyword">new</span> {name=<span class="hljs-string">"Keaton"</span>,department=<span class="hljs-string">"IT"</span>}
    }
};
MiniExcel.SaveAsByTemplate(path, templatePath, <span class="hljs-keyword">value</span>);

<span class="hljs-comment">// 2. Через Dictionary</span>
<span class="hljs-keyword">var</span> <span class="hljs-keyword">value</span> = <span class="hljs-keyword">new</span> Dictionary&lt;<span class="hljs-built_in">string</span>, <span class="hljs-built_in">object</span>&gt;()
{
    [<span class="hljs-string">"title"</span>] = <span class="hljs-string">"FooCompany"</span>,
    [<span class="hljs-string">"managers"</span>] = <span class="hljs-keyword">new</span>[] {
        <span class="hljs-keyword">new</span> {name=<span class="hljs-string">"Jack"</span>,department=<span class="hljs-string">"HR"</span>},
        <span class="hljs-keyword">new</span> {name=<span class="hljs-string">"Loan"</span>,department=<span class="hljs-string">"IT"</span>}
    },
    [<span class="hljs-string">"employees"</span>] = <span class="hljs-keyword">new</span>[] {
        <span class="hljs-keyword">new</span> {name=<span class="hljs-string">"Wade"</span>,department=<span class="hljs-string">"HR"</span>},
        <span class="hljs-keyword">new</span> {name=<span class="hljs-string">"Felix"</span>,department=<span class="hljs-string">"HR"</span>},
        <span class="hljs-keyword">new</span> {name=<span class="hljs-string">"Eric"</span>,department=<span class="hljs-string">"IT"</span>},
        <span class="hljs-keyword">new</span> {name=<span class="hljs-string">"Keaton"</span>,department=<span class="hljs-string">"IT"</span>}
    }
};
MiniExcel.SaveAsByTemplate(path, templatePath, <span class="hljs-keyword">value</span>);
</code></pre>
<h4>4. Производительность заполнения больших данных</h4>
<blockquote>
<p>ПРИМЕЧАНИЕ: Использование IEnumerable с отложенным выполнением, а не ToList, позволяет максимально экономить память в MiniExcel</p>
</blockquote>
<p><img src="https://user-images.githubusercontent.com/12729184/114577091-5046ec80-9cae-11eb-924b-087c7becf8da.png" alt="image"></p>
<h4>5. Автоматическое сопоставление типа значения ячейки</h4>
<p>Шаблон</p>
<p><img src="https://user-images.githubusercontent.com/12729184/114802504-64830a80-9dd0-11eb-8d56-8e8c401b3ace.png" alt="image"></p>
<p>Результат</p>
<p><img src="https://user-images.githubusercontent.com/12729184/114802419-43221e80-9dd0-11eb-9ffe-a2ce34fe7076.png" alt="image"></p>
<p>Класс</p>
<pre><code class="language-csharp hljs"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title">Poco</span>
{
    <span class="hljs-keyword">public</span> <span class="hljs-built_in">string</span> @string { <span class="hljs-keyword">get</span>; <span class="hljs-keyword">set</span>; }
    <span class="hljs-keyword">public</span> <span class="hljs-built_in">int</span>? @int { <span class="hljs-keyword">get</span>; <span class="hljs-keyword">set</span>; }
</code></pre>
<pre><code class="language-csharp hljs"><span class="hljs-keyword">public</span> <span class="hljs-built_in">decimal</span>? @decimal { <span class="hljs-keyword">get</span>; <span class="hljs-keyword">set</span>; }
<span class="hljs-keyword">public</span> <span class="hljs-built_in">double</span>? @double { <span class="hljs-keyword">get</span>; <span class="hljs-keyword">set</span>; }
<span class="hljs-keyword">public</span> DateTime? datetime { <span class="hljs-keyword">get</span>; <span class="hljs-keyword">set</span>; }
<span class="hljs-keyword">public</span> <span class="hljs-built_in">bool</span>? @bool { <span class="hljs-keyword">get</span>; <span class="hljs-keyword">set</span>; }
<span class="hljs-keyword">public</span> Guid? Guid { <span class="hljs-keyword">get</span>; <span class="hljs-keyword">set</span>; }
}
</code></pre>
<p>Код</p>
<pre><code class="language-csharp hljs"><span class="hljs-keyword">var</span> poco = <span class="hljs-keyword">new</span> TestIEnumerableTypePoco { @string = <span class="hljs-string">"string"</span>, @int = <span class="hljs-number">123</span>, @decimal = <span class="hljs-built_in">decimal</span>.Parse(<span class="hljs-string">"123.45"</span>), @double = (<span class="hljs-built_in">double</span>)<span class="hljs-number">123.33</span>, @datetime = <span class="hljs-keyword">new</span> DateTime(<span class="hljs-number">2021</span>, <span class="hljs-number">4</span>, <span class="hljs-number">1</span>), @bool = <span class="hljs-literal">true</span>, @Guid = Guid.NewGuid() };
<span class="hljs-keyword">var</span> <span class="hljs-keyword">value</span> = <span class="hljs-keyword">new</span>
{
    Ts = <span class="hljs-keyword">new</span>[] {
        poco,
        <span class="hljs-keyword">new</span> TestIEnumerableTypePoco{},
        <span class="hljs-literal">null</span>,
        poco
    }
};
MiniExcel.SaveAsByTemplate(path, templatePath, <span class="hljs-keyword">value</span>);
</code></pre>
<h4>6. Пример: Список проектов Github</h4>
<p>Шаблон</p>
<p><img src="https://user-images.githubusercontent.com/12729184/115068623-12073280-9f25-11eb-9124-f4b3efcdb2a7.png" alt="image"></p>
<p>Результат</p>
<p><img src="https://user-images.githubusercontent.com/12729184/115068639-1a5f6d80-9f25-11eb-9f45-27c434d19a78.png" alt="image"></p>
<p>Код</p>
<pre><code class="language-csharp hljs"><span class="hljs-keyword">var</span> projects = <span class="hljs-keyword">new</span>[]
{
    <span class="hljs-keyword">new</span> {Name = <span class="hljs-string">"MiniExcel"</span>,Link=<span class="hljs-string">"https://github.com/mini-software/MiniExcel"</span>,Star=<span class="hljs-number">146</span>, CreateTime=<span class="hljs-keyword">new</span> DateTime(<span class="hljs-number">2021</span>,<span class="hljs-number">03</span>,<span class="hljs-number">01</span>)},
    <span class="hljs-keyword">new</span> {Name = <span class="hljs-string">"HtmlTableHelper"</span>,Link=<span class="hljs-string">"https://github.com/mini-software/HtmlTableHelper"</span>,Star=<span class="hljs-number">16</span>, CreateTime=<span class="hljs-keyword">new</span> DateTime(<span class="hljs-number">2020</span>,<span class="hljs-number">02</span>,<span class="hljs-number">01</span>)},
    <span class="hljs-keyword">new</span> {Name = <span class="hljs-string">"PocoClassGenerator"</span>,Link=<span class="hljs-string">"https://github.com/mini-software/PocoClassGenerator"</span>,Star=<span class="hljs-number">16</span>, CreateTime=<span class="hljs-keyword">new</span> DateTime(<span class="hljs-number">2019</span>,<span class="hljs-number">03</span>,<span class="hljs-number">17</span>)}
};
<span class="hljs-keyword">var</span> <span class="hljs-keyword">value</span> = <span class="hljs-keyword">new</span>
{
    User = <span class="hljs-string">"ITWeiHan"</span>,
    Projects = projects,
    TotalStar = projects.Sum(s =&gt; s.Star)
};
MiniExcel.SaveAsByTemplate(path, templatePath, <span class="hljs-keyword">value</span>);
</code></pre>
<h4>7. Заполнение сгруппированных данных</h4>
<pre><code class="language-csharp hljs"><span class="hljs-keyword">var</span> <span class="hljs-keyword">value</span> = <span class="hljs-keyword">new</span> Dictionary&lt;<span class="hljs-built_in">string</span>, <span class="hljs-built_in">object</span>&gt;()
{
    [<span class="hljs-string">"employees"</span>] = <span class="hljs-keyword">new</span>[] {
        <span class="hljs-keyword">new</span> {name=<span class="hljs-string">"Jack"</span>,department=<span class="hljs-string">"HR"</span>},
        <span class="hljs-keyword">new</span> {name=<span class="hljs-string">"Jack"</span>,department=<span class="hljs-string">"HR"</span>},
        <span class="hljs-keyword">new</span> {name=<span class="hljs-string">"John"</span>,department=<span class="hljs-string">"HR"</span>},
        <span class="hljs-keyword">new</span> {name=<span class="hljs-string">"John"</span>,department=<span class="hljs-string">"IT"</span>},
        <span class="hljs-keyword">new</span> {name=<span class="hljs-string">"Neo"</span>,department=<span class="hljs-string">"IT"</span>},
        <span class="hljs-keyword">new</span> {name=<span class="hljs-string">"Loan"</span>,department=<span class="hljs-string">"IT"</span>}
    }
};
<span class="hljs-keyword">await</span> MiniExcel.SaveAsByTemplateAsync(path, templatePath, <span class="hljs-keyword">value</span>);
</code></pre>
<h5>1. С тегом <code>@group</code> и с тегом <code>@header</code></h5>
<p>До</p>
<p><img src="https://user-images.githubusercontent.com/38832863/218646717-21b9d57a-2be2-4e9a-801b-ae212231d2b4.PNG" alt="before_with_header"></p>
<p>После</p>
<p><img src="https://user-images.githubusercontent.com/38832863/218646721-58a7a340-7004-4bc2-af24-cffcb2c20737.PNG" alt="after_with_header"></p>
<h5>2. С тегом @group и без тега @header</h5>
<p>До</p>
<p><img src="https://user-images.githubusercontent.com/38832863/218646873-b12417fa-801b-4890-8e96-669ed3b43902.PNG" alt="before_without_header"></p>
<p>После</p>
<p><img src="https://user-images.githubusercontent.com/38832863/218646872-622461ba-342e-49ee-834f-b91ad9c2dac3.PNG" alt="after_without_header"></p>
<h5>3. Без тега @group</h5>
<p>До</p>
<p><img src="https://user-images.githubusercontent.com/38832863/218646975-f52a68eb-e031-43b5-abaa-03b67c052d1a.PNG" alt="without_group"></p>
<p>После</p>
<p><img src="https://user-images.githubusercontent.com/38832863/218646974-4a3c0e07-7c66-4088-ad07-b4ad3695b7e1.PNG" alt="without_group_after"></p>
<h4>8. Оператор If/ElseIf/Else внутри ячейки</h4>
<p>Правила:</p>
<ol>
<li>Поддерживаются типы DateTime, Double, Int с операторами ==, !=, &gt;, &gt;=, &lt;, &lt;=.</li>
<li>Для строк поддерживаются операторы ==, !=.</li>
<li>Каждое выражение должно быть на новой строке.</li>
<li>Один пробел должен быть до и после оператора.</li>
<li>Не должно быть разрывов строк внутри выражения.</li>
<li>Ячейка должна быть в точности в следующем формате.</li>
</ol>
<pre><code class="language-csharp hljs">@if(name == Jack)
{{employees.name}}
@elseif(name == Neo)
Test {{employees.name}}
@else
{{employees.department}}
@endif
</code></pre>
<p>До</p>
<p><img src="https://user-images.githubusercontent.com/38832863/235360606-ca654769-ff55-4f5b-98d2-d2ec0edb8173.PNG" alt="if_before"></p>
<p>После</p>
<p><img src="https://user-images.githubusercontent.com/38832863/235360609-869bb960-d63d-45ae-8d64-9e8b0d0ab658.PNG" alt="if_after"></p>
<h4>9. DataTable в качестве параметра</h4>
<pre><code class="language-csharp hljs"><span class="hljs-keyword">var</span> managers = <span class="hljs-keyword">new</span> DataTable();
{
    managers.Columns.Add(<span class="hljs-string">"name"</span>);
    managers.Columns.Add(<span class="hljs-string">"department"</span>);
    managers.Rows.Add(<span class="hljs-string">"Jack"</span>, <span class="hljs-string">"HR"</span>);
    managers.Rows.Add(<span class="hljs-string">"Loan"</span>, <span class="hljs-string">"IT"</span>);
}
<span class="hljs-keyword">var</span> <span class="hljs-keyword">value</span> = <span class="hljs-keyword">new</span> Dictionary&lt;<span class="hljs-built_in">string</span>, <span class="hljs-built_in">object</span>&gt;()
{
    [<span class="hljs-string">"title"</span>] = <span class="hljs-string">"FooCompany"</span>,
    [<span class="hljs-string">"managers"</span>] = managers,
};
MiniExcel.SaveAsByTemplate(path, templatePath, <span class="hljs-keyword">value</span>);
</code></pre>
<h4>10. Формулы</h4>
<h5>1. Пример</h5>
<p>Добавьте префикс <code>$</code> к вашей формуле и используйте <code>$enumrowstart</code> и <code>$enumrowend</code> для обозначения ссылок на начальную и конечную строки перечисления:</p>
<p><img src="docs/images/template-formulas-1.png" alt="image"></p>
<p>Когда шаблон будет отрисован, префикс <code>$</code> будет удалён, а <code>$enumrowstart</code> и <code>$enumrowend</code> будут заменены на номера начальной и конечной строки перечисления:</p>
<p><img src="docs/images/template-formulas-2.png" alt="image"></p>
<h5>2. Другие примеры формул:</h5>
<table>
<thead>
<tr>
<th></th>
<th></th>
</tr>
</thead>
<tbody><tr>
<td>Сумма</td>
<td><code>$=SUM(C{{$enumrowstart}}:C{{$enumrowend}})</code></td>
</tr>
<tr>
<td>Альт. Среднее</td>
<td><code>$=SUM(C{{$enumrowstart}}:C{{$enumrowend}}) / COUNT(C{{$enumrowstart}}:C{{$enumrowend}})</code></td>
</tr>
<tr>
<td>Диапазон</td>
<td><code>$=MAX(C{{$enumrowstart}}:C{{$enumrowend}}) - MIN(C{{$enumrowstart}}:C{{$enumrowend}})</code></td>
</tr>
</tbody></table>
<h4>11. Другое</h4>
<h5>1. Проверка ключа параметра шаблона</h5>
<p>Начиная с V1.24.0, по умолчанию отсутствующий ключ параметра шаблона игнорируется и заменяется на пустую строку, параметр <code>IgnoreTemplateParameterMissing</code> позволяет управлять выбрасыванием исключения.</p>
<pre><code class="language-csharp hljs"><span class="hljs-keyword">var</span> config = <span class="hljs-keyword">new</span> OpenXmlConfiguration()
{
    IgnoreTemplateParameterMissing = <span class="hljs-literal">false</span>,
};
MiniExcel.SaveAsByTemplate(path, templatePath, <span class="hljs-keyword">value</span>, config)
</code></pre>
<p><img src="https://user-images.githubusercontent.com/12729184/157464332-e316f829-54aa-4c84-a5aa-9aef337b668d.png" alt="image"></p>
<h3>Атрибуты имени/индекса/игнорирования столбца Excel <a name="getstart4"></a></h3>
<h4>1. Задание имени столбца, индекса столбца, игнорирования столбца</h4>
<p>Пример Excel</p>
<p><img src="https://user-images.githubusercontent.com/12729184/114230869-3e163700-99ac-11eb-9a90-2039d4b4b313.png" alt="image"></p>
<p>Код</p>
<pre><code class="language-csharp hljs"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title">ExcelAttributeDemo</span>
{
    [<span class="hljs-meta">ExcelColumnName(<span class="hljs-string">"Column1"</span>)</span>]
</code></pre>
<pre><code class="language-csharp hljs"><span class="hljs-keyword">public</span> <span class="hljs-built_in">string</span> Test1 { <span class="hljs-keyword">get</span>; <span class="hljs-keyword">set</span>; }
[<span class="hljs-meta">ExcelColumnName(<span class="hljs-string">"Column2"</span>)</span>]
<span class="hljs-keyword">public</span> <span class="hljs-built_in">string</span> Test2 { <span class="hljs-keyword">get</span>; <span class="hljs-keyword">set</span>; }
[<span class="hljs-meta">ExcelIgnore</span>]
<span class="hljs-keyword">public</span> <span class="hljs-built_in">string</span> Test3 { <span class="hljs-keyword">get</span>; <span class="hljs-keyword">set</span>; }
[<span class="hljs-meta">ExcelColumnIndex(<span class="hljs-string">"I"</span>)</span>] <span class="hljs-comment">// система преобразует "I" в индекс 8</span>
<span class="hljs-keyword">public</span> <span class="hljs-built_in">string</span> Test4 { <span class="hljs-keyword">get</span>; <span class="hljs-keyword">set</span>; }
<span class="hljs-keyword">public</span> <span class="hljs-built_in">string</span> Test5 { <span class="hljs-keyword">get</span>; } <span class="hljs-comment">// если нет set, будет проигнорировано</span>
<span class="hljs-keyword">public</span> <span class="hljs-built_in">string</span> Test6 { <span class="hljs-keyword">get</span>; <span class="hljs-keyword">private</span> <span class="hljs-keyword">set</span>; } <span class="hljs-comment">// если set не публичен, будет проигнорировано</span>
[<span class="hljs-meta">ExcelColumnIndex(3)</span>] <span class="hljs-comment">// отсчет начинается с 0</span>
<span class="hljs-keyword">public</span> <span class="hljs-built_in">string</span> Test7 { <span class="hljs-keyword">get</span>; <span class="hljs-keyword">set</span>; }
}

<span class="hljs-keyword">var</span> rows = MiniExcel.Query&lt;ExcelAttributeDemo&gt;(path).ToList();
Assert.Equal(<span class="hljs-string">"Column1"</span>, rows[<span class="hljs-number">0</span>].Test1);
Assert.Equal(<span class="hljs-string">"Column2"</span>, rows[<span class="hljs-number">0</span>].Test2);
Assert.Null(rows[<span class="hljs-number">0</span>].Test3);
Assert.Equal(<span class="hljs-string">"Test7"</span>, rows[<span class="hljs-number">0</span>].Test4);
Assert.Null(rows[<span class="hljs-number">0</span>].Test5);
Assert.Null(rows[<span class="hljs-number">0</span>].Test6);
Assert.Equal(<span class="hljs-string">"Test4"</span>, rows[<span class="hljs-number">0</span>].Test7);
</code></pre>
<h4>2. Пользовательский формат (ExcelFormatAttribute)</h4>
<p>Начиная с версии V0.21.0 поддерживается класс, который содержит метод форматирования <code>ToString(string content)</code></p>
<p>Класс</p>
<pre><code class="language-csharp hljs"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title">Dto</span>
{
    <span class="hljs-keyword">public</span> <span class="hljs-built_in">string</span> Name { <span class="hljs-keyword">get</span>; <span class="hljs-keyword">set</span>; }

    [<span class="hljs-meta">ExcelFormat(<span class="hljs-string">"MMMM dd, yyyy"</span>)</span>]
    <span class="hljs-keyword">public</span> DateTime InDate { <span class="hljs-keyword">get</span>; <span class="hljs-keyword">set</span>; }
}
</code></pre>
<p>Код</p>
<pre><code class="language-csharp hljs"><span class="hljs-keyword">var</span> <span class="hljs-keyword">value</span> = <span class="hljs-keyword">new</span> Dto[] {
    <span class="hljs-keyword">new</span> Issue241Dto{ Name=<span class="hljs-string">"Jack"</span>,InDate=<span class="hljs-keyword">new</span> DateTime(<span class="hljs-number">2021</span>,<span class="hljs-number">01</span>,<span class="hljs-number">04</span>)},
    <span class="hljs-keyword">new</span> Issue241Dto{ Name=<span class="hljs-string">"Henry"</span>,InDate=<span class="hljs-keyword">new</span> DateTime(<span class="hljs-number">2020</span>,<span class="hljs-number">04</span>,<span class="hljs-number">05</span>)},
};
MiniExcel.SaveAs(path, <span class="hljs-keyword">value</span>);
</code></pre>
<p>Результат</p>
<p><img src="https://user-images.githubusercontent.com/12729184/118910788-ab2bcd80-b957-11eb-8d42-bfce36621b1b.png" alt="image"></p>
<p>Запрос поддерживает преобразование с пользовательским форматом</p>
<p><img src="https://user-images.githubusercontent.com/12729184/118911286-87b55280-b958-11eb-9a88-c8ff403d240a.png" alt="image"></p>
<h4>3. Установка ширины столбца (ExcelColumnWidthAttribute)</h4>
<pre><code class="language-csharp hljs"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title">Dto</span>
{
    [<span class="hljs-meta">ExcelColumnWidth(20)</span>]
    <span class="hljs-keyword">public</span> <span class="hljs-built_in">int</span> ID { <span class="hljs-keyword">get</span>; <span class="hljs-keyword">set</span>; }
    [<span class="hljs-meta">ExcelColumnWidth(15.50)</span>]
    <span class="hljs-keyword">public</span> <span class="hljs-built_in">string</span> Name { <span class="hljs-keyword">get</span>; <span class="hljs-keyword">set</span>; }
}
</code></pre>
<h4>4. Несколько имен столбцов, сопоставленных с одним свойством.</h4>
<pre><code class="language-csharp hljs"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title">Dto</span>
{
    [<span class="hljs-meta">ExcelColumnName(excelColumnName:<span class="hljs-string">"EmployeeNo"</span>,aliases:new[</span>] { <span class="hljs-string">"EmpNo"</span>,<span class="hljs-string">"No"</span> })]
    <span class="hljs-keyword">public</span> <span class="hljs-built_in">string</span> Empno { <span class="hljs-keyword">get</span>; <span class="hljs-keyword">set</span>; }
    <span class="hljs-keyword">public</span> <span class="hljs-built_in">string</span> Name { <span class="hljs-keyword">get</span>; <span class="hljs-keyword">set</span>; }
}
</code></pre>
<h4>5. System.ComponentModel.DisplayNameAttribute = ExcelColumnName.excelColumnNameAttribute</h4>
<p>Начиная с версии 1.24.0, система поддерживает System.ComponentModel.DisplayNameAttribute = ExcelColumnName.excelColumnNameAttribute</p>
<pre><code class="language-C# hljs language-C">public <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">TestIssueI4TXGTDto</span>
{</span>
    public <span class="hljs-type">int</span> ID { get; <span class="hljs-built_in">set</span>; }
    public <span class="hljs-built_in">string</span> Name { get; <span class="hljs-built_in">set</span>; }
    [DisplayName(<span class="hljs-string">"Specification"</span>)]
    public <span class="hljs-built_in">string</span> Spc { get; <span class="hljs-built_in">set</span>; }
    [DisplayName(<span class="hljs-string">"Unit Price"</span>)]
    public decimal Up { get; <span class="hljs-built_in">set</span>; }
}
</code></pre>
<h4>6. ExcelColumnAttribute</h4>
<p>Начиная с версии V1.26.0, несколько атрибутов можно упростить следующим образом:</p>
<pre><code class="language-csharp hljs">        <span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title">TestIssueI4ZYUUDto</span>
        {
            [<span class="hljs-meta">ExcelColumn(Name = <span class="hljs-string">"ID"</span>,Index =0)</span>]
            <span class="hljs-keyword">public</span> <span class="hljs-built_in">string</span> MyProperty { <span class="hljs-keyword">get</span>; <span class="hljs-keyword">set</span>; }
            [<span class="hljs-meta">ExcelColumn(Name = <span class="hljs-string">"CreateDate"</span>, Index = 1,Format =<span class="hljs-string">"yyyy-MM"</span>,Width =100)</span>]
            <span class="hljs-keyword">public</span> DateTime MyProperty2 { <span class="hljs-keyword">get</span>; <span class="hljs-keyword">set</span>; }
        }
</code></pre>
<h4>7. DynamicColumnAttribute</h4>
<p>Начиная с версии V1.26.0, мы можем динамически задавать атрибуты столбцов</p>
<pre><code class="language-csharp hljs">            <span class="hljs-keyword">var</span> config = <span class="hljs-keyword">new</span> OpenXmlConfiguration
            {
                DynamicColumns = <span class="hljs-keyword">new</span> DynamicExcelColumn[] {
                    <span class="hljs-keyword">new</span> DynamicExcelColumn(<span class="hljs-string">"id"</span>){Ignore=<span class="hljs-literal">true</span>},
                    <span class="hljs-keyword">new</span> DynamicExcelColumn(<span class="hljs-string">"name"</span>){Index=<span class="hljs-number">1</span>,Width=<span class="hljs-number">10</span>},
                    <span class="hljs-keyword">new</span> DynamicExcelColumn(<span class="hljs-string">"createdate"</span>){Index=<span class="hljs-number">0</span>,Format=<span class="hljs-string">"yyyy-MM-dd"</span>,Width=<span class="hljs-number">15</span>},
                    <span class="hljs-keyword">new</span> DynamicExcelColumn(<span class="hljs-string">"point"</span>){Index=<span class="hljs-number">2</span>,Name=<span class="hljs-string">"Account Point"</span>},
                }
            };
            <span class="hljs-keyword">var</span> path = PathHelper.GetTempPath();
            <span class="hljs-keyword">var</span> <span class="hljs-keyword">value</span> = <span class="hljs-keyword">new</span>[] { <span class="hljs-keyword">new</span> { id = <span class="hljs-number">1</span>, name = <span class="hljs-string">"Jack"</span>, createdate = <span class="hljs-keyword">new</span> DateTime(<span class="hljs-number">2022</span>, <span class="hljs-number">04</span>, <span class="hljs-number">12</span>) ,point = <span class="hljs-number">123.456</span>} };
            MiniExcel.SaveAs(path, <span class="hljs-keyword">value</span>, configuration: config);
</code></pre>
<p><img src="https://user-images.githubusercontent.com/12729184/164510353-5aecbc4e-c3ce-41e8-b6cf-afd55eb23b68.png" alt="image"></p>
<h4>8. DynamicSheetAttribute</h4>
<p>Начиная с версии V1.31.4 можно динамически задавать атрибуты листа. Можно задавать имя и состояние (видимость) листа.</p>
<pre><code class="language-csharp hljs">            <span class="hljs-keyword">var</span> configuration = <span class="hljs-keyword">new</span> OpenXmlConfiguration
            {
                DynamicSheets = <span class="hljs-keyword">new</span> DynamicExcelSheet[] {
                    <span class="hljs-keyword">new</span> DynamicExcelSheet(<span class="hljs-string">"usersSheet"</span>) { Name = <span class="hljs-string">"Users"</span>, State = SheetState.Visible },
                    <span class="hljs-keyword">new</span> DynamicExcelSheet(<span class="hljs-string">"departmentSheet"</span>) { Name = <span class="hljs-string">"Departments"</span>, State = SheetState.Hidden }
                }
            };

            <span class="hljs-keyword">var</span> users = <span class="hljs-keyword">new</span>[] { <span class="hljs-keyword">new</span> { Name = <span class="hljs-string">"Jack"</span>, Age = <span class="hljs-number">25</span> }, <span class="hljs-keyword">new</span> { Name = <span class="hljs-string">"Mike"</span>, Age = <span class="hljs-number">44</span> } };
            <span class="hljs-keyword">var</span> department = <span class="hljs-keyword">new</span>[] { <span class="hljs-keyword">new</span> { ID = <span class="hljs-string">"01"</span>, Name = <span class="hljs-string">"HR"</span> }, <span class="hljs-keyword">new</span> { ID = <span class="hljs-string">"02"</span>, Name = <span class="hljs-string">"IT"</span> } };
            <span class="hljs-keyword">var</span> sheets = <span class="hljs-keyword">new</span> Dictionary&lt;<span class="hljs-built_in">string</span>, <span class="hljs-built_in">object</span>&gt;
            {
                [<span class="hljs-string">"usersSheet"</span>] = users,
                [<span class="hljs-string">"departmentSheet"</span>] = department
            };

            <span class="hljs-keyword">var</span> path = PathHelper.GetTempPath();
            MiniExcel.SaveAs(path, sheets, configuration: configuration);
</code></pre>
<p>Также можно использовать новый атрибут ExcelSheetAttribute:</p>
<pre><code class="language-C# hljs language-C">   [ExcelSheet(Name = <span class="hljs-string">"Departments"</span>, State = SheetState.Hidden)]
   private <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">DepartmentDto</span>
   {</span>
      [ExcelColumn(Name = <span class="hljs-string">"ID"</span>,Index = <span class="hljs-number">0</span>)]
      public <span class="hljs-built_in">string</span> ID { get; <span class="hljs-built_in">set</span>; }
      [ExcelColumn(Name = <span class="hljs-string">"Name"</span>,Index = <span class="hljs-number">1</span>)]
      public <span class="hljs-built_in">string</span> Name { get; <span class="hljs-built_in">set</span>; }
   }
</code></pre>
<h3>Добавление, удаление, обновление</h3>
<h4>Добавление</h4>
<p>В версии v1.28.0 поддерживается добавление N строк в CSV после последней строки</p>
<pre><code class="language-csharp hljs"><span class="hljs-comment">// Оригинал</span>
{
    <span class="hljs-keyword">var</span> <span class="hljs-keyword">value</span> = <span class="hljs-keyword">new</span>[] {
          <span class="hljs-keyword">new</span> { ID=<span class="hljs-number">1</span>,Name =<span class="hljs-string">"Jack"</span>,InDate=<span class="hljs-keyword">new</span> DateTime(<span class="hljs-number">2021</span>,<span class="hljs-number">01</span>,<span class="hljs-number">03</span>)},
          <span class="hljs-keyword">new</span> { ID=<span class="hljs-number">2</span>,Name =<span class="hljs-string">"Henry"</span>,InDate=<span class="hljs-keyword">new</span> DateTime(<span class="hljs-number">2020</span>,<span class="hljs-number">05</span>,<span class="hljs-number">03</span>)},
    };
    MiniExcel.SaveAs(path, <span class="hljs-keyword">value</span>);
}
<span class="hljs-comment">// Вставить 1 строку после последней</span>
{
    <span class="hljs-keyword">var</span> <span class="hljs-keyword">value</span> = <span class="hljs-keyword">new</span> { ID=<span class="hljs-number">3</span>,Name = <span class="hljs-string">"Mike"</span>, InDate = <span class="hljs-keyword">new</span> DateTime(<span class="hljs-number">2021</span>, <span class="hljs-number">04</span>, <span class="hljs-number">23</span>) };
    MiniExcel.Insert(path, <span class="hljs-keyword">value</span>);
}
<span class="hljs-comment">// Вставить N строк после последней</span>
{
    <span class="hljs-keyword">var</span> <span class="hljs-keyword">value</span> = <span class="hljs-keyword">new</span>[] {
          <span class="hljs-keyword">new</span> { ID=<span class="hljs-number">4</span>,Name =<span class="hljs-string">"Frank"</span>,InDate=<span class="hljs-keyword">new</span> DateTime(<span class="hljs-number">2021</span>,<span class="hljs-number">06</span>,<span class="hljs-number">07</span>)},
          <span class="hljs-keyword">new</span> { ID=<span class="hljs-number">5</span>,Name =<span class="hljs-string">"Gloria"</span>,InDate=<span class="hljs-keyword">new</span> DateTime(<span class="hljs-number">2022</span>,<span class="hljs-number">05</span>,<span class="hljs-number">03</span>)},
```csharp
};
MiniExcel.Insert(path, <span class="hljs-keyword">value</span>);
}
</code></pre>
<p><img src="https://user-images.githubusercontent.com/12729184/191023733-1e2fa732-db5c-4a3a-9722-b891fe5aa069.png" alt="image"></p>
<p>v1.37.0 поддерживает вставку нового листа в существующую рабочую книгу Excel</p>
<pre><code class="language-csharp hljs"><span class="hljs-comment">// Исходный excel</span>
{
    <span class="hljs-keyword">var</span> <span class="hljs-keyword">value</span> = <span class="hljs-keyword">new</span>[] {
          <span class="hljs-keyword">new</span> { ID=<span class="hljs-number">1</span>,Name =<span class="hljs-string">"Jack"</span>,InDate=<span class="hljs-keyword">new</span> DateTime(<span class="hljs-number">2021</span>,<span class="hljs-number">01</span>,<span class="hljs-number">03</span>)},
          <span class="hljs-keyword">new</span> { ID=<span class="hljs-number">2</span>,Name =<span class="hljs-string">"Henry"</span>,InDate=<span class="hljs-keyword">new</span> DateTime(<span class="hljs-number">2020</span>,<span class="hljs-number">05</span>,<span class="hljs-number">03</span>)},
    };
    MiniExcel.SaveAs(path, <span class="hljs-keyword">value</span>, sheetName: <span class="hljs-string">"Sheet1"</span>);
}
<span class="hljs-comment">// Вставка нового листа</span>
{
    <span class="hljs-keyword">var</span> <span class="hljs-keyword">value</span> = <span class="hljs-keyword">new</span> { ID=<span class="hljs-number">3</span>,Name = <span class="hljs-string">"Mike"</span>, InDate = <span class="hljs-keyword">new</span> DateTime(<span class="hljs-number">2021</span>, <span class="hljs-number">04</span>, <span class="hljs-number">23</span>) };
    MiniExcel.Insert(path, table, sheetName: <span class="hljs-string">"Sheet2"</span>);
}
</code></pre>
<h4>Удаление (ожидается)</h4>
<h4>Обновление (ожидается)</h4>
<h3>Автоматическое определение типа Excel <a name="getstart5"></a></h3>
<ul>
<li>MiniExcel по умолчанию определяет, является ли файл xlsx или csv, на основе <code>расширения файла</code>, но это может быть неточно, пожалуйста, указывайте тип вручную.</li>
<li>Для потока невозможно определить тип excel, пожалуйста, указывайте его вручную.</li>
</ul>
<pre><code class="language-csharp hljs">stream.SaveAs(excelType:ExcelType.CSV);
<span class="hljs-comment">//или</span>
stream.SaveAs(excelType:ExcelType.XLSX);
<span class="hljs-comment">//или</span>
stream.Query(excelType:ExcelType.CSV);
<span class="hljs-comment">//или</span>
stream.Query(excelType:ExcelType.XLSX);
</code></pre>
<h3>CSV</h3>
<h4>Примечание</h4>
<ul>
<li>По умолчанию возвращается тип <code>string</code>, и значение не будет преобразовано в числа или дату/время, если только тип не определён явно через generic с строгой типизацией.</li>
</ul>
<h4>Пользовательский разделитель</h4>
<p>По умолчанию используется <code>,</code> как разделитель, вы можете изменить свойство <code>Seperator</code> для настройки</p>
<pre><code class="language-csharp hljs"><span class="hljs-keyword">var</span> config = <span class="hljs-keyword">new</span> MiniExcelLibs.Csv.CsvConfiguration()
{
    Seperator=<span class="hljs-string">';'</span>
};
MiniExcel.SaveAs(path, values,configuration: config);
</code></pre>
<p>С версии V1.30.1 поддерживается функция пользовательского разделителя (спасибо @hyzx86)</p>
<pre><code class="language-csharp hljs"><span class="hljs-keyword">var</span> config = <span class="hljs-keyword">new</span> CsvConfiguration()
{
    SplitFn = (row) =&gt; Regex.Split(row, <span class="hljs-string">$"[\t,](?=(?:[^\"]|\"[^\"]*\")*$)"</span>)
        .Select(s =&gt; Regex.Replace(s.Replace(<span class="hljs-string">"\"\""</span>, <span class="hljs-string">"\""</span>), <span class="hljs-string">"^\"|\"$"</span>, <span class="hljs-string">""</span>)).ToArray()
};
<span class="hljs-keyword">var</span> rows = MiniExcel.Query(path, configuration: config).ToList();
</code></pre>
<h4>Пользовательский перенос строки</h4>
<p>По умолчанию используется <code>\r\n</code> как символ новой строки, вы можете изменить свойство <code>NewLine</code> для кастомизации</p>
<pre><code class="language-csharp hljs"><span class="hljs-keyword">var</span> config = <span class="hljs-keyword">new</span> MiniExcelLibs.Csv.CsvConfiguration()
{
    NewLine=<span class="hljs-string">'\n'</span>
};
MiniExcel.SaveAs(path, values,configuration: config);
</code></pre>
<h4>Пользовательская кодировка</h4>
<ul>
<li>По умолчанию используется "Detect Encoding From Byte Order Marks"  (detectEncodingFromByteOrderMarks: true)</li>
<li>Если у вас есть требования к другой кодировке, пожалуйста, измените свойство StreamReaderFunc / StreamWriterFunc</li>
</ul>
<pre><code class="language-csharp hljs"><span class="hljs-comment">// Чтение</span>
<span class="hljs-keyword">var</span> config = <span class="hljs-keyword">new</span> MiniExcelLibs.Csv.CsvConfiguration()
{
    StreamReaderFunc = (stream) =&gt; <span class="hljs-keyword">new</span> StreamReader(stream,Encoding.GetEncoding(<span class="hljs-string">"gb2312"</span>))
};
<span class="hljs-keyword">var</span> rows = MiniExcel.Query(path, <span class="hljs-literal">true</span>,excelType:ExcelType.CSV,configuration: config);

<span class="hljs-comment">// Запись</span>
<span class="hljs-keyword">var</span> config = <span class="hljs-keyword">new</span> MiniExcelLibs.Csv.CsvConfiguration()
{
    StreamWriterFunc = (stream) =&gt; <span class="hljs-keyword">new</span> StreamWriter(stream, Encoding.GetEncoding(<span class="hljs-string">"gb2312"</span>))
};
MiniExcel.SaveAs(path, <span class="hljs-keyword">value</span>,excelType:ExcelType.CSV, configuration: config);
</code></pre>
<h4>Чтение пустой строки как null</h4>
<p>По умолчанию пустые значения сопоставляются с string.Empty. Вы можете изменить это поведение</p>
<pre><code class="language-csharp hljs"><span class="hljs-keyword">var</span> config = <span class="hljs-keyword">new</span> MiniExcelLibs.Csv.CsvConfiguration()
{
   ReadEmptyStringAsNull = <span class="hljs-literal">true</span>
};
</code></pre>
<h3>DataReader</h3>
<h4>1. GetReader</h4>
<p>Начиная с версии 1.23.0, вы можете использовать GetDataReader</p>
<pre><code class="language-csharp hljs">    <span class="hljs-keyword">using</span> (<span class="hljs-keyword">var</span> reader = MiniExcel.GetReader(path,<span class="hljs-literal">true</span>))
    {
        <span class="hljs-keyword">while</span> (reader.Read())
        {
            <span class="hljs-keyword">for</span> (<span class="hljs-built_in">int</span> i = <span class="hljs-number">0</span>; i &lt; reader.FieldCount; i++)
            {
                <span class="hljs-keyword">var</span> <span class="hljs-keyword">value</span> = reader.GetValue(i);
            }
        }
    }
</code></pre>
<h3>Async</h3>
<ul>
<li>С версии v0.17.0 поддерживается Async (спасибо isdaniel ( SHIH,BING-SIOU)](<a href="https://github.com/isdaniel">https://github.com/isdaniel</a>))</li>
</ul>
<pre><code class="language-csharp hljs"><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> Task <span class="hljs-title">SaveAsAsync</span>(<span class="hljs-params"><span class="hljs-built_in">string</span> path, <span class="hljs-built_in">object</span> <span class="hljs-keyword">value</span>, <span class="hljs-built_in">bool</span> printHeader = <span class="hljs-literal">true</span>, <span class="hljs-built_in">string</span> sheetName = <span class="hljs-string">"Sheet1"</span>, ExcelType excelType = ExcelType.UNKNOWN, IConfiguration configuration = <span class="hljs-literal">null</span></span>)
<span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> Task <span class="hljs-title">SaveAsAsync</span>(<span class="hljs-params"><span class="hljs-keyword">this</span> Stream stream, <span class="hljs-built_in">object</span> <span class="hljs-keyword">value</span>, <span class="hljs-built_in">bool</span> printHeader = <span class="hljs-literal">true</span>, <span class="hljs-built_in">string</span> sheetName = <span class="hljs-string">"Sheet1"</span>, ExcelType excelType = ExcelType.XLSX, IConfiguration configuration = <span class="hljs-literal">null</span></span>)
<span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> Task&lt;IEnumerable&lt;<span class="hljs-built_in">dynamic</span>&gt;&gt; <span class="hljs-title">QueryAsync</span>(<span class="hljs-params"><span class="hljs-built_in">string</span> path, <span class="hljs-built_in">bool</span> useHeaderRow = <span class="hljs-literal">false</span>, <span class="hljs-built_in">string</span> sheetName = <span class="hljs-literal">null</span>, ExcelType excelType = ExcelType.UNKNOWN, <span class="hljs-built_in">string</span> startCell = <span class="hljs-string">"A1"</span>, IConfiguration configuration = <span class="hljs-literal">null</span></span>)
<span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-title">Task</span>&lt;<span class="hljs-title">IEnumerable</span>&lt;<span class="hljs-title">T</span>&gt;&gt; <span class="hljs-title">QueryAsync</span>&lt;<span class="hljs-title">T</span>&gt;(<span class="hljs-params"><span class="hljs-keyword">this</span> Stream stream, <span class="hljs-built_in">string</span> sheetName = <span class="hljs-literal">null</span>, ExcelType excelType = ExcelType.UNKNOWN, <span class="hljs-built_in">string</span> startCell = <span class="hljs-string">"A1"</span>, IConfiguration configuration = <span class="hljs-literal">null</span></span>) <span class="hljs-keyword">where</span> T : <span class="hljs-keyword">class</span>, <span class="hljs-keyword">new</span>()
<span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-title">Task</span>&lt;<span class="hljs-title">IEnumerable</span>&lt;<span class="hljs-title">T</span>&gt;&gt; <span class="hljs-title">QueryAsync</span>&lt;<span class="hljs-title">T</span>&gt;(<span class="hljs-params"><span class="hljs-built_in">string</span> path, <span class="hljs-built_in">string</span> sheetName = <span class="hljs-literal">null</span>, ExcelType excelType = ExcelType.UNKNOWN, <span class="hljs-built_in">string</span> startCell = <span class="hljs-string">"A1"</span>, IConfiguration configuration = <span class="hljs-literal">null</span></span>) <span class="hljs-keyword">where</span> T : <span class="hljs-keyword">class</span>, <span class="hljs-keyword">new</span>()
<span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> Task&lt;IEnumerable&lt;IDictionary&lt;<span class="hljs-built_in">string</span>, <span class="hljs-built_in">object</span>&gt;&gt;&gt; <span class="hljs-title">QueryAsync</span>(<span class="hljs-params"><span class="hljs-keyword">this</span> Stream stream, <span class="hljs-built_in">bool</span> useHeaderRow = <span class="hljs-literal">false</span>, <span class="hljs-built_in">string</span> sheetName = <span class="hljs-literal">null</span>, ExcelType excelType = ExcelType.UNKNOWN, <span class="hljs-built_in">string</span> startCell = <span class="hljs-string">"A1"</span>, IConfiguration configuration = <span class="hljs-literal">null</span></span>)
<span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> Task <span class="hljs-title">SaveAsByTemplateAsync</span>(<span class="hljs-params"><span class="hljs-keyword">this</span> Stream stream, <span class="hljs-built_in">string</span> templatePath, <span class="hljs-built_in">object</span> <span class="hljs-keyword">value</span></span>)
<span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> Task <span class="hljs-title">SaveAsByTemplateAsync</span>(<span class="hljs-params"><span class="hljs-keyword">this</span> Stream stream, <span class="hljs-built_in">byte</span>[] templateBytes, <span class="hljs-built_in">object</span> <span class="hljs-keyword">value</span></span>)
<span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> Task <span class="hljs-title">SaveAsByTemplateAsync</span>(<span class="hljs-params"><span class="hljs-built_in">string</span> path, <span class="hljs-built_in">string</span> templatePath, <span class="hljs-built_in">object</span> <span class="hljs-keyword">value</span></span>)
<span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> Task <span class="hljs-title">SaveAsByTemplateAsync</span>(<span class="hljs-params"><span class="hljs-built_in">string</span> path, <span class="hljs-built_in">byte</span>[] templateBytes, <span class="hljs-built_in">object</span> <span class="hljs-keyword">value</span></span>)
<span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> Task&lt;DataTable&gt; <span class="hljs-title">QueryAsDataTableAsync</span>(<span class="hljs-params"><span class="hljs-built_in">string</span> path, <span class="hljs-built_in">bool</span> useHeaderRow = <span class="hljs-literal">true</span>, <span class="hljs-built_in">string</span> sheetName = <span class="hljs-literal">null</span>, ExcelType excelType = ExcelType.UNKNOWN, <span class="hljs-built_in">string</span> startCell = <span class="hljs-string">"A1"</span>, IConfiguration configuration = <span class="hljs-literal">null</span></span>)
</span></code></pre>
<ul>
<li>С версии v1.25.0 поддерживается <code>cancellationToken</code>。</li>
</ul>
<h3>Другое</h3>
<h4>1. Enum</h4>
<p>Убедитесь, что имена в excel и свойстве совпадают, система автоматически сопоставит их (без учёта регистра)</p>
<p><img src="https://user-images.githubusercontent.com/12729184/116210595-9784b100-a775-11eb-936f-8e7a8b435961.png" alt="image"></p>
<p>С версии V0.18.0 поддерживаются Enum Description</p>
<pre><code class="language-csharp hljs"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title">Dto</span>
{
    <span class="hljs-keyword">public</span> <span class="hljs-built_in">string</span> Name { <span class="hljs-keyword">get</span>; <span class="hljs-keyword">set</span>; }
    <span class="hljs-keyword">public</span> I49RYZUserType UserType { <span class="hljs-keyword">get</span>; <span class="hljs-keyword">set</span>; }
}

<span class="hljs-keyword">public</span> <span class="hljs-built_in">enum</span> Type
{
    [<span class="hljs-meta">Description(<span class="hljs-string">"General User"</span>)</span>]
    V1,
    [<span class="hljs-meta">Description(<span class="hljs-string">"General Administrator"</span>)</span>]
    V2,
    [<span class="hljs-meta">Description(<span class="hljs-string">"Super Administrator"</span>)</span>]
    V3
}
</code></pre>
<pre><code class="hljs language-less">
!<span class="hljs-selector-attr">[image]</span>(<span class="hljs-attribute">https</span>:<span class="hljs-comment">//user-images.githubusercontent.com/12729184/133116630-27cc7161-099a-48b8-9784-cd1e443af3d1.png)</span>

Начиная с версии <span class="hljs-number">1.30</span>.<span class="hljs-number">0</span> поддерживается сопоставление excel Description с Enum, спасибо <span class="hljs-variable">@KaneLeung</span>

#### <span class="hljs-number">2</span>. Конвертация CSV в XLSX или XLSX в CSV

<span class="hljs-built_in">``</span>`csharp
MiniExcel.<span class="hljs-built_in">ConvertXlsxToCsv</span>(xlsxPath, csvPath);
MiniExcel.<span class="hljs-built_in">ConvertXlsxToCsv</span>(xlsxStream, csvStream);
MiniExcel.<span class="hljs-built_in">ConvertCsvToXlsx</span>(csvPath, xlsxPath);
MiniExcel.<span class="hljs-built_in">ConvertCsvToXlsx</span>(csvStream, xlsxStream);
</code></pre>
<pre><code class="language-csharp hljs"><span class="hljs-keyword">using</span> (<span class="hljs-keyword">var</span> excelStream = <span class="hljs-keyword">new</span> FileStream(path: filePath, FileMode.Open, FileAccess.Read))
<span class="hljs-keyword">using</span> (<span class="hljs-keyword">var</span> csvStream = <span class="hljs-keyword">new</span> MemoryStream())
{
   MiniExcel.ConvertXlsxToCsv(excelStream, csvStream);
}
</code></pre>
<h4>3. Кастомизация CultureInfo</h4>
<p>Начиная с версии 1.22.0, вы можете задать свою CultureInfo, как показано ниже, системная по умолчанию — <code>CultureInfo.InvariantCulture</code>.</p>
<pre><code class="language-csharp hljs"><span class="hljs-keyword">var</span> config = <span class="hljs-keyword">new</span> CsvConfiguration()
{
    Culture = <span class="hljs-keyword">new</span> CultureInfo(<span class="hljs-string">"fr-FR"</span>),
};
MiniExcel.SaveAs(path, <span class="hljs-keyword">value</span>, configuration: config);

<span class="hljs-comment">// или</span>
MiniExcel.Query(path, configuration: config);
</code></pre>
<h4>4. Кастомизация размера буфера</h4>
<pre><code class="language-csharp hljs">    <span class="hljs-keyword">public</span> <span class="hljs-keyword">abstract</span> <span class="hljs-keyword">class</span> <span class="hljs-title">Configuration</span> : <span class="hljs-title">IConfiguration</span>
    {
        <span class="hljs-keyword">public</span> <span class="hljs-built_in">int</span> BufferSize { <span class="hljs-keyword">get</span>; <span class="hljs-keyword">set</span>; } = <span class="hljs-number">1024</span> * <span class="hljs-number">512</span>;
    }
</code></pre>
<h4>5. FastMode</h4>
<p>Система не будет контролировать использование памяти, но вы получите более быструю скорость сохранения.</p>
<pre><code class="language-csharp hljs"><span class="hljs-keyword">var</span> config = <span class="hljs-keyword">new</span> OpenXmlConfiguration() { FastMode = <span class="hljs-literal">true</span> };
MiniExcel.SaveAs(path, reader,configuration:config);
</code></pre>
<h4>6. Пакетное добавление изображений (MiniExcel.AddPicture)</h4>
<pre><code class="language-csharp hljs"><span class="hljs-keyword">var</span> images = <span class="hljs-keyword">new</span>[]
{
    <span class="hljs-keyword">new</span> MiniExcelPicture
    {
        ImageBytes = File.ReadAllBytes(PathHelper.GetFile(<span class="hljs-string">"images/github_logo.png"</span>)),
        SheetName = <span class="hljs-literal">null</span>, <span class="hljs-comment">// по умолчанию null — первый лист</span>
        CellAddress = <span class="hljs-string">"C3"</span>, <span class="hljs-comment">// обязательно</span>
    },
    <span class="hljs-keyword">new</span> MiniExcelPicture
    {
        ImageBytes = File.ReadAllBytes(PathHelper.GetFile(<span class="hljs-string">"images/google_logo.png"</span>)),
        PictureType = <span class="hljs-string">"image/png"</span>, <span class="hljs-comment">// по умолчанию PictureType = image/png</span>
        SheetName = <span class="hljs-string">"Demo"</span>,
        CellAddress = <span class="hljs-string">"C9"</span>, <span class="hljs-comment">// обязательно</span>
        WidthPx = <span class="hljs-number">100</span>,
        HeightPx = <span class="hljs-number">100</span>,
    },
};
MiniExcel.AddPicture(path, images);
</code></pre>
<p><img src="https://github.com/user-attachments/assets/19c4d241-9753-4ede-96c8-f810c1a22247" alt="Image"></p>
<h4>7. Получение размеров листов</h4>
<pre><code class="language-csharp hljs"><span class="hljs-keyword">var</span> dim = MiniExcel.GetSheetDimensions(path);
</code></pre>
<h3>Примеры:</h3>
<h4>1. SQLite &amp; Dapper <code>Большой файл</code> SQL-вставка без OOM</h4>
<p>замечание: пожалуйста, не вызывайте методы ToList/ToArray после Query, иначе все данные загрузятся в память</p>
<pre><code class="language-csharp hljs"><span class="hljs-keyword">using</span> (<span class="hljs-keyword">var</span> connection = <span class="hljs-keyword">new</span> SQLiteConnection(connectionString))
{
    connection.Open();
    <span class="hljs-keyword">using</span> (<span class="hljs-keyword">var</span> transaction = connection.BeginTransaction())
    <span class="hljs-keyword">using</span> (<span class="hljs-keyword">var</span> stream = File.OpenRead(path))
    {
       <span class="hljs-keyword">var</span> rows = stream.Query();
       <span class="hljs-keyword">foreach</span> (<span class="hljs-keyword">var</span> row <span class="hljs-keyword">in</span> rows)
             connection.Execute(<span class="hljs-string">"insert into T (A,B) values (@A,@B)"</span>, <span class="hljs-keyword">new</span> { row.A, row.B }, transaction: transaction);
       transaction.Commit();
    }
}
</code></pre>
<p>производительность:<br><img src="https://user-images.githubusercontent.com/12729184/111072579-2dda7b80-8516-11eb-9843-c01a1edc88ec.png" alt="image"></p>
<h4>2. ASP.NET Core 3.1 или MVC 5 Пример API для загрузки/выгрузки Excel Xlsx <a href="https://raw.githubusercontent.com/mini-software/MiniExcel/master/tests/MiniExcel.Tests.AspNetCore">Попробовать</a></h4>
<pre><code class="language-csharp hljs"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title">ApiController</span> : <span class="hljs-title">Controller</span>
{
    <span class="hljs-function"><span class="hljs-keyword">public</span> IActionResult <span class="hljs-title">Index</span>()</span>
    {
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> ContentResult
        {
            ContentType = <span class="hljs-string">"text/html"</span>,
            StatusCode = (<span class="hljs-built_in">int</span>)HttpStatusCode.OK,
            Content = <span class="hljs-string">@"&lt;html&gt;&lt;body&gt;
&lt;a href='api/DownloadExcel'&gt;DownloadExcel&lt;/a&gt;&lt;br&gt;
&lt;a href='api/DownloadExcelFromTemplatePath'&gt;DownloadExcelFromTemplatePath&lt;/a&gt;&lt;br&gt;
&lt;a href='api/DownloadExcelFromTemplateBytes'&gt;DownloadExcelFromTemplateBytes&lt;/a&gt;&lt;br&gt;
&lt;p&gt;Upload Excel&lt;/p&gt;
&lt;form method='post' enctype='multipart/form-data' action='/api/uploadexcel'&gt;
    &lt;input type='file' name='excel'&gt; &lt;br&gt;
    &lt;input type='submit' &gt;
&lt;/form&gt;
&lt;/body&gt;&lt;/html&gt;"</span>
        };
    }

    <span class="hljs-function"><span class="hljs-keyword">public</span> IActionResult <span class="hljs-title">DownloadExcel</span>()</span>
    {
        <span class="hljs-keyword">var</span> values = <span class="hljs-keyword">new</span>[] {
            <span class="hljs-keyword">new</span> { Column1 = <span class="hljs-string">"MiniExcel"</span>, Column2 = <span class="hljs-number">1</span> },
            <span class="hljs-keyword">new</span> { Column1 = <span class="hljs-string">"Github"</span>, Column2 = <span class="hljs-number">2</span>}
        };
        <span class="hljs-keyword">var</span> memoryStream = <span class="hljs-keyword">new</span> MemoryStream();
        memoryStream.SaveAs(values);
        memoryStream.Seek(<span class="hljs-number">0</span>, SeekOrigin.Begin);
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> FileStreamResult(memoryStream, <span class="hljs-string">"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"</span>)
        {
            FileDownloadName = <span class="hljs-string">"demo.xlsx"</span>
        };
    }

    <span class="hljs-function"><span class="hljs-keyword">public</span> IActionResult <span class="hljs-title">DownloadExcelFromTemplatePath</span>()</span>
    {
        <span class="hljs-built_in">string</span> templatePath = <span class="hljs-string">"TestTemplateComplex.xlsx"</span>;

        Dictionary&lt;<span class="hljs-built_in">string</span>, <span class="hljs-built_in">object</span>&gt; <span class="hljs-keyword">value</span> = <span class="hljs-keyword">new</span> Dictionary&lt;<span class="hljs-built_in">string</span>, <span class="hljs-built_in">object</span>&gt;()
        {
            [<span class="hljs-string">"title"</span>] = <span class="hljs-string">"FooCompany"</span>,
            [<span class="hljs-string">"managers"</span>] = <span class="hljs-keyword">new</span>[] {
                <span class="hljs-keyword">new</span> {name=<span class="hljs-string">"Jack"</span>,department=<span class="hljs-string">"HR"</span>},
                <span class="hljs-keyword">new</span> {name=<span class="hljs-string">"Loan"</span>,department=<span class="hljs-string">"IT"</span>}
            },
            [<span class="hljs-string">"employees"</span>] = <span class="hljs-keyword">new</span>[] {
                <span class="hljs-keyword">new</span> {name=<span class="hljs-string">"Wade"</span>,department=<span class="hljs-string">"HR"</span>},
                <span class="hljs-keyword">new</span> {name=<span class="hljs-string">"Felix"</span>,department=<span class="hljs-string">"HR"</span>},
                <span class="hljs-keyword">new</span> {name=<span class="hljs-string">"Eric"</span>,department=<span class="hljs-string">"IT"</span>},
                <span class="hljs-keyword">new</span> {name=<span class="hljs-string">"Keaton"</span>,department=<span class="hljs-string">"IT"</span>}
            }
        };

        MemoryStream memoryStream = <span class="hljs-keyword">new</span> MemoryStream();
        memoryStream.SaveAsByTemplate(templatePath, <span class="hljs-keyword">value</span>);
        memoryStream.Seek(<span class="hljs-number">0</span>, SeekOrigin.Begin);
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> FileStreamResult(memoryStream, <span class="hljs-string">"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"</span>)
        {
            FileDownloadName = <span class="hljs-string">"demo.xlsx"</span>
        };
    }

    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> Dictionary&lt;<span class="hljs-built_in">string</span>, Byte[]&gt; TemplateBytesCache = <span class="hljs-keyword">new</span> Dictionary&lt;<span class="hljs-built_in">string</span>, <span class="hljs-built_in">byte</span>[]&gt;();

    <span class="hljs-function"><span class="hljs-keyword">static</span> <span class="hljs-title">ApiController</span>()</span>
    {
        <span class="hljs-built_in">string</span> templatePath = <span class="hljs-string">"TestTemplateComplex.xlsx"</span>;
        <span class="hljs-built_in">byte</span>[] bytes = System.IO.File.ReadAllBytes(templatePath);
        TemplateBytesCache.Add(templatePath, bytes);
    }

    <span class="hljs-function"><span class="hljs-keyword">public</span> IActionResult <span class="hljs-title">DownloadExcelFromTemplateBytes</span>()</span>
    {
        <span class="hljs-built_in">byte</span>[] bytes = TemplateBytesCache[<span class="hljs-string">"TestTemplateComplex.xlsx"</span>];

        Dictionary&lt;<span class="hljs-built_in">string</span>, <span class="hljs-built_in">object</span>&gt; <span class="hljs-keyword">value</span> = <span class="hljs-keyword">new</span> Dictionary&lt;<span class="hljs-built_in">string</span>, <span class="hljs-built_in">object</span>&gt;()
        {
            [<span class="hljs-string">"title"</span>] = <span class="hljs-string">"FooCompany"</span>,
            [<span class="hljs-string">"managers"</span>] = <span class="hljs-keyword">new</span>[] {
                <span class="hljs-keyword">new</span> {name=<span class="hljs-string">"Jack"</span>,department=<span class="hljs-string">"HR"</span>},
                <span class="hljs-keyword">new</span> {name=<span class="hljs-string">"Loan"</span>,department=<span class="hljs-string">"IT"</span>}
</code></pre>
<pre><code class="language-csharp hljs">            },
            [<span class="hljs-string">"employees"</span>] = <span class="hljs-keyword">new</span>[] {
                <span class="hljs-keyword">new</span> {name=<span class="hljs-string">"Wade"</span>,department=<span class="hljs-string">"HR"</span>},
                <span class="hljs-keyword">new</span> {name=<span class="hljs-string">"Felix"</span>,department=<span class="hljs-string">"HR"</span>},
                <span class="hljs-keyword">new</span> {name=<span class="hljs-string">"Eric"</span>,department=<span class="hljs-string">"IT"</span>},
                <span class="hljs-keyword">new</span> {name=<span class="hljs-string">"Keaton"</span>,department=<span class="hljs-string">"IT"</span>}
            }
        };

        MemoryStream memoryStream = <span class="hljs-keyword">new</span> MemoryStream();
        memoryStream.SaveAsByTemplate(bytes, <span class="hljs-keyword">value</span>);
        memoryStream.Seek(<span class="hljs-number">0</span>, SeekOrigin.Begin);
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> FileStreamResult(memoryStream, <span class="hljs-string">"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"</span>)
        {
            FileDownloadName = <span class="hljs-string">"demo.xlsx"</span>
        };
    }

    <span class="hljs-function"><span class="hljs-keyword">public</span> IActionResult <span class="hljs-title">UploadExcel</span>(<span class="hljs-params">IFormFile excel</span>)</span>
    {
        <span class="hljs-keyword">var</span> stream = <span class="hljs-keyword">new</span> MemoryStream();
        excel.CopyTo(stream);

        <span class="hljs-keyword">foreach</span> (<span class="hljs-keyword">var</span> item <span class="hljs-keyword">in</span> stream.Query(<span class="hljs-literal">true</span>))
        {
            <span class="hljs-comment">// ваша логика и т.д.</span>
        }

        <span class="hljs-keyword">return</span> Ok(<span class="hljs-string">"Файл успешно загружен"</span>);
    }
}
</code></pre>
<h4>3. Постраничный запрос</h4>
<pre><code class="language-csharp hljs"><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">Main</span>()</span>
{
    <span class="hljs-keyword">var</span> rows = MiniExcel.Query(path);

    Console.WriteLine(<span class="hljs-string">"==== Страница №1 ===="</span>);
    Console.WriteLine(Page(rows,pageSize:<span class="hljs-number">3</span>,page:<span class="hljs-number">1</span>));
    Console.WriteLine(<span class="hljs-string">"==== Страница №50 ===="</span>);
    Console.WriteLine(Page(rows,pageSize:<span class="hljs-number">3</span>,page:<span class="hljs-number">50</span>));
    Console.WriteLine(<span class="hljs-string">"==== Страница №5000 ===="</span>);
    Console.WriteLine(Page(rows,pageSize:<span class="hljs-number">3</span>,page:<span class="hljs-number">5000</span>));
}

<span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-title">IEnumerable</span>&lt;<span class="hljs-title">T</span>&gt; <span class="hljs-title">Page</span>&lt;<span class="hljs-title">T</span>&gt;(<span class="hljs-params">IEnumerable&lt;T&gt; en, <span class="hljs-built_in">int</span> pageSize, <span class="hljs-built_in">int</span> page</span>)</span>
{
    <span class="hljs-keyword">return</span> en.Skip(page * pageSize).Take(pageSize);
}
</code></pre>
<p><img src="https://user-images.githubusercontent.com/12729184/114679083-6ef4c400-9d3e-11eb-9f78-a86daa45fe46.gif" alt="20210419"></p>
<h4>4. Экспорт Excel в WebForm через memorystream</h4>
<pre><code class="language-csharp hljs"><span class="hljs-keyword">var</span> fileName = <span class="hljs-string">"Demo.xlsx"</span>;
<span class="hljs-keyword">var</span> sheetName = <span class="hljs-string">"Sheet1"</span>;
HttpResponse response = HttpContext.Current.Response;
response.Clear();
response.ContentType = <span class="hljs-string">"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"</span>;
response.AddHeader(<span class="hljs-string">"Content-Disposition"</span>, <span class="hljs-string">$"attachment;filename=\"<span class="hljs-subst">{fileName}</span>\""</span>);
<span class="hljs-keyword">var</span> values = <span class="hljs-keyword">new</span>[] {
    <span class="hljs-keyword">new</span> { Column1 = <span class="hljs-string">"MiniExcel"</span>, Column2 = <span class="hljs-number">1</span> },
    <span class="hljs-keyword">new</span> { Column1 = <span class="hljs-string">"Github"</span>, Column2 = <span class="hljs-number">2</span>}
};
<span class="hljs-keyword">var</span> memoryStream = <span class="hljs-keyword">new</span> MemoryStream();
memoryStream.SaveAs(values, sheetName: sheetName);
memoryStream.Seek(<span class="hljs-number">0</span>, SeekOrigin.Begin);
memoryStream.CopyTo(Response.OutputStream);
response.End();
</code></pre>
<h4>5. Динамическая i18n многоязычность и управление ролями</h4>
<p>Как в примере, создайте метод для обработки i18n и управления разрешениями, и используйте <code>yield return</code> для возврата IEnumerable&lt;Dictionary&lt;string, object&gt;&gt;, чтобы добиться динамической обработки с низким потреблением памяти</p>
<pre><code class="language-csharp hljs"><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">Main</span>()</span>
{
    <span class="hljs-keyword">var</span> <span class="hljs-keyword">value</span> = <span class="hljs-keyword">new</span> Order[] {
        <span class="hljs-keyword">new</span> Order(){OrderNo = <span class="hljs-string">"SO01"</span>,CustomerID=<span class="hljs-string">"C001"</span>,ProductID=<span class="hljs-string">"P001"</span>,Qty=<span class="hljs-number">100</span>,Amt=<span class="hljs-number">500</span>},
        <span class="hljs-keyword">new</span> Order(){OrderNo = <span class="hljs-string">"SO02"</span>,CustomerID=<span class="hljs-string">"C002"</span>,ProductID=<span class="hljs-string">"P002"</span>,Qty=<span class="hljs-number">300</span>,Amt=<span class="hljs-number">400</span>},
    };

    Console.WriteLine(<span class="hljs-string">"en-Us и роль Sales"</span>);
    {
        <span class="hljs-keyword">var</span> path = Path.GetTempPath() + Guid.NewGuid() + <span class="hljs-string">".xlsx"</span>;
        <span class="hljs-keyword">var</span> lang = <span class="hljs-string">"en-US"</span>;
        <span class="hljs-keyword">var</span> role = <span class="hljs-string">"Sales"</span>;
        MiniExcel.SaveAs(path, GetOrders(lang, role, <span class="hljs-keyword">value</span>));
        MiniExcel.Query(path, <span class="hljs-literal">true</span>).Dump();
    }

    Console.WriteLine(<span class="hljs-string">"zh-CN и роль PMC"</span>);
    {
        <span class="hljs-keyword">var</span> path = Path.GetTempPath() + Guid.NewGuid() + <span class="hljs-string">".xlsx"</span>;
        <span class="hljs-keyword">var</span> lang = <span class="hljs-string">"zh-CN"</span>;
        <span class="hljs-keyword">var</span> role = <span class="hljs-string">"PMC"</span>;
        MiniExcel.SaveAs(path, GetOrders(lang, role, <span class="hljs-keyword">value</span>));
        MiniExcel.Query(path, <span class="hljs-literal">true</span>).Dump();
    }
}

<span class="hljs-keyword">private</span> IEnumerable&lt;Dictionary&lt;<span class="hljs-built_in">string</span>, <span class="hljs-built_in">object</span>&gt;&gt; GetOrders(<span class="hljs-built_in">string</span> lang, <span class="hljs-built_in">string</span> role, Order[] orders)
{
    <span class="hljs-keyword">foreach</span> (<span class="hljs-keyword">var</span> order <span class="hljs-keyword">in</span> orders)
    {
        <span class="hljs-keyword">var</span> newOrder = <span class="hljs-keyword">new</span> Dictionary&lt;<span class="hljs-built_in">string</span>, <span class="hljs-built_in">object</span>&gt;();

        <span class="hljs-keyword">if</span> (lang == <span class="hljs-string">"zh-CN"</span>)
        {
            newOrder.Add(<span class="hljs-string">"客户编号"</span>, order.CustomerID);
            newOrder.Add(<span class="hljs-string">"订单编号"</span>, order.OrderNo);
            newOrder.Add(<span class="hljs-string">"产品编号"</span>, order.ProductID);
            newOrder.Add(<span class="hljs-string">"数量"</span>, order.Qty);
            <span class="hljs-keyword">if</span> (role == <span class="hljs-string">"Sales"</span>)
                newOrder.Add(<span class="hljs-string">"价格"</span>, order.Amt);
            <span class="hljs-keyword">yield</span> <span class="hljs-keyword">return</span> newOrder;
        }
        <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (lang == <span class="hljs-string">"en-US"</span>)
        {
            newOrder.Add(<span class="hljs-string">"Customer ID"</span>, order.CustomerID);
            newOrder.Add(<span class="hljs-string">"Order No"</span>, order.OrderNo);
            newOrder.Add(<span class="hljs-string">"Product ID"</span>, order.ProductID);
            newOrder.Add(<span class="hljs-string">"Quantity"</span>, order.Qty);
            <span class="hljs-keyword">if</span> (role == <span class="hljs-string">"Sales"</span>)
                newOrder.Add(<span class="hljs-string">"Amount"</span>, order.Amt);
            <span class="hljs-keyword">yield</span> <span class="hljs-keyword">return</span> newOrder;
        }
        <span class="hljs-keyword">else</span>
        {
            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> InvalidDataException(<span class="hljs-string">$"lang <span class="hljs-subst">{lang}</span> wrong"</span>);
        }
    }
}

<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title">Order</span>
{
    <span class="hljs-keyword">public</span> <span class="hljs-built_in">string</span> OrderNo { <span class="hljs-keyword">get</span>; <span class="hljs-keyword">set</span>; }
    <span class="hljs-keyword">public</span> <span class="hljs-built_in">string</span> CustomerID { <span class="hljs-keyword">get</span>; <span class="hljs-keyword">set</span>; }
    <span class="hljs-keyword">public</span> <span class="hljs-built_in">decimal</span> Qty { <span class="hljs-keyword">get</span>; <span class="hljs-keyword">set</span>; }
    <span class="hljs-keyword">public</span> <span class="hljs-built_in">string</span> ProductID { <span class="hljs-keyword">get</span>; <span class="hljs-keyword">set</span>; }
    <span class="hljs-keyword">public</span> <span class="hljs-built_in">decimal</span> Amt { <span class="hljs-keyword">get</span>; <span class="hljs-keyword">set</span>; }
}
</code></pre>
<p><img src="https://user-images.githubusercontent.com/12729184/118939964-d24bc480-b982-11eb-88dd-f06655f6121a.png" alt="image"></p>
<h3>FAQ</h3>
<h4>В: Заголовок столбца Excel не совпадает с именем свойства класса, как сделать сопоставление?</h4>
<p>О. Используйте атрибут ExcelColumnName</p>
<p><img src="https://user-images.githubusercontent.com/12729184/116020475-eac50980-a678-11eb-8804-129e87200e5e.png" alt="image"></p>
<h4>В. Как выполнять запрос или экспортировать несколько листов?</h4>
<p>О. Используйте метод <code>GetSheetNames</code> с параметром sheetName в методе Query.</p>
<pre><code class="language-csharp hljs"><span class="hljs-keyword">var</span> sheets = MiniExcel.GetSheetNames(path);
<span class="hljs-keyword">foreach</span> (<span class="hljs-keyword">var</span> sheet <span class="hljs-keyword">in</span> sheets)
{
    Console.WriteLine(<span class="hljs-string">$"sheet name : <span class="hljs-subst">{sheet}</span> "</span>);
    <span class="hljs-keyword">var</span> rows = MiniExcel.Query(path,useHeaderRow:<span class="hljs-literal">true</span>,sheetName:sheet);
    Console.WriteLine(rows);
}
</code></pre>
<p><img src="https://user-images.githubusercontent.com/12729184/116199841-2a1f5300-a76a-11eb-90a3-6710561cf6db.png" alt="image"></p>
<h4>В. Как запросить или экспортировать информацию о видимости листа?</h4>
<p>О. Используйте метод <code>GetSheetInformations</code>.</p>
<pre><code class="language-csharp hljs"><span class="hljs-keyword">var</span> sheets = MiniExcel.GetSheetInformations(path);
<span class="hljs-keyword">foreach</span> (<span class="hljs-keyword">var</span> sheetInfo <span class="hljs-keyword">in</span> sheets)
{
    Console.WriteLine(<span class="hljs-string">$"sheet index : <span class="hljs-subst">{sheetInfo.Index}</span> "</span>); <span class="hljs-comment">// следующий индекс листа - нумерация с 0</span>
    Console.WriteLine(<span class="hljs-string">$"sheet name : <span class="hljs-subst">{sheetInfo.Name}</span> "</span>);   <span class="hljs-comment">// имя листа</span>
    Console.WriteLine(<span class="hljs-string">$"sheet state : <span class="hljs-subst">{sheetInfo.State}</span> "</span>); <span class="hljs-comment">// состояние видимости листа - visible / hidden</span>
}
</code></pre>
<h4>Вопрос: Использует ли Count всю память для загрузки всех данных?</h4>
<p>Нет, на изображении теста 1 миллион строк * 10 столбцов данных, максимальное использование памяти &lt;60MB, время выполнения 13,65 секунд.</p>
<p><img src="https://user-images.githubusercontent.com/12729184/117118518-70586000-adc3-11eb-9ce3-2ba76cf8b5e5.png" alt="image"></p>
<h4>Вопрос: Как использовать Query с целочисленными индексами?</h4>
<p>По умолчанию индексы в Query — строковые ключи: A,B,C.... Если вы хотите использовать числовые индексы, создайте следующий метод для преобразования:</p>
<pre><code class="language-csharp hljs"><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">Main</span>()</span>
{
    <span class="hljs-keyword">var</span> path = <span class="hljs-string">@"D:\git\MiniExcel\samples\xlsx\TestTypeMapping.xlsx"</span>;
    <span class="hljs-keyword">var</span> rows = MiniExcel.Query(path,<span class="hljs-literal">true</span>);
    <span class="hljs-keyword">foreach</span> (<span class="hljs-function"><span class="hljs-keyword">var</span> r <span class="hljs-keyword">in</span> <span class="hljs-title">ConvertToIntIndexRows</span>(<span class="hljs-params">rows</span>))</span>
    {
        Console.Write(<span class="hljs-string">$"column 0 : <span class="hljs-subst">{r[<span class="hljs-number">0</span>]}</span> ,column 1 : <span class="hljs-subst">{r[<span class="hljs-number">1</span>]}</span>"</span>);
        Console.WriteLine();
    }
}

<span class="hljs-keyword">private</span> IEnumerable&lt;Dictionary&lt;<span class="hljs-built_in">int</span>, <span class="hljs-built_in">object</span>&gt;&gt; ConvertToIntIndexRows(IEnumerable&lt;<span class="hljs-built_in">object</span>&gt; rows)
{
    ICollection&lt;<span class="hljs-built_in">string</span>&gt; keys = <span class="hljs-literal">null</span>;
    <span class="hljs-keyword">var</span> isFirst = <span class="hljs-literal">true</span>;
    <span class="hljs-keyword">foreach</span> (IDictionary&lt;<span class="hljs-built_in">string</span>,<span class="hljs-built_in">object</span>&gt; r <span class="hljs-keyword">in</span> rows)
    {
        <span class="hljs-keyword">if</span>(isFirst)
        {
            keys = r.Keys;
            isFirst = <span class="hljs-literal">false</span>;
        }

        <span class="hljs-keyword">var</span> dic = <span class="hljs-keyword">new</span> Dictionary&lt;<span class="hljs-built_in">int</span>, <span class="hljs-built_in">object</span>&gt;();
        <span class="hljs-keyword">var</span> index = <span class="hljs-number">0</span>;
        <span class="hljs-keyword">foreach</span> (<span class="hljs-keyword">var</span> key <span class="hljs-keyword">in</span> keys)
            dic[index++] = r[key];
        <span class="hljs-keyword">yield</span> <span class="hljs-keyword">return</span> dic;
    }
}
</code></pre>
<h4>Вопрос: Почему при экспорте Excel с пустыми значениями генерируется пустой Excel без заголовков?</h4>
<p>Потому что MiniExcel использует логику, аналогичную JSON.NET, чтобы динамически получать тип из значений для упрощения работы с API, тип не может быть определён без данных. Для подробностей смотрите <a href="https://github.com/mini-software/MiniExcel/issues/133">issue #133</a>.</p>
<p><img src="https://user-images.githubusercontent.com/12729184/122639771-546c0c00-d12e-11eb-800c-498db27889ca.png" alt="image"></p>
<blockquote>
<p>Сильный тип &amp; DataTable сгенерируют заголовки, но для Dictionary Excel останется пустым</p>
</blockquote>
<h4>Вопрос: Как остановить foreach при пустой строке?</h4>
<p>MiniExcel можно использовать с <code>LINQ TakeWhile</code> для остановки итератора foreach.</p>
<p><img src="https://user-images.githubusercontent.com/12729184/130209137-162621c2-f337-4479-9996-beeac65bc4d4.png" alt="Image"></p>
<h4>Вопрос: Как удалить пустые строки?</h4>
<p><img src="https://user-images.githubusercontent.com/12729184/137873865-7107d8f5-eb59-42db-903a-44e80589f1b2.png" alt="image"></p>
<p>IEnumerable :</p>
<pre><code class="language-csharp hljs"><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> IEnumerable&lt;<span class="hljs-built_in">dynamic</span>&gt; <span class="hljs-title">QueryWithoutEmptyRow</span>(<span class="hljs-params">Stream stream, <span class="hljs-built_in">bool</span> useHeaderRow, <span class="hljs-built_in">string</span> sheetName, ExcelType excelType, <span class="hljs-built_in">string</span> startCell, IConfiguration configuration</span>)</span>
{
    <span class="hljs-keyword">var</span> rows = stream.Query(useHeaderRow,sheetName,excelType,startCell,configuration);
    <span class="hljs-keyword">foreach</span> (IDictionary&lt;<span class="hljs-built_in">string</span>,<span class="hljs-built_in">object</span>&gt; row <span class="hljs-keyword">in</span> rows)
    {
        <span class="hljs-keyword">if</span>(row.Keys.Any(key=&gt;row[key]!=<span class="hljs-literal">null</span>))
            <span class="hljs-keyword">yield</span> <span class="hljs-keyword">return</span> row;
    }
}
</code></pre>
<p>DataTable :</p>
<pre><code class="language-csharp hljs"><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> DataTable <span class="hljs-title">QueryAsDataTableWithoutEmptyRow</span>(<span class="hljs-params">Stream stream, <span class="hljs-built_in">bool</span> useHeaderRow, <span class="hljs-built_in">string</span> sheetName, ExcelType excelType, <span class="hljs-built_in">string</span> startCell, IConfiguration configuration</span>)</span>
{
    <span class="hljs-keyword">if</span> (sheetName == <span class="hljs-literal">null</span> &amp;&amp; excelType != ExcelType.CSV) <span class="hljs-comment">/*Issue #279*/</span>
        sheetName = stream.GetSheetNames().First();

    <span class="hljs-keyword">var</span> dt = <span class="hljs-keyword">new</span> DataTable(sheetName);
    <span class="hljs-keyword">var</span> first = <span class="hljs-literal">true</span>;
    <span class="hljs-keyword">var</span> rows = stream.Query(useHeaderRow,sheetName,excelType,startCell,configuration);
    <span class="hljs-keyword">foreach</span> (IDictionary&lt;<span class="hljs-built_in">string</span>, <span class="hljs-built_in">object</span>&gt; row <span class="hljs-keyword">in</span> rows)
    {
        <span class="hljs-keyword">if</span> (first)
        {

            <span class="hljs-keyword">foreach</span> (<span class="hljs-keyword">var</span> key <span class="hljs-keyword">in</span> row.Keys)
            {
                <span class="hljs-keyword">var</span> column = <span class="hljs-keyword">new</span> DataColumn(key, <span class="hljs-keyword">typeof</span>(<span class="hljs-built_in">object</span>)) { Caption = key };
                dt.Columns.Add(column);
            }

            dt.BeginLoadData();
            first = <span class="hljs-literal">false</span>;
        }

        <span class="hljs-keyword">var</span> newRow = dt.NewRow();
        <span class="hljs-keyword">var</span> isNull=<span class="hljs-literal">true</span>;
        <span class="hljs-keyword">foreach</span> (<span class="hljs-keyword">var</span> key <span class="hljs-keyword">in</span> row.Keys)
        {
            <span class="hljs-keyword">var</span> _v = row[key];
            <span class="hljs-keyword">if</span>(_v!=<span class="hljs-literal">null</span>)
                isNull = <span class="hljs-literal">false</span>;
            newRow[key] = _v;
        }

        <span class="hljs-keyword">if</span>(!isNull)
            dt.Rows.Add(newRow);
    }

    dt.EndLoadData();
    <span class="hljs-keyword">return</span> dt;
}
</code></pre>
<h4>Вопрос: Как использовать SaveAs(path,value) для замены существующего файла без ошибки "The file ...xlsx already exists error"</h4>
<p>Пожалуйста, используйте класс Stream для кастомной логики создания файла, например:</p>
<pre><code class="language-C# hljs language-C">    using (var stream = File.Create(<span class="hljs-string">"Demo.xlsx"</span>))
        MiniExcel.SaveAs(stream,value);
</code></pre>
<p>или, начиная с версии V1.25.0, SaveAs поддерживает параметр overwriteFile для включения/отключения перезаписи существующего файла</p>
<pre><code class="language-csharp hljs">    MiniExcel.SaveAs(path, <span class="hljs-keyword">value</span>, overwriteFile: <span class="hljs-literal">true</span>);
</code></pre>
<h3>Ограничения и особенности</h3>
<ul>
<li>В настоящее время не поддерживаются xls и зашифрованные файлы</li>
<li>xlsm поддерживает только Query</li>
</ul>
<h3>Ссылки</h3>
<p><a href="https://github.com/ExcelDataReader/ExcelDataReader">ExcelDataReader</a>  / <a href="https://github.com/ClosedXML/ClosedXML">ClosedXML</a> / <a href="https://github.com/DapperLib/Dapper">Dapper</a> / <a href="https://github.com/andersnm/ExcelNumberFormat">ExcelNumberFormat</a></p>
<h3>Благодарности</h3>
<h4><a href="https://www.jetbrains.com/">Jetbrains</a></h4>
<p><img src="https://user-images.githubusercontent.com/12729184/123997015-8456c180-da02-11eb-829a-aec476fe8e94.png" alt="jetbrains-variant-2"></p>
<p>Спасибо за предоставление бесплатной лицензии All product IDE для этого проекта (<a href="https://user-images.githubusercontent.com/12729184/123988233-6ab17c00-d9fa-11eb-8739-2a08c6a4a263.png">Лицензия</a>)</p>
<h3>Донаты и вклад в развитие проекта</h3>
<p>Ссылка <a href="https://github.com/orgs/mini-software/discussions/754">https://github.com/orgs/mini-software/discussions/754</a></p>
<h3>Контрибьюторы</h3>
<p><img src="https://contrib.rocks/image?repo=mini-software/MiniExcel" alt=""></p>
<hr>
<p>Tranlated By <a href="https://github.com/OpenAiTx/OpenAiTx">Open Ai Tx</a> | Last indexed: 2025-06-08</p>
<hr>
</div>
    </div>

    <footer class="footer">
        Powered by <a href="https://github.com/OpenAiTx/OpenAiTx" target="_blank">Open AI Tx</a>
    </footer>
    <!-- Default Statcounter code for openaitx
https://openaitx.github.io/ -->
    <script type="text/javascript">
        var sc_project = 13142514;
        var sc_invisible = 1;
        var sc_security = "d03a31d8"; 
    </script>
    <script type="text/javascript" src="https://www.statcounter.com/counter/counter.js" async=""></script>
    <noscript>
        <div class="statcounter"><a title="Web Analytics" href="https://statcounter.com/" target="_blank"><img
                    class="statcounter" src="https://c.statcounter.com/13142514/0/d03a31d8/1/" alt="Web Analytics"
                    referrerPolicy="no-referrer-when-downgrade"></a></div>
    </noscript>
    <!-- End of Statcounter Code -->
    <script src="view.js"></script>


</body></html>