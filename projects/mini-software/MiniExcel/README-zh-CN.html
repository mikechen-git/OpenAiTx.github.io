<!DOCTYPE html><html lang="en"><head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Open AI Tx - Markdown Viewer</title>

    <!-- Primary Meta Tags -->
    <meta name="title" content="Open AI Tx - Markdown Viewer">
    <meta name="description" content="GitHub style markdown viewer for Open AI Tx projects">
    <meta name="keywords" content="Open AI Tx, Markdown, GitHub Style, Documentation">
    <meta name="author" content="Open AI Tx">
    <meta name="robots" content="index, follow">

    <!-- Open Graph -->
    <meta property="og:type" content="website">
    <meta property="og:url" content="https://openaitx.github.io/view.html">
    <meta property="og:title" content="Open AI Tx - Markdown Viewer">
    <meta property="og:description" content="GitHub style markdown viewer for Open AI Tx projects">
    <meta property="og:image" content="https://openaitx.github.io/logo_crop.png">

    <!-- Favicon -->
    <link rel="icon" type="image/jpeg" href="/icon.jpg">
    <link rel="apple-touch-icon" href="/icon.jpg">

    <!-- Marked.js for Markdown rendering -->
    <script type="text/javascript" async="" src="https://www.statcounter.com/counter/recorder.js"></script>
    <script src="/js/marked.min.js"></script>
    <!-- Highlight.js for code syntax highlighting -->
    <link rel="stylesheet" href="/css/github.min.css">
    <script src="/js/highlight.min.js"></script>
    <!-- Custom CSS -->
    <link rel="stylesheet" href="/view.css">
    <style>
        /* Layout */
        body {
            display: flex;
            flex-direction: column;
            min-height: 100vh;
        }

        .main-container {
            margin: 0 auto;
            width: 100%;
            max-width: 980px;
            padding: 0 20px;
        }

        @media (max-width: 768px) {
            .main-container {
                padding: 0 15px;
            }
        }

        /* Image size restrictions */
        .markdown-body img {
            max-width: 100%;
            height: auto;
        }

        /* Existing styles */
        .header {
            text-align: center;
            margin-bottom: 30px;
            padding: 20px;
            background-color: #f6f8fa;
            border-bottom: 1px solid #e1e4e8;
            position: relative;
        }

        .back-button {
            position: absolute;
            left: 20px;
            top: 50%;
            transform: translateY(-50%);
            color: #0366d6;
            text-decoration: none;
            display: flex;
            align-items: center;
            font-size: 14px;
            padding: 5px 10px;
            border: 1px solid #e1e4e8;
            border-radius: 6px;
            background-color: #fff;
        }

        .back-button:hover {
            background-color: #f6f8fa;
            border-color: #0366d6;
        }

        .back-button::before {
            content: "←";
            margin-right: 5px;
            font-size: 16px;
        }

        .header .links {
            margin-top: 10px;
            font-size: 16px;
        }

        .header .links a {
            color: #0366d6;
            text-decoration: none;
            margin-left: 5px;
        }

        .header .links a:hover {
            text-decoration: underline;
        }
        
        /* Language badges styles */
        .language-badges {
            margin-top: 15px;
            text-align: center;
        }
        .language-badges a {
            display: inline-block;
            margin: 2px;
            text-decoration: none;
        }
        .language-badges img {
            height: 20px;
            border-radius: 3px;
        }
        .language-badges a:hover img {
            opacity: 0.8;
        }
    </style>
</head>

<body>
    <div class="header">
        <a href="javascript:history.back()" class="back-button">Back</a>
        <div class="links">
            GitHub Repository: <a href="https://github.com/mini-software/MiniExcel" id="githubRepoLink" target="_blank">mini-software/MiniExcel</a>
        </div>
        <div class="language-badges" id="languageBadges"><a href="https://openaitx.github.io/view.html?user=mini-software&amp;project=MiniExcel&amp;lang=en"><img src="https://img.shields.io/badge/EN-white" alt="version"></a> <a href="https://openaitx.github.io/view.html?user=mini-software&amp;project=MiniExcel&amp;lang=zh-CN"><img src="https://img.shields.io/badge/简中-white" alt="version"></a> <a href="https://openaitx.github.io/view.html?user=mini-software&amp;project=MiniExcel&amp;lang=zh-TW"><img src="https://img.shields.io/badge/繁中-white" alt="version"></a> <a href="https://openaitx.github.io/view.html?user=mini-software&amp;project=MiniExcel&amp;lang=ja"><img src="https://img.shields.io/badge/日本語-white" alt="version"></a> <a href="https://openaitx.github.io/view.html?user=mini-software&amp;project=MiniExcel&amp;lang=ko"><img src="https://img.shields.io/badge/한국어-white" alt="version"></a> <a href="https://openaitx.github.io/view.html?user=mini-software&amp;project=MiniExcel&amp;lang=th"><img src="https://img.shields.io/badge/ไทย-white" alt="version"></a> <a href="https://openaitx.github.io/view.html?user=mini-software&amp;project=MiniExcel&amp;lang=fr"><img src="https://img.shields.io/badge/Français-white" alt="version"></a> <a href="https://openaitx.github.io/view.html?user=mini-software&amp;project=MiniExcel&amp;lang=de"><img src="https://img.shields.io/badge/Deutsch-white" alt="version"></a> <a href="https://openaitx.github.io/view.html?user=mini-software&amp;project=MiniExcel&amp;lang=es"><img src="https://img.shields.io/badge/Español-white" alt="version"></a> <a href="https://openaitx.github.io/view.html?user=mini-software&amp;project=MiniExcel&amp;lang=it"><img src="https://img.shields.io/badge/Italiano-white" alt="version"></a> <a href="https://openaitx.github.io/view.html?user=mini-software&amp;project=MiniExcel&amp;lang=ru"><img src="https://img.shields.io/badge/Русский-white" alt="version"></a> <a href="https://openaitx.github.io/view.html?user=mini-software&amp;project=MiniExcel&amp;lang=pt"><img src="https://img.shields.io/badge/Português-white" alt="version"></a> <a href="https://openaitx.github.io/view.html?user=mini-software&amp;project=MiniExcel&amp;lang=nl"><img src="https://img.shields.io/badge/Nederlands-white" alt="version"></a> <a href="https://openaitx.github.io/view.html?user=mini-software&amp;project=MiniExcel&amp;lang=pl"><img src="https://img.shields.io/badge/Polski-white" alt="version"></a> <a href="https://openaitx.github.io/view.html?user=mini-software&amp;project=MiniExcel&amp;lang=ar"><img src="https://img.shields.io/badge/العربية-white" alt="version"></a> <a href="https://openaitx.github.io/view.html?user=mini-software&amp;project=MiniExcel&amp;lang=tr"><img src="https://img.shields.io/badge/Türkçe-white" alt="version"></a> <a href="https://openaitx.github.io/view.html?user=mini-software&amp;project=MiniExcel&amp;lang=vi"><img src="https://img.shields.io/badge/Tiếng Việt-white" alt="version"></a></div>
    </div>

    <div class="main-container">
        <div class="markdown-body" id="content"><div style="text-align: center">
<p><a href="https://www.nuget.org/packages/MiniExcel"><img src="https://img.shields.io/nuget/v/MiniExcel.svg" alt="NuGet"></a>  <a href="https://www.nuget.org/packages/MiniExcel"><img src="https://img.shields.io/nuget/dt/MiniExcel.svg" alt=""></a>
<a href="https://ci.appveyor.com/project/mini-software/miniexcel/branch/master"><img src="https://ci.appveyor.com/api/projects/status/b2vustrwsuqx45f4/branch/master?svg=true" alt="Build status"></a>
<a href="https://gitee.com/dotnetchina/MiniExcel"><img src="https://gitee.com/dotnetchina/MiniExcel/badge/star.svg" alt="star"></a> <a href="https://github.com/mini-software/MiniExcel" rel="nofollow"><img src="https://img.shields.io/github/stars/mini-software/MiniExcel?logo=github" alt="GitHub stars"></a>
<a href="https://www.nuget.org/packages/MiniExcel"><img src="https://img.shields.io/badge/.NET-%3E%3D%204.5-red.svg" alt="version"></a>
<a href="https://deepwiki.com/mini-software/MiniExcel"><img src="https://deepwiki.com/badge.svg" alt="Ask DeepWiki"></a>
</p>
</div>

<hr>
<p><a href="https://www.dotnetfoundation.org/"><img align="right" src="https://github.com/dotnet-foundation/swag/blob/main/logo/dotnetfoundation_v4.png?raw=true" width="100"></a></p>
<div style="text-align: center">
<p>本项目属于 <a href="https://www.dotnetfoundation.org/">.NET 基金会</a>，并遵循其<a href="https://www.dotnetfoundation.org/code-of-conduct">行为准则</a>。</p>
</div>

<hr>
<div style="text-align: center">
<p><strong><a href="README.md">English</a> | <a href="README.zh-CN.md">简体中文</a> | <a href="README.zh-Hant.md">繁體中文</a></strong></p>
</div>

<hr>
<div style="text-align: center">
 您的 <a href="https://github.com/mini-software/MiniExcel">Star</a> 和 <a href="https://miniexcel.github.io">捐赠</a> 能让 MiniExcel 更好
</div>

<hr>
<h3>简介</h3>
<p>MiniExcel 是一个简单高效、避免 OOM 的 .NET Excel 处理工具。</p>
<p>目前，大多数流行的框架为了方便操作都需要将所有数据加载到内存中，但这样会带来内存消耗的问题。MiniExcel 尝试采用流式算法，将原本 1000 MB 的占用减少到几 MB，从而避免 OOM（内存溢出）。</p>
<p><img src="https://user-images.githubusercontent.com/12729184/113086657-ab8bd000-9214-11eb-9563-c970ac1ee35e.png" alt="image"></p>
<h3>特性</h3>
<ul>
<li>内存消耗低，避免 OOM（内存溢出）和 Full GC</li>
<li>支持实时操作每一行数据</li>
<li>支持 LINQ 延迟执行，可进行低消耗、快速分页等复杂查询</li>
<li>轻量级，无需安装 Microsoft Office，无需 COM+，DLL 大小小于 400KB</li>
<li>简洁的 API 风格，便于读取/写入/填充 Excel</li>
</ul>
<h3>快速上手</h3>
<ul>
<li><p><a href="#getstart1">导入/查询 Excel</a></p>
</li>
<li><p><a href="#getstart2">导出/创建 Excel</a></p>
</li>
<li><p><a href="#getstart3">Excel 模板</a></p>
</li>
<li><p><a href="#getstart4">Excel 列名/索引/忽略属性</a></p>
</li>
<li><p><a href="#getstart5">示例</a></p>
</li>
</ul>
<h3>安装</h3>
<p>你可以通过 <a href="https://www.nuget.org/packages/MiniExcel">NuGet 安装该包</a></p>
<h3>发布日志</h3>
<p>请查看 <a href="docs">发布日志</a></p>
<h3>TODO</h3>
<p>请查看 <a href="https://github.com/mini-software/MiniExcel/projects/1?fullscreen=true">TODO</a></p>
<h3>性能</h3>
<p>基准测试代码可在 <a href="benchmarks/MiniExcel.Benchmarks/Program.cs">MiniExcel.Benchmarks</a> 找到。</p>
<p>用于性能测试的文件是 <a href="benchmarks/MiniExcel.Benchmarks/Test1%2C000%2C000x10.xlsx"><strong>Test1,000,000x10.xlsx</strong></a>，这是一个 32MB 的文档，包含 1,000,000 行 * 10 列，单元格内容均为字符串 "HelloWorld"。</p>
<p>运行全部基准测试命令如下：</p>
<pre><code class="language-bash hljs">dotnet run -project .\benchmarks\MiniExcel.Benchmarks -c Release -f net9.0 -filter * --<span class="hljs-built_in">join</span>
</code></pre>
<p>你可以在最新版本的 <a href="benchmarks/results">此处</a> 查看基准测试结果。</p>
<h3>Excel 查询/导入 <a name="getstart1"></a></h3>
<h4>1. 执行查询并将结果映射到强类型 IEnumerable <a href="https://dotnetfiddle.net/w5WD1J">[在线体验]</a></h4>
<p>推荐使用 Stream.Query，效率更高。</p>
<pre><code class="language-csharp hljs"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title">UserAccount</span>
{
    <span class="hljs-keyword">public</span> Guid ID { <span class="hljs-keyword">get</span>; <span class="hljs-keyword">set</span>; }
    <span class="hljs-keyword">public</span> <span class="hljs-built_in">string</span> Name { <span class="hljs-keyword">get</span>; <span class="hljs-keyword">set</span>; }
    <span class="hljs-keyword">public</span> DateTime BoD { <span class="hljs-keyword">get</span>; <span class="hljs-keyword">set</span>; }
    <span class="hljs-keyword">public</span> <span class="hljs-built_in">int</span> Age { <span class="hljs-keyword">get</span>; <span class="hljs-keyword">set</span>; }
    <span class="hljs-keyword">public</span> <span class="hljs-built_in">bool</span> VIP { <span class="hljs-keyword">get</span>; <span class="hljs-keyword">set</span>; }
    <span class="hljs-keyword">public</span> <span class="hljs-built_in">decimal</span> Points { <span class="hljs-keyword">get</span>; <span class="hljs-keyword">set</span>; }
}

<span class="hljs-keyword">var</span> rows = MiniExcel.Query&lt;UserAccount&gt;(path);

<span class="hljs-comment">// 或者</span>

<span class="hljs-keyword">using</span> (<span class="hljs-keyword">var</span> stream = File.OpenRead(path))
    <span class="hljs-keyword">var</span> rows = stream.Query&lt;UserAccount&gt;();
</code></pre>
<p><img src="https://user-images.githubusercontent.com/12729184/111107423-c8c46b80-8591-11eb-982f-c97a2dafb379.png" alt="image"></p>
<h4>2. 执行查询并以动态对象列表（不使用表头）映射 <a href="https://dotnetfiddle.net/w5WD1J">[在线体验]</a></h4>
<ul>
<li>dynamic 的 key 为 <code>A.B.C.D..</code></li>
</ul>
<table>
<thead>
<tr>
<th>MiniExcel</th>
<th>1</th>
</tr>
</thead>
<tbody><tr>
<td>Github</td>
<td>2</td>
</tr>
</tbody></table>
<pre><code class="language-csharp hljs">
<span class="hljs-keyword">var</span> rows = MiniExcel.Query(path).ToList();

<span class="hljs-comment">// 或者</span>
<span class="hljs-keyword">using</span> (<span class="hljs-keyword">var</span> stream = File.OpenRead(path))
{
    <span class="hljs-keyword">var</span> rows = stream.Query().ToList();

    Assert.Equal(<span class="hljs-string">"MiniExcel"</span>, rows[<span class="hljs-number">0</span>].A);
    Assert.Equal(<span class="hljs-number">1</span>, rows[<span class="hljs-number">0</span>].B);
    Assert.Equal(<span class="hljs-string">"Github"</span>, rows[<span class="hljs-number">1</span>].A);
    Assert.Equal(<span class="hljs-number">2</span>, rows[<span class="hljs-number">1</span>].B);
}
</code></pre>
<h4>3. 使用首行表头执行查询 <a href="https://dotnetfiddle.net/w5WD1J">[在线体验]</a></h4>
<p>注意：同名列将采用最右侧一个</p>
<p>输入 Excel :</p>
<table>
<thead>
<tr>
<th>Column1</th>
<th>Column2</th>
</tr>
</thead>
<tbody><tr>
<td>MiniExcel</td>
<td>1</td>
</tr>
<tr>
<td>Github</td>
<td>2</td>
</tr>
</tbody></table>
<pre><code class="language-csharp hljs">
<span class="hljs-keyword">var</span> rows = MiniExcel.Query(useHeaderRow:<span class="hljs-literal">true</span>).ToList();

<span class="hljs-comment">// 或者</span>

<span class="hljs-keyword">using</span> (<span class="hljs-keyword">var</span> stream = File.OpenRead(path))
{
    <span class="hljs-keyword">var</span> rows = stream.Query(useHeaderRow:<span class="hljs-literal">true</span>).ToList();

    Assert.Equal(<span class="hljs-string">"MiniExcel"</span>, rows[<span class="hljs-number">0</span>].Column1);
    Assert.Equal(<span class="hljs-number">1</span>, rows[<span class="hljs-number">0</span>].Column2);
    Assert.Equal(<span class="hljs-string">"Github"</span>, rows[<span class="hljs-number">1</span>].Column1);
    Assert.Equal(<span class="hljs-number">2</span>, rows[<span class="hljs-number">1</span>].Column2);
}
</code></pre>
<h4>4. 查询支持 LINQ 扩展 First/Take/Skip 等</h4>
<p>查询第一个</p>
<pre><code class="language-csharp hljs"><span class="hljs-keyword">var</span> row = MiniExcel.Query(path).First();
Assert.Equal(<span class="hljs-string">"HelloWorld"</span>, row.A);

<span class="hljs-comment">// 或者</span>

<span class="hljs-keyword">using</span> (<span class="hljs-keyword">var</span> stream = File.OpenRead(path))
{
    <span class="hljs-keyword">var</span> row = stream.Query().First();
    Assert.Equal(<span class="hljs-string">"HelloWorld"</span>, row.A);
}
</code></pre>
<p>MiniExcel/ExcelDataReader/ClosedXML/EPPlus 查询 First 性能对比<br><img src="https://user-images.githubusercontent.com/12729184/111072392-6037a900-8515-11eb-9693-5ce2dad1e460.gif" alt="queryfirst"></p>
<h4>5. 按工作表名称查询</h4>
<pre><code class="language-csharp hljs">MiniExcel.Query(path, sheetName: <span class="hljs-string">"SheetName"</span>);
<span class="hljs-comment">// 或</span>
stream.Query(sheetName: <span class="hljs-string">"SheetName"</span>);
</code></pre>
<h4>6. 查询所有工作表名称及数据行</h4>
<pre><code class="language-csharp hljs"><span class="hljs-keyword">var</span> sheetNames = MiniExcel.GetSheetNames(path);
<span class="hljs-keyword">foreach</span> (<span class="hljs-keyword">var</span> sheetName <span class="hljs-keyword">in</span> sheetNames)
{
    <span class="hljs-keyword">var</span> rows = MiniExcel.Query(path, sheetName: sheetName);
}
</code></pre>
<h4>7. 获取列</h4>
<pre><code class="language-csharp hljs"><span class="hljs-keyword">var</span> columns = MiniExcel.GetColumns(path); <span class="hljs-comment">// 例如结果 : ["A","B"...]</span>

<span class="hljs-keyword">var</span> cnt = columns.Count;  <span class="hljs-comment">// 获取列数</span>
</code></pre>
<h4>8. 动态查询，将行转换为 <code>IDictionary&lt;string,object&gt;</code></h4>
<pre><code class="language-csharp hljs"><span class="hljs-keyword">foreach</span>(IDictionary&lt;<span class="hljs-built_in">string</span>,<span class="hljs-built_in">object</span>&gt; row <span class="hljs-keyword">in</span> MiniExcel.Query(path))
{
    <span class="hljs-comment">//..</span>
}

<span class="hljs-comment">// 或者</span>
<span class="hljs-keyword">var</span> rows = MiniExcel.Query(path).Cast&lt;IDictionary&lt;<span class="hljs-built_in">string</span>,<span class="hljs-built_in">object</span>&gt;&gt;();
<span class="hljs-comment">// 或查询指定范围（大写字母）</span>
<span class="hljs-comment">// A2 代表 A 列第二行，C3 代表 C 列第三行</span>
<span class="hljs-comment">// 如果不想限制行数，只需不包含数字即可</span>
<span class="hljs-keyword">var</span> rows = MiniExcel.QueryRange(path, startCell: <span class="hljs-string">"A2"</span>, endCell: <span class="hljs-string">"C3"</span>).Cast&lt;IDictionary&lt;<span class="hljs-built_in">string</span>, <span class="hljs-built_in">object</span>&gt;&gt;();
</code></pre>
<h4>9. 查询 Excel 返回 DataTable</h4>
<p>不推荐，因为 DataTable 会将所有数据加载到内存中，失去了 MiniExcel 的低内存消耗特性。</p>
<pre><code class="language-C# hljs language-C">var table = MiniExcel.QueryAsDataTable(path, useHeaderRow: <span class="hljs-literal">true</span>);
</code></pre>
<p><img src="https://user-images.githubusercontent.com/12729184/116673475-07917200-a9d6-11eb-947e-a6f68cce58df.png" alt="image"></p>
<h4>10. 指定单元格开始读取数据</h4>
<pre><code class="language-csharp hljs">MiniExcel.Query(path,useHeaderRow:<span class="hljs-literal">true</span>,startCell:<span class="hljs-string">"B3"</span>)
</code></pre>
<p><img src="https://user-images.githubusercontent.com/12729184/117260316-8593c400-ae81-11eb-9877-c087b7ac2b01.png" alt="image"></p>
<h4>11. 填充合并单元格</h4>
<p>注意：效率较 <code>不使用合并填充</code> 慢</p>
<p>原因：OpenXml 标准将 mergeCells 放在文件底部，导致需要对 sheetxml 遍历两次</p>
<pre><code class="language-csharp hljs">    <span class="hljs-keyword">var</span> config = <span class="hljs-keyword">new</span> OpenXmlConfiguration()
    {
        FillMergedCells = <span class="hljs-literal">true</span>
    };
    <span class="hljs-keyword">var</span> rows = MiniExcel.Query(path, configuration: config);
</code></pre>
<p><img src="https://user-images.githubusercontent.com/12729184/117973630-3527d500-b35f-11eb-95c3-bde255f8114e.png" alt="image"></p>
<p>支持变长多行多列填充</p>
<p><img src="https://user-images.githubusercontent.com/12729184/117973820-6d2f1800-b35f-11eb-88d8-555063938108.png" alt="image"></p>
<h4>12. 通过磁盘缓存读取大文件（磁盘缓存 - SharedString）</h4>
<p>如果 SharedStrings 大小超过 5MB，MiniExcel 默认将使用本地磁盘缓存，例如，<a href="https://github.com/MiniExcel/MiniExcel/files/8403819/NotDuplicateSharedStrings_10x100000.xlsx">10x100000.xlsx</a>（一百万行数据），禁用磁盘缓存时最大内存占用为 195MB，启用磁盘缓存仅需 65MB。注意，这项优化会有一定的效率损耗，因此此场景下读取时间会从 7.4 秒增加到 27.2 秒。如果不需要可通过以下代码禁用磁盘缓存：</p>
<pre><code class="language-csharp hljs"><span class="hljs-keyword">var</span> config = <span class="hljs-keyword">new</span> OpenXmlConfiguration { EnableSharedStringCache = <span class="hljs-literal">false</span> };
MiniExcel.Query(path,configuration: config)
</code></pre>
<p>你可以用 <code>SharedStringCacheSize</code> 更改 sharedString 文件超出指定大小后进行磁盘缓存</p>
<pre><code class="language-csharp hljs"><span class="hljs-keyword">var</span> config = <span class="hljs-keyword">new</span> OpenXmlConfiguration { SharedStringCacheSize=<span class="hljs-number">500</span>*<span class="hljs-number">1024</span>*<span class="hljs-number">1024</span> };
MiniExcel.Query(path, configuration: config);
</code></pre>
<p><img src="https://user-images.githubusercontent.com/12729184/161411851-1c3f72a7-33b3-4944-84dc-ffc1d16747dd.png" alt="image"></p>
<p><img src="https://user-images.githubusercontent.com/12729184/161411825-17f53ec7-bef4-4b16-b234-e24799ea41b0.png" alt="image"></p>
<h3>创建/导出 Excel  <a name="getstart2"></a></h3>
<ol>
<li><p>必须为具有公共无参构造函数的非抽象类型。</p>
</li>
<li><p>MiniExcel 支持 IEnumerable 的延迟执行，如果你想极低内存占用，请不要调用 ToList 等方法</p>
</li>
</ol>
<p>例如：ToList 或不使用 ToList 的内存占用<br><img src="https://user-images.githubusercontent.com/12729184/112587389-752b0b00-8e38-11eb-8a52-cfb76c57e5eb.png" alt="image"></p>
<h4>1. 匿名或强类型 <a href="https://dotnetfiddle.net/w5WD1J">[在线试用]</a></h4>
<pre><code class="language-csharp hljs"><span class="hljs-keyword">var</span> path = Path.Combine(Path.GetTempPath(), <span class="hljs-string">$"<span class="hljs-subst">{Guid.NewGuid()}</span>.xlsx"</span>);
MiniExcel.SaveAs(path, <span class="hljs-keyword">new</span>[] {
    <span class="hljs-keyword">new</span> { Column1 = <span class="hljs-string">"MiniExcel"</span>, Column2 = <span class="hljs-number">1</span> },
    <span class="hljs-keyword">new</span> { Column1 = <span class="hljs-string">"Github"</span>, Column2 = <span class="hljs-number">2</span>}
});
</code></pre>
<h4>2. <code>IEnumerable&lt;IDictionary&lt;string, object&gt;&gt;</code></h4>
<pre><code class="language-csharp hljs"><span class="hljs-keyword">var</span> values = <span class="hljs-keyword">new</span> List&lt;Dictionary&lt;<span class="hljs-built_in">string</span>, <span class="hljs-built_in">object</span>&gt;&gt;()
{
    <span class="hljs-keyword">new</span> Dictionary&lt;<span class="hljs-built_in">string</span>,<span class="hljs-built_in">object</span>&gt;{{ <span class="hljs-string">"Column1"</span>, <span class="hljs-string">"MiniExcel"</span> }, { <span class="hljs-string">"Column2"</span>, <span class="hljs-number">1</span> } },
    <span class="hljs-keyword">new</span> Dictionary&lt;<span class="hljs-built_in">string</span>,<span class="hljs-built_in">object</span>&gt;{{ <span class="hljs-string">"Column1"</span>, <span class="hljs-string">"Github"</span> }, { <span class="hljs-string">"Column2"</span>, <span class="hljs-number">2</span> } }
};
MiniExcel.SaveAs(path, values);
</code></pre>
<p>生成文件结果：</p>
<table>
<thead>
<tr>
<th>Column1</th>
<th>Column2</th>
</tr>
</thead>
<tbody><tr>
<td>MiniExcel</td>
<td>1</td>
</tr>
<tr>
<td>Github</td>
<td>2</td>
</tr>
</tbody></table>
<h4>3.  IDataReader</h4>
<ul>
<li><code>推荐</code>，可以避免将所有数据加载到内存中</li>
</ul>
<pre><code class="language-csharp hljs">MiniExcel.SaveAs(path, reader);
</code></pre>
<p><img src="https://user-images.githubusercontent.com/12729184/121275378-149a5e80-c8bc-11eb-85fe-5453552134f0.png" alt="image"></p>
<p>DataReader 导出多工作表（推荐使用 Dapper ExecuteReader）</p>
<pre><code class="language-csharp hljs"><span class="hljs-keyword">using</span> (<span class="hljs-keyword">var</span> cnn = Connection)
{
    cnn.Open();
    <span class="hljs-keyword">var</span> sheets = <span class="hljs-keyword">new</span> Dictionary&lt;<span class="hljs-built_in">string</span>,<span class="hljs-built_in">object</span>&gt;();
    sheets.Add(<span class="hljs-string">"sheet1"</span>, cnn.ExecuteReader(<span class="hljs-string">"select 1 id"</span>));
    sheets.Add(<span class="hljs-string">"sheet2"</span>, cnn.ExecuteReader(<span class="hljs-string">"select 2 id"</span>));
    MiniExcel.SaveAs(<span class="hljs-string">"Demo.xlsx"</span>, sheets);
}
</code></pre>
<h4>4. Datatable</h4>
<ul>
<li><p><code>不推荐</code>，会将所有数据加载到内存中</p>
</li>
<li><p>DataTable 优先使用 Caption 作为列名，然后使用列名</p>
</li>
</ul>
<pre><code class="language-csharp hljs"><span class="hljs-keyword">var</span> path = Path.Combine(Path.GetTempPath(), <span class="hljs-string">$"<span class="hljs-subst">{Guid.NewGuid()}</span>.xlsx"</span>);
<span class="hljs-keyword">var</span> table = <span class="hljs-keyword">new</span> DataTable();
{
    table.Columns.Add(<span class="hljs-string">"Column1"</span>, <span class="hljs-keyword">typeof</span>(<span class="hljs-built_in">string</span>));
    table.Columns.Add(<span class="hljs-string">"Column2"</span>, <span class="hljs-keyword">typeof</span>(<span class="hljs-built_in">decimal</span>));
    table.Rows.Add(<span class="hljs-string">"MiniExcel"</span>, <span class="hljs-number">1</span>);
    table.Rows.Add(<span class="hljs-string">"Github"</span>, <span class="hljs-number">2</span>);
}

MiniExcel.SaveAs(path, table);
</code></pre>
<h4>5. Dapper 查询</h4>
<p>感谢 @shaofing #552 ，请使用 <code>CommandDefinition + CommandFlags.NoCache</code></p>
<pre><code class="language-csharp hljs"><span class="hljs-keyword">using</span> (<span class="hljs-keyword">var</span> connection = GetConnection(connectionString))
{
    <span class="hljs-keyword">var</span> rows = connection.Query(
        <span class="hljs-keyword">new</span> CommandDefinition(
            <span class="hljs-string">@"select 'MiniExcel' as Column1,1 as Column2 union all select 'Github',2"</span>
            , flags: CommandFlags.NoCache)
        );
    <span class="hljs-comment">// 注意：QueryAsync 会抛出连接关闭异常</span>
    MiniExcel.SaveAs(path, rows);
</code></pre>
<p>}</p>
<pre><code class="hljs language-csharp">
下面的代码会将所有数据加载到内存中

```<span class="hljs-function">csharp
<span class="hljs-title">using</span> (<span class="hljs-params"><span class="hljs-keyword">var</span> connection = GetConnection(connectionString</span>))</span>
{
    <span class="hljs-keyword">var</span> rows = connection.Query(<span class="hljs-string">@"select 'MiniExcel' as Column1,1 as Column2 union all select 'Github',2"</span>);
    MiniExcel.SaveAs(path, rows);
}
</code></pre>
<h4>6. 保存到 MemoryStream  <a href="https://dotnetfiddle.net/JOen0e">[在线体验]</a></h4>
<pre><code class="language-csharp hljs"><span class="hljs-keyword">using</span> (<span class="hljs-keyword">var</span> stream = <span class="hljs-keyword">new</span> MemoryStream()) <span class="hljs-comment">//支持 FileStream、MemoryStream 等</span>
{
    stream.SaveAs(values);
}
</code></pre>
<p>例如：导出 Excel 的 api</p>
<pre><code class="language-csharp hljs"><span class="hljs-function"><span class="hljs-keyword">public</span> IActionResult <span class="hljs-title">DownloadExcel</span>()</span>
{
    <span class="hljs-keyword">var</span> values = <span class="hljs-keyword">new</span>[] {
        <span class="hljs-keyword">new</span> { Column1 = <span class="hljs-string">"MiniExcel"</span>, Column2 = <span class="hljs-number">1</span> },
        <span class="hljs-keyword">new</span> { Column1 = <span class="hljs-string">"Github"</span>, Column2 = <span class="hljs-number">2</span>}
    };

    <span class="hljs-keyword">var</span> memoryStream = <span class="hljs-keyword">new</span> MemoryStream();
    memoryStream.SaveAs(values);
    memoryStream.Seek(<span class="hljs-number">0</span>, SeekOrigin.Begin);
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> FileStreamResult(memoryStream, <span class="hljs-string">"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"</span>)
    {
        FileDownloadName = <span class="hljs-string">"demo.xlsx"</span>
    };
}
</code></pre>
<h4>7. 创建多工作表</h4>
<pre><code class="language-csharp hljs"><span class="hljs-comment">// 1. Dictionary&lt;string,object&gt;</span>
<span class="hljs-keyword">var</span> users = <span class="hljs-keyword">new</span>[] { <span class="hljs-keyword">new</span> { Name = <span class="hljs-string">"Jack"</span>, Age = <span class="hljs-number">25</span> }, <span class="hljs-keyword">new</span> { Name = <span class="hljs-string">"Mike"</span>, Age = <span class="hljs-number">44</span> } };
<span class="hljs-keyword">var</span> department = <span class="hljs-keyword">new</span>[] { <span class="hljs-keyword">new</span> { ID = <span class="hljs-string">"01"</span>, Name = <span class="hljs-string">"HR"</span> }, <span class="hljs-keyword">new</span> { ID = <span class="hljs-string">"02"</span>, Name = <span class="hljs-string">"IT"</span> } };
<span class="hljs-keyword">var</span> sheets = <span class="hljs-keyword">new</span> Dictionary&lt;<span class="hljs-built_in">string</span>, <span class="hljs-built_in">object</span>&gt;
{
    [<span class="hljs-string">"users"</span>] = users,
    [<span class="hljs-string">"department"</span>] = department
};
MiniExcel.SaveAs(path, sheets);

<span class="hljs-comment">// 2. DataSet</span>
<span class="hljs-keyword">var</span> sheets = <span class="hljs-keyword">new</span> DataSet();
sheets.Add(UsersDataTable);
sheets.Add(DepartmentDataTable);
<span class="hljs-comment">//..</span>
MiniExcel.SaveAs(path, sheets);
</code></pre>
<p><img src="https://user-images.githubusercontent.com/12729184/118130875-6e7c4580-b430-11eb-9b82-22f02716bd63.png" alt="image"></p>
<h4>8. 表格样式选项</h4>
<p>默认样式</p>
<p><img src="https://user-images.githubusercontent.com/12729184/138234373-cfa97109-b71f-4711-b7f5-0eaaa4a0a3a6.png" alt="image"></p>
<p>无样式配置</p>
<pre><code class="language-csharp hljs"><span class="hljs-keyword">var</span> config = <span class="hljs-keyword">new</span> OpenXmlConfiguration()
{
     TableStyles = TableStyles.None
};
MiniExcel.SaveAs(path, <span class="hljs-keyword">value</span>,configuration:config);
</code></pre>
<p><img src="https://user-images.githubusercontent.com/12729184/118784917-f3e57700-b8c2-11eb-8718-8d955b1bc197.png" alt="image"></p>
<h4>9. 自动筛选</h4>
<p>自 v0.19.0 起，<code>OpenXmlConfiguration.AutoFilter</code> 可用来启用/禁用自动筛选，默认值为 <code>true</code>，设置自动筛选方法如下：</p>
<pre><code class="language-csharp hljs">MiniExcel.SaveAs(path, <span class="hljs-keyword">value</span>, configuration: <span class="hljs-keyword">new</span> OpenXmlConfiguration() { AutoFilter = <span class="hljs-literal">false</span> });
</code></pre>
<h4>10. 插入图片</h4>
<pre><code class="language-csharp hljs"><span class="hljs-keyword">var</span> <span class="hljs-keyword">value</span> = <span class="hljs-keyword">new</span>[] {
    <span class="hljs-keyword">new</span> { Name=<span class="hljs-string">"github"</span>,Image=File.ReadAllBytes(PathHelper.GetFile(<span class="hljs-string">"images/github_logo.png"</span>))},
    <span class="hljs-keyword">new</span> { Name=<span class="hljs-string">"google"</span>,Image=File.ReadAllBytes(PathHelper.GetFile(<span class="hljs-string">"images/google_logo.png"</span>))},
    <span class="hljs-keyword">new</span> { Name=<span class="hljs-string">"microsoft"</span>,Image=File.ReadAllBytes(PathHelper.GetFile(<span class="hljs-string">"images/microsoft_logo.png"</span>))},
    <span class="hljs-keyword">new</span> { Name=<span class="hljs-string">"reddit"</span>,Image=File.ReadAllBytes(PathHelper.GetFile(<span class="hljs-string">"images/reddit_logo.png"</span>))},
    <span class="hljs-keyword">new</span> { Name=<span class="hljs-string">"statck_overflow"</span>,Image=File.ReadAllBytes(PathHelper.GetFile(<span class="hljs-string">"images/statck_overflow_logo.png"</span>))},
};
MiniExcel.SaveAs(path, <span class="hljs-keyword">value</span>);
</code></pre>
<p><img src="https://user-images.githubusercontent.com/12729184/150462383-ad9931b3-ed8d-4221-a1d6-66f799743433.png" alt="image"></p>
<h4>11. 字节数组文件导出</h4>
<p>自 1.22.0 起，当值类型为 <code>byte[]</code> 时，系统会默认在单元格中保存文件路径，并且在导入时可以自动转换为 <code>byte[]</code>。如果不想使用此功能，可以将 <code>OpenXmlConfiguration.EnableConvertByteArray</code> 设置为 <code>false</code>，这样可以提升系统效率。</p>
<p><img src="https://user-images.githubusercontent.com/12729184/153702334-c3b834f4-6ae4-4ddf-bd4e-e5005d5d8c6a.png" alt="image"></p>
<p>自 1.22.0 起，当值类型为 <code>byte[]</code> 时，系统会默认在单元格中保存文件路径，并且在导入时可以自动转换为 <code>byte[]</code>。如果不想使用此功能，可以将 <code>OpenXmlConfiguration.EnableConvertByteArray</code> 设置为 <code>false</code>，这样可以提升系统效率。</p>
<p><img src="https://user-images.githubusercontent.com/12729184/153702334-c3b834f4-6ae4-4ddf-bd4e-e5005d5d8c6a.png" alt="image"></p>
<h4>12. 垂直合并相同单元格</h4>
<p>该功能仅支持 <code>xlsx</code> 格式，并且会在 @merge 和 @endmerge 标签之间按列垂直合并单元格。<br>你可以使用 @mergelimit 来限制垂直合并单元格的边界。</p>
<pre><code class="language-csharp hljs"><span class="hljs-keyword">var</span> mergedFilePath = Path.Combine(Path.GetTempPath(), <span class="hljs-string">$"<span class="hljs-subst">{Guid.NewGuid().ToString()}</span>.xlsx"</span>);

<span class="hljs-keyword">var</span> path = <span class="hljs-string">@"../../../../../samples/xlsx/TestMergeWithTag.xlsx"</span>;

MiniExcel.MergeSameCells(mergedFilePath, path);
</code></pre>
<pre><code class="language-csharp hljs"><span class="hljs-keyword">var</span> memoryStream = <span class="hljs-keyword">new</span> MemoryStream();

<span class="hljs-keyword">var</span> path = <span class="hljs-string">@"../../../../../samples/xlsx/TestMergeWithTag.xlsx"</span>;

memoryStream.MergeSameCells(path);
</code></pre>
<p>合并前后文件内容：</p>
<p>未设置合并边界：</p>
<img width="318" alt="Screenshot 2023-08-07 at 11 59 24" src="https://github.com/mini-software/MiniExcel/assets/38832863/49cc96b9-6c35-4bf3-8d43-a9752a15b22e">

<img width="318" alt="Screenshot 2023-08-07 at 11 59 57" src="https://github.com/mini-software/MiniExcel/assets/38832863/3fbd529b-3ae6-4bbe-b4d8-2793a5a58010">

<p>设置合并边界：</p>
<img width="346" alt="Screenshot 2023-08-08 at 18 21 00" src="https://github.com/mini-software/MiniExcel/assets/38832863/04049d28-84d5-4c2a-bcff-5847547df5e1">

<img width="346" alt="Screenshot 2023-08-08 at 18 21 40" src="https://github.com/mini-software/MiniExcel/assets/38832863/f5cf8957-b0b0-4831-b8fc-8556299235c2">

<h4>13. 跳过 null 值</h4>
<p>新增显式选项，可为 null 值写入空单元格：</p>
<pre><code class="language-csharp hljs">DataTable dt = <span class="hljs-keyword">new</span> DataTable();

<span class="hljs-comment">/* ... */</span>

DataRow dr = dt.NewRow();

dr[<span class="hljs-string">"Name1"</span>] = <span class="hljs-string">"Somebody once"</span>;
dr[<span class="hljs-string">"Name2"</span>] = <span class="hljs-literal">null</span>;
dr[<span class="hljs-string">"Name3"</span>] = <span class="hljs-string">"told me."</span>;

dt.Rows.Add(dr);

OpenXmlConfiguration configuration = <span class="hljs-keyword">new</span> OpenXmlConfiguration()
{
     EnableWriteNullValueCell = <span class="hljs-literal">true</span> <span class="hljs-comment">// 默认值。</span>
};

MiniExcel.SaveAs(<span class="hljs-string">@"C:\temp\Book1.xlsx"</span>, dt, configuration: configuration);
</code></pre>
<p><img src="https://user-images.githubusercontent.com/31481586/241419455-3c0aec8a-4e5f-4d83-b7ec-6572124c165d.png" alt="image"></p>
<pre><code class="language-xml hljs"><span class="hljs-tag">&lt;<span class="hljs-name">x:row</span> <span class="hljs-attr">r</span>=<span class="hljs-string">"2"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">x:c</span> <span class="hljs-attr">r</span>=<span class="hljs-string">"A2"</span> <span class="hljs-attr">t</span> =<span class="hljs-string">"str"</span> <span class="hljs-attr">s</span>=<span class="hljs-string">"2"</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">x:v</span>&gt;</span>Somebody once<span class="hljs-tag">&lt;/<span class="hljs-name">x:v</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">x:c</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">x:c</span> <span class="hljs-attr">r</span>=<span class="hljs-string">"B2"</span> <span class="hljs-attr">s</span>=<span class="hljs-string">"2"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">x:c</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">x:c</span> <span class="hljs-attr">r</span>=<span class="hljs-string">"C2"</span> <span class="hljs-attr">t</span> =<span class="hljs-string">"str"</span> <span class="hljs-attr">s</span>=<span class="hljs-string">"2"</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">x:v</span>&gt;</span>told me.<span class="hljs-tag">&lt;/<span class="hljs-name">x:v</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">x:c</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">x:row</span>&gt;</span>
</code></pre>
<p>之前的行为：</p>
<pre><code class="language-csharp hljs"><span class="hljs-comment">/* ... */</span>

OpenXmlConfiguration configuration = <span class="hljs-keyword">new</span> OpenXmlConfiguration()
{
     EnableWriteNullValueCell = <span class="hljs-literal">false</span> <span class="hljs-comment">// 默认值为 true。</span>
};

MiniExcel.SaveAs(<span class="hljs-string">@"C:\temp\Book1.xlsx"</span>, dt, configuration: configuration);
</code></pre>
<p><img src="https://user-images.githubusercontent.com/31481586/241419441-c4f27e8f-3f87-46db-a10f-08665864c874.png" alt="image"></p>
<pre><code class="language-xml hljs"><span class="hljs-tag">&lt;<span class="hljs-name">x:row</span> <span class="hljs-attr">r</span>=<span class="hljs-string">"2"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">x:c</span> <span class="hljs-attr">r</span>=<span class="hljs-string">"A2"</span> <span class="hljs-attr">t</span> =<span class="hljs-string">"str"</span> <span class="hljs-attr">s</span>=<span class="hljs-string">"2"</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">x:v</span>&gt;</span>Somebody once<span class="hljs-tag">&lt;/<span class="hljs-name">x:v</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">x:c</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">x:c</span> <span class="hljs-attr">r</span>=<span class="hljs-string">"B2"</span> <span class="hljs-attr">t</span> =<span class="hljs-string">"str"</span> <span class="hljs-attr">s</span>=<span class="hljs-string">"2"</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">x:v</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">x:v</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">x:c</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">x:c</span> <span class="hljs-attr">r</span>=<span class="hljs-string">"C2"</span> <span class="hljs-attr">t</span> =<span class="hljs-string">"str"</span> <span class="hljs-attr">s</span>=<span class="hljs-string">"2"</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">x:v</span>&gt;</span>told me.<span class="hljs-tag">&lt;/<span class="hljs-name">x:v</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">x:c</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">x:row</span>&gt;</span>
</code></pre>
<p>适用于 null 和 DBNull 值。</p>
<h4>14. 冻结窗格</h4>
<pre><code class="language-csharp hljs"><span class="hljs-comment">/* ... */</span>

OpenXmlConfiguration configuration = <span class="hljs-keyword">new</span> OpenXmlConfiguration()
{
    FreezeRowCount = <span class="hljs-number">1</span>,     <span class="hljs-comment">// 默认值为 1</span>
    FreezeColumnCount = <span class="hljs-number">2</span>   <span class="hljs-comment">// 默认值为 0</span>
};

MiniExcel.SaveAs(<span class="hljs-string">@"C:\temp\Book1.xlsx"</span>, dt, configuration: configuration);
</code></pre>
<p><img src="https://raw.githubusercontent.com/mini-software/MiniExcel/master/docs/images/freeze-pane-1.png" alt="image"></p>
<h3>向 Excel 模板填充数据 <a name="getstart3"></a></h3>
<ul>
<li>声明方式类似于 Vue 模板的 <code>{{变量名}}</code>，或集合渲染 <code>{{集合名.字段名}}</code></li>
<li>集合渲染支持 IEnumerable/DataTable/DapperRow</li>
</ul>
<h4>1. 基础填充</h4>
<p>模板：<br><img src="https://user-images.githubusercontent.com/12729184/114537556-ed8d2b00-9c84-11eb-8303-a69f62c41e5b.png" alt="image"></p>
<p>结果：<br><img src="https://user-images.githubusercontent.com/12729184/114537490-d8180100-9c84-11eb-8c69-db58692f3a85.png" alt="image"></p>
<p>代码：</p>
<pre><code class="language-csharp hljs"><span class="hljs-comment">// 1. 通过 POCO</span>
<span class="hljs-keyword">var</span> <span class="hljs-keyword">value</span> = <span class="hljs-keyword">new</span>
{
    Name = <span class="hljs-string">"Jack"</span>,
    CreateDate = <span class="hljs-keyword">new</span> DateTime(<span class="hljs-number">2021</span>, <span class="hljs-number">01</span>, <span class="hljs-number">01</span>),
    VIP = <span class="hljs-literal">true</span>,
    Points = <span class="hljs-number">123</span>
};
MiniExcel.SaveAsByTemplate(path, templatePath, <span class="hljs-keyword">value</span>);


<span class="hljs-comment">// 2. 通过 Dictionary</span>
<span class="hljs-keyword">var</span> <span class="hljs-keyword">value</span> = <span class="hljs-keyword">new</span> Dictionary&lt;<span class="hljs-built_in">string</span>, <span class="hljs-built_in">object</span>&gt;()
{
    [<span class="hljs-string">"Name"</span>] = <span class="hljs-string">"Jack"</span>,
    [<span class="hljs-string">"CreateDate"</span>] = <span class="hljs-keyword">new</span> DateTime(<span class="hljs-number">2021</span>, <span class="hljs-number">01</span>, <span class="hljs-number">01</span>),
    [<span class="hljs-string">"VIP"</span>] = <span class="hljs-literal">true</span>,
    [<span class="hljs-string">"Points"</span>] = <span class="hljs-number">123</span>
};
MiniExcel.SaveAsByTemplate(path, templatePath, <span class="hljs-keyword">value</span>);
</code></pre>
<h4>2. IEnumerable 数据填充</h4>
<blockquote>
<p>注意1：以第一个同列的 IEnumerable 作为填充列表的基础</p>
</blockquote>
<p>模板：<br><img src="https://user-images.githubusercontent.com/12729184/114564652-14f2f080-9ca3-11eb-831f-09e3fedbc5fc.png" alt="image"></p>
<p>结果：<br><img src="https://user-images.githubusercontent.com/12729184/114564204-b2015980-9ca2-11eb-900d-e21249f93f7c.png" alt="image"></p>
<p>代码：</p>
<pre><code class="language-csharp hljs"><span class="hljs-comment">//1. 通过 POCO</span>
<span class="hljs-keyword">var</span> <span class="hljs-keyword">value</span> = <span class="hljs-keyword">new</span>
{
    employees = <span class="hljs-keyword">new</span>[] {
        <span class="hljs-keyword">new</span> {name=<span class="hljs-string">"Jack"</span>,department=<span class="hljs-string">"HR"</span>},
        <span class="hljs-keyword">new</span> {name=<span class="hljs-string">"Lisa"</span>,department=<span class="hljs-string">"HR"</span>},
        <span class="hljs-keyword">new</span> {name=<span class="hljs-string">"John"</span>,department=<span class="hljs-string">"HR"</span>},
        <span class="hljs-keyword">new</span> {name=<span class="hljs-string">"Mike"</span>,department=<span class="hljs-string">"IT"</span>},
        <span class="hljs-keyword">new</span> {name=<span class="hljs-string">"Neo"</span>,department=<span class="hljs-string">"IT"</span>},
        <span class="hljs-keyword">new</span> {name=<span class="hljs-string">"Loan"</span>,department=<span class="hljs-string">"IT"</span>}
    }
};
MiniExcel.SaveAsByTemplate(path, templatePath, <span class="hljs-keyword">value</span>);

<span class="hljs-comment">//2. 通过 Dictionary</span>
<span class="hljs-keyword">var</span> <span class="hljs-keyword">value</span> = <span class="hljs-keyword">new</span> Dictionary&lt;<span class="hljs-built_in">string</span>, <span class="hljs-built_in">object</span>&gt;()
{
    [<span class="hljs-string">"employees"</span>] = <span class="hljs-keyword">new</span>[] {
        <span class="hljs-keyword">new</span> {name=<span class="hljs-string">"Jack"</span>,department=<span class="hljs-string">"HR"</span>},
        <span class="hljs-keyword">new</span> {name=<span class="hljs-string">"Lisa"</span>,department=<span class="hljs-string">"HR"</span>},
        <span class="hljs-keyword">new</span> {name=<span class="hljs-string">"John"</span>,department=<span class="hljs-string">"HR"</span>},
        <span class="hljs-keyword">new</span> {name=<span class="hljs-string">"Mike"</span>,department=<span class="hljs-string">"IT"</span>},
        <span class="hljs-keyword">new</span> {name=<span class="hljs-string">"Neo"</span>,department=<span class="hljs-string">"IT"</span>},
        <span class="hljs-keyword">new</span> {name=<span class="hljs-string">"Loan"</span>,department=<span class="hljs-string">"IT"</span>}
    }
};
MiniExcel.SaveAsByTemplate(path, templatePath, <span class="hljs-keyword">value</span>);
</code></pre>
<h4>3. 复杂数据填充</h4>
<blockquote>
<p>注意：支持多工作表及同变量名复用</p>
</blockquote>
<p>模板：</p>
<p><img src="https://user-images.githubusercontent.com/12729184/114565255-acf0da00-9ca3-11eb-8a7f-8131b2265ae8.png" alt="image"></p>
<p>结果：</p>
<p><img src="https://user-images.githubusercontent.com/12729184/114565329-bf6b1380-9ca3-11eb-85e3-3969e8bf6378.png" alt="image"></p>
<pre><code class="language-csharp hljs"><span class="hljs-comment">// 1. 通过 POCO</span>
<span class="hljs-keyword">var</span> <span class="hljs-keyword">value</span> = <span class="hljs-keyword">new</span>
{
    title = <span class="hljs-string">"FooCompany"</span>,
    managers = <span class="hljs-keyword">new</span>[] {
        <span class="hljs-keyword">new</span> {name=<span class="hljs-string">"Jack"</span>,department=<span class="hljs-string">"HR"</span>},
        <span class="hljs-keyword">new</span> {name=<span class="hljs-string">"Loan"</span>,department=<span class="hljs-string">"IT"</span>}
    },
    employees = <span class="hljs-keyword">new</span>[] {
        <span class="hljs-keyword">new</span> {name=<span class="hljs-string">"Wade"</span>,department=<span class="hljs-string">"HR"</span>},
        <span class="hljs-keyword">new</span> {name=<span class="hljs-string">"Felix"</span>,department=<span class="hljs-string">"HR"</span>},
        <span class="hljs-keyword">new</span> {name=<span class="hljs-string">"Eric"</span>,department=<span class="hljs-string">"IT"</span>},
        <span class="hljs-keyword">new</span> {name=<span class="hljs-string">"Keaton"</span>,department=<span class="hljs-string">"IT"</span>}
    }
};
MiniExcel.SaveAsByTemplate(path, templatePath, <span class="hljs-keyword">value</span>);

<span class="hljs-comment">// 2. 通过 Dictionary</span>
<span class="hljs-keyword">var</span> <span class="hljs-keyword">value</span> = <span class="hljs-keyword">new</span> Dictionary&lt;<span class="hljs-built_in">string</span>, <span class="hljs-built_in">object</span>&gt;()
{
    [<span class="hljs-string">"title"</span>] = <span class="hljs-string">"FooCompany"</span>,
    [<span class="hljs-string">"managers"</span>] = <span class="hljs-keyword">new</span>[] {
        <span class="hljs-keyword">new</span> {name=<span class="hljs-string">"Jack"</span>,department=<span class="hljs-string">"HR"</span>},
        <span class="hljs-keyword">new</span> {name=<span class="hljs-string">"Loan"</span>,department=<span class="hljs-string">"IT"</span>}
    },
    [<span class="hljs-string">"employees"</span>] = <span class="hljs-keyword">new</span>[] {
        <span class="hljs-keyword">new</span> {name=<span class="hljs-string">"Wade"</span>,department=<span class="hljs-string">"HR"</span>},
        <span class="hljs-keyword">new</span> {name=<span class="hljs-string">"Felix"</span>,department=<span class="hljs-string">"HR"</span>},
        <span class="hljs-keyword">new</span> {name=<span class="hljs-string">"Eric"</span>,department=<span class="hljs-string">"IT"</span>},
        <span class="hljs-keyword">new</span> {name=<span class="hljs-string">"Keaton"</span>,department=<span class="hljs-string">"IT"</span>}
    }
};
MiniExcel.SaveAsByTemplate(path, templatePath, <span class="hljs-keyword">value</span>);
</code></pre>
<h4>4. 大数据填充性能</h4>
<blockquote>
<p>注意：使用 IEnumerable 延迟执行而不是 ToList，可以最大程度节省 MiniExcel 的内存使用</p>
</blockquote>
<p><img src="https://user-images.githubusercontent.com/12729184/114577091-5046ec80-9cae-11eb-924b-087c7becf8da.png" alt="image"></p>
<h4>5. 单元格值自动类型映射</h4>
<p>模板</p>
<p><img src="https://user-images.githubusercontent.com/12729184/114802504-64830a80-9dd0-11eb-8d56-8e8c401b3ace.png" alt="image"></p>
<p>结果</p>
<p><img src="https://user-images.githubusercontent.com/12729184/114802419-43221e80-9dd0-11eb-9ffe-a2ce34fe7076.png" alt="image"></p>
<p>类</p>
<pre><code class="language-csharp hljs"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title">Poco</span>
{
    <span class="hljs-keyword">public</span> <span class="hljs-built_in">string</span> @string { <span class="hljs-keyword">get</span>; <span class="hljs-keyword">set</span>; }
    <span class="hljs-keyword">public</span> <span class="hljs-built_in">int</span>? @int { <span class="hljs-keyword">get</span>; <span class="hljs-keyword">set</span>; }
</code></pre>
<pre><code class="language-csharp hljs"><span class="hljs-keyword">public</span> <span class="hljs-built_in">decimal</span>? @decimal { <span class="hljs-keyword">get</span>; <span class="hljs-keyword">set</span>; }
<span class="hljs-keyword">public</span> <span class="hljs-built_in">double</span>? @double { <span class="hljs-keyword">get</span>; <span class="hljs-keyword">set</span>; }
<span class="hljs-keyword">public</span> DateTime? datetime { <span class="hljs-keyword">get</span>; <span class="hljs-keyword">set</span>; }
<span class="hljs-keyword">public</span> <span class="hljs-built_in">bool</span>? @bool { <span class="hljs-keyword">get</span>; <span class="hljs-keyword">set</span>; }
<span class="hljs-keyword">public</span> Guid? Guid { <span class="hljs-keyword">get</span>; <span class="hljs-keyword">set</span>; }
}
</code></pre>
<p>代码</p>
<pre><code class="language-csharp hljs"><span class="hljs-keyword">var</span> poco = <span class="hljs-keyword">new</span> TestIEnumerableTypePoco { @string = <span class="hljs-string">"string"</span>, @int = <span class="hljs-number">123</span>, @decimal = <span class="hljs-built_in">decimal</span>.Parse(<span class="hljs-string">"123.45"</span>), @double = (<span class="hljs-built_in">double</span>)<span class="hljs-number">123.33</span>, @datetime = <span class="hljs-keyword">new</span> DateTime(<span class="hljs-number">2021</span>, <span class="hljs-number">4</span>, <span class="hljs-number">1</span>), @bool = <span class="hljs-literal">true</span>, @Guid = Guid.NewGuid() };
<span class="hljs-keyword">var</span> <span class="hljs-keyword">value</span> = <span class="hljs-keyword">new</span>
{
    Ts = <span class="hljs-keyword">new</span>[] {
        poco,
        <span class="hljs-keyword">new</span> TestIEnumerableTypePoco{},
        <span class="hljs-literal">null</span>,
        poco
    }
};
MiniExcel.SaveAsByTemplate(path, templatePath, <span class="hljs-keyword">value</span>);
</code></pre>
<h4>6. 示例 :  列出 Github 项目</h4>
<p>模板</p>
<p><img src="https://user-images.githubusercontent.com/12729184/115068623-12073280-9f25-11eb-9124-f4b3efcdb2a7.png" alt="image"></p>
<p>结果</p>
<p><img src="https://user-images.githubusercontent.com/12729184/115068639-1a5f6d80-9f25-11eb-9f45-27c434d19a78.png" alt="image"></p>
<p>代码</p>
<pre><code class="language-csharp hljs"><span class="hljs-keyword">var</span> projects = <span class="hljs-keyword">new</span>[]
{
    <span class="hljs-keyword">new</span> {Name = <span class="hljs-string">"MiniExcel"</span>,Link=<span class="hljs-string">"https://github.com/mini-software/MiniExcel"</span>,Star=<span class="hljs-number">146</span>, CreateTime=<span class="hljs-keyword">new</span> DateTime(<span class="hljs-number">2021</span>,<span class="hljs-number">03</span>,<span class="hljs-number">01</span>)},
    <span class="hljs-keyword">new</span> {Name = <span class="hljs-string">"HtmlTableHelper"</span>,Link=<span class="hljs-string">"https://github.com/mini-software/HtmlTableHelper"</span>,Star=<span class="hljs-number">16</span>, CreateTime=<span class="hljs-keyword">new</span> DateTime(<span class="hljs-number">2020</span>,<span class="hljs-number">02</span>,<span class="hljs-number">01</span>)},
    <span class="hljs-keyword">new</span> {Name = <span class="hljs-string">"PocoClassGenerator"</span>,Link=<span class="hljs-string">"https://github.com/mini-software/PocoClassGenerator"</span>,Star=<span class="hljs-number">16</span>, CreateTime=<span class="hljs-keyword">new</span> DateTime(<span class="hljs-number">2019</span>,<span class="hljs-number">03</span>,<span class="hljs-number">17</span>)}
};
<span class="hljs-keyword">var</span> <span class="hljs-keyword">value</span> = <span class="hljs-keyword">new</span>
{
    User = <span class="hljs-string">"ITWeiHan"</span>,
    Projects = projects,
    TotalStar = projects.Sum(s =&gt; s.Star)
};
MiniExcel.SaveAsByTemplate(path, templatePath, <span class="hljs-keyword">value</span>);
</code></pre>
<h4>7. 分组数据填充</h4>
<pre><code class="language-csharp hljs"><span class="hljs-keyword">var</span> <span class="hljs-keyword">value</span> = <span class="hljs-keyword">new</span> Dictionary&lt;<span class="hljs-built_in">string</span>, <span class="hljs-built_in">object</span>&gt;()
{
    [<span class="hljs-string">"employees"</span>] = <span class="hljs-keyword">new</span>[] {
        <span class="hljs-keyword">new</span> {name=<span class="hljs-string">"Jack"</span>,department=<span class="hljs-string">"HR"</span>},
        <span class="hljs-keyword">new</span> {name=<span class="hljs-string">"Jack"</span>,department=<span class="hljs-string">"HR"</span>},
        <span class="hljs-keyword">new</span> {name=<span class="hljs-string">"John"</span>,department=<span class="hljs-string">"HR"</span>},
        <span class="hljs-keyword">new</span> {name=<span class="hljs-string">"John"</span>,department=<span class="hljs-string">"IT"</span>},
        <span class="hljs-keyword">new</span> {name=<span class="hljs-string">"Neo"</span>,department=<span class="hljs-string">"IT"</span>},
        <span class="hljs-keyword">new</span> {name=<span class="hljs-string">"Loan"</span>,department=<span class="hljs-string">"IT"</span>}
    }
};
<span class="hljs-keyword">await</span> MiniExcel.SaveAsByTemplateAsync(path, templatePath, <span class="hljs-keyword">value</span>);
</code></pre>
<h5>1. 使用 <code>@group</code> 标签和 <code>@header</code> 标签</h5>
<p>前</p>
<p><img src="https://user-images.githubusercontent.com/38832863/218646717-21b9d57a-2be2-4e9a-801b-ae212231d2b4.PNG" alt="before_with_header"></p>
<p>后</p>
<p><img src="https://user-images.githubusercontent.com/38832863/218646721-58a7a340-7004-4bc2-af24-cffcb2c20737.PNG" alt="after_with_header"></p>
<h5>2. 使用 @group 标签但不使用 @header 标签</h5>
<p>前</p>
<p><img src="https://user-images.githubusercontent.com/38832863/218646873-b12417fa-801b-4890-8e96-669ed3b43902.PNG" alt="before_without_header"></p>
<p>后</p>
<p><img src="https://user-images.githubusercontent.com/38832863/218646872-622461ba-342e-49ee-834f-b91ad9c2dac3.PNG" alt="after_without_header"></p>
<h5>3. 不使用 @group 标签</h5>
<p>前</p>
<p><img src="https://user-images.githubusercontent.com/38832863/218646975-f52a68eb-e031-43b5-abaa-03b67c052d1a.PNG" alt="without_group"></p>
<p>后</p>
<p><img src="https://user-images.githubusercontent.com/38832863/218646974-4a3c0e07-7c66-4088-ad07-b4ad3695b7e1.PNG" alt="without_group_after"></p>
<h4>8. 单元格内 If/ElseIf/Else 语句</h4>
<p>规则：</p>
<ol>
<li>支持 DateTime、Double、Int 类型的 ==、!=、&gt;、&gt;=、&lt;、&lt;= 操作符。</li>
<li>支持 String 类型的 ==、!= 操作符。</li>
<li>每条语句应为新的一行。</li>
<li>操作符前后应有一个空格。</li>
<li>语句内不应有换行。</li>
<li>单元格内容应与下方格式完全一致。</li>
</ol>
<pre><code class="language-csharp hljs">@if(name == Jack)
{{employees.name}}
@elseif(name == Neo)
Test {{employees.name}}
@else
{{employees.department}}
@endif
</code></pre>
<p>前</p>
<p><img src="https://user-images.githubusercontent.com/38832863/235360606-ca654769-ff55-4f5b-98d2-d2ec0edb8173.PNG" alt="if_before"></p>
<p>后</p>
<p><img src="https://user-images.githubusercontent.com/38832863/235360609-869bb960-d63d-45ae-8d64-9e8b0d0ab658.PNG" alt="if_after"></p>
<h4>9. DataTable 作为参数</h4>
<pre><code class="language-csharp hljs"><span class="hljs-keyword">var</span> managers = <span class="hljs-keyword">new</span> DataTable();
{
    managers.Columns.Add(<span class="hljs-string">"name"</span>);
    managers.Columns.Add(<span class="hljs-string">"department"</span>);
    managers.Rows.Add(<span class="hljs-string">"Jack"</span>, <span class="hljs-string">"HR"</span>);
    managers.Rows.Add(<span class="hljs-string">"Loan"</span>, <span class="hljs-string">"IT"</span>);
}
<span class="hljs-keyword">var</span> <span class="hljs-keyword">value</span> = <span class="hljs-keyword">new</span> Dictionary&lt;<span class="hljs-built_in">string</span>, <span class="hljs-built_in">object</span>&gt;()
{
    [<span class="hljs-string">"title"</span>] = <span class="hljs-string">"FooCompany"</span>,
    [<span class="hljs-string">"managers"</span>] = managers,
};
MiniExcel.SaveAsByTemplate(path, templatePath, <span class="hljs-keyword">value</span>);
</code></pre>
<h4>10. 公式</h4>
<h5>1. 示例</h5>
<p>在公式前添加 <code>$</code> 前缀，并用 <code>$enumrowstart</code> 和 <code>$enumrowend</code> 标记可枚举对象的起始和结束行：</p>
<p><img src="docs/images/template-formulas-1.png" alt="image"></p>
<p>当模板渲染时，<code>$</code> 前缀会被移除，<code>$enumrowstart</code> 和 <code>$enumrowend</code> 会被替换为实际的起始和结束行号：</p>
<p><img src="docs/images/template-formulas-2.png" alt="image"></p>
<h5>2. 其他公式示例：</h5>
<table>
<thead>
<tr>
<th></th>
<th></th>
</tr>
</thead>
<tbody><tr>
<td>求和</td>
<td><code>$=SUM(C{{$enumrowstart}}:C{{$enumrowend}})</code></td>
</tr>
<tr>
<td>平均</td>
<td><code>$=SUM(C{{$enumrowstart}}:C{{$enumrowend}}) / COUNT(C{{$enumrowstart}}:C{{$enumrowend}})</code></td>
</tr>
<tr>
<td>极差</td>
<td><code>$=MAX(C{{$enumrowstart}}:C{{$enumrowend}}) - MIN(C{{$enumrowstart}}:C{{$enumrowend}})</code></td>
</tr>
</tbody></table>
<h4>11. 其他</h4>
<h5>1. 检查模板参数 key</h5>
<p>自 V1.24.0 起，默认忽略模板中缺失的参数 key，并用空字符串替换，<code>IgnoreTemplateParameterMissing</code> 可控制是否抛出异常。</p>
<pre><code class="language-csharp hljs"><span class="hljs-keyword">var</span> config = <span class="hljs-keyword">new</span> OpenXmlConfiguration()
{
    IgnoreTemplateParameterMissing = <span class="hljs-literal">false</span>,
};
MiniExcel.SaveAsByTemplate(path, templatePath, <span class="hljs-keyword">value</span>, config)
</code></pre>
<p><img src="https://user-images.githubusercontent.com/12729184/157464332-e316f829-54aa-4c84-a5aa-9aef337b668d.png" alt="image"></p>
<h3>Excel 列名/索引/忽略特性 <a name="getstart4"></a></h3>
<h4>1. 指定列名、列索引、列忽略</h4>
<p>Excel 示例</p>
<p><img src="https://user-images.githubusercontent.com/12729184/114230869-3e163700-99ac-11eb-9a90-2039d4b4b313.png" alt="image"></p>
<p>代码</p>
<pre><code class="language-csharp hljs"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title">ExcelAttributeDemo</span>
{
    [<span class="hljs-meta">ExcelColumnName(<span class="hljs-string">"Column1"</span>)</span>]
</code></pre>
<pre><code class="language-csharp hljs"><span class="hljs-keyword">public</span> <span class="hljs-built_in">string</span> Test1 { <span class="hljs-keyword">get</span>; <span class="hljs-keyword">set</span>; }
[<span class="hljs-meta">ExcelColumnName(<span class="hljs-string">"Column2"</span>)</span>]
<span class="hljs-keyword">public</span> <span class="hljs-built_in">string</span> Test2 { <span class="hljs-keyword">get</span>; <span class="hljs-keyword">set</span>; }
[<span class="hljs-meta">ExcelIgnore</span>]
<span class="hljs-keyword">public</span> <span class="hljs-built_in">string</span> Test3 { <span class="hljs-keyword">get</span>; <span class="hljs-keyword">set</span>; }
[<span class="hljs-meta">ExcelColumnIndex(<span class="hljs-string">"I"</span>)</span>] <span class="hljs-comment">// 系统将"I"转换为索引8</span>
<span class="hljs-keyword">public</span> <span class="hljs-built_in">string</span> Test4 { <span class="hljs-keyword">get</span>; <span class="hljs-keyword">set</span>; }
<span class="hljs-keyword">public</span> <span class="hljs-built_in">string</span> Test5 { <span class="hljs-keyword">get</span>; } <span class="hljs-comment">//没有set将被忽略</span>
<span class="hljs-keyword">public</span> <span class="hljs-built_in">string</span> Test6 { <span class="hljs-keyword">get</span>; <span class="hljs-keyword">private</span> <span class="hljs-keyword">set</span>; } <span class="hljs-comment">//非public set将被忽略</span>
[<span class="hljs-meta">ExcelColumnIndex(3)</span>] <span class="hljs-comment">// 从0开始</span>
<span class="hljs-keyword">public</span> <span class="hljs-built_in">string</span> Test7 { <span class="hljs-keyword">get</span>; <span class="hljs-keyword">set</span>; }
}

<span class="hljs-keyword">var</span> rows = MiniExcel.Query&lt;ExcelAttributeDemo&gt;(path).ToList();
Assert.Equal(<span class="hljs-string">"Column1"</span>, rows[<span class="hljs-number">0</span>].Test1);
Assert.Equal(<span class="hljs-string">"Column2"</span>, rows[<span class="hljs-number">0</span>].Test2);
Assert.Null(rows[<span class="hljs-number">0</span>].Test3);
Assert.Equal(<span class="hljs-string">"Test7"</span>, rows[<span class="hljs-number">0</span>].Test4);
Assert.Null(rows[<span class="hljs-number">0</span>].Test5);
Assert.Null(rows[<span class="hljs-number">0</span>].Test6);
Assert.Equal(<span class="hljs-string">"Test4"</span>, rows[<span class="hljs-number">0</span>].Test7);
</code></pre>
<h4>2. 自定义格式（ExcelFormatAttribute）</h4>
<p>自V0.21.0起，支持包含 <code>ToString(string content)</code> 方法格式的类</p>
<p>类定义</p>
<pre><code class="language-csharp hljs"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title">Dto</span>
{
    <span class="hljs-keyword">public</span> <span class="hljs-built_in">string</span> Name { <span class="hljs-keyword">get</span>; <span class="hljs-keyword">set</span>; }

    [<span class="hljs-meta">ExcelFormat(<span class="hljs-string">"MMMM dd, yyyy"</span>)</span>]
    <span class="hljs-keyword">public</span> DateTime InDate { <span class="hljs-keyword">get</span>; <span class="hljs-keyword">set</span>; }
}
</code></pre>
<p>代码</p>
<pre><code class="language-csharp hljs"><span class="hljs-keyword">var</span> <span class="hljs-keyword">value</span> = <span class="hljs-keyword">new</span> Dto[] {
    <span class="hljs-keyword">new</span> Issue241Dto{ Name=<span class="hljs-string">"Jack"</span>,InDate=<span class="hljs-keyword">new</span> DateTime(<span class="hljs-number">2021</span>,<span class="hljs-number">01</span>,<span class="hljs-number">04</span>)},
    <span class="hljs-keyword">new</span> Issue241Dto{ Name=<span class="hljs-string">"Henry"</span>,InDate=<span class="hljs-keyword">new</span> DateTime(<span class="hljs-number">2020</span>,<span class="hljs-number">04</span>,<span class="hljs-number">05</span>)},
};
MiniExcel.SaveAs(path, <span class="hljs-keyword">value</span>);
</code></pre>
<p>结果</p>
<p><img src="https://user-images.githubusercontent.com/12729184/118910788-ab2bcd80-b957-11eb-8d42-bfce36621b1b.png" alt="image"></p>
<p>查询支持自定义格式转换</p>
<p><img src="https://user-images.githubusercontent.com/12729184/118911286-87b55280-b958-11eb-9a88-c8ff403d240a.png" alt="image"></p>
<h4>3. 设置列宽（ExcelColumnWidthAttribute）</h4>
<pre><code class="language-csharp hljs"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title">Dto</span>
{
    [<span class="hljs-meta">ExcelColumnWidth(20)</span>]
    <span class="hljs-keyword">public</span> <span class="hljs-built_in">int</span> ID { <span class="hljs-keyword">get</span>; <span class="hljs-keyword">set</span>; }
    [<span class="hljs-meta">ExcelColumnWidth(15.50)</span>]
    <span class="hljs-keyword">public</span> <span class="hljs-built_in">string</span> Name { <span class="hljs-keyword">get</span>; <span class="hljs-keyword">set</span>; }
}
</code></pre>
<h4>4. 多个列名映射到同一属性</h4>
<pre><code class="language-csharp hljs"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title">Dto</span>
{
    [<span class="hljs-meta">ExcelColumnName(excelColumnName:<span class="hljs-string">"EmployeeNo"</span>,aliases:new[</span>] { <span class="hljs-string">"EmpNo"</span>,<span class="hljs-string">"No"</span> })]
    <span class="hljs-keyword">public</span> <span class="hljs-built_in">string</span> Empno { <span class="hljs-keyword">get</span>; <span class="hljs-keyword">set</span>; }
    <span class="hljs-keyword">public</span> <span class="hljs-built_in">string</span> Name { <span class="hljs-keyword">get</span>; <span class="hljs-keyword">set</span>; }
}
</code></pre>
<h4>5. System.ComponentModel.DisplayNameAttribute = ExcelColumnName.excelColumnNameAttribute</h4>
<p>自1.24.0起，系统支持 System.ComponentModel.DisplayNameAttribute = ExcelColumnName.excelColumnNameAttribute</p>
<pre><code class="language-C# hljs language-C">public <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">TestIssueI4TXGTDto</span>
{</span>
    public <span class="hljs-type">int</span> ID { get; <span class="hljs-built_in">set</span>; }
    public <span class="hljs-built_in">string</span> Name { get; <span class="hljs-built_in">set</span>; }
    [DisplayName(<span class="hljs-string">"Specification"</span>)]
    public <span class="hljs-built_in">string</span> Spc { get; <span class="hljs-built_in">set</span>; }
    [DisplayName(<span class="hljs-string">"Unit Price"</span>)]
    public decimal Up { get; <span class="hljs-built_in">set</span>; }
}
</code></pre>
<h4>6. ExcelColumnAttribute</h4>
<p>自V1.26.0起，多个属性可以简化为如下方式：</p>
<pre><code class="language-csharp hljs">        <span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title">TestIssueI4ZYUUDto</span>
        {
            [<span class="hljs-meta">ExcelColumn(Name = <span class="hljs-string">"ID"</span>,Index =0)</span>]
            <span class="hljs-keyword">public</span> <span class="hljs-built_in">string</span> MyProperty { <span class="hljs-keyword">get</span>; <span class="hljs-keyword">set</span>; }
            [<span class="hljs-meta">ExcelColumn(Name = <span class="hljs-string">"CreateDate"</span>, Index = 1,Format =<span class="hljs-string">"yyyy-MM"</span>,Width =100)</span>]
            <span class="hljs-keyword">public</span> DateTime MyProperty2 { <span class="hljs-keyword">get</span>; <span class="hljs-keyword">set</span>; }
        }
</code></pre>
<h4>7. DynamicColumnAttribute</h4>
<p>自V1.26.0起，可以动态设置列的属性</p>
<pre><code class="language-csharp hljs">            <span class="hljs-keyword">var</span> config = <span class="hljs-keyword">new</span> OpenXmlConfiguration
            {
                DynamicColumns = <span class="hljs-keyword">new</span> DynamicExcelColumn[] {
                    <span class="hljs-keyword">new</span> DynamicExcelColumn(<span class="hljs-string">"id"</span>){Ignore=<span class="hljs-literal">true</span>},
                    <span class="hljs-keyword">new</span> DynamicExcelColumn(<span class="hljs-string">"name"</span>){Index=<span class="hljs-number">1</span>,Width=<span class="hljs-number">10</span>},
                    <span class="hljs-keyword">new</span> DynamicExcelColumn(<span class="hljs-string">"createdate"</span>){Index=<span class="hljs-number">0</span>,Format=<span class="hljs-string">"yyyy-MM-dd"</span>,Width=<span class="hljs-number">15</span>},
                    <span class="hljs-keyword">new</span> DynamicExcelColumn(<span class="hljs-string">"point"</span>){Index=<span class="hljs-number">2</span>,Name=<span class="hljs-string">"Account Point"</span>},
                }
            };
            <span class="hljs-keyword">var</span> path = PathHelper.GetTempPath();
            <span class="hljs-keyword">var</span> <span class="hljs-keyword">value</span> = <span class="hljs-keyword">new</span>[] { <span class="hljs-keyword">new</span> { id = <span class="hljs-number">1</span>, name = <span class="hljs-string">"Jack"</span>, createdate = <span class="hljs-keyword">new</span> DateTime(<span class="hljs-number">2022</span>, <span class="hljs-number">04</span>, <span class="hljs-number">12</span>) ,point = <span class="hljs-number">123.456</span>} };
            MiniExcel.SaveAs(path, <span class="hljs-keyword">value</span>, configuration: config);
</code></pre>
<p><img src="https://user-images.githubusercontent.com/12729184/164510353-5aecbc4e-c3ce-41e8-b6cf-afd55eb23b68.png" alt="image"></p>
<h4>8. DynamicSheetAttribute</h4>
<p>自V1.31.4起，可以动态设置Sheet的属性。可以设置Sheet名称和状态（可见性）。</p>
<pre><code class="language-csharp hljs">            <span class="hljs-keyword">var</span> configuration = <span class="hljs-keyword">new</span> OpenXmlConfiguration
            {
                DynamicSheets = <span class="hljs-keyword">new</span> DynamicExcelSheet[] {
                    <span class="hljs-keyword">new</span> DynamicExcelSheet(<span class="hljs-string">"usersSheet"</span>) { Name = <span class="hljs-string">"Users"</span>, State = SheetState.Visible },
                    <span class="hljs-keyword">new</span> DynamicExcelSheet(<span class="hljs-string">"departmentSheet"</span>) { Name = <span class="hljs-string">"Departments"</span>, State = SheetState.Hidden }
                }
            };

            <span class="hljs-keyword">var</span> users = <span class="hljs-keyword">new</span>[] { <span class="hljs-keyword">new</span> { Name = <span class="hljs-string">"Jack"</span>, Age = <span class="hljs-number">25</span> }, <span class="hljs-keyword">new</span> { Name = <span class="hljs-string">"Mike"</span>, Age = <span class="hljs-number">44</span> } };
            <span class="hljs-keyword">var</span> department = <span class="hljs-keyword">new</span>[] { <span class="hljs-keyword">new</span> { ID = <span class="hljs-string">"01"</span>, Name = <span class="hljs-string">"HR"</span> }, <span class="hljs-keyword">new</span> { ID = <span class="hljs-string">"02"</span>, Name = <span class="hljs-string">"IT"</span> } };
            <span class="hljs-keyword">var</span> sheets = <span class="hljs-keyword">new</span> Dictionary&lt;<span class="hljs-built_in">string</span>, <span class="hljs-built_in">object</span>&gt;
            {
                [<span class="hljs-string">"usersSheet"</span>] = users,
                [<span class="hljs-string">"departmentSheet"</span>] = department
            };

            <span class="hljs-keyword">var</span> path = PathHelper.GetTempPath();
            MiniExcel.SaveAs(path, sheets, configuration: configuration);
</code></pre>
<p>也可以使用新的属性 ExcelSheetAttribute：</p>
<pre><code class="language-C# hljs language-C">   [ExcelSheet(Name = <span class="hljs-string">"Departments"</span>, State = SheetState.Hidden)]
   private <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">DepartmentDto</span>
   {</span>
      [ExcelColumn(Name = <span class="hljs-string">"ID"</span>,Index = <span class="hljs-number">0</span>)]
      public <span class="hljs-built_in">string</span> ID { get; <span class="hljs-built_in">set</span>; }
      [ExcelColumn(Name = <span class="hljs-string">"Name"</span>,Index = <span class="hljs-number">1</span>)]
      public <span class="hljs-built_in">string</span> Name { get; <span class="hljs-built_in">set</span>; }
   }
</code></pre>
<h3>新增、删除、更新</h3>
<h4>新增</h4>
<p>v1.28.0 支持在 CSV 最后一行后插入N行数据</p>
<pre><code class="language-csharp hljs"><span class="hljs-comment">// 原始数据</span>
{
    <span class="hljs-keyword">var</span> <span class="hljs-keyword">value</span> = <span class="hljs-keyword">new</span>[] {
          <span class="hljs-keyword">new</span> { ID=<span class="hljs-number">1</span>,Name =<span class="hljs-string">"Jack"</span>,InDate=<span class="hljs-keyword">new</span> DateTime(<span class="hljs-number">2021</span>,<span class="hljs-number">01</span>,<span class="hljs-number">03</span>)},
          <span class="hljs-keyword">new</span> { ID=<span class="hljs-number">2</span>,Name =<span class="hljs-string">"Henry"</span>,InDate=<span class="hljs-keyword">new</span> DateTime(<span class="hljs-number">2020</span>,<span class="hljs-number">05</span>,<span class="hljs-number">03</span>)},
    };
    MiniExcel.SaveAs(path, <span class="hljs-keyword">value</span>);
}
<span class="hljs-comment">// 在最后插入1行</span>
{
    <span class="hljs-keyword">var</span> <span class="hljs-keyword">value</span> = <span class="hljs-keyword">new</span> { ID=<span class="hljs-number">3</span>,Name = <span class="hljs-string">"Mike"</span>, InDate = <span class="hljs-keyword">new</span> DateTime(<span class="hljs-number">2021</span>, <span class="hljs-number">04</span>, <span class="hljs-number">23</span>) };
    MiniExcel.Insert(path, <span class="hljs-keyword">value</span>);
}
<span class="hljs-comment">// 在最后插入N行</span>
{
    <span class="hljs-keyword">var</span> <span class="hljs-keyword">value</span> = <span class="hljs-keyword">new</span>[] {
          <span class="hljs-keyword">new</span> { ID=<span class="hljs-number">4</span>,Name =<span class="hljs-string">"Frank"</span>,InDate=<span class="hljs-keyword">new</span> DateTime(<span class="hljs-number">2021</span>,<span class="hljs-number">06</span>,<span class="hljs-number">07</span>)},
          <span class="hljs-keyword">new</span> { ID=<span class="hljs-number">5</span>,Name =<span class="hljs-string">"Gloria"</span>,InDate=<span class="hljs-keyword">new</span> DateTime(<span class="hljs-number">2022</span>,<span class="hljs-number">05</span>,<span class="hljs-number">03</span>)},
```csharp
};
MiniExcel.Insert(path, <span class="hljs-keyword">value</span>);
}
</code></pre>
<p><img src="https://user-images.githubusercontent.com/12729184/191023733-1e2fa732-db5c-4a3a-9722-b891fe5aa069.png" alt="image"></p>
<p>v1.37.0 支持向现有工作簿插入新工作表</p>
<pre><code class="language-csharp hljs"><span class="hljs-comment">// 原始 Excel</span>
{
    <span class="hljs-keyword">var</span> <span class="hljs-keyword">value</span> = <span class="hljs-keyword">new</span>[] {
          <span class="hljs-keyword">new</span> { ID=<span class="hljs-number">1</span>,Name =<span class="hljs-string">"Jack"</span>,InDate=<span class="hljs-keyword">new</span> DateTime(<span class="hljs-number">2021</span>,<span class="hljs-number">01</span>,<span class="hljs-number">03</span>)},
          <span class="hljs-keyword">new</span> { ID=<span class="hljs-number">2</span>,Name =<span class="hljs-string">"Henry"</span>,InDate=<span class="hljs-keyword">new</span> DateTime(<span class="hljs-number">2020</span>,<span class="hljs-number">05</span>,<span class="hljs-number">03</span>)},
    };
    MiniExcel.SaveAs(path, <span class="hljs-keyword">value</span>, sheetName: <span class="hljs-string">"Sheet1"</span>);
}
<span class="hljs-comment">// 插入新工作表</span>
{
    <span class="hljs-keyword">var</span> <span class="hljs-keyword">value</span> = <span class="hljs-keyword">new</span> { ID=<span class="hljs-number">3</span>,Name = <span class="hljs-string">"Mike"</span>, InDate = <span class="hljs-keyword">new</span> DateTime(<span class="hljs-number">2021</span>, <span class="hljs-number">04</span>, <span class="hljs-number">23</span>) };
    MiniExcel.Insert(path, table, sheetName: <span class="hljs-string">"Sheet2"</span>);
}
</code></pre>
<h4>删除（等待中）</h4>
<h4>更新（等待中）</h4>
<h3>Excel 类型自动检测 <a name="getstart5"></a></h3>
<ul>
<li>MiniExcel 默认会根据 <code>文件扩展名</code> 检测是 xlsx 还是 csv，但可能存在不准确的情况，请手动指定。</li>
<li>流无法判断属于哪种 excel，请手动指定。</li>
</ul>
<pre><code class="language-csharp hljs">stream.SaveAs(excelType:ExcelType.CSV);
<span class="hljs-comment">//或</span>
stream.SaveAs(excelType:ExcelType.XLSX);
<span class="hljs-comment">//或</span>
stream.Query(excelType:ExcelType.CSV);
<span class="hljs-comment">//或</span>
stream.Query(excelType:ExcelType.XLSX);
</code></pre>
<h3>CSV</h3>
<h4>注意</h4>
<ul>
<li>默认返回 <code>string</code> 类型，除非通过强类型泛型定义类型，否则不会将值转换为数字或日期时间类型。</li>
</ul>
<h4>自定义分隔符</h4>
<p>默认分隔符为 <code>,</code>，可以通过修改 <code>Seperator</code> 属性自定义</p>
<pre><code class="language-csharp hljs"><span class="hljs-keyword">var</span> config = <span class="hljs-keyword">new</span> MiniExcelLibs.Csv.CsvConfiguration()
{
    Seperator=<span class="hljs-string">';'</span>
};
MiniExcel.SaveAs(path, values,configuration: config);
</code></pre>
<p>自 V1.30.1 起支持自定义分隔符函数（感谢 @hyzx86）</p>
<pre><code class="language-csharp hljs"><span class="hljs-keyword">var</span> config = <span class="hljs-keyword">new</span> CsvConfiguration()
{
    SplitFn = (row) =&gt; Regex.Split(row, <span class="hljs-string">$"[\t,](?=(?:[^\"]|\"[^\"]*\")*$)"</span>)
        .Select(s =&gt; Regex.Replace(s.Replace(<span class="hljs-string">"\"\""</span>, <span class="hljs-string">"\""</span>), <span class="hljs-string">"^\"|\"$"</span>, <span class="hljs-string">""</span>)).ToArray()
};
<span class="hljs-keyword">var</span> rows = MiniExcel.Query(path, configuration: config).ToList();
</code></pre>
<h4>自定义换行符</h4>
<p>默认换行符为 <code>\r\n</code>，可以通过修改 <code>NewLine</code> 属性自定义</p>
<pre><code class="language-csharp hljs"><span class="hljs-keyword">var</span> config = <span class="hljs-keyword">new</span> MiniExcelLibs.Csv.CsvConfiguration()
{
    NewLine=<span class="hljs-string">'\n'</span>
};
MiniExcel.SaveAs(path, values,configuration: config);
</code></pre>
<h4>自定义编码</h4>
<ul>
<li>默认编码为 "Detect Encoding From Byte Order Marks"  (detectEncodingFromByteOrderMarks: true)</li>
<li>如果有自定义编码需求，请修改 StreamReaderFunc / StreamWriterFunc 属性</li>
</ul>
<pre><code class="language-csharp hljs"><span class="hljs-comment">// 读取</span>
<span class="hljs-keyword">var</span> config = <span class="hljs-keyword">new</span> MiniExcelLibs.Csv.CsvConfiguration()
{
    StreamReaderFunc = (stream) =&gt; <span class="hljs-keyword">new</span> StreamReader(stream,Encoding.GetEncoding(<span class="hljs-string">"gb2312"</span>))
};
<span class="hljs-keyword">var</span> rows = MiniExcel.Query(path, <span class="hljs-literal">true</span>,excelType:ExcelType.CSV,configuration: config);

<span class="hljs-comment">// 写入</span>
<span class="hljs-keyword">var</span> config = <span class="hljs-keyword">new</span> MiniExcelLibs.Csv.CsvConfiguration()
{
    StreamWriterFunc = (stream) =&gt; <span class="hljs-keyword">new</span> StreamWriter(stream, Encoding.GetEncoding(<span class="hljs-string">"gb2312"</span>))
};
MiniExcel.SaveAs(path, <span class="hljs-keyword">value</span>,excelType:ExcelType.CSV, configuration: config);
</code></pre>
<h4>读取空字符串为 null</h4>
<p>默认情况下，空值会映射为 string.Empty。你可以修改这一行为</p>
<pre><code class="language-csharp hljs"><span class="hljs-keyword">var</span> config = <span class="hljs-keyword">new</span> MiniExcelLibs.Csv.CsvConfiguration()
{
   ReadEmptyStringAsNull = <span class="hljs-literal">true</span>
};
</code></pre>
<h3>DataReader</h3>
<h4>1. GetReader</h4>
<p>自 1.23.0 起，可以使用 GetDataReader</p>
<pre><code class="language-csharp hljs">    <span class="hljs-keyword">using</span> (<span class="hljs-keyword">var</span> reader = MiniExcel.GetReader(path,<span class="hljs-literal">true</span>))
    {
        <span class="hljs-keyword">while</span> (reader.Read())
        {
            <span class="hljs-keyword">for</span> (<span class="hljs-built_in">int</span> i = <span class="hljs-number">0</span>; i &lt; reader.FieldCount; i++)
            {
                <span class="hljs-keyword">var</span> <span class="hljs-keyword">value</span> = reader.GetValue(i);
            }
        }
    }
</code></pre>
<h3>异步</h3>
<ul>
<li>v0.17.0 支持异步（感谢 isdaniel ( SHIH,BING-SIOU)](<a href="https://github.com/isdaniel">https://github.com/isdaniel</a>))</li>
</ul>
<pre><code class="language-csharp hljs"><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> Task <span class="hljs-title">SaveAsAsync</span>(<span class="hljs-params"><span class="hljs-built_in">string</span> path, <span class="hljs-built_in">object</span> <span class="hljs-keyword">value</span>, <span class="hljs-built_in">bool</span> printHeader = <span class="hljs-literal">true</span>, <span class="hljs-built_in">string</span> sheetName = <span class="hljs-string">"Sheet1"</span>, ExcelType excelType = ExcelType.UNKNOWN, IConfiguration configuration = <span class="hljs-literal">null</span></span>)
<span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> Task <span class="hljs-title">SaveAsAsync</span>(<span class="hljs-params"><span class="hljs-keyword">this</span> Stream stream, <span class="hljs-built_in">object</span> <span class="hljs-keyword">value</span>, <span class="hljs-built_in">bool</span> printHeader = <span class="hljs-literal">true</span>, <span class="hljs-built_in">string</span> sheetName = <span class="hljs-string">"Sheet1"</span>, ExcelType excelType = ExcelType.XLSX, IConfiguration configuration = <span class="hljs-literal">null</span></span>)
<span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> Task&lt;IEnumerable&lt;<span class="hljs-built_in">dynamic</span>&gt;&gt; <span class="hljs-title">QueryAsync</span>(<span class="hljs-params"><span class="hljs-built_in">string</span> path, <span class="hljs-built_in">bool</span> useHeaderRow = <span class="hljs-literal">false</span>, <span class="hljs-built_in">string</span> sheetName = <span class="hljs-literal">null</span>, ExcelType excelType = ExcelType.UNKNOWN, <span class="hljs-built_in">string</span> startCell = <span class="hljs-string">"A1"</span>, IConfiguration configuration = <span class="hljs-literal">null</span></span>)
<span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-title">Task</span>&lt;<span class="hljs-title">IEnumerable</span>&lt;<span class="hljs-title">T</span>&gt;&gt; <span class="hljs-title">QueryAsync</span>&lt;<span class="hljs-title">T</span>&gt;(<span class="hljs-params"><span class="hljs-keyword">this</span> Stream stream, <span class="hljs-built_in">string</span> sheetName = <span class="hljs-literal">null</span>, ExcelType excelType = ExcelType.UNKNOWN, <span class="hljs-built_in">string</span> startCell = <span class="hljs-string">"A1"</span>, IConfiguration configuration = <span class="hljs-literal">null</span></span>) <span class="hljs-keyword">where</span> T : <span class="hljs-keyword">class</span>, <span class="hljs-keyword">new</span>()
<span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-title">Task</span>&lt;<span class="hljs-title">IEnumerable</span>&lt;<span class="hljs-title">T</span>&gt;&gt; <span class="hljs-title">QueryAsync</span>&lt;<span class="hljs-title">T</span>&gt;(<span class="hljs-params"><span class="hljs-built_in">string</span> path, <span class="hljs-built_in">string</span> sheetName = <span class="hljs-literal">null</span>, ExcelType excelType = ExcelType.UNKNOWN, <span class="hljs-built_in">string</span> startCell = <span class="hljs-string">"A1"</span>, IConfiguration configuration = <span class="hljs-literal">null</span></span>) <span class="hljs-keyword">where</span> T : <span class="hljs-keyword">class</span>, <span class="hljs-keyword">new</span>()
<span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> Task&lt;IEnumerable&lt;IDictionary&lt;<span class="hljs-built_in">string</span>, <span class="hljs-built_in">object</span>&gt;&gt;&gt; <span class="hljs-title">QueryAsync</span>(<span class="hljs-params"><span class="hljs-keyword">this</span> Stream stream, <span class="hljs-built_in">bool</span> useHeaderRow = <span class="hljs-literal">false</span>, <span class="hljs-built_in">string</span> sheetName = <span class="hljs-literal">null</span>, ExcelType excelType = ExcelType.UNKNOWN, <span class="hljs-built_in">string</span> startCell = <span class="hljs-string">"A1"</span>, IConfiguration configuration = <span class="hljs-literal">null</span></span>)
<span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> Task <span class="hljs-title">SaveAsByTemplateAsync</span>(<span class="hljs-params"><span class="hljs-keyword">this</span> Stream stream, <span class="hljs-built_in">string</span> templatePath, <span class="hljs-built_in">object</span> <span class="hljs-keyword">value</span></span>)
<span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> Task <span class="hljs-title">SaveAsByTemplateAsync</span>(<span class="hljs-params"><span class="hljs-keyword">this</span> Stream stream, <span class="hljs-built_in">byte</span>[] templateBytes, <span class="hljs-built_in">object</span> <span class="hljs-keyword">value</span></span>)
<span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> Task <span class="hljs-title">SaveAsByTemplateAsync</span>(<span class="hljs-params"><span class="hljs-built_in">string</span> path, <span class="hljs-built_in">string</span> templatePath, <span class="hljs-built_in">object</span> <span class="hljs-keyword">value</span></span>)
<span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> Task <span class="hljs-title">SaveAsByTemplateAsync</span>(<span class="hljs-params"><span class="hljs-built_in">string</span> path, <span class="hljs-built_in">byte</span>[] templateBytes, <span class="hljs-built_in">object</span> <span class="hljs-keyword">value</span></span>)
<span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> Task&lt;DataTable&gt; <span class="hljs-title">QueryAsDataTableAsync</span>(<span class="hljs-params"><span class="hljs-built_in">string</span> path, <span class="hljs-built_in">bool</span> useHeaderRow = <span class="hljs-literal">true</span>, <span class="hljs-built_in">string</span> sheetName = <span class="hljs-literal">null</span>, ExcelType excelType = ExcelType.UNKNOWN, <span class="hljs-built_in">string</span> startCell = <span class="hljs-string">"A1"</span>, IConfiguration configuration = <span class="hljs-literal">null</span></span>)
</span></code></pre>
<ul>
<li>v1.25.0 支持 <code>cancellationToken</code>。</li>
</ul>
<h3>其它</h3>
<h4>1. 枚举</h4>
<p>请确保 excel 列名和属性名一致，系统会自动映射（不区分大小写）</p>
<p><img src="https://user-images.githubusercontent.com/12729184/116210595-9784b100-a775-11eb-936f-8e7a8b435961.png" alt="image"></p>
<p>自 V0.18.0 起支持枚举 Description</p>
<pre><code class="language-csharp hljs"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title">Dto</span>
{
    <span class="hljs-keyword">public</span> <span class="hljs-built_in">string</span> Name { <span class="hljs-keyword">get</span>; <span class="hljs-keyword">set</span>; }
    <span class="hljs-keyword">public</span> I49RYZUserType UserType { <span class="hljs-keyword">get</span>; <span class="hljs-keyword">set</span>; }
}

<span class="hljs-keyword">public</span> <span class="hljs-built_in">enum</span> Type
{
    [<span class="hljs-meta">Description(<span class="hljs-string">"普通用户"</span>)</span>]
    V1,
    [<span class="hljs-meta">Description(<span class="hljs-string">"普通管理员"</span>)</span>]
    V2,
    [<span class="hljs-meta">Description(<span class="hljs-string">"超级管理员"</span>)</span>]
    V3
}
</code></pre>
<pre><code class="hljs language-less">
!<span class="hljs-selector-attr">[image]</span>(<span class="hljs-attribute">https</span>:<span class="hljs-comment">//user-images.githubusercontent.com/12729184/133116630-27cc7161-099a-48b8-9784-cd1e443af3d1.png)</span>

自 <span class="hljs-number">1.30</span>.<span class="hljs-number">0</span> 版本起支持将 Excel 的 Description 映射到枚举类型，感谢 <span class="hljs-variable">@KaneLeung</span>

#### <span class="hljs-number">2</span>. CSV 与 XLSX 的互转

<span class="hljs-built_in">``</span>`csharp
MiniExcel.<span class="hljs-built_in">ConvertXlsxToCsv</span>(xlsxPath, csvPath);
MiniExcel.<span class="hljs-built_in">ConvertXlsxToCsv</span>(xlsxStream, csvStream);
MiniExcel.<span class="hljs-built_in">ConvertCsvToXlsx</span>(csvPath, xlsxPath);
MiniExcel.<span class="hljs-built_in">ConvertCsvToXlsx</span>(csvStream, xlsxStream);
</code></pre>
<pre><code class="language-csharp hljs"><span class="hljs-keyword">using</span> (<span class="hljs-keyword">var</span> excelStream = <span class="hljs-keyword">new</span> FileStream(path: filePath, FileMode.Open, FileAccess.Read))
<span class="hljs-keyword">using</span> (<span class="hljs-keyword">var</span> csvStream = <span class="hljs-keyword">new</span> MemoryStream())
{
   MiniExcel.ConvertXlsxToCsv(excelStream, csvStream);
}
</code></pre>
<h4>3. 自定义 CultureInfo</h4>
<p>自 1.22.0 起，您可以像下面这样自定义 CultureInfo，系统默认使用 <code>CultureInfo.InvariantCulture</code>。</p>
<pre><code class="language-csharp hljs"><span class="hljs-keyword">var</span> config = <span class="hljs-keyword">new</span> CsvConfiguration()
{
    Culture = <span class="hljs-keyword">new</span> CultureInfo(<span class="hljs-string">"fr-FR"</span>),
};
MiniExcel.SaveAs(path, <span class="hljs-keyword">value</span>, configuration: config);

<span class="hljs-comment">// 或者</span>
MiniExcel.Query(path, configuration: config);
</code></pre>
<h4>4. 自定义缓冲区大小</h4>
<pre><code class="language-csharp hljs">    <span class="hljs-keyword">public</span> <span class="hljs-keyword">abstract</span> <span class="hljs-keyword">class</span> <span class="hljs-title">Configuration</span> : <span class="hljs-title">IConfiguration</span>
    {
        <span class="hljs-keyword">public</span> <span class="hljs-built_in">int</span> BufferSize { <span class="hljs-keyword">get</span>; <span class="hljs-keyword">set</span>; } = <span class="hljs-number">1024</span> * <span class="hljs-number">512</span>;
    }
</code></pre>
<h4>5. FastMode（极速模式）</h4>
<p>系统不会控制内存，但可以获得更快的保存速度。</p>
<pre><code class="language-csharp hljs"><span class="hljs-keyword">var</span> config = <span class="hljs-keyword">new</span> OpenXmlConfiguration() { FastMode = <span class="hljs-literal">true</span> };
MiniExcel.SaveAs(path, reader,configuration:config);
</code></pre>
<h4>6. 批量添加图片（MiniExcel.AddPicture）</h4>
<pre><code class="language-csharp hljs"><span class="hljs-keyword">var</span> images = <span class="hljs-keyword">new</span>[]
{
    <span class="hljs-keyword">new</span> MiniExcelPicture
    {
        ImageBytes = File.ReadAllBytes(PathHelper.GetFile(<span class="hljs-string">"images/github_logo.png"</span>)),
        SheetName = <span class="hljs-literal">null</span>, <span class="hljs-comment">// 默认为 null，即第一个工作表</span>
        CellAddress = <span class="hljs-string">"C3"</span>, <span class="hljs-comment">// 必填</span>
    },
    <span class="hljs-keyword">new</span> MiniExcelPicture
    {
        ImageBytes = File.ReadAllBytes(PathHelper.GetFile(<span class="hljs-string">"images/google_logo.png"</span>)),
        PictureType = <span class="hljs-string">"image/png"</span>, <span class="hljs-comment">// 默认 PictureType = image/png</span>
        SheetName = <span class="hljs-string">"Demo"</span>,
        CellAddress = <span class="hljs-string">"C9"</span>, <span class="hljs-comment">// 必填</span>
        WidthPx = <span class="hljs-number">100</span>,
        HeightPx = <span class="hljs-number">100</span>,
    },
};
MiniExcel.AddPicture(path, images);
</code></pre>
<p><img src="https://github.com/user-attachments/assets/19c4d241-9753-4ede-96c8-f810c1a22247" alt="Image"></p>
<h4>7. 获取工作表范围</h4>
<pre><code class="language-csharp hljs"><span class="hljs-keyword">var</span> dim = MiniExcel.GetSheetDimensions(path);
</code></pre>
<h3>示例：</h3>
<h4>1. SQLite &amp; Dapper <code>大文件</code> SQL 插入避免 OOM</h4>
<p>注意：请不要在 Query 之后调用 ToList/ToArray 方法，否则会将所有数据加载到内存中</p>
<pre><code class="language-csharp hljs"><span class="hljs-keyword">using</span> (<span class="hljs-keyword">var</span> connection = <span class="hljs-keyword">new</span> SQLiteConnection(connectionString))
{
    connection.Open();
    <span class="hljs-keyword">using</span> (<span class="hljs-keyword">var</span> transaction = connection.BeginTransaction())
    <span class="hljs-keyword">using</span> (<span class="hljs-keyword">var</span> stream = File.OpenRead(path))
    {
       <span class="hljs-keyword">var</span> rows = stream.Query();
       <span class="hljs-keyword">foreach</span> (<span class="hljs-keyword">var</span> row <span class="hljs-keyword">in</span> rows)
             connection.Execute(<span class="hljs-string">"insert into T (A,B) values (@A,@B)"</span>, <span class="hljs-keyword">new</span> { row.A, row.B }, transaction: transaction);
       transaction.Commit();
    }
}
</code></pre>
<p>性能表现：<br><img src="https://user-images.githubusercontent.com/12729184/111072579-2dda7b80-8516-11eb-9843-c01a1edc88ec.png" alt="image"></p>
<h4>2. ASP.NET Core 3.1 或 MVC 5 下载/上传 Excel Xlsx API 示例 <a href="tests/MiniExcel.Tests.AspNetCore">在线体验</a></h4>
<pre><code class="language-csharp hljs"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title">ApiController</span> : <span class="hljs-title">Controller</span>
{
    <span class="hljs-function"><span class="hljs-keyword">public</span> IActionResult <span class="hljs-title">Index</span>()</span>
    {
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> ContentResult
        {
            ContentType = <span class="hljs-string">"text/html"</span>,
            StatusCode = (<span class="hljs-built_in">int</span>)HttpStatusCode.OK,
            Content = <span class="hljs-string">@"&lt;html&gt;&lt;body&gt;
&lt;a href='api/DownloadExcel'&gt;DownloadExcel&lt;/a&gt;&lt;br&gt;
&lt;a href='api/DownloadExcelFromTemplatePath'&gt;DownloadExcelFromTemplatePath&lt;/a&gt;&lt;br&gt;
&lt;a href='api/DownloadExcelFromTemplateBytes'&gt;DownloadExcelFromTemplateBytes&lt;/a&gt;&lt;br&gt;
&lt;p&gt;Upload Excel&lt;/p&gt;
&lt;form method='post' enctype='multipart/form-data' action='/api/uploadexcel'&gt;
    &lt;input type='file' name='excel'&gt; &lt;br&gt;
    &lt;input type='submit' &gt;
&lt;/form&gt;
&lt;/body&gt;&lt;/html&gt;"</span>
        };
    }

    <span class="hljs-function"><span class="hljs-keyword">public</span> IActionResult <span class="hljs-title">DownloadExcel</span>()</span>
    {
        <span class="hljs-keyword">var</span> values = <span class="hljs-keyword">new</span>[] {
            <span class="hljs-keyword">new</span> { Column1 = <span class="hljs-string">"MiniExcel"</span>, Column2 = <span class="hljs-number">1</span> },
            <span class="hljs-keyword">new</span> { Column1 = <span class="hljs-string">"Github"</span>, Column2 = <span class="hljs-number">2</span>}
        };
        <span class="hljs-keyword">var</span> memoryStream = <span class="hljs-keyword">new</span> MemoryStream();
        memoryStream.SaveAs(values);
        memoryStream.Seek(<span class="hljs-number">0</span>, SeekOrigin.Begin);
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> FileStreamResult(memoryStream, <span class="hljs-string">"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"</span>)
        {
            FileDownloadName = <span class="hljs-string">"demo.xlsx"</span>
        };
    }

    <span class="hljs-function"><span class="hljs-keyword">public</span> IActionResult <span class="hljs-title">DownloadExcelFromTemplatePath</span>()</span>
    {
        <span class="hljs-built_in">string</span> templatePath = <span class="hljs-string">"TestTemplateComplex.xlsx"</span>;

        Dictionary&lt;<span class="hljs-built_in">string</span>, <span class="hljs-built_in">object</span>&gt; <span class="hljs-keyword">value</span> = <span class="hljs-keyword">new</span> Dictionary&lt;<span class="hljs-built_in">string</span>, <span class="hljs-built_in">object</span>&gt;()
        {
            [<span class="hljs-string">"title"</span>] = <span class="hljs-string">"FooCompany"</span>,
            [<span class="hljs-string">"managers"</span>] = <span class="hljs-keyword">new</span>[] {
                <span class="hljs-keyword">new</span> {name=<span class="hljs-string">"Jack"</span>,department=<span class="hljs-string">"HR"</span>},
                <span class="hljs-keyword">new</span> {name=<span class="hljs-string">"Loan"</span>,department=<span class="hljs-string">"IT"</span>}
            },
            [<span class="hljs-string">"employees"</span>] = <span class="hljs-keyword">new</span>[] {
                <span class="hljs-keyword">new</span> {name=<span class="hljs-string">"Wade"</span>,department=<span class="hljs-string">"HR"</span>},
                <span class="hljs-keyword">new</span> {name=<span class="hljs-string">"Felix"</span>,department=<span class="hljs-string">"HR"</span>},
                <span class="hljs-keyword">new</span> {name=<span class="hljs-string">"Eric"</span>,department=<span class="hljs-string">"IT"</span>},
                <span class="hljs-keyword">new</span> {name=<span class="hljs-string">"Keaton"</span>,department=<span class="hljs-string">"IT"</span>}
            }
        };

        MemoryStream memoryStream = <span class="hljs-keyword">new</span> MemoryStream();
        memoryStream.SaveAsByTemplate(templatePath, <span class="hljs-keyword">value</span>);
        memoryStream.Seek(<span class="hljs-number">0</span>, SeekOrigin.Begin);
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> FileStreamResult(memoryStream, <span class="hljs-string">"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"</span>)
        {
            FileDownloadName = <span class="hljs-string">"demo.xlsx"</span>
        };
    }

    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> Dictionary&lt;<span class="hljs-built_in">string</span>, Byte[]&gt; TemplateBytesCache = <span class="hljs-keyword">new</span> Dictionary&lt;<span class="hljs-built_in">string</span>, <span class="hljs-built_in">byte</span>[]&gt;();

    <span class="hljs-function"><span class="hljs-keyword">static</span> <span class="hljs-title">ApiController</span>()</span>
    {
        <span class="hljs-built_in">string</span> templatePath = <span class="hljs-string">"TestTemplateComplex.xlsx"</span>;
        <span class="hljs-built_in">byte</span>[] bytes = System.IO.File.ReadAllBytes(templatePath);
        TemplateBytesCache.Add(templatePath, bytes);
    }

    <span class="hljs-function"><span class="hljs-keyword">public</span> IActionResult <span class="hljs-title">DownloadExcelFromTemplateBytes</span>()</span>
    {
        <span class="hljs-built_in">byte</span>[] bytes = TemplateBytesCache[<span class="hljs-string">"TestTemplateComplex.xlsx"</span>];

        Dictionary&lt;<span class="hljs-built_in">string</span>, <span class="hljs-built_in">object</span>&gt; <span class="hljs-keyword">value</span> = <span class="hljs-keyword">new</span> Dictionary&lt;<span class="hljs-built_in">string</span>, <span class="hljs-built_in">object</span>&gt;()
        {
            [<span class="hljs-string">"title"</span>] = <span class="hljs-string">"FooCompany"</span>,
            [<span class="hljs-string">"managers"</span>] = <span class="hljs-keyword">new</span>[] {
                <span class="hljs-keyword">new</span> {name=<span class="hljs-string">"Jack"</span>,department=<span class="hljs-string">"HR"</span>},
                <span class="hljs-keyword">new</span> {name=<span class="hljs-string">"Loan"</span>,department=<span class="hljs-string">"IT"</span>}
</code></pre>
<pre><code class="language-csharp hljs">            },
            [<span class="hljs-string">"employees"</span>] = <span class="hljs-keyword">new</span>[] {
                <span class="hljs-keyword">new</span> {name=<span class="hljs-string">"Wade"</span>,department=<span class="hljs-string">"HR"</span>},
                <span class="hljs-keyword">new</span> {name=<span class="hljs-string">"Felix"</span>,department=<span class="hljs-string">"HR"</span>},
                <span class="hljs-keyword">new</span> {name=<span class="hljs-string">"Eric"</span>,department=<span class="hljs-string">"IT"</span>},
                <span class="hljs-keyword">new</span> {name=<span class="hljs-string">"Keaton"</span>,department=<span class="hljs-string">"IT"</span>}
            }
        };

        MemoryStream memoryStream = <span class="hljs-keyword">new</span> MemoryStream();
        memoryStream.SaveAsByTemplate(bytes, <span class="hljs-keyword">value</span>);
        memoryStream.Seek(<span class="hljs-number">0</span>, SeekOrigin.Begin);
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> FileStreamResult(memoryStream, <span class="hljs-string">"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"</span>)
        {
            FileDownloadName = <span class="hljs-string">"demo.xlsx"</span>
        };
    }

    <span class="hljs-function"><span class="hljs-keyword">public</span> IActionResult <span class="hljs-title">UploadExcel</span>(<span class="hljs-params">IFormFile excel</span>)</span>
    {
        <span class="hljs-keyword">var</span> stream = <span class="hljs-keyword">new</span> MemoryStream();
        excel.CopyTo(stream);

        <span class="hljs-keyword">foreach</span> (<span class="hljs-keyword">var</span> item <span class="hljs-keyword">in</span> stream.Query(<span class="hljs-literal">true</span>))
        {
            <span class="hljs-comment">// do your logic etc.</span>
        }

        <span class="hljs-keyword">return</span> Ok(<span class="hljs-string">"File uploaded successfully"</span>);
    }
}
</code></pre>
<h4>3. 分页查询</h4>
<pre><code class="language-csharp hljs"><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">Main</span>()</span>
{
    <span class="hljs-keyword">var</span> rows = MiniExcel.Query(path);

    Console.WriteLine(<span class="hljs-string">"==== 第1页 ===="</span>);
    Console.WriteLine(Page(rows,pageSize:<span class="hljs-number">3</span>,page:<span class="hljs-number">1</span>));
    Console.WriteLine(<span class="hljs-string">"==== 第50页 ===="</span>);
    Console.WriteLine(Page(rows,pageSize:<span class="hljs-number">3</span>,page:<span class="hljs-number">50</span>));
    Console.WriteLine(<span class="hljs-string">"==== 第5000页 ===="</span>);
    Console.WriteLine(Page(rows,pageSize:<span class="hljs-number">3</span>,page:<span class="hljs-number">5000</span>));
}

<span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-title">IEnumerable</span>&lt;<span class="hljs-title">T</span>&gt; <span class="hljs-title">Page</span>&lt;<span class="hljs-title">T</span>&gt;(<span class="hljs-params">IEnumerable&lt;T&gt; en, <span class="hljs-built_in">int</span> pageSize, <span class="hljs-built_in">int</span> page</span>)</span>
{
    <span class="hljs-keyword">return</span> en.Skip(page * pageSize).Take(pageSize);
}
</code></pre>
<p><img src="https://user-images.githubusercontent.com/12729184/114679083-6ef4c400-9d3e-11eb-9f78-a86daa45fe46.gif" alt="20210419"></p>
<h4>4. WebForm 通过 memorystream 导出 Excel</h4>
<pre><code class="language-csharp hljs"><span class="hljs-keyword">var</span> fileName = <span class="hljs-string">"Demo.xlsx"</span>;
<span class="hljs-keyword">var</span> sheetName = <span class="hljs-string">"Sheet1"</span>;
HttpResponse response = HttpContext.Current.Response;
response.Clear();
response.ContentType = <span class="hljs-string">"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"</span>;
response.AddHeader(<span class="hljs-string">"Content-Disposition"</span>, <span class="hljs-string">$"attachment;filename=\"<span class="hljs-subst">{fileName}</span>\""</span>);
<span class="hljs-keyword">var</span> values = <span class="hljs-keyword">new</span>[] {
    <span class="hljs-keyword">new</span> { Column1 = <span class="hljs-string">"MiniExcel"</span>, Column2 = <span class="hljs-number">1</span> },
    <span class="hljs-keyword">new</span> { Column1 = <span class="hljs-string">"Github"</span>, Column2 = <span class="hljs-number">2</span>}
};
<span class="hljs-keyword">var</span> memoryStream = <span class="hljs-keyword">new</span> MemoryStream();
memoryStream.SaveAs(values, sheetName: sheetName);
memoryStream.Seek(<span class="hljs-number">0</span>, SeekOrigin.Begin);
memoryStream.CopyTo(Response.OutputStream);
response.End();
</code></pre>
<h4>5. 动态多语言（i18n）与角色权限管理</h4>
<p>如示例，创建方法来处理多语言和权限管理，并使用 <code>yield return</code> 返回 IEnumerable&lt;Dictionary&lt;string, object&gt;&gt;，以实现动态和低内存处理效果</p>
<pre><code class="language-csharp hljs"><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">Main</span>()</span>
{
    <span class="hljs-keyword">var</span> <span class="hljs-keyword">value</span> = <span class="hljs-keyword">new</span> Order[] {
        <span class="hljs-keyword">new</span> Order(){OrderNo = <span class="hljs-string">"SO01"</span>,CustomerID=<span class="hljs-string">"C001"</span>,ProductID=<span class="hljs-string">"P001"</span>,Qty=<span class="hljs-number">100</span>,Amt=<span class="hljs-number">500</span>},
        <span class="hljs-keyword">new</span> Order(){OrderNo = <span class="hljs-string">"SO02"</span>,CustomerID=<span class="hljs-string">"C002"</span>,ProductID=<span class="hljs-string">"P002"</span>,Qty=<span class="hljs-number">300</span>,Amt=<span class="hljs-number">400</span>},
    };

    Console.WriteLine(<span class="hljs-string">"en-Us 及 Sales 角色"</span>);
    {
        <span class="hljs-keyword">var</span> path = Path.GetTempPath() + Guid.NewGuid() + <span class="hljs-string">".xlsx"</span>;
        <span class="hljs-keyword">var</span> lang = <span class="hljs-string">"en-US"</span>;
        <span class="hljs-keyword">var</span> role = <span class="hljs-string">"Sales"</span>;
        MiniExcel.SaveAs(path, GetOrders(lang, role, <span class="hljs-keyword">value</span>));
        MiniExcel.Query(path, <span class="hljs-literal">true</span>).Dump();
    }

    Console.WriteLine(<span class="hljs-string">"zh-CN 及 PMC 角色"</span>);
    {
        <span class="hljs-keyword">var</span> path = Path.GetTempPath() + Guid.NewGuid() + <span class="hljs-string">".xlsx"</span>;
        <span class="hljs-keyword">var</span> lang = <span class="hljs-string">"zh-CN"</span>;
        <span class="hljs-keyword">var</span> role = <span class="hljs-string">"PMC"</span>;
        MiniExcel.SaveAs(path, GetOrders(lang, role, <span class="hljs-keyword">value</span>));
        MiniExcel.Query(path, <span class="hljs-literal">true</span>).Dump();
    }
}

<span class="hljs-keyword">private</span> IEnumerable&lt;Dictionary&lt;<span class="hljs-built_in">string</span>, <span class="hljs-built_in">object</span>&gt;&gt; GetOrders(<span class="hljs-built_in">string</span> lang, <span class="hljs-built_in">string</span> role, Order[] orders)
{
    <span class="hljs-keyword">foreach</span> (<span class="hljs-keyword">var</span> order <span class="hljs-keyword">in</span> orders)
    {
        <span class="hljs-keyword">var</span> newOrder = <span class="hljs-keyword">new</span> Dictionary&lt;<span class="hljs-built_in">string</span>, <span class="hljs-built_in">object</span>&gt;();

        <span class="hljs-keyword">if</span> (lang == <span class="hljs-string">"zh-CN"</span>)
        {
            newOrder.Add(<span class="hljs-string">"客户编号"</span>, order.CustomerID);
            newOrder.Add(<span class="hljs-string">"订单编号"</span>, order.OrderNo);
            newOrder.Add(<span class="hljs-string">"产品编号"</span>, order.ProductID);
            newOrder.Add(<span class="hljs-string">"数量"</span>, order.Qty);
            <span class="hljs-keyword">if</span> (role == <span class="hljs-string">"Sales"</span>)
                newOrder.Add(<span class="hljs-string">"价格"</span>, order.Amt);
            <span class="hljs-keyword">yield</span> <span class="hljs-keyword">return</span> newOrder;
        }
        <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (lang == <span class="hljs-string">"en-US"</span>)
        {
            newOrder.Add(<span class="hljs-string">"Customer ID"</span>, order.CustomerID);
            newOrder.Add(<span class="hljs-string">"Order No"</span>, order.OrderNo);
            newOrder.Add(<span class="hljs-string">"Product ID"</span>, order.ProductID);
            newOrder.Add(<span class="hljs-string">"Quantity"</span>, order.Qty);
            <span class="hljs-keyword">if</span> (role == <span class="hljs-string">"Sales"</span>)
                newOrder.Add(<span class="hljs-string">"Amount"</span>, order.Amt);
            <span class="hljs-keyword">yield</span> <span class="hljs-keyword">return</span> newOrder;
        }
        <span class="hljs-keyword">else</span>
        {
            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> InvalidDataException(<span class="hljs-string">$"lang <span class="hljs-subst">{lang}</span> wrong"</span>);
        }
    }
}

<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title">Order</span>
{
    <span class="hljs-keyword">public</span> <span class="hljs-built_in">string</span> OrderNo { <span class="hljs-keyword">get</span>; <span class="hljs-keyword">set</span>; }
    <span class="hljs-keyword">public</span> <span class="hljs-built_in">string</span> CustomerID { <span class="hljs-keyword">get</span>; <span class="hljs-keyword">set</span>; }
    <span class="hljs-keyword">public</span> <span class="hljs-built_in">decimal</span> Qty { <span class="hljs-keyword">get</span>; <span class="hljs-keyword">set</span>; }
    <span class="hljs-keyword">public</span> <span class="hljs-built_in">string</span> ProductID { <span class="hljs-keyword">get</span>; <span class="hljs-keyword">set</span>; }
    <span class="hljs-keyword">public</span> <span class="hljs-built_in">decimal</span> Amt { <span class="hljs-keyword">get</span>; <span class="hljs-keyword">set</span>; }
}
</code></pre>
<p><img src="https://user-images.githubusercontent.com/12729184/118939964-d24bc480-b982-11eb-88dd-f06655f6121a.png" alt="image"></p>
<h3>常见问题</h3>
<h4>Q: Excel 表头标题与类属性名不一致，如何映射？</h4>
<p>A. 请使用 ExcelColumnName 特性</p>
<p><img src="https://user-images.githubusercontent.com/12729184/116020475-eac50980-a678-11eb-8804-129e87200e5e.png" alt="image"></p>
<h4>Q. 如何查询或导出多工作表？</h4>
<p>A. 使用 <code>GetSheetNames</code> 方法配合 Query 的 sheetName 参数。</p>
<pre><code class="language-csharp hljs"><span class="hljs-keyword">var</span> sheets = MiniExcel.GetSheetNames(path);
<span class="hljs-keyword">foreach</span> (<span class="hljs-keyword">var</span> sheet <span class="hljs-keyword">in</span> sheets)
{
    Console.WriteLine(<span class="hljs-string">$"sheet name : <span class="hljs-subst">{sheet}</span> "</span>);
    <span class="hljs-keyword">var</span> rows = MiniExcel.Query(path,useHeaderRow:<span class="hljs-literal">true</span>,sheetName:sheet);
    Console.WriteLine(rows);
}
</code></pre>
<p><img src="https://user-images.githubusercontent.com/12729184/116199841-2a1f5300-a76a-11eb-90a3-6710561cf6db.png" alt="image"></p>
<h4>Q. 如何查询或导出工作表可见性相关信息？</h4>
<p>A. 使用 <code>GetSheetInformations</code> 方法。</p>
<pre><code class="language-csharp hljs"><span class="hljs-keyword">var</span> sheets = MiniExcel.GetSheetInformations(path);
<span class="hljs-keyword">foreach</span> (<span class="hljs-keyword">var</span> sheetInfo <span class="hljs-keyword">in</span> sheets)
{
    Console.WriteLine(<span class="hljs-string">$"sheet index : <span class="hljs-subst">{sheetInfo.Index}</span> "</span>); <span class="hljs-comment">// 下一个工作表索引，从0开始编号</span>
    Console.WriteLine(<span class="hljs-string">$"sheet name : <span class="hljs-subst">{sheetInfo.Name}</span> "</span>);   <span class="hljs-comment">// 工作表名称</span>
    Console.WriteLine(<span class="hljs-string">$"sheet state : <span class="hljs-subst">{sheetInfo.State}</span> "</span>); <span class="hljs-comment">// 工作表可见性状态 - visible / hidden</span>
}
</code></pre>
<pre><code class="hljs language-csharp"><span class="hljs-meta">#### 问：使用 Count 是否会将所有数据加载到内存中？</span>

不会，图片测试中有 <span class="hljs-number">100</span> 万行 * <span class="hljs-number">10</span> 列的数据，最大内存占用 &lt;<span class="hljs-number">60</span>MB，耗时 <span class="hljs-number">13.65</span> 秒

![image](https:<span class="hljs-comment">//user-images.githubusercontent.com/12729184/117118518-70586000-adc3-11eb-9ce3-2ba76cf8b5e5.png)</span>

<span class="hljs-meta">#### 问：Query 如何使用整数索引？</span>

Query 的默认索引是字符串 Key：A、B、C……如果你想改为数字索引，请创建如下方法进行转换

```<span class="hljs-function">csharp
<span class="hljs-keyword">void</span> <span class="hljs-title">Main</span>()</span>
{
    <span class="hljs-keyword">var</span> path = <span class="hljs-string">@"D:\git\MiniExcel\samples\xlsx\TestTypeMapping.xlsx"</span>;
    <span class="hljs-keyword">var</span> rows = MiniExcel.Query(path,<span class="hljs-literal">true</span>);
    <span class="hljs-keyword">foreach</span> (<span class="hljs-function"><span class="hljs-keyword">var</span> r <span class="hljs-keyword">in</span> <span class="hljs-title">ConvertToIntIndexRows</span>(<span class="hljs-params">rows</span>))</span>
    {
        Console.Write(<span class="hljs-string">$"column 0 : <span class="hljs-subst">{r[<span class="hljs-number">0</span>]}</span> ,column 1 : <span class="hljs-subst">{r[<span class="hljs-number">1</span>]}</span>"</span>);
        Console.WriteLine();
    }
}

<span class="hljs-keyword">private</span> IEnumerable&lt;Dictionary&lt;<span class="hljs-built_in">int</span>, <span class="hljs-built_in">object</span>&gt;&gt; ConvertToIntIndexRows(IEnumerable&lt;<span class="hljs-built_in">object</span>&gt; rows)
{
    ICollection&lt;<span class="hljs-built_in">string</span>&gt; keys = <span class="hljs-literal">null</span>;
    <span class="hljs-keyword">var</span> isFirst = <span class="hljs-literal">true</span>;
    <span class="hljs-keyword">foreach</span> (IDictionary&lt;<span class="hljs-built_in">string</span>,<span class="hljs-built_in">object</span>&gt; r <span class="hljs-keyword">in</span> rows)
    {
        <span class="hljs-keyword">if</span>(isFirst)
        {
            keys = r.Keys;
            isFirst = <span class="hljs-literal">false</span>;
        }

        <span class="hljs-keyword">var</span> dic = <span class="hljs-keyword">new</span> Dictionary&lt;<span class="hljs-built_in">int</span>, <span class="hljs-built_in">object</span>&gt;();
        <span class="hljs-keyword">var</span> index = <span class="hljs-number">0</span>;
        <span class="hljs-keyword">foreach</span> (<span class="hljs-keyword">var</span> key <span class="hljs-keyword">in</span> keys)
            dic[index++] = r[key];
        <span class="hljs-keyword">yield</span> <span class="hljs-keyword">return</span> dic;
    }
}
</code></pre>
<h4>问：当导出 Excel 时，值为空会生成无标题空表格</h4>
<p>因为 MiniExcel 使用了类似 JSON.NET 的逻辑，从值动态获取类型以简化 API 操作，没有数据时无法得知类型。你可以查看 <a href="https://github.com/mini-software/MiniExcel/issues/133">issue #133</a> 了解详情。</p>
<p><img src="https://user-images.githubusercontent.com/12729184/122639771-546c0c00-d12e-11eb-800c-498db27889ca.png" alt="image"></p>
<blockquote>
<p>强类型 &amp; DataTable 会生成表头，但 Dictionary 依然会生成空表格</p>
</blockquote>
<h4>问：如何在遇到空行时停止 foreach？</h4>
<p>MiniExcel 可与 <code>LINQ TakeWhile</code> 一起使用，以在迭代器中遇到空行时停止。</p>
<p><img src="https://user-images.githubusercontent.com/12729184/130209137-162621c2-f337-4479-9996-beeac65bc4d4.png" alt="Image"></p>
<h4>问：如何移除空行？</h4>
<p><img src="https://user-images.githubusercontent.com/12729184/137873865-7107d8f5-eb59-42db-903a-44e80589f1b2.png" alt="image"></p>
<p>IEnumerable :</p>
<pre><code class="language-csharp hljs"><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> IEnumerable&lt;<span class="hljs-built_in">dynamic</span>&gt; <span class="hljs-title">QueryWithoutEmptyRow</span>(<span class="hljs-params">Stream stream, <span class="hljs-built_in">bool</span> useHeaderRow, <span class="hljs-built_in">string</span> sheetName, ExcelType excelType, <span class="hljs-built_in">string</span> startCell, IConfiguration configuration</span>)</span>
{
    <span class="hljs-keyword">var</span> rows = stream.Query(useHeaderRow,sheetName,excelType,startCell,configuration);
    <span class="hljs-keyword">foreach</span> (IDictionary&lt;<span class="hljs-built_in">string</span>,<span class="hljs-built_in">object</span>&gt; row <span class="hljs-keyword">in</span> rows)
    {
        <span class="hljs-keyword">if</span>(row.Keys.Any(key=&gt;row[key]!=<span class="hljs-literal">null</span>))
            <span class="hljs-keyword">yield</span> <span class="hljs-keyword">return</span> row;
    }
}
</code></pre>
<p>DataTable :</p>
<pre><code class="language-csharp hljs"><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> DataTable <span class="hljs-title">QueryAsDataTableWithoutEmptyRow</span>(<span class="hljs-params">Stream stream, <span class="hljs-built_in">bool</span> useHeaderRow, <span class="hljs-built_in">string</span> sheetName, ExcelType excelType, <span class="hljs-built_in">string</span> startCell, IConfiguration configuration</span>)</span>
{
    <span class="hljs-keyword">if</span> (sheetName == <span class="hljs-literal">null</span> &amp;&amp; excelType != ExcelType.CSV) <span class="hljs-comment">/*Issue #279*/</span>
        sheetName = stream.GetSheetNames().First();

    <span class="hljs-keyword">var</span> dt = <span class="hljs-keyword">new</span> DataTable(sheetName);
    <span class="hljs-keyword">var</span> first = <span class="hljs-literal">true</span>;
    <span class="hljs-keyword">var</span> rows = stream.Query(useHeaderRow,sheetName,excelType,startCell,configuration);
    <span class="hljs-keyword">foreach</span> (IDictionary&lt;<span class="hljs-built_in">string</span>, <span class="hljs-built_in">object</span>&gt; row <span class="hljs-keyword">in</span> rows)
    {
        <span class="hljs-keyword">if</span> (first)
        {

            <span class="hljs-keyword">foreach</span> (<span class="hljs-keyword">var</span> key <span class="hljs-keyword">in</span> row.Keys)
            {
                <span class="hljs-keyword">var</span> column = <span class="hljs-keyword">new</span> DataColumn(key, <span class="hljs-keyword">typeof</span>(<span class="hljs-built_in">object</span>)) { Caption = key };
                dt.Columns.Add(column);
            }

            dt.BeginLoadData();
            first = <span class="hljs-literal">false</span>;
        }

        <span class="hljs-keyword">var</span> newRow = dt.NewRow();
        <span class="hljs-keyword">var</span> isNull=<span class="hljs-literal">true</span>;
        <span class="hljs-keyword">foreach</span> (<span class="hljs-keyword">var</span> key <span class="hljs-keyword">in</span> row.Keys)
        {
            <span class="hljs-keyword">var</span> _v = row[key];
            <span class="hljs-keyword">if</span>(_v!=<span class="hljs-literal">null</span>)
                isNull = <span class="hljs-literal">false</span>;
            newRow[key] = _v;
        }

        <span class="hljs-keyword">if</span>(!isNull)
            dt.Rows.Add(newRow);
    }

    dt.EndLoadData();
    <span class="hljs-keyword">return</span> dt;
}
</code></pre>
<h4>问：如何用 SaveAs(path,value) 替换已存在的文件且不抛出 "The file ...xlsx already exists error"</h4>
<p>请使用 Stream 类自定义文件创建逻辑，例如：</p>
<pre><code class="language-C# hljs language-C">    using (var stream = File.Create(<span class="hljs-string">"Demo.xlsx"</span>))
        MiniExcel.SaveAs(stream,value);
</code></pre>
<p>或者，自 V1.25.0 起，SaveAs 支持 overwriteFile 参数来启用/禁用覆盖已存在文件</p>
<pre><code class="language-csharp hljs">    MiniExcel.SaveAs(path, <span class="hljs-keyword">value</span>, overwriteFile: <span class="hljs-literal">true</span>);
</code></pre>
<h3>限制与注意事项</h3>
<ul>
<li>目前不支持 xls 及加密文件</li>
<li>xlsm 仅支持 Query</li>
</ul>
<h3>参考</h3>
<p><a href="https://github.com/ExcelDataReader/ExcelDataReader">ExcelDataReader</a>  / <a href="https://github.com/ClosedXML/ClosedXML">ClosedXML</a> / <a href="https://github.com/DapperLib/Dapper">Dapper</a> / <a href="https://github.com/andersnm/ExcelNumberFormat">ExcelNumberFormat</a></p>
<h3>鸣谢</h3>
<h4><a href="https://www.jetbrains.com/">Jetbrains</a></h4>
<p><img src="https://user-images.githubusercontent.com/12729184/123997015-8456c180-da02-11eb-829a-aec476fe8e94.png" alt="jetbrains-variant-2"></p>
<p>感谢为本项目提供免费的 All product IDE (<a href="https://user-images.githubusercontent.com/12729184/123988233-6ab17c00-d9fa-11eb-8739-2a08c6a4a263.png">License</a>)</p>
<h3>贡献分享与捐赠</h3>
<p>链接 <a href="https://github.com/orgs/mini-software/discussions/754">https://github.com/orgs/mini-software/discussions/754</a></p>
<h3>贡献者</h3>
<p><img src="https://contrib.rocks/image?repo=mini-software/MiniExcel" alt=""></p>
<hr>
<p>Tranlated By <a href="https://github.com/OpenAiTx/OpenAiTx">Open Ai Tx</a> | Last indexed: 2025-06-08</p>
<hr>
</div>
    </div>

    <footer class="footer">
        Powered by <a href="https://github.com/OpenAiTx/OpenAiTx" target="_blank">Open AI Tx</a>
    </footer>
    <!-- Default Statcounter code for openaitx
https://openaitx.github.io/ -->
    <script type="text/javascript">
        var sc_project = 13142514;
        var sc_invisible = 1;
        var sc_security = "d03a31d8"; 
    </script>
    <script type="text/javascript" src="https://www.statcounter.com/counter/counter.js" async=""></script>
    <noscript>
        <div class="statcounter"><a title="Web Analytics" href="https://statcounter.com/" target="_blank"><img
                    class="statcounter" src="https://c.statcounter.com/13142514/0/d03a31d8/1/" alt="Web Analytics"
                    referrerPolicy="no-referrer-when-downgrade"></a></div>
    </noscript>
    <!-- End of Statcounter Code -->
    <script src="view.js"></script>


</body></html>