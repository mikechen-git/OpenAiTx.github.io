<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>storm - asdine/storm</title>
    <meta name="title" content="storm - asdine/storm">
    <meta name="description" content="asdine/storm - GitHub repository zh-CN documentation and informationStorm Storm 是一个为 BoltDB 提供的简单而强大的工具包。基本上，Storm 提供了索引、多种存储和获取数据的方法、一个高级查询系统以及更多功能。 除了下面的示例外，也可以参见 GoDoc 中的示例。 关于扩展查询和对 Badger 的支持，也可参见 Genji 目录 快速开始 导入 Storm 打开数据库 简单的 CRUD 系统 声明你的结构体 保存你的对象 自增 简单查询 获取单个对象 获取多个对象 获取所有对象 按索引排序获取所有对象 获取对象范围 按前缀获取对象 Skip、Limit 和 Reverse 删除对象 更新对象 在保存对象前初始化 bucket 和索引 删除 bucket 重建 bucket 索引 高级查询 事务 选项 BoltOptions MarshalUnmarshaler 内置编解码器 使用已有的 Bolt 连接 批量模式 节点与嵌套 bucket 节点选项 简单的键/值存储 BoltDB 许可证 致谢 快速开始 GO111MODULE=on go get -u github.com/asdine/storm/v3 导入 Storm import &quot;github.com/asdine/storm/v3&quot; 打开数据库 快速打开数据库的方法 db, err := storm.Open(&quot;my.db&quot;) defer db.Close() Open 可以接收多个选项以自定义其行为。参见下文 选项 简单的 CRUD 系统 声明你的结构体 type User struct { ID int // 主键 Group string `storm:&quot;index&quot;` // 该字段会被索引 Email string `storm:&quot;unique&quot;` // 该字段会被唯一索引 Name string // 该字段不会被索引 Age int `storm:&quot;index&quot;` } 主键可以为任意类型，只要不是零值。Storm 会优先查找标签 id，如果没有则查找名为 ID 的字段。 type User struct { ThePrimaryKey string `storm:&quot;id&quot;`// 主键 Group string `storm:&quot;index&quot;` // 该字段会被索引 Email string `storm:&quot;unique&quot;` // 该字段会被唯一索引 Name string // 该字段不会被索引 } Storm 使用 inline 标签处理嵌套结构体中的标签 type Base struct { Ident bson.ObjectId...">
    <meta name="keywords" content="asdine, storm, GitHub, repository, zh-CN documentation">
    <meta name="author" content="Open AI Tx">
    <meta name="robots" content="index, follow">
    <meta property="og:type" content="website">
    <meta property="og:url" content="https://openaitx.github.io/projects/asdine/storm/README-zh-CN.html">
    <meta property="og:title" content="storm - asdine/storm">
    <meta property="og:description" content="asdine/storm - GitHub repository zh-CN documentation and information">
    <meta property="og:image" content="https://openaitx.github.io/logo_crop.png">
    <link rel="icon" type="image/jpeg" href="/icon.jpg">
    <link rel="apple-touch-icon" href="/icon.jpg">
    <script src="/js/marked.min.js?v=20250613"></script>
    <link rel="stylesheet" href="/css/github.min.css?v=20250613">
    <script src="/js/highlight.min.js?v=20250613"></script>
    <link rel="stylesheet" href="/view.css?v=20250613">
    <style>
        body { display: flex; flex-direction: column; min-height: 100vh; }
        .main-container { margin: 0 auto; width: 100%; max-width: 980px; padding: 0 20px; }
        @media (max-width: 768px) { .main-container { padding: 0 15px; } }
        .markdown-body img { max-width: 100%; height: auto; }
        .header { text-align: center; margin-bottom: 30px; padding: 20px; background-color: #f6f8fa; border-bottom: 1px solid #e1e4e8; position: relative; }
        .header .links { margin-top: 10px; font-size: 16px; }
        .header .links a { color: #0366d6; text-decoration: none; margin-left: 5px; }
        .header .links a:hover { text-decoration: underline; }
        .language-badges { margin-top: 15px; text-align: center; }
        .language-badges a { display: inline-block; margin: 2px; text-decoration: none; }
        .language-badges img { height: 20px; border-radius: 3px; }
        .language-badges a:hover img { opacity: 0.8; }
    </style>
</head>
<body>
    <div class="header">
        <div class="links">
            GitHub Repository: <a href="https://github.com/asdine/storm" id="githubRepoLink" target="_blank">asdine/storm</a>
<br>
<h1 style="display: none;">Storm Storm 是一个为 BoltDB 提供的简单而强大的工具包。基本上，Storm 提供了索引、多种存储和获取数据的方法、一个高级查询系统以及更多功能。 除了下面的示例外，也可以参见 GoDoc 中的示例。 关于扩展查询和对 Badger 的支持，也可参见 Genji 目录 快速开始 导入 Storm 打开数据库 简单的 CRUD 系统 声明你的结构体 保存你的对象 自增 简单查询 获取单个对象 获取多个对象 获取所有对象 按索引排序获取所有对象 获取对象范围 按前缀获取对象 Skip、Limit 和 Reverse 删除对象 更新对象 在保存对象前初始化 bucket 和索引 删除 bucket 重建 bucket 索引 高级查询 事务 选项 BoltOptions MarshalUnmarshaler 内置编解码器 使用已有的 Bolt 连接 批量模式 节点与嵌套 bucket 节点选项 简单的键/值存储 BoltDB 许可证 致谢 快速开始 GO111MODULE=on go get -u github.com/asdine/storm/v3 导入 Storm import &quot;github.com/asdine/storm/v3&quot; 打开数据库 快速打开数据库的方法 db, err := storm.Open(&quot;my.db&quot;) defer db.Close() Open 可以接收多个选项以自定义其行为。参见下文 选项 简单的 CRUD 系统 声明你的结构体 type User struct { ID int // 主键 Group string `storm:&quot;index&quot;` // 该字段会被索引 Email string `storm:&quot;unique&quot;` // 该字段会被唯一索引 Name string // 该字段不会被索引 Age int `storm:&quot;index&quot;` } 主键可以为任意类型，只要不是零值。Storm 会优先查找标签 id，如果没有则查找名为 ID 的字段。 type User struct { ThePrimaryKey string `storm:&quot;id&quot;`// 主键 Group string `storm:&quot;index&quot;` // 该字段会被索引 Email string `storm:&quot;unique&quot;` // 该字段会被唯一索引 Name string // 该字段不会被索引 } Storm 使用 inline 标签处理嵌套结构体中的标签 type Base struct { Ident bson.ObjectId...</h1>
        </div>
        <div class="language-badges" id="languageBadges">
            <!-- You can generate language badges here if needed -->
        </div>
    </div>
    <div class="main-container">
        <div class="markdown-body" id="content">
            <h1>Storm</h1>
<p><a href="https://travis-ci.org/asdine/storm"><img src="https://travis-ci.org/asdine/storm.svg" alt="Build Status" /></a>
<a href="https://godoc.org/github.com/asdine/storm"><img src="https://godoc.org/github.com/asdine/storm?status.svg" alt="GoDoc" /></a></p>
<p>Storm 是一个为 <a href="https://github.com/coreos/bbolt">BoltDB</a> 提供的简单而强大的工具包。基本上，Storm 提供了索引、多种存储和获取数据的方法、一个高级查询系统以及更多功能。</p>
<p>除了下面的示例外，也可以参见 <a href="https://godoc.org/github.com/asdine/storm#pkg-examples">GoDoc 中的示例</a>。</p>
<p><em>关于扩展查询和对 <a href="https://github.com/dgraph-io/badger">Badger</a> 的支持，也可参见 <a href="https://github.com/asdine/genji">Genji</a></em></p>
<h2>目录</h2>
<ul>
<li><a href="#getting-started">快速开始</a></li>
<li><a href="#import-storm">导入 Storm</a></li>
<li><a href="#open-a-database">打开数据库</a></li>
<li><a href="#simple-crud-system">简单的 CRUD 系统</a>
<ul>
<li><a href="#declare-your-structures">声明你的结构体</a></li>
<li><a href="#save-your-object">保存你的对象</a>
<ul>
<li><a href="#auto-increment">自增</a></li>
</ul>
</li>
<li><a href="#simple-queries">简单查询</a>
<ul>
<li><a href="#fetch-one-object">获取单个对象</a></li>
<li><a href="#fetch-multiple-objects">获取多个对象</a></li>
<li><a href="#fetch-all-objects">获取所有对象</a></li>
<li><a href="#fetch-all-objects-sorted-by-index">按索引排序获取所有对象</a></li>
<li><a href="#fetch-a-range-of-objects">获取对象范围</a></li>
<li><a href="#fetch-objects-by-prefix">按前缀获取对象</a></li>
<li><a href="#skip-limit-and-reverse">Skip、Limit 和 Reverse</a></li>
<li><a href="#delete-an-object">删除对象</a></li>
<li><a href="#update-an-object">更新对象</a></li>
<li><a href="#initialize-buckets-and-indexes-before-saving-an-object">在保存对象前初始化 bucket 和索引</a></li>
<li><a href="#drop-a-bucket">删除 bucket</a></li>
<li><a href="#re-index-a-bucket">重建 bucket 索引</a></li>
</ul>
</li>
<li><a href="#advanced-queries">高级查询</a></li>
<li><a href="#transactions">事务</a></li>
<li><a href="#options">选项</a>
<ul>
<li><a href="#boltoptions">BoltOptions</a></li>
<li><a href="#marshalunmarshaler">MarshalUnmarshaler</a>
<ul>
<li><a href="#provided-codecs">内置编解码器</a></li>
</ul>
</li>
<li><a href="#use-existing-bolt-connection">使用已有的 Bolt 连接</a></li>
<li><a href="#batch-mode">批量模式</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#nodes-and-nested-buckets">节点与嵌套 bucket</a>
<ul>
<li><a href="#node-options">节点选项</a></li>
</ul>
</li>
<li><a href="#simple-keyvalue-store">简单的键/值存储</a></li>
<li><a href="#boltdb">BoltDB</a></li>
<li><a href="#license">许可证</a></li>
<li><a href="#credits">致谢</a></li>
</ul>
<h2>快速开始</h2>
<pre><code class="language-bash">GO111MODULE=on go get -u github.com/asdine/storm/v3
</code></pre>
<h2>导入 Storm</h2>
<pre><code class="language-go">import &quot;github.com/asdine/storm/v3&quot;
</code></pre>
<h2>打开数据库</h2>
<p>快速打开数据库的方法</p>
<pre><code class="language-go">db, err := storm.Open(&quot;my.db&quot;)

defer db.Close()
</code></pre>
<p><code>Open</code> 可以接收多个选项以自定义其行为。参见下文 <a href="#options">选项</a></p>
<h2>简单的 CRUD 系统</h2>
<h3>声明你的结构体</h3>
<pre><code class="language-go">type User struct {
  ID int // 主键
  Group string `storm:&quot;index&quot;` // 该字段会被索引
  Email string `storm:&quot;unique&quot;` // 该字段会被唯一索引
  Name string // 该字段不会被索引
  Age int `storm:&quot;index&quot;`
}
</code></pre>
<p>主键可以为任意类型，只要不是零值。Storm 会优先查找标签 <code>id</code>，如果没有则查找名为 <code>ID</code> 的字段。</p>
<pre><code class="language-go">type User struct {
  ThePrimaryKey string `storm:&quot;id&quot;`// 主键
  Group string `storm:&quot;index&quot;` // 该字段会被索引
  Email string `storm:&quot;unique&quot;` // 该字段会被唯一索引
  Name string // 该字段不会被索引
}
</code></pre>
<p>Storm 使用 <code>inline</code> 标签处理嵌套结构体中的标签</p>
<pre><code class="language-go">type Base struct {
  Ident bson.ObjectId `storm:&quot;id&quot;`
}

type User struct {
  Base      `storm:&quot;inline&quot;`
  Group     string `storm:&quot;index&quot;`
  Email     string `storm:&quot;unique&quot;`
  Name      string
  CreatedAt time.Time `storm:&quot;index&quot;`
}
</code></pre>
<h3>保存你的对象</h3>
<pre><code class="language-go">user := User{
  ID: 10,
  Group: &quot;staff&quot;,
  Email: &quot;john@provider.com&quot;,
  Name: &quot;John&quot;,
  Age: 21,
  CreatedAt: time.Now(),
}

err := db.Save(&amp;user)
// err == nil

user.ID++
err = db.Save(&amp;user)
// err == storm.ErrAlreadyExists
</code></pre>
<p>就是这样。</p>
<p><code>Save</code> 会创建或更新所有需要的索引和 bucket，检查唯一性约束，并将对象保存到存储中。</p>
<h4>自增</h4>
<p>Storm 可以自动递增整型字段，因此在保存对象时无需担心。同时，新值会自动写入你的字段。</p>
<pre><code class="language-go">
type Product struct {
  Pk                  int `storm:&quot;id,increment&quot;` // 主键自增
  Name                string
  IntegerField        uint64 `storm:&quot;increment&quot;`
  IndexedIntegerField uint32 `storm:&quot;index,increment&quot;`
  UniqueIntegerField  int16  `storm:&quot;unique,increment=100&quot;` // 可设置起始值
}

p := Product{Name: &quot;Vaccum Cleaner&quot;}

fmt.Println(p.Pk)
fmt.Println(p.IntegerField)
fmt.Println(p.IndexedIntegerField)
fmt.Println(p.UniqueIntegerField)
// 0
// 0
// 0
// 0

_ = db.Save(&amp;p)

fmt.Println(p.Pk)
fmt.Println(p.IntegerField)
fmt.Println(p.IndexedIntegerField)
fmt.Println(p.UniqueIntegerField)
// 1
// 1
// 1
// 100

</code></pre>
<h3>简单查询</h3>
<p>任何对象都可以被获取，无论是否有索引。Storm 会优先使用索引，否则会使用 <a href="#advanced-queries">查询系统</a>。</p>
<h4>获取单个对象</h4>
<pre><code class="language-go">var user User
err := db.One(&quot;Email&quot;, &quot;john@provider.com&quot;, &amp;user)
// err == nil

err = db.One(&quot;Name&quot;, &quot;John&quot;, &amp;user)
// err == nil

err = db.One(&quot;Name&quot;, &quot;Jack&quot;, &amp;user)
// err == storm.ErrNotFound
</code></pre>
<h4>获取多个对象</h4>
<pre><code class="language-go">var users []User
err := db.Find(&quot;Group&quot;, &quot;staff&quot;, &amp;users)
</code></pre>
<h4>获取所有对象</h4>
<pre><code class="language-go">var users []User
err := db.All(&amp;users)
</code></pre>
<h4>按索引排序获取所有对象</h4>
<pre><code class="language-go">var users []User
err := db.AllByIndex(&quot;CreatedAt&quot;, &amp;users)
</code></pre>
<h4>获取对象区间</h4>
<pre><code class="language-go">var users []User
err := db.Range(&quot;Age&quot;, 10, 21, &amp;users)
</code></pre>
<h4>按前缀获取对象</h4>
<pre><code class="language-go">var users []User
err := db.Prefix(&quot;Name&quot;, &quot;Jo&quot;, &amp;users)
</code></pre>
<h4>跳过、限制和反转</h4>
<pre><code class="language-go">var users []User
err := db.Find(&quot;Group&quot;, &quot;staff&quot;, &amp;users, storm.Skip(10))
err = db.Find(&quot;Group&quot;, &quot;staff&quot;, &amp;users, storm.Limit(10))
err = db.Find(&quot;Group&quot;, &quot;staff&quot;, &amp;users, storm.Reverse())
err = db.Find(&quot;Group&quot;, &quot;staff&quot;, &amp;users, storm.Limit(10), storm.Skip(10), storm.Reverse())

err = db.All(&amp;users, storm.Limit(10), storm.Skip(10), storm.Reverse())
err = db.AllByIndex(&quot;CreatedAt&quot;, &amp;users, storm.Limit(10), storm.Skip(10), storm.Reverse())
err = db.Range(&quot;Age&quot;, 10, 21, &amp;users, storm.Limit(10), storm.Skip(10), storm.Reverse())
</code></pre>
<h4>删除对象</h4>
<pre><code class="language-go">err := db.DeleteStruct(&amp;user)
</code></pre>
<h4>更新对象</h4>
<pre><code class="language-go">// 更新多个字段
// 仅适用于非零值字段（例如 Name 不能为 &quot;&quot;，Age 不能为 0）
err := db.Update(&amp;User{ID: 10, Name: &quot;Jack&quot;, Age: 45})

// 更新单个字段
// 也适用于零值字段（0, false, &quot;&quot;, ...）
err := db.UpdateField(&amp;User{ID: 10}, &quot;Age&quot;, 0)
</code></pre>
<h4>在保存对象前初始化桶和索引</h4>
<pre><code class="language-go">err := db.Init(&amp;User{})
</code></pre>
<p>应用程序启动时很有用</p>
<h4>删除桶</h4>
<p>使用结构体</p>
<pre><code class="language-go">err := db.Drop(&amp;User)
</code></pre>
<p>使用桶名称</p>
<pre><code class="language-go">err := db.Drop(&quot;User&quot;)
</code></pre>
<h4>重新索引桶</h4>
<pre><code class="language-go">err := db.ReIndex(&amp;User{})
</code></pre>
<p>当结构发生变化时很有用</p>
<h3>高级查询</h3>
<p>对于更复杂的查询，可以使用 <code>Select</code> 方法。<br />
<code>Select</code> 可以接收任意数量的 <a href="https://godoc.org/github.com/asdine/storm/q#Matcher"><code>Matcher</code></a> ，来自 <a href="https://godoc.org/github.com/asdine/storm/q"><code>q</code></a> 包。</p>
<p>以下是一些常用的 Matcher：</p>
<pre><code class="language-go">// 等值
q.Eq(&quot;Name&quot;, John)

// 严格大于
q.Gt(&quot;Age&quot;, 7)

// 小于等于
q.Lte(&quot;Age&quot;, 77)

// 用正则表达式匹配以 D 开头的 Name
q.Re(&quot;Name&quot;, &quot;^D&quot;)

// 在给定的值切片中
q.In(&quot;Group&quot;, []string{&quot;Staff&quot;, &quot;Admin&quot;})

// 字段间比较
q.EqF(&quot;FieldName&quot;, &quot;SecondFieldName&quot;)
q.LtF(&quot;FieldName&quot;, &quot;SecondFieldName&quot;)
q.GtF(&quot;FieldName&quot;, &quot;SecondFieldName&quot;)
q.LteF(&quot;FieldName&quot;, &quot;SecondFieldName&quot;)
q.GteF(&quot;FieldName&quot;, &quot;SecondFieldName&quot;)
</code></pre>
<p>Matcher 也可以用 <code>And</code>、<code>Or</code> 和 <code>Not</code> 组合：</p>
<pre><code class="language-go">
// 所有条件都满足时匹配
q.And(
  q.Gt(&quot;Age&quot;, 7),
  q.Re(&quot;Name&quot;, &quot;^D&quot;)
)

// 只要有一个条件满足就匹配
q.Or(
  q.Re(&quot;Name&quot;, &quot;^A&quot;),
  q.Not(
    q.Re(&quot;Name&quot;, &quot;^B&quot;)
  ),
  q.Re(&quot;Name&quot;, &quot;^C&quot;),
  q.In(&quot;Group&quot;, []string{&quot;Staff&quot;, &quot;Admin&quot;}),
  q.And(
    q.StrictEq(&quot;Password&quot;, []byte(password)),
    q.Eq(&quot;Registered&quot;, true)
  )
)
</code></pre>
<p>完整列表可见 <a href="https://godoc.org/github.com/asdine/storm/q#Matcher">文档</a>。</p>
<p><code>Select</code> 接收任意数量的 matcher，并自动包裹在 <code>q.And()</code> 中，因此无需手动指定。它返回一个 <a href="https://godoc.org/github.com/asdine/storm#Query"><code>Query</code></a> 类型。</p>
<pre><code class="language-go">query := db.Select(q.Gte(&quot;Age&quot;, 7), q.Lte(&quot;Age&quot;, 77))
</code></pre>
<p><code>Query</code> 类型包含用于过滤和排序记录的方法。</p>
<pre><code class="language-go">// 限制数量
query = query.Limit(10)

// 跳过
query = query.Skip(20)

// 方法也可以链式调用
query = query.Limit(10).Skip(20).OrderBy(&quot;Age&quot;).Reverse()
</code></pre>
<p>同时还能指定如何获取数据。</p>
<pre><code class="language-go">var users []User
err = query.Find(&amp;users)

var user User
err = query.First(&amp;user)
</code></pre>
<p><code>Select</code> 示例：</p>
<pre><code class="language-go">// 查找所有 ID 在 10 到 100 之间的用户
err = db.Select(q.Gte(&quot;ID&quot;, 10), q.Lte(&quot;ID&quot;, 100)).Find(&amp;users)

// 嵌套 matcher
err = db.Select(q.Or(
  q.Gt(&quot;ID&quot;, 50),
  q.Lt(&quot;Age&quot;, 21),
  q.And(
    q.Eq(&quot;Group&quot;, &quot;admin&quot;),
    q.Gte(&quot;Age&quot;, 21),
  ),
)).Find(&amp;users)

query := db.Select(q.Gte(&quot;ID&quot;, 10), q.Lte(&quot;ID&quot;, 100)).Limit(10).Skip(5).Reverse().OrderBy(&quot;Age&quot;, &quot;Name&quot;)

// 查找多条记录
err = query.Find(&amp;users)
// 或者
err = db.Select(q.Gte(&quot;ID&quot;, 10), q.Lte(&quot;ID&quot;, 100)).Limit(10).Skip(5).Reverse().OrderBy(&quot;Age&quot;, &quot;Name&quot;).Find(&amp;users)
</code></pre>
<pre><code class="language-go">// 查找第一条记录
err = query.First(&amp;user)
// 或者
err = db.Select(q.Gte(&quot;ID&quot;, 10), q.Lte(&quot;ID&quot;, 100)).Limit(10).Skip(5).Reverse().OrderBy(&quot;Age&quot;, &quot;Name&quot;).First(&amp;user)

// 删除所有匹配的记录
err = query.Delete(new(User))

// 逐条获取记录（当桶里有大量记录时很有用）
query = db.Select(q.Gte(&quot;ID&quot;, 10),q.Lte(&quot;ID&quot;, 100)).OrderBy(&quot;Age&quot;, &quot;Name&quot;)

err = query.Each(new(User), func(record interface{}) error) {
  u := record.(*User)
  ...
  return nil
}
</code></pre>
<p>完整方法列表请参见<a href="https://godoc.org/github.com/asdine/storm#Query">文档</a>。</p>
<h3>事务</h3>
<pre><code class="language-go">tx, err := db.Begin(true)
if err != nil {
  return err
}
defer tx.Rollback()

accountA.Amount -= 100
accountB.Amount += 100

err = tx.Save(accountA)
if err != nil {
  return err
}

err = tx.Save(accountB)
if err != nil {
  return err
}

return tx.Commit()
</code></pre>
<h3>选项</h3>
<p>Storm 选项是你在构造 Storm 实例时可以传递的函数。你可以传递任意数量的选项。</p>
<h4>BoltOptions</h4>
<p>默认情况下，Storm 以 <code>0600</code> 的模式和一秒的超时时间打开数据库。
你可以通过使用 <code>BoltOptions</code> 来更改此行为</p>
<pre><code class="language-go">db, err := storm.Open(&quot;my.db&quot;, storm.BoltOptions(0600, &amp;bolt.Options{Timeout: 1 * time.Second}))
</code></pre>
<h4>MarshalUnmarshaler</h4>
<p>为了将数据存储到 BoltDB，Storm 默认以 JSON 方式序列化数据。如果你希望更改此行为，可以通过 <a href="https://godoc.org/github.com/asdine/storm#Codec"><code>storm.Codec</code></a> 选项传递实现了 <a href="https://godoc.org/github.com/asdine/storm/codec#MarshalUnmarshaler"><code>codec.MarshalUnmarshaler</code></a> 的编解码器：</p>
<pre><code class="language-go">db := storm.Open(&quot;my.db&quot;, storm.Codec(myCodec))
</code></pre>
<h5>内置编解码器</h5>
<p>你可以很容易地实现你自己的 <code>MarshalUnmarshaler</code>，但 Storm 已经内置支持 <a href="https://godoc.org/github.com/asdine/storm/codec/json">JSON</a>（默认）、<a href="https://godoc.org/github.com/asdine/storm/codec/gob">GOB</a>、<a href="https://godoc.org/github.com/asdine/storm/codec/sereal">Sereal</a>、<a href="https://godoc.org/github.com/asdine/storm/codec/protobuf">Protocol Buffers</a> 和 <a href="https://godoc.org/github.com/asdine/storm/codec/msgpack">MessagePack</a>。</p>
<p>你可以通过导入相关包并使用该编解码器来配置 Storm。下面的例子展示了所有变体（未处理错误）：</p>
<pre><code class="language-go">import (
  &quot;github.com/asdine/storm/v3&quot;
  &quot;github.com/asdine/storm/v3/codec/gob&quot;
  &quot;github.com/asdine/storm/v3/codec/json&quot;
  &quot;github.com/asdine/storm/v3/codec/sereal&quot;
  &quot;github.com/asdine/storm/v3/codec/protobuf&quot;
  &quot;github.com/asdine/storm/v3/codec/msgpack&quot;
)

var gobDb, _ = storm.Open(&quot;gob.db&quot;, storm.Codec(gob.Codec))
var jsonDb, _ = storm.Open(&quot;json.db&quot;, storm.Codec(json.Codec))
var serealDb, _ = storm.Open(&quot;sereal.db&quot;, storm.Codec(sereal.Codec))
var protobufDb, _ = storm.Open(&quot;protobuf.db&quot;, storm.Codec(protobuf.Codec))
var msgpackDb, _ = storm.Open(&quot;msgpack.db&quot;, storm.Codec(msgpack.Codec))
</code></pre>
<p><strong>提示</strong>：为生成的 Protobuf 文件添加 Storm 标签可能会有点棘手。一个好的解决方案是使用<a href="https://github.com/favadi/protoc-go-inject-tag">这个工具</a>在编译时注入标签。</p>
<h4>使用已有的 Bolt 连接</h4>
<p>你可以使用已有的连接并将其传递给 Storm</p>
<pre><code class="language-go">bDB, _ := bolt.Open(filepath.Join(dir, &quot;bolt.db&quot;), 0600, &amp;bolt.Options{Timeout: 10 * time.Second})
db := storm.Open(&quot;my.db&quot;, storm.UseDB(bDB))
</code></pre>
<h4>批量模式</h4>
<p>可以启用批量模式以加速并发写入（参见 <a href="https://github.com/coreos/bbolt#batch-read-write-transactions">批量读写事务</a>）</p>
<pre><code class="language-go">db := storm.Open(&quot;my.db&quot;, storm.Batch())
</code></pre>
<h2>节点与嵌套桶</h2>
<p>Storm 通过 <code>storm.Node</code> 利用 BoltDB 的嵌套桶特性。
<code>storm.Node</code> 是 <code>storm.DB</code> 操作桶时的底层对象。
要创建嵌套桶并使用与 <code>storm.DB</code> 相同的 API，可以使用 <code>DB.From</code> 方法。</p>
<pre><code class="language-go">repo := db.From(&quot;repo&quot;)

err := repo.Save(&amp;Issue{
  Title: &quot;I want more features&quot;,
  Author: user.ID,
})

err = repo.Save(newRelease(&quot;0.10&quot;))

var issues []Issue
err = repo.Find(&quot;Author&quot;, user.ID, &amp;issues)

var release Release
err = repo.One(&quot;Tag&quot;, &quot;0.10&quot;, &amp;release)
</code></pre>
<p>你还可以链式调用节点来创建层级结构</p>
<pre><code class="language-go">chars := db.From(&quot;characters&quot;)
heroes := chars.From(&quot;heroes&quot;)
enemies := chars.From(&quot;enemies&quot;)

items := db.From(&quot;items&quot;)
potions := items.From(&quot;consumables&quot;).From(&quot;medicine&quot;).From(&quot;potions&quot;)
</code></pre>
<p>你甚至可以将整个层级作为参数传递给 <code>From</code>：</p>
<pre><code class="language-go">privateNotes := db.From(&quot;notes&quot;, &quot;private&quot;)
workNotes :=  db.From(&quot;notes&quot;, &quot;work&quot;)
</code></pre>
<h3>节点选项</h3>
<p>节点也可以进行配置。对节点激活选项会创建一个副本，因此节点始终是线程安全的。</p>
<pre><code class="language-go">n := db.From(&quot;my-node&quot;)
</code></pre>
<p>为节点指定一个 bolt.Tx 事务</p>
<pre><code class="language-go">n = n.WithTransaction(tx)
</code></pre>
<p>启用批量模式</p>
<pre><code class="language-go">n = n.WithBatch(true)
</code></pre>
<p>使用编解码器</p>
<pre><code class="language-go">n = n.WithCodec(gob.Codec)
</code></pre>
<h2>简单的键/值存储</h2>
<p>Storm 可以作为一个简单、健壮的键/值存储，能够存储任何内容。
只要 key 不是零值，key 和 value 可以是任意类型。</p>
<p>保存数据：</p>
<pre><code class="language-go">db.Set(&quot;logs&quot;, time.Now(), &quot;I'm eating my breakfast man&quot;)
db.Set(&quot;sessions&quot;, bson.NewObjectId(), &amp;someUser)
db.Set(&quot;weird storage&quot;, &quot;754-3010&quot;, map[string]interface{}{
  &quot;hair&quot;: &quot;blonde&quot;,
  &quot;likes&quot;: []string{&quot;cheese&quot;, &quot;star wars&quot;},
})
</code></pre>
<p>获取数据：</p>
<pre><code class="language-go">user := User{}
db.Get(&quot;sessions&quot;, someObjectId, &amp;user)

var details map[string]interface{}
db.Get(&quot;weird storage&quot;, &quot;754-3010&quot;, &amp;details)
</code></pre>
<pre><code>db.Get(&quot;sessions&quot;, someObjectId, &amp;details)
</code></pre>
<p>删除数据：</p>
<pre><code class="language-go">db.Delete(&quot;sessions&quot;, someObjectId)
db.Delete(&quot;weird storage&quot;, &quot;754-3010&quot;)
</code></pre>
<p>你可以在<a href="https://godoc.org/github.com/asdine/storm#KeyValueStore">文档</a>中找到其他有用的方法。</p>
<h2>BoltDB</h2>
<p>BoltDB 依然可以轻松访问，并且可以像往常一样使用</p>
<pre><code class="language-go">db.Bolt.View(func(tx *bolt.Tx) error {
  bucket := tx.Bucket([]byte(&quot;my bucket&quot;))
  val := bucket.Get([]byte(&quot;any id&quot;))
  fmt.Println(string(val))
  return nil
})
</code></pre>
<p>事务也可以传递给 Storm</p>
<pre><code class="language-go">db.Bolt.Update(func(tx *bolt.Tx) error {
  ...
  dbx := db.WithTransaction(tx)
  err = dbx.Save(&amp;user)
  ...
  return nil
})
</code></pre>
<h2>许可证</h2>
<p>MIT</p>
<h2>鸣谢</h2>
<ul>
<li><a href="https://github.com/asdine">Asdine El Hrychy</a></li>
<li><a href="https://github.com/bep">Bjørn Erik Pedersen</a></li>
</ul>
<hr />
<p>Tranlated By <a href="https://github.com/OpenAiTx/OpenAiTx">Open Ai Tx</a> | Last indexed: 2025-06-11</p>
<hr />

        </div>
    </div>
    <footer class="footer">
        Powered by <a href="https://github.com/OpenAiTx/OpenAiTx" target="_blank">Open AI Tx</a>
    </footer>
    <!-- Statcounter and other scripts can be added here -->
</body>
</html>