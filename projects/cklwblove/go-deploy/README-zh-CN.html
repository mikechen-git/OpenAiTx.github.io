<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>go-deploy - cklwblove/go-deploy</title>
    <meta name="title" content="go-deploy - cklwblove/go-deploy">
    <meta name="description" content="cklwblove/go-deploy - GitHub repository zh-CN documentation and informationGo-Deploy 部署工具 一个基于Go语言开发的自动化部署工具，支持通过SFTP协议将本地构建产物上传到远程服务器。 功能特性 ✅ 安全传输：使用SFTP协议，基于SSH加密传输 ✅ 目录同步：递归上传整个目录结构，保持文件层级 ✅ 智能创建：自动创建远程目录结构 ✅ 路径自适应：自动基于可执行文件位置计算本地路径...">
    <meta name="keywords" content="cklwblove, go-deploy, GitHub, repository, zh-CN documentation">
    <meta name="author" content="Open AI Tx">
    <meta name="robots" content="index, follow">
    <meta property="og:type" content="website">
    <meta property="og:url" content="https://openaitx.github.io/projects/cklwblove/go-deploy/README-zh-CN.html">
    <meta property="og:title" content="go-deploy - cklwblove/go-deploy">
    <meta property="og:description" content="cklwblove/go-deploy - GitHub repository zh-CN documentation and information">
    <meta property="og:image" content="https://openaitx.github.io/logo_crop.png">
    <link rel="icon" type="image/jpeg" href="/icon.jpg">
    <link rel="apple-touch-icon" href="/icon.jpg">
    <script src="/js/marked.min.js?v=20250613"></script>
    <link rel="stylesheet" href="/css/github.min.css?v=20250613">
    <script src="/js/highlight.min.js?v=20250613"></script>
    <link rel="stylesheet" href="/view.css?v=20250613">
    <style>
        body { display: flex; flex-direction: column; min-height: 100vh; }
        .main-container { margin: 0 auto; width: 100%; max-width: 980px; padding: 0 20px; }
        @media (max-width: 768px) { .main-container { padding: 0 15px; } }
        .markdown-body img { max-width: 100%; height: auto; }
        .header { text-align: center; margin-bottom: 30px; padding: 20px; background-color: #f6f8fa; border-bottom: 1px solid #e1e4e8; position: relative; }
        .header .links { margin-top: 10px; font-size: 16px; }
        .header .links a { color: #0366d6; text-decoration: none; margin-left: 5px; }
        .header .links a:hover { text-decoration: underline; }
        .language-badges { margin-top: 15px; text-align: center; }
        .language-badges a { display: inline-block; margin: 2px; text-decoration: none; }
        .language-badges img { height: 20px; border-radius: 3px; }
        .language-badges a:hover img { opacity: 0.8; }
    </style>
</head>
<body>
    <div class="header">
        <div class="links">
            GitHub Repository: <a href="https://github.com/cklwblove/go-deploy" id="githubRepoLink" target="_blank">cklwblove/go-deploy</a>
<h1 style="display: none;">Go-Deploy 部署工具 一个基于Go语言开发的自动化部署工具，支持通过SFTP协议将本地构建产物上传到远程服务器。 功能特性 ✅ 安全传输：使用SFTP协议，基于SSH加密传输 ✅ 目录同步：递归上传整个目录结构，保持文件层级 ✅ 智能创建：自动创建远程目录结构 ✅ 路径自适应：自动基于可执行文件位置计算本地路径...</h1>
        </div>
        <div class="language-badges" id="languageBadges">
            <!-- You can generate language badges here if needed -->
        </div>
    </div>
    <div class="main-container">
        <div class="markdown-body" id="content">
            <h1>Go-Deploy 部署工具</h1>
<p>一个基于Go语言开发的自动化部署工具，支持通过SFTP协议将本地构建产物上传到远程服务器。</p>
<h2>功能特性</h2>
<ul>
<li>✅ <strong>安全传输</strong>：使用SFTP协议，基于SSH加密传输</li>
<li>✅ <strong>目录同步</strong>：递归上传整个目录结构，保持文件层级</li>
<li>✅ <strong>智能创建</strong>：自动创建远程目录结构</li>
<li>✅ <strong>路径自适应</strong>：自动基于可执行文件位置计算本地路径，无需关心执行目录</li>
<li>✅ <strong>配置文件支持</strong>：支持JSON配置文件，便于管理不同环境的配置</li>
<li>✅ <strong>文件排除</strong>：支持通配符模式排除不需要上传的文件</li>
<li>✅ <strong>自动备份</strong>：上传前可自动备份远程文件</li>
<li>✅ <strong>重试机制</strong>：上传失败时自动重试，提高成功率</li>
<li>✅ <strong>详细统计</strong>：显示上传文件数、传输大小、耗时和速度</li>
<li>✅ <strong>进度显示</strong>：实时显示上传进度和文件信息</li>
<li>✅ <strong>错误处理</strong>：完善的错误处理和日志输出</li>
</ul>
<h2>系统要求</h2>
<ul>
<li>Go 1.18 或更高版本</li>
<li>目标服务器支持SSH/SFTP协议</li>
</ul>
<h2>安装说明</h2>
<h3>1. 克隆项目</h3>
<pre><code class="language-bash">git clone &lt;your-repo-url&gt;
cd go-deploy
</code></pre>
<h3>2. 初始化Go模块</h3>
<pre><code class="language-bash">go mod init go-deploy
go mod tidy
</code></pre>
<h3>3. 安装依赖</h3>
<p>程序会自动下载以下依赖：</p>
<ul>
<li><code>github.com/pkg/sftp</code> - SFTP客户端</li>
<li><code>golang.org/x/crypto/ssh</code> - SSH客户端</li>
</ul>
<h2>配置说明</h2>
<p>程序支持两种配置方式：</p>
<h3>1. 使用配置文件（推荐）</h3>
<p>将 <code>config.example.json</code> 复制为 <code>config.json</code> 并修改配置：</p>
<pre><code class="language-bash">cp config.example.json config.json
</code></pre>
<p>然后编辑 <code>config.json</code>：</p>
<pre><code class="language-json">{
  &quot;server&quot;: {
    &quot;host&quot;: &quot;your-server-ip&quot;,
    &quot;port&quot;: 22,
    &quot;username&quot;: &quot;your-username&quot;,
    &quot;password&quot;: &quot;your-password&quot;,
    &quot;timeout&quot;: 10
  },
  &quot;paths&quot;: {
    &quot;local&quot;: &quot;../../unpackage/dist/build/web&quot;,
    &quot;remote&quot;: &quot;/opt/your-path/dist&quot;
  },
  &quot;options&quot;: {
    &quot;backup&quot;: true,
    &quot;backup_suffix&quot;: &quot;.backup&quot;,
    &quot;exclude_patterns&quot;: [
      &quot;*.log&quot;,
      &quot;*.map&quot;,
      &quot;.DS_Store&quot;,
      &quot;node_modules&quot;
    ],
    &quot;max_retries&quot;: 3,
    &quot;chunk_size&quot;: 1048576
  }
}
</code></pre>
<h4>配置项说明</h4>
<p><strong>server 配置</strong>：</p>
<ul>
<li><code>host</code>: SSH服务器地址</li>
<li><code>port</code>: SSH端口，通常为22</li>
<li><code>username</code>: SSH用户名</li>
<li><code>password</code>: SSH密码（生产环境建议使用密钥认证）</li>
<li><code>timeout</code>: 连接超时时间（秒）</li>
</ul>
<p><strong>paths 配置</strong>：</p>
<ul>
<li><code>local</code>: 本地目录路径，支持相对路径和绝对路径</li>
<li><code>remote</code>: 远程目录路径，必须是绝对路径</li>
</ul>
<p><strong>options 配置</strong>：</p>
<ul>
<li><code>backup</code>: 是否在上传前创建备份远程已经存在的文件</li>
<li><code>backup_suffix</code>: 备份文件的后缀名，可自定义备份文件后缀，如果备份文件不存在则跳过备份</li>
<li><code>exclude_patterns</code>: 文件排除模式，支持通配符</li>
<li><code>max_retries</code>: 上传失败时的最大重试次数</li>
<li><code>chunk_size</code>: 文件传输块大小（字节，暂未实现）</li>
</ul>
<h3>2. 默认配置（兼容模式）</h3>
<p>如果没有 <code>config.json</code> 文件，程序会使用内置的默认配置，保持向后兼容。</p>
<h4>配置文件优先级</h4>
<ol>
<li><strong>命令行指定的配置文件</strong>：<code>--config</code> 参数指定的文件</li>
<li><strong>默认配置文件</strong>：当前目录下的 <code>config.json</code></li>
<li><strong>内置默认配置</strong>：如果以上都不存在，使用程序内置的配置</li>
</ol>
<h4>路径处理规则</h4>
<ul>
<li><p><strong>配置文件路径</strong>：</p>
<ul>
<li>相对路径：基于可执行文件所在目录</li>
<li>绝对路径：直接使用指定路径</li>
</ul>
</li>
<li><p><strong>本地目录路径</strong>：</p>
<ul>
<li>相对路径：基于可执行文件所在目录</li>
<li>绝对路径：直接使用指定路径</li>
</ul>
</li>
</ul>
<h2>运行说明</h2>
<h3>命令行参数</h3>
<p>程序支持以下命令行参数：</p>
<pre><code class="language-bash"># 显示帮助信息
./deploy --help

# 显示版本信息  
./deploy --version

# 使用默认配置文件 config.json
./deploy

# 使用指定配置文件
./deploy --config prod.json

# 使用绝对路径配置文件
./deploy --config /path/to/config.json
</code></pre>
<h3>开发环境运行</h3>
<pre><code class="language-bash"># 使用默认配置
go run main.go

# 使用指定配置文件
go run main.go --config test.json

# 显示帮助
go run main.go --help
</code></pre>
<h3>编译后运行</h3>
<pre><code class="language-bash"># 编译
go build -o deploy main.go

# 使用默认配置运行
./deploy

# 使用指定配置文件运行
./deploy --config prod.json
</code></pre>
<h2>打包说明</h2>
<h3>1. 本地平台打包</h3>
<pre><code class="language-bash"># 编译当前平台可执行文件
go build -o deploy main.go
</code></pre>
<h3>2. 跨平台打包</h3>
<h4>Linux 64位</h4>
<pre><code class="language-bash">GOOS=linux GOARCH=amd64 go build -o deploy-linux-amd64 main.go
</code></pre>
<h4>Windows 64位</h4>
<pre><code class="language-bash">GOOS=windows GOARCH=amd64 go build -o deploy-windows-amd64.exe main.go
</code></pre>
<h4>macOS 64位</h4>
<pre><code class="language-bash">GOOS=darwin GOARCH=amd64 go build -o deploy-darwin-amd64 main.go
</code></pre>
<h4>macOS ARM64 (M1/M2)</h4>
<pre><code class="language-bash">GOOS=darwin GOARCH=arm64 go build -o deploy-darwin-arm64 main.go
</code></pre>
<h3>3. 优化打包（减小文件大小）</h3>
<pre><code class="language-bash"># 去除调试信息和符号表
go build -ldflags=&quot;-s -w&quot; -o deploy main.go

# 使用UPX压缩（需要先安装UPX）
upx --best deploy
</code></pre>
<h3>4. 批量打包脚本</h3>
<p>创建 <code>build.sh</code> 脚本：</p>
<pre><code class="language-bash">#!/bin/bash

# 创建构建目录
mkdir -p builds

# 构建各平台版本
echo &quot;构建 Linux 64位版本...&quot;
GOOS=linux GOARCH=amd64 go build -ldflags=&quot;-s -w&quot; -o builds/deploy-linux-amd64 main.go

echo &quot;构建 Windows 64位版本...&quot;
GOOS=windows GOARCH=amd64 go build -ldflags=&quot;-s -w&quot; -o builds/deploy-windows-amd64.exe main.go

echo &quot;构建 macOS 64位版本...&quot;
GOOS=darwin GOARCH=amd64 go build -ldflags=&quot;-s -w&quot; -o builds/deploy-darwin-amd64 main.go

echo &quot;构建 macOS ARM64版本...&quot;
GOOS=darwin GOARCH=arm64 go build -ldflags=&quot;-s -w&quot; -o builds/deploy-darwin-arm64 main.go

echo &quot;构建完成！&quot;
ls -la builds/
</code></pre>
<p>运行脚本：</p>
<pre><code class="language-bash">chmod +x build.sh
./build.sh
</code></pre>
<h2>使用示例</h2>
<h3>显示帮助信息</h3>
<pre><code class="language-bash">$ ./deploy --help
Go-Deploy 部署工具

用法: ./deploy [选项]

选项:
  -config string
        配置文件路径 (default &quot;config.json&quot;)
  -help
        显示帮助信息
  -version
        显示版本信息

示例:
  ./deploy                           # 使用默认配置文件 config.json
  ./deploy --config prod.json        # 使用指定配置文件
  ./deploy --config /path/to/config.json  # 使用绝对路径配置文件
</code></pre>
<h3>使用指定配置文件</h3>
<pre><code class="language-bash">$ ./deploy --config prod.json
开始执行部署程序...
尝试读取配置文件: /path/to/go-deploy/prod.json
使用配置文件...
本地目录 /path/to/project/dist 存在
正在连接SSH服务器...
SSH服务器连接成功
...
</code></pre>
<h3>使用配置文件</h3>
<pre><code class="language-bash">$ ./deploy
开始执行部署程序...
尝试读取配置文件: /path/to/go-deploy/config.json
使用配置文件...
本地目录 /path/to/project/unpackage/dist/build/web 存在
正在连接SSH服务器...
SSH服务器连接成功
正在创建SFTP客户端...
SFTP客户端创建成功
准备上传到远程目录: /opt/xsoft/nginx/html/app/dist
开始上传目录...
开始遍历本地目录: /path/to/project/unpackage/dist/build/web
创建目录: /opt/xsoft/nginx/html/app/dist
文件 static/js/app.js.map 被排除，跳过上传
创建备份: /opt/xsoft/nginx/html/app/dist/index.html -&gt; /opt/xsoft/nginx/html/app/dist/index.html.backup
上传文件: /path/to/project/unpackage/dist/build/web/index.html -&gt; /opt/xsoft/nginx/html/app/dist/index.html
文件 .DS_Store 被排除，跳过上传
上传文件: /path/to/project/unpackage/dist/build/web/static/css/app.css -&gt; /opt/xsoft/nginx/html/app/dist/static/css/app.css
上传失败 (尝试 1/3): 网络错误
重试上传文件 (2/3): /path/to/project/unpackage/dist/build/web/static/js/app.js
上传文件: /path/to/project/unpackage/dist/build/web/static/js/app.js -&gt; /opt/xsoft/nginx/html/app/dist/static/js/app.js
...
目录上传成功!
统计信息:
  - 上传文件数: 485
  - 创建目录数: 18
  - 传输大小: 25.8 MB
  - 上传耗时: 38.5s
  - 总耗时: 39.2s
  - 传输速度: 0.67 MB/s
</code></pre>
<h2>注意事项</h2>
<ol>
<li><p><strong>安全性</strong>：</p>
<ul>
<li>生产环境建议使用SSH密钥认证而非密码认证</li>
<li>当前使用 <code>ssh.InsecureIgnoreHostKey()</code>，生产环境应验证主机密钥</li>
</ul>
</li>
<li><p><strong>网络</strong>：</p>
<ul>
<li>确保本地能够访问目标服务器的22端口</li>
<li>传输速度取决于网络带宽和服务器性能</li>
</ul>
</li>
<li><p><strong>权限</strong>：</p>
<ul>
<li>确保SSH用户对目标目录有写入权限</li>
<li>如需要，可能需要使用sudo权限</li>
</ul>
</li>
<li><p><strong>路径</strong>：</p>
<ul>
<li>本地路径自动基于可执行文件位置计算，无需关心执行目录</li>
<li>远程路径使用绝对路径</li>
</ul>
</li>
</ol>
<h2>故障排除</h2>
<h3>常见问题</h3>
<ol>
<li><p><strong>连接超时</strong></p>
<pre><code>连接SSH服务器失败: dial tcp: i/o timeout
</code></pre>
<ul>
<li>检查服务器地址和端口</li>
<li>确认网络连通性</li>
<li>检查防火墙设置</li>
</ul>
</li>
<li><p><strong>认证失败</strong></p>
<pre><code>登录失败: ssh: handshake failed
</code></pre>
<ul>
<li>检查用户名和密码</li>
<li>确认SSH服务已启动</li>
<li>检查SSH配置</li>
</ul>
</li>
<li><p><strong>权限错误</strong></p>
<pre><code>创建目录失败: permission denied
</code></pre>
<ul>
<li>检查用户对目标目录的写入权限</li>
<li>可能需要使用sudo或更改目录所有者</li>
</ul>
</li>
<li><p><strong>本地目录不存在</strong></p>
<pre><code>错误: 本地目录 /path/to/unpackage/dist/build/web 不存在
</code></pre>
<ul>
<li>确认本地构建已完成</li>
<li>检查项目目录结构是否正确</li>
<li>程序会自动计算路径，无需手动调整工作目录</li>
</ul>
</li>
</ol>
<h2>开发说明</h2>
<h3>项目结构</h3>
<pre><code>go-deploy/
├── main.go                 # 主程序文件
├── go.mod                  # Go模块文件  
├── go.sum                  # 依赖校验文件
</code></pre>
<p>├── README.md               # 详细说明文档<br />
├── Makefile                # 构建工具<br />
├── build.sh                # 批量打包脚本<br />
├── install.sh              # 一键安装脚本<br />
└── config.example.json     # 配置文件示例</p>
<pre><code>
### 主要函数

- `main()` - 主函数，处理连接和调用上传
- `uploadDirectory()` - 递归上传目录
- `uploadFile()` - 上传单个文件
- `mkdirAll()` - 递归创建远程目录

## 许可证

MIT 许可证

## 贡献

欢迎提交 Issue 和 Pull Request！



---


Tranlated By [Open Ai Tx](https://github.com/OpenAiTx/OpenAiTx) | Last indexed: 2025-06-19


---
</code></pre>

        </div>
    </div>
    <footer class="footer">
        Powered by <a href="https://github.com/OpenAiTx/OpenAiTx" target="_blank">Open AI Tx</a>
    </footer>
    <!-- Statcounter and other scripts can be added here -->
</body>
</html>