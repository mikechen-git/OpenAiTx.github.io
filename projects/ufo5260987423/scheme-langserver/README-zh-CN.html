<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>scheme-langserver - ufo5260987423/scheme-langserver zh-CN</title>
    <meta name="title" content="scheme-langserver - ufo5260987423/scheme-langserver zh-CN | Scheme-langserver 你可以阅读我的论文并按如下方式引用 WANG, Z. (2025, May 12). Scheme-langserver: Treat Scheme Code Editing as the First-Class Concern. The 18th European Lisp Sym...">
    <meta name="description" content="ufo5260987423/scheme-langserver - GitHub repository zh-CN documentation and information | Scheme-langserver 你可以阅读我的论文并按如下方式引用 WANG, Z. (2025, May 12). Scheme-langserver: Treat Scheme Code Editing as the First-Class Concern. The 18th European Lisp Sym...">
    <meta name="keywords" content="ufo5260987423, scheme-langserver, GitHub, repository, zh-CN documentation">
    <meta name="author" content="Open AI Tx">
    <meta name="robots" content="index, follow">
    <meta property="og:type" content="website">
    <meta property="og:url" content="https://openaitx.github.io/projects/ufo5260987423/scheme-langserver/README-zh-CN.html">
    <meta property="og:title" content="scheme-langserver - ufo5260987423/scheme-langserver zh-CN | Scheme-langserver 你可以阅读我的论文并按如下方式引用 WANG, Z. (2025, May 12). Scheme-langserver: Treat Scheme Code Editing as the First-Class Concern. The 18th European Lisp Sym...">
    <meta property="og:description" content="ufo5260987423/scheme-langserver - GitHub repository zh-CN documentation and information | Scheme-langserver 你可以阅读我的论文并按如下方式引用 WANG, Z. (2025, May 12). Scheme-langserver: Treat Scheme Code Editing as the First-Class Concern. The 18th European Lisp Sym...">
    <meta property="og:image" content="https://openaitx.github.io/logo_crop.png">
    <link rel="icon" type="image/jpeg" href="/icon.jpg">
    <link rel="apple-touch-icon" href="/icon.jpg">
    <script src="/js/marked.min.js?v=20250613"></script>
    <link rel="stylesheet" href="/css/github.min.css?v=20250613">
    <script src="/js/highlight.min.js?v=20250613"></script>
    <link rel="stylesheet" href="/view.css?v=20250613">
    <style>
        body { display: flex; flex-direction: column; min-height: 100vh; }
        .main-container { margin: 0 auto; width: 100%; max-width: 980px; padding: 0 20px; }
        @media (max-width: 768px) { .main-container { padding: 0 15px; } }
        .markdown-body img { max-width: 100%; height: auto; }
        .header { text-align: center; margin-bottom: 30px; padding: 20px; background-color: #f6f8fa; border-bottom: 1px solid #e1e4e8; position: relative; }
        .header .links { margin-top: 10px; font-size: 16px; }
        .header .links a { color: #0366d6; text-decoration: none; margin-left: 5px; }
        .header .links a:hover { text-decoration: underline; }
        .language-badges { margin-top: 15px; text-align: center; }
        .language-badges a { display: inline-block; margin: 2px; text-decoration: none; }
        .language-badges img { height: 20px; border-radius: 3px; }
        .language-badges a:hover img { opacity: 0.8; }
    </style>
</head>
<body>
    <div style="position: fixed; top: 2px; left: 2px; z-index: 2000; background: rgba(255,255,255,0.95); border-radius: 6px; box-shadow: 0 2px 8px rgba(0,0,0,0.06); padding: 4px 14px; font-size: 15px; color: #222; font-family: 'Segoe UI', Arial, sans-serif; font-weight: 500; letter-spacing: 0.5px;">
        Powered by <a href="https://github.com/OpenAiTx/OpenAiTx" target="_blank" style="color: #0366d6; text-decoration: none; font-weight: 600;">Open AI Tx</a>
    </div>
    <div class="header">
        <div class="links">
            GitHub Repository: <a href="https://github.com/ufo5260987423/scheme-langserver" id="githubRepoLink" target="_blank">ufo5260987423/scheme-langserver</a>
<h1 style="display: none;">Scheme-langserver 你可以阅读我的论文并按如下方式引用 WANG, Z. (2025, May 12). Scheme-langserver: Treat Scheme Code Editing as the First-Class Concern. The 18th European Lisp Sym...</h1>
        </div>
        <div class="language-badges" id="languageBadges">
            <!-- You can generate language badges here if needed -->
        </div>
    </div>
    <div class="main-container">
        <div class="markdown-body" id="content">
            <p><img src="https://raw.githubusercontent.com/ufo5260987423/scheme-langserver/main/./doc/figure/logo-no-background.png" alt="" /></p>
<h1>Scheme-langserver</h1>
<p><a href="https://deepwiki.com/ufo5260987423/scheme-langserver"><img src="https://deepwiki.com/badge.svg" alt="Ask DeepWiki" /></a></p>
<p>你可以阅读我的<a href="https://raw.githubusercontent.com/ufo5260987423/scheme-langserver/main/./doc/paper.pdf">论文</a>并按如下方式引用</p>
<blockquote>
<p>WANG, Z. (2025, May 12). Scheme-langserver: Treat Scheme Code Editing as the First-Class Concern. The 18th European Lisp Symposium (ELS`25), Zurich. https://doi.org/10.5281/zenodo.15384882</p>
</blockquote>
<p>由于 GitHub 可能会屏蔽中国大陆的 IP 地址，我不得不将此仓库复制到<a href="https://codeberg.org/ufo5260987423/scheme-langserver">这里</a>和<a href="https://gitee.com/ufo5260987423/scheme-langserver">这里</a>。我会持续更新所有仓库，但无法保证。同时我也与<a href="https://github.com/XmacsLabs">XmacsLabs</a>合作，你也可以在<a href="https://github.com/XmacsLabs/scheme-langserver">这里</a>找到一个分支。</p>
<p><video src="https://github.com/user-attachments/assets/893bba98-6709-4fac-a4d3-dc7b6aab46fb" controls="controls" width="500" height="300"></video></p>
<p><strong>现在，VSCode 可以使用 scheme-langserver 了！</strong> 请参见<a href="https://raw.githubusercontent.com/ufo5260987423/scheme-langserver/main/./doc/startup.md">此处</a>。</p>
<blockquote>
<p>注意：scheme-langserver 还有很多很多 bug。我正在修复中，并寻求社区的帮助。请耐心等待。</p>
</blockquote>
<blockquote>
<p>注意：你可以在<a href="https://ufo5260987423.github.io/scheme-langserver/doc/analysis/type-inference-result">这里</a>找到自动生成的类型信息。它目前主要用于下一阶段开发（也许包括 AKKU）和调试。</p>
</blockquote>
<p>实现诸如自动补全、跳转定义或悬停文档等支持功能，对于编程来说是一项重大工作。然而，与 java、python、javascript 和 c 等其他语言相比，针对 lisp 语言的语言服务器协议实现几乎处于真空状态。<a href="https://gitlab.com/emacs-geiser">Geiser</a>、<a href="https://github.com/jeapostrophe/racket-langserver">racket langserver</a> 以及 <a href="https://github.com/becls/swish-lint">swish-lint</a> 等等，它们的实现都基于 <code>repl</code>（读-求值-输出循环）或关键字分词器，而不是编程。例如，如果程序员正在一个未完成的项目中编写代码，代码尚未完全可执行，<a href="https://gitlab.com/emacs-geiser">Geiser</a> 或其他工具只能补全由 <code>environment-symbols</code> 过程（对于 <a href="https://cisco.github.io/ChezScheme/">Chez</a>）列出的顶层绑定标识符，或者补全符号而不是标识符。这意味着对于局部绑定和未完成的代码，尽管编程本应是最重要的，<a href="https://gitlab.com/emacs-geiser">Geiser</a> 及其同类工具在识别标识符的有效作用域方面毫无帮助。类似的情况也出现在跳转定义和许多其他功能上。</p>
<p>主要原因是，对于 scheme 和其他 lisp 方言来说，其丰富的数据集和灵活的控制结构使得程序分析面临巨大挑战。尤其是宏，好像 scheme 主要是为天才和元/宏编程而用。但我认为不是这样。如果有更好的编程环境，Scheme 也可以实现许多有趣的功能。现在你可以<a href="https://raw.githubusercontent.com/ufo5260987423/scheme-langserver/main/./doc/startup.md"><strong>从这里开始</strong></a>。</p>
<p>本包是一个帮助 scheme 编程的语言服务器协议实现。它提供补全、定义和类型推断功能。这些功能基于<a href="http://www.r6rs.org/">r6rs 标准</a>和一些针对未完成代码的显式规则进行静态代码分析建立。此包及相关库已经或将要通过 <a href="https://akkuscm.org/">Akku</a> 发布，Akku 是 Scheme 的包管理器。</p>
<p>本包也已在 <a href="https://cisco.github.io/ChezScheme/">Chez Scheme</a> 9.4 和 9.5 版本中测试过。将在我的笔记本操作系统升级后，对 10.0.0 版本做详细测试。</p>
<p>我只是业余时间做这个开源项目，我能为社区贡献许多精彩的想法，比如将数据流分析嵌入 scheme-langserver 或其它很多内容。同时我也在不断寻求更多的捐助或资助。你可以通过<a href="https://www.patreon.com/PoorProgrammer/membership">这个 patreon 页面</a>或<a href="https://afdian.com/a/ufo5260987423">爱发电</a>进行捐赠。</p>
<h2>编译、安装与配置请见<a href="https://raw.githubusercontent.com/ufo5260987423/scheme-langserver/main/./doc/startup.md">这里</a></h2>
<h2>最近状态</h2>
<p>我会持续修复 bug，对代码进行性能分析，并为我的自制类型推断系统巨著收集资料。这将耗时约一年。后续开发包括 <a href="https://code.visualstudio.com/">VScode</a> 插件和数据流分析。但实际上，我现在将这个开源工作当作兼职，无法保证进度。</p>
<h2>发行说明</h2>
<p>1.2.9 现在，体验类型推断功能！</p>
<p>以往的发布信息请参见<a href="https://raw.githubusercontent.com/ufo5260987423/scheme-langserver/main/./doc/release-log.md">此文件</a>。</p>
<h3>功能特性</h3>
<ol>
<li>顶层和局部标识符绑定补全。
<img src="https://raw.githubusercontent.com/ufo5260987423/scheme-langserver/main/./doc/figure/auto-completion.png" alt="顶层和局部标识符绑定" title="Top-level and local identifiers binding" /></li>
<li>跳转定义。
<img src="https://raw.githubusercontent.com/ufo5260987423/scheme-langserver/main/./doc/figure/definition.png" alt="使用 telescope.nvim 跳转定义" title="Goto Definition with telescope.nvim" /></li>
<li>兼容包管理器：Akku。</li>
<li>文件变动同步与相应索引变更。</li>
<li>悬停功能。</li>
<li>引用和文档高亮（文档范围内的引用）。
<img src="https://raw.githubusercontent.com/ufo5260987423/scheme-langserver/main/./doc/figure/find-references.png" alt="使用 telescope.nvim 查找引用" title="Find references with telescope.nvim" /></li>
<li>文档符号。
<img src="https://raw.githubusercontent.com/ufo5260987423/scheme-langserver/main/./doc/figure/document-symbol.png" alt="使用 telescope.nvim 查找文档符号" title="find document symbols with telescope.nvim" /></li>
<li>捕获 *-syntax（define-syntax, let-syntax 等）形式的局部标识符绑定。</li>
<li>跨平台并行索引。</li>
<li>自制源码注释器以兼容 .sps 文件。</li>
<li>API 请求的窥孔优化和可挂起任务。</li>
<li>类型推断，基于自制 DSL 解释器（我为此非常自豪！）。现在类型推断已经集成进自动补全。如下图所示，类型为 &quot;integer?&quot; 的 &quot;length-b&quot; 和 &quot;length-a&quot; 会优先出现在推荐选项中，因为它们能匹配 &quot;&lt;=&quot; 所需的参数类型。
<img src="https://raw.githubusercontent.com/ufo5260987423/scheme-langserver/main/./doc/figure/auto-completion-with-type-inference.png" alt="带类型推断的自动补全" title="Autocompletion with type inference" />
一个测试可以证明该结果，只需运行 <code>scheme --script tests/protocol/apis/test-completion.sps</code>，日志文件 <code>scheme-langserver.log</code> 会包含如下内容：</li>
</ol>
<pre><code class="language-bash">send-message
2023 11 21 11 26 41 967266866
{&quot;jsonrpc&quot;:&quot;2.0&quot;,&quot;id&quot;:&quot;3&quot;,&quot;result&quot;:[{&quot;label&quot;:&quot;length-a&quot;},{&quot;label&quot;:&quot;length-b&quot;},{&quot;label&quot;:&quot;lambda&quot;},{&quot;label&quot;:&quot;latin-1-codec&quot;},{&quot;label&quot;:&quot;lcm&quot;},{&quot;label&quot;:&quot;least-fixnum&quot;},{&quot;label&quot;:&quot;length&quot;},{&quot;label&quot;:&quot;let&quot;},{&quot;label&quot;:&quot;let*&quot;},{&quot;label&quot;:&quot;let*-values&quot;},{&quot;label&quot;:&quot;let-syntax&quot;},{&quot;label&quot;:&quot;let-values&quot;},{&quot;label&quot;:&quot;letrec&quot;},{&quot;label&quot;:&quot;letrec*&quot;},{&quot;label&quot;:&quot;letrec-syntax&quot;},{&quot;label&quot;:&quot;lexical-violation?&quot;},{&quot;label&quot;:&quot;list&quot;},{&quot;label&quot;:&quot;list-&gt;string&quot;},{&quot;label&quot;:&quot;list-&gt;vector&quot;},{&quot;label&quot;:&quot;list-ref&quot;},{&quot;label&quot;:&quot;list-sort&quot;},{&quot;label&quot;:&quot;list-tail&quot;},{&quot;label&quot;:&quot;list?&quot;},{&quot;label&quot;:&quot;log&quot;},{&quot;label&quot;:&quot;lookahead-char&quot;},{&quot;label&quot;:&quot;lookahead-u8&quot;}]}
</code></pre>
<ol start="13">
<li>跨 scm、ss、sps、sls、sld 文件扩展名的标识符捕获抽象解释器。</li>
</ol>
<h3>待办事项</h3>
<ol start="14">
<li>重命名功能。</li>
<li>完全兼容 <a href="http://www.r6rs.org/">r6rs 标准</a>。</li>
<li>步进式宏展开器：实际上，我已经实现了一个，我想用它作为捕获自定义宏标识符绑定的关键步骤。但现在我发现这种捕获比我想象的难得多，而且这个展开器我也不知道它能用在哪里。</li>
<li>代码求值。</li>
<li>代码诊断。</li>
<li>增加跨语言语义支持。嗯，java、c、python 及许多其他语言是否可以通过 AST 转换器支持？</li>
<li>抽取表达式/语句为过程。</li>
</ol>
<h2>TODO: 贡献指南</h2>
<h2>调试</h2>
<h3>如何调试</h3>
<p>https://www.scheme.com/debug/debug.html#g1</p>
<h3>输出日志</h3>
<p>按照 <a href="#building">编译</a>、<a href="#installation-for-lunarvim">Lunar Vim 安装</a> 和 <a href="#todo-installation-for-vscode">VScode 安装</a> 的提示，如果有人想开发和记录日志，可以添加 <code>path-to-log-file</code> 并重写文件 <code>~/.local/share/lunarvim/site/pack/packer/start/nvim-lspconfig/lua/lspconfig/server_configurations/scheme_langserver.lua</code> 如下：</p>
<pre><code class="language-lua">local util = require 'lspconfig.util'
local bin_name = '{path-to-run}'
local cmd = { bin_name ,&quot;path-to-log-file&quot;}

return {
  default_config = {
    cmd = cmd,
    filetypes = { 'scheme' },
    root_dir = util.find_git_ancestor,
    single_file_support = true,
  },
  docs = {
    description = [[
https://github.com/ufo5260987423/scheme-langserver
`scheme-langserver`, a language server protocol implementation for scheme
]]   ,
  },
</code></pre>
<pre><code>### 使用日志进行复现
通过上述的[输出日志](#output-log)，你可以使用 `tests/log-debug.sps` 来复现 bug：
1. 将 `{path-to-log}`（通常为 `~/scheme-langserver.log`）重命名为 `~/ready-for-analyse.log`；
2. 运行 `scheme --script tests/log-debug.sps`。如果你想复现多线程环境，也可以运行 `scheme --script tests/log-debug.sps`。

## 测试
几乎所有关键过程和 API 都经过了测试。我的工作虽然粗糙但很有用，也许你会想在 `tests` 目录下找到我完成的内容，或者直接在 `{scheme-langserver-root-directory}` 下运行如下命令：
``` bash
bash test.sh
</code></pre>
<blockquote>
<p>注意
在多线程环境下进行测试很难。因此，目前的测试主要集中在单线程环境下。</p>
</blockquote>
<h2>将 Scheme-langserver 用于其他目的</h2>
<h3>GIMP 中的 Script-Fu</h3>
<p>Script-Fu 基于一种解释型语言 Scheme，可以通过使用与 GIMP 内部函数交互的函数来工作。以<a href="https://dalelane.co.uk/blog/?p=628">此页面</a>的脚本为例，你可以将 scheme-langserver 应用于扩展名为 &quot;SCM&quot; 的脚本文件。</p>
<h3>其他</h3>
<p>嗯，我对 <a href="https://opusmodus.com/">OMN (Opusmodus Notation)</a> 和 AutoLisp 也很感兴趣。但我还有许多事情要做。</p>
<h2>代码统计</h2>
<pre><code class="language-bash">find . -name &quot;*.sls&quot; ! -path &quot;./.akku/*&quot; |xargs wc -l
</code></pre>
<h2>详细文档</h2>
<ol>
<li><a href="https://raw.githubusercontent.com/ufo5260987423/scheme-langserver/main/./doc/paper.pdf">Scheme-langserver: 将 Scheme 代码编辑作为首要关注点</a>。</li>
<li><a href="https://raw.githubusercontent.com/ufo5260987423/scheme-langserver/main/./doc/analysis/identifier.md">捕获标识符绑定</a></li>
<li><a href="https://raw.githubusercontent.com/ufo5260987423/scheme-langserver/main/./doc/util/synchronize.md">同步机制</a></li>
<li><a href="https://raw.githubusercontent.com/ufo5260987423/scheme-langserver/main/./doc/analysis/type-inference.md">类型推断</a>，~~<a href="https://raw.githubusercontent.com/ufo5260987423/scheme-langserver/main/./doc/analysis/type-inference.cn.md">类型推断（中文）</a>~~（已废弃，正在为其编写中文书籍）</li>
<li><a href="https://raw.githubusercontent.com/ufo5260987423/scheme-langserver/main/./doc/protocol/analysis.md">API 分析</a></li>
<li><a href="https://deepwiki.com/ufo5260987423/scheme-langserver">Deepwiki</a></li>
</ol>
<h2>Star 历史</h2>
<p><a href="https://star-history.com/#ufo5260987423/scheme-langserver"><img src="https://api.star-history.com/svg?repos=ufo5260987423/scheme-langserver&amp;type=Date" alt="Star History Chart" /></a></p>
<h2>贡献者</h2>
<p><img src="https://contrib.rocks/image?repo=ufo5260987423/scheme-langserver" alt="Contributors" /></p>
<pre><code>

---


Tranlated By [Open Ai Tx](https://github.com/OpenAiTx/OpenAiTx) | Last indexed: 2025-07-01


---
</code></pre>

        </div>
    </div>
    <footer class="footer">
        Powered by <a href="https://github.com/OpenAiTx/OpenAiTx" target="_blank">Open AI Tx</a>
    </footer>
    <!-- Default Statcounter code for openaitx
https://openaitx.github.io/ -->
    <script type="text/javascript">
        var sc_project = 13142514;
        var sc_invisible = 1;
        var sc_security = "d03a31d8"; 
    </script>
    <script type="text/javascript" src="https://www.statcounter.com/counter/counter.js" async></script>
    <noscript>
        <div class="statcounter"><a title="Web Analytics" href="https://statcounter.com/" target="_blank"><img
                    class="statcounter" src="https://c.statcounter.com/13142514/0/d03a31d8/1/" alt="Web Analytics"
                    referrerPolicy="no-referrer-when-downgrade"></a></div>
    </noscript>
    <!-- End of Statcounter Code -->
</body>
</html>